window.__require=function t(e,i,o){function a(r,s){if(!i[r]){if(!e[r]){var l=r.split("/");if(l=l[l.length-1],!e[l]){var c="function"==typeof __require&&__require;if(!s&&c)return c(l,!0);if(n)return n(l,!0);throw new Error("Cannot find module '"+r+"'")}r=l}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){return a(e[r][1][t]||t)},u,u.exports,t,e,i,o)}return i[r].exports}for(var n="function"==typeof __require&&__require,r=0;r<o.length;r++)a(o[r]);return a}({AchievementData:[function(t,e,i){"use strict";cc._RF.push(e,"6a835W88Z5L36Zxiky/P1I6","AchievementData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.index=0,this.monsters={},this.items={},this.equips={},this.npcs={},this.maps={},this.challenges={},this.furnitures={},this.playerLifes=0}return t.prototype.valueCopy=function(t){t&&(this.index=t.index?t.index:0,this.monsters=t.monsters?t.monsters:{},this.items=t.items?t.items:{},this.equips=t.equips?t.equips:{},this.npcs=t.npcs?t.npcs:{},this.maps=t.maps?t.maps:{},this.challenges=t.challenges?t.challenges:{},this.furnitures=t.furnitures?t.furnitures:{},this.playerLifes=t.playerLifes?t.playerLifes:0)},t}();i.default=o,cc._RF.pop()},{}],AchievementItemDialog:[function(t,e,i){"use strict";cc._RF.push(e,"96567VnqW1J7rI4r4v/kGbc","AchievementItemDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../../manager/EquipmentManager"),s=t("../../utils/AudioPlayer"),l=t("./BaseDialog"),c=t("./EquipmentAndItemDialog"),u=cc._decorator,h=u.ccclass,d=u.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.equipmentAndItemDialogPrefab=null,e.equipmentAndItemDialog=null,e.icon=null,e}return a(e,t),e.prototype.onLoad=function(){this.equipmentAndItemDialog=this.initDialog()},e.prototype.initDialog=function(){var t=cc.instantiate(this.equipmentAndItemDialogPrefab);t.parent=this.node;var e=t.getComponent(c.default);return e.changeBgAndAnchor(c.default.BG_TYPE_NONE),e.hideDialog(),e},e.prototype.start=function(){},e.prototype.show=function(e,i,o,a,n){t.prototype.show.call(this),n&&(this.icon.spriteFrame=n,this.icon.node.width=160,this.icon.node.height=160/n.getOriginalSize().width*n.getOriginalSize().height),o&&(o=r.default.getOriginEquipData(o.img)),this.equipmentAndItemDialog.showDialog(cc.v3(80,150),e,i,o,a)},e.prototype.close=function(){s.default.play(s.default.SELECT),this.dismiss()},n([d(cc.Prefab)],e.prototype,"equipmentAndItemDialogPrefab",void 0),n([d(cc.Sprite)],e.prototype,"icon",void 0),n([h],e)}(l.default);i.default=p,cc._RF.pop()},{"../../manager/EquipmentManager":"EquipmentManager","../../utils/AudioPlayer":"AudioPlayer","./BaseDialog":"BaseDialog","./EquipmentAndItemDialog":"EquipmentAndItemDialog"}],AchievementItem:[function(t,e,i){"use strict";cc._RF.push(e,"769e5+ojuhFiYvxDanjxQKn","AchievementItem");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../utils/AudioPlayer"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isSelect=!1,e.labelBg=null,e.sprite=null,e.label=null,e.index=0,e.parentIndex=0,e.count=0,e.spriteFrame=null,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_START,function(){},this),this.node.on(cc.Node.EventType.TOUCH_END,function(){t.node&&t.count>0?(r.default.play(r.default.SELECT),t.achievements.achievementItemDialog.show(t.nonPlayerData,t.itemData,t.equipData,t.furnitureData,t.sprite.spriteFrame)):r.default.play(r.default.SELECT_FAIL)},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){},this)},e.prototype.init=function(t,e,i,o,a,n,r,s,l){this.nonPlayerData=n,this.itemData=r,this.equipData=s,this.furnitureData=l,this.achievements=t,this.parentIndex=e,this.index=i,this.count=o,this.spriteFrame=a,this.isSelect=!1,this.updateData()},e.prototype.updateData=function(){if(this.isSelect=!1,this.label.string="",this.sprite.spriteFrame=null,this.spriteFrame){this.sprite.spriteFrame=this.spriteFrame;var t=this.spriteFrame.getOriginalSize().width,e=this.spriteFrame.getOriginalSize().height;this.sprite.node.width=4*t,this.sprite.node.height=4*e,this.sprite.node.height>96&&(this.sprite.node.height=96,this.sprite.node.width=96/this.spriteFrame.getOriginalSize().height*this.spriteFrame.getOriginalSize().width);var o=4;e>96&&(o=.5),this.mat||(this.mat=this.sprite.getMaterial(0)),this.mat.setProperty("textureSizeWidth",this.spriteFrame.getTexture().width*o),this.mat.setProperty("textureSizeHeight",this.spriteFrame.getTexture().height*o),this.mat.setProperty("outlineColor",cc.color(200,200,200)),this.mat.setProperty("blackBg",this.count>0?0:1),this.mat.setProperty("openOutline",this.count>0?0:1)}if(this.count>0){var a=this.count%20;this.count>100&&(a=20);for(var n="",r=0;r<a;r+=4)n+="\u2605";this.label.string=n;var s=Math.floor(this.count/20);s>i.COLORS.length-1&&(s=i.COLORS.length-1),this.label.node.color=cc.Color.WHITE.fromHEX(i.COLORS[s])}},e.prototype.setEmpty=function(){this.label.string="",this.sprite.spriteFrame=null},e.prototype.start=function(){},e.TYPE_EMPTY=0,e.TYPE_CHALLENGE=1,e.TYPE_MAP=2,e.TYPE_FURNITURE=3,e.TYPE_NPC=4,e.TYPE_BOSS=5,e.TYPE_MONSTER=6,e.TYPE_EQUIP=7,e.TYPE_ITEM=8,e.COLORS=["#ffffff","#00ff00","#0000ff","#800080","#ffa500"],n([c(cc.Node)],e.prototype,"labelBg",void 0),n([c(cc.Sprite)],e.prototype,"sprite",void 0),n([c(cc.Label)],e.prototype,"label",void 0),i=n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../utils/AudioPlayer":"AudioPlayer"}],Achievement:[function(t,e,i){"use strict";cc._RF.push(e,"5607byYvNBEQ4yBaPsgf0sF","Achievement");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/EquipmentData"),s=t("../data/FurnitureData"),l=t("../data/ItemData"),c=t("../data/NonPlayerData"),u=t("./Logic"),h=t("../manager/InventoryManager"),d=t("../manager/LoadingManager"),p=t("../ui/AchievementItem"),f=t("../ui/dialog/AchievementItemDialog"),g=t("../utils/AudioPlayer"),y=t("../utils/LocalStorage"),m=t("../ui/LoadingIcon"),v=cc._decorator,E=v.ccclass,_=v.property,T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.contentBg=null,e.contentSprite=null,e.contentLabelBg=null,e.contentLabel=null,e.prefab=null,e.lifesLabel=null,e.coinLabel=null,e.goldLabel=null,e.loadingBackground=null,e.achievementItemDialog=null,e.bossSpriteFrames=null,e.isBossLoaded=!1,e.currentListIndex=0,e.currentItemIndex=-1,e.loadingManager=new d.default,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){if(this.loadingManager.init(),this.removeContent(),this.data=y.default.getAchievementData(),this.lifesLabel&&this.data.playerLifes&&(this.lifesLabel.string="DIED "+this.data.playerLifes),this.coinLabel){var t=y.default.getValueFromData(y.default.KEY_COIN);this.coinLabel.string=""+(t?parseInt(t):0)}this.achievementItemDialog&&(this.achievementItemDialog.node.active=!1)},e.prototype.start=function(){this.loadingManager.loadEquipment(),this.loadingManager.loadAutoSpriteFrames(),this.loadingManager.loadSpriteAtlas(d.default.KEY_TEXTURES,"singleColor"),this.loadingManager.loadSpriteAtlas(d.default.KEY_ITEM,"ammo"),this.loadingManager.loadSpriteAtlas(d.default.KEY_EQUIPMENT,"emptyequipment"),this.loadingManager.loadSpriteAtlas(d.default.KEY_NPC,"npcshadow"),this.loadingManager.loadMonsters(),this.loadingManager.loadItems(),this.loadingManager.loadNonplayer(),this.loadingManager.loadSuits(),this.loadingManager.loadFurnitures(),this.loadBossSpriteFrames(),this.loadingBackground.active=!0},e.prototype.removeContent=function(){this.contentBg.removeAllChildren(),this.contentSprite.removeAllChildren(),this.contentLabelBg.removeAllChildren(),this.contentLabel.removeAllChildren()},e.prototype.addItem=function(t){this.contentBg.addChild(t.node)},e.prototype.changeList=function(t,e){var o=this;switch(this.currentListIndex=parseInt(e),this.unscheduleAllCallbacks(),this.currentListIndex){case i.TYPE_CHALLENGE:case i.TYPE_MAP:this.removeContent();break;case i.TYPE_FURNITURE:this.showFurnitureList();break;case i.TYPE_NPC:this.showNpcList();break;case i.TYPE_BOSS:this.showBossList();break;case i.TYPE_MONSTER:this.showMonsterList();break;case i.TYPE_EQUIP:this.showEquipList();break;case i.TYPE_ITEM:this.showItemList()}this.scheduleOnce(function(){for(var t=0,e=o.contentLabelBg.children;t<e.length;t++){var i=e[t].getComponent(p.default),a=o.contentSprite.convertToNodeSpaceAR(i.sprite.node.convertToWorldSpaceAR(cc.Vec3.ZERO)),n=o.contentLabelBg.convertToNodeSpaceAR(i.labelBg.convertToWorldSpaceAR(cc.Vec3.ZERO)),r=o.contentLabel.convertToNodeSpaceAR(i.label.node.convertToWorldSpaceAR(cc.Vec3.ZERO));i.sprite.node.parent=o.contentSprite,i.labelBg.parent=o.contentLabelBg,i.label.node.parent=o.contentLabel,i.sprite.node.position=a,i.labelBg.position=n,i.label.node.position=r}},.1)},e.prototype.showMonsterList=function(){var t=this;this.removeContent();var e=0,i=function(i){d.default.loadNpcSpriteAtlas(i,function(){var o=new c.default;o.valueCopy(u.default.monsters[i]);var a=cc.instantiate(t.prefab).getComponent(p.default);a.init(t,t.currentListIndex,e++,t.data.monsters[o.resName],u.default.spriteFrameRes(o.resName+"anim000"),o,null,null,null),t.addItem(a)})};for(var o in u.default.monsters)i(o)},e.prototype.showBossList=function(){this.removeContent();for(var t=0;t<i.BOSS_SIZE;t++){var e=cc.instantiate(this.prefab).getComponent(p.default);e.init(this,this.currentListIndex,t,this.data.monsters["iconboss00"+t],this.bossSpriteFrames["iconboss00"+t],null,null,null,null),this.addItem(e)}},e.prototype.showNpcList=function(){this.removeContent();var t=0;for(var e in u.default.nonplayers){var i=new c.default;i.valueCopy(u.default.nonplayers[e]);var o=cc.instantiate(this.prefab).getComponent(p.default);o.init(this,this.currentListIndex,t++,this.data.npcs[i.resName],u.default.spriteFrameRes(i.resName+"anim000"),i,null,null,null),this.addItem(o)}},e.prototype.showItemList=function(){this.removeContent();var t=0;for(var e in u.default.items){var i=new l.default;i.valueCopy(u.default.items[e]);var o=cc.instantiate(this.prefab).getComponent(p.default);o.init(this,this.currentListIndex,t++,this.data.items[i.resName],u.default.spriteFrameRes(i.resName),null,i,null,null),t>5&&this.addItem(o)}},e.prototype.showEquipList=function(){this.removeContent();var t=0;for(var e in u.default.equipments){var i=new r.default;i.valueCopy(u.default.equipments[e]);var o=cc.instantiate(this.prefab).getComponent(p.default),a=u.default.spriteFrameRes(i.img);i.equipmetType==h.default.CLOTHES?a=u.default.spriteFrameRes(i.img+"anim0"):i.equipmetType==h.default.HELMET?a=u.default.spriteFrameRes(i.img+"anim0"):i.equipmetType==h.default.REMOTE&&(a=u.default.spriteFrameRes(i.img+"anim0")),o.init(this,this.currentListIndex,t++,this.data.equips[i.img],a,null,null,i,null),t>1&&this.addItem(o)}},e.prototype.showFurnitureList=function(){this.removeContent();var t=0;for(var e in u.default.furnitures){var i=new s.default;i.valueCopy(u.default.furnitures[e]);var o=cc.instantiate(this.prefab).getComponent(p.default);o.init(this,this.currentListIndex,t++,this.data.furnitures[i.id],u.default.spriteFrameRes(i.resName),null,null,null,i),this.addItem(o)}},e.prototype.show=function(){var t=this,e=this.loadingBackground.getComponentInChildren(m.default);e&&e.isFirst?cc.tween(this.loadingBackground).to(.5,{opacity:0}).call(function(){t.loadingBackground.active=!1}).start():this.loadingBackground.active=!1,this.changeList(null,"0")},e.prototype.loadBossSpriteFrames=function(){var t=this;this.bossSpriteFrames?this.isBossLoaded=!0:cc.resources.load("OtherTexture/bossicons",cc.SpriteAtlas,function(e,i){t.bossSpriteFrames={};for(var o=0,a=i.getSpriteFrames();o<a.length;o++){var n=a[o];t.bossSpriteFrames[n.name]=n}t.isBossLoaded=!0,cc.log("bossicons spriteatlas loaded")})},e.prototype.backToHome=function(){cc.director.loadScene("start"),g.default.play(g.default.SELECT)},e.addMonsterKillAchievement=function(t){var e=y.default.getAchievementData();e.monsters[t]?(e.monsters[t]=e.monsters[t]+1,e.monsters[t]>9999&&(e.monsters[t]=9999)):e.monsters[t]=1,y.default.saveAchievementData(e)},e.addPlayerDiedLifesAchievement=function(){var t=y.default.getAchievementData();t.playerLifes?(t.playerLifes=t.playerLifes+1,t.playerLifes>9999&&(t.playerLifes=9999)):t.playerLifes=1,y.default.saveAchievementData(t)},e.addItemAchievement=function(t){var e=y.default.getAchievementData();e.items[t]?(e.items[t]=e.items[t]+1,e.items[t]>9999&&(e.items[t]=9999)):e.items[t]=1,y.default.saveAchievementData(e)},e.addEquipsAchievement=function(t){var e=y.default.getAchievementData();e.equips[t]?(e.equips[t]=e.equips[t]+1,e.equips[t]>9999&&(e.equips[t]=9999)):e.equips[t]=1,y.default.saveAchievementData(e)},e.addNpcsAchievement=function(t){var e=y.default.getAchievementData();e.npcs[t]?(e.npcs[t]=e.npcs[t]+1,e.npcs[t]>9999&&(e.npcs[t]=9999)):e.npcs[t]=1,y.default.saveAchievementData(e)},e.addMapsAchievement=function(t){var e=y.default.getAchievementData();e.maps[t]?(e.maps[t]=e.maps[t]+1,e.maps[t]>9999&&(e.maps[t]=9999)):e.maps[t]=1,y.default.saveAchievementData(e)},e.addChallengesAchievement=function(t){var e=y.default.getAchievementData();e.challenges[t]?(e.challenges[t]=e.challenges[t]+1,e.challenges[t]>9999&&(e.challenges[t]=9999)):e.challenges[t]=1,y.default.saveAchievementData(e)},e.addFurnituresAchievement=function(t){var e=y.default.getAchievementData();e.furnitures[t]?(e.furnitures[t]=e.furnitures[t]+1,e.furnitures[t]>9999&&(e.furnitures[t]=9999)):e.furnitures[t]=1,y.default.saveAchievementData(e)},e.prototype.update=function(){this.isBossLoaded&&this.loadingManager.isEquipmentLoaded&&this.loadingManager.isAllSpriteFramesLoaded()&&this.loadingManager.isMonsterLoaded&&this.loadingManager.isNonplayerLoaded&&this.loadingManager.isItemsLoaded&&this.loadingManager.isFurnituresLoaded&&this.loadingManager.isSuitsLoaded&&(this.isBossLoaded=!0,this.loadingManager.reset(),this.show())},e.MONSTER_SIZE=33,e.BOSS_SIZE=9,e.TYPE_CHALLENGE=0,e.TYPE_MAP=1,e.TYPE_FURNITURE=2,e.TYPE_NPC=3,e.TYPE_BOSS=4,e.TYPE_MONSTER=5,e.TYPE_EQUIP=6,e.TYPE_ITEM=7,n([_(cc.Node)],e.prototype,"contentBg",void 0),n([_(cc.Node)],e.prototype,"contentSprite",void 0),n([_(cc.Node)],e.prototype,"contentLabelBg",void 0),n([_(cc.Node)],e.prototype,"contentLabel",void 0),n([_(cc.Prefab)],e.prototype,"prefab",void 0),n([_(cc.Label)],e.prototype,"lifesLabel",void 0),n([_(cc.Label)],e.prototype,"coinLabel",void 0),n([_(cc.Label)],e.prototype,"goldLabel",void 0),n([_(cc.Node)],e.prototype,"loadingBackground",void 0),n([_(f.default)],e.prototype,"achievementItemDialog",void 0),i=n([E],e)}(cc.Component);i.default=T,cc._RF.pop()},{"../data/EquipmentData":"EquipmentData","../data/FurnitureData":"FurnitureData","../data/ItemData":"ItemData","../data/NonPlayerData":"NonPlayerData","../manager/InventoryManager":"InventoryManager","../manager/LoadingManager":"LoadingManager","../ui/AchievementItem":"AchievementItem","../ui/LoadingIcon":"LoadingIcon","../ui/dialog/AchievementItemDialog":"AchievementItemDialog","../utils/AudioPlayer":"AudioPlayer","../utils/LocalStorage":"LocalStorage","./Logic":"Logic"}],ActorAttackBox:[function(t,e,i){"use strict";cc._RF.push(e,"c5bd3A3tgpJso8uoa83DjVW","ActorAttackBox");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/FromData"),s=t("../base/Actor"),l=t("../utils/ActorUtils"),c=t("../utils/Utils"),u=t("../collider/CCollider"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isEnemy=!1,e.attackType=0,e.isAttacking=!1,e.hv=cc.v2(1,0),e.isSpecial=!1,e.isLarge=!1,e.checkTimeDelay=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.node.opacity=0,this.collider=this.getComponent(u.default)},e.prototype.init=function(t,e,i){this.isEnemy=i,this.nonPlayer=t,this.dungeon=e,this.collider||(this.collider=this.getComponent(u.default)),i?this.collider.setTargetTags([u.default.TAG.GOODNONPLAYER,u.default.TAG.PLAYER]):this.collider.setTargetTags([u.default.TAG.NONPLAYER,u.default.TAG.BOSS])},e.prototype.start=function(){},e.prototype.show=function(t,e,i,o){this.nonPlayer&&(this.isLarge=i,this.isSpecial=e,this.attackType=t,this.changeBoxSize(t),this.node.opacity=80,this.collider.enabled=!0,this.setHv(o))},e.prototype.changeBoxSize=function(t){var e=64,o=cc.v2(e,0);switch(this.node.anchorX=0,this.node.width=this.isLarge?1.5*e:e,this.node.height=e,this.node.position=cc.v3(-16,32),this.collider.offset=o,this.collider.w=this.isLarge?1.5*e:e,this.collider.h=e,t){case i.ATTACK_NORMAL:break;case i.ATTACK_STAB:this.node.width=this.isSpecial?400:200,this.collider.offset=cc.v2(0,0);break;case i.ATTACK_AREA:this.node.anchorX=.5,e=160,this.isLarge&&(e=320),this.node.width=e,this.node.height=e,this.node.position=cc.v3(0,32),this.collider.w=e,this.collider.h=e,this.collider.offset=cc.v2(0,0);break;case i.ATTACK_DASH:this.node.anchorX=.5,e=64,this.node.width=e,this.node.height=e,this.node.position=cc.v3(0,32),this.collider.w=e,this.collider.h=e,this.collider.offset=cc.v2(0,0)}},e.prototype.hide=function(t){this.isAttacking=!t,this.node.opacity=0},e.prototype.finish=function(){this.node.opacity=0,this.isAttacking=!1,this.isSpecial=!1,this.collider.enabled=!1},e.prototype.onColliderStay=function(t){if(this.isAttacking&&this.nonPlayer){var e=t.getComponent(s.default),i=this.nonPlayer;if(l.default.getEnemyCollisionTarget(t,!this.isEnemy)){this.nonPlayer.sc.isDashing=!1,this.isAttacking=!1;var o=r.default.getClone(i.data.nameCn,i.data.resName+"anim000"),a=i.data.getAttackPoint();a.isBackAttack=i.isFaceTargetBehind(e)&&i.data.FinalCommon.damageBack>0,a.isBackAttack&&(a.realDamage+=i.data.FinalCommon.damageBack),a.isMelee=!0,this.isSpecial&&(a.physicalDamage=2*a.physicalDamage),e.takeDamage(a,o,this.nonPlayer)&&i.addPlayerStatus(e,o),this.isSpecial=!1}}},e.prototype.setHv=function(t){this.hv=t,this.rotateCollider(this.hv)},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.02&&(this.checkTimeDelay=0,!0)},e.prototype.rotateCollider=function(t){t.equals(cc.Vec2.ZERO)||(this.node.angle=c.default.getRotateAngle(t,this.node.scaleX<0))},e.ATTACK_NORMAL=0,e.ATTACK_STAB=1,e.ATTACK_AREA=2,e.ATTACK_DASH=3,i=n([d],e)}(cc.Component));i.default=p,cc._RF.pop()},{"../base/Actor":"Actor","../collider/CCollider":"CCollider","../data/FromData":"FromData","../utils/ActorUtils":"ActorUtils","../utils/Utils":"Utils"}],ActorEntity:[function(t,e,i){"use strict";cc._RF.push(e,"cd28cVliS9Fy6d63F6LdqDD","ActorEntity");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(t("../ECS").ecs.Entity);i.default=n,cc._RF.pop()},{"../ECS":"ECS"}],ActorUtils:[function(t,e,i){"use strict";cc._RF.push(e,"01700dV3iVC1p7rezKVnsyV","ActorUtils");var o=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var a=t("../base/Actor"),n=t("../boss/Boss"),r=t("../collider/CCollider"),s=t("../logic/Logic"),l=t("../logic/NonPlayer"),c=t("../logic/Player"),u=cc._decorator,h=u.ccclass,d=(u.property,function(){function t(){}var e;return e=t,t.getEnemyCollisionTarget=function(t,e){if(e){if(t.tag==r.default.TAG.NONPLAYER||t.tag==r.default.TAG.BOSS)return t.node.getComponent(a.default)}else if(t.tag==r.default.TAG.PLAYER||t.tag==r.default.TAG.GOODNONPLAYER)return t.node.getComponent(a.default);return null},t.getEnemyActorByNode=function(t,e){if(e){if((o=t.getComponent(l.default))&&o.data.isEnemy>0)return o;var i=t.getComponent(n.default);if(i)return i}else{var o,a=t.getComponent(c.default);if(a)return a;if((o=t.getComponent(l.default))&&o.data.isEnemy<1)return o}return null},t.getPlayerPosition=function(t,i,o){return e.getNearestTargetPosition(t,[a.default.TARGET_PLAYER],i,!0,o)},t.getDirectionFromNearestEnemy=function(t,i,o,n,r){var s=e.getNearestTargetPosition(t,i?[a.default.TARGET_PLAYER,a.default.TARGET_NONPLAYER]:[a.default.TARGET_MONSTER,a.default.TARGET_NONPLAYER_ENEMY,a.default.TARGET_BOSS],o,n,r);return s.equals(cc.Vec3.ZERO)?cc.Vec3.ZERO:s.subtract(t).normalize()},t.getNearestEnemyPosition=function(t,i,o,n,r){return e.getNearestTargetPosition(t,i?[a.default.TARGET_PLAYER,a.default.TARGET_NONPLAYER]:[a.default.TARGET_MONSTER,a.default.TARGET_NONPLAYER_ENEMY,a.default.TARGET_BOSS],o,n,r)},t.getNearestTargetPosition=function(t,i,o,a,n){var r=e.getNearestTargetActor(t,i,o,n||999999);return r?r.getCenterPosition():a?t.clone().addSelf(cc.v3(s.default.getRandomNum(0,600)-300,s.default.getRandomNum(0,600)-300)):cc.Vec3.ZERO},t.getNearestEnemyActor=function(t,i,o){return e.getNearestTargetActor(t,i?[a.default.TARGET_PLAYER,a.default.TARGET_NONPLAYER]:[a.default.TARGET_MONSTER,a.default.TARGET_NONPLAYER_ENEMY,a.default.TARGET_BOSS],o)},t.getNearestTargetActor=function(t,e,i,o){if(!i)return null;for(var n,r=o||999999,l=[],c=0,u=e;c<u.length;c++){var h=u[c];if(h==a.default.TARGET_PLAYER)l.push(i.player);else if(h==a.default.TARGET_MONSTER)l=l.concat(i.monsterManager.monsterList);else if(h==a.default.TARGET_BOSS)l=l.concat(i.monsterManager.bossList);else if(h==a.default.TARGET_NONPLAYER)for(var d=0,p=i.nonPlayerManager.nonPlayerList;d<p.length;d++)(y=p[d])&&y.node&&y.node.active&&y.data.isEnemy<1&&l.push(y);else if(h==a.default.TARGET_NONPLAYER_ENEMY)for(var f=0,g=i.nonPlayerManager.nonPlayerList;f<g.length;f++){var y;(y=g[f])&&y.node&&y.node.active&&y.data.isEnemy>0&&l.push(y)}}for(var m=0,v=l;m<v.length;m++){var E=v[m];if(E&&E.node&&E.node.active&&this.isTargetCanTrack(E)){var _=s.default.getDistanceNoSqrt(t,E.getCenterPosition());_<r&&(r=_,n=E)}}return n||null},t.getTargetDistance=function(t,e){return e?s.default.getDistanceNoSqrt(t.node.position,e.node.position):999999},t.isTargetAlive=function(t){return!(!t||t.invisible||t.sc.isDied||!t.sc.isShow)},t.isTargetCanTrack=function(t){return!(!t.isValid||t.sc.isDied||!t.sc.isShow||t.sc.isJumping)},e=o([h],t)}());i.default=d,cc._RF.pop()},{"../base/Actor":"Actor","../boss/Boss":"Boss","../collider/CCollider":"CCollider","../logic/Logic":"Logic","../logic/NonPlayer":"NonPlayer","../logic/Player":"Player"}],Actor:[function(t,e,i){"use strict";cc._RF.push(e,"d1527FzjXVGUp0qJt0LJYgx","Actor");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./../ecs/component/ColliderComponent"),s=t("../collider/CCollider"),l=t("../ecs/component/MoveComponent"),c=t("../ecs/component/NodeRenderComponent"),u=t("../ecs/component/TransformComponent"),h=t("../ecs/ECS"),d=t("./StateContext"),p=t("./BaseColliderComponent"),f=cc._decorator,g=f.ccclass,y=(f.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.invisible=!1,e.isFaceRight=!0,e.isFaceUp=!0,e.lights=[],e.sc=new d.default,e.seed=0,e.entity=h.ecs.createEntityWithComps(c.NodeRenderComponent,l.MoveComponent,u.TransformComponent,r.ColliderComponent),e}return a(e,t),e.prototype.initCollider=function(){this.ccolliders=[];for(var t=0,e=this.getComponentsInChildren(s.default);t<e.length;t++){var i=e[t];i.tag==s.default.TAG.LIGHT||i.getComponent(p.default)||this.ccolliders.push(i)}if(this.ccolliders&&this.ccolliders.length>0){this.entity.Collider.colliders=this.ccolliders;for(var o=s.default.genNonDuplicateID(),a=0,n=this.ccolliders;a<n.length;a++){var l=n[a];l.groupId=o,l.setOnContactListener(this)}}else this.entity.remove(r.ColliderComponent)},e.prototype.registerListener=function(t){for(var e=0,i=this.ccolliders;e<i.length;e++)i[e].setOnContactListener(t)},e.prototype.setTargetTags=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,o=this.ccolliders;i<o.length;i++){var a=o[i];a.setTargetTags(t)}},e.prototype.setIgnoreTags=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,o=this.ccolliders;i<o.length;i++){var a=o[i];a.setIgnoreTags(t)}},e.prototype.destroyEntityNode=function(){this.entity.destroy(),this.node.destroy()},e.prototype.onColliderEnter=function(){},e.prototype.onColliderStay=function(){},e.prototype.onColliderExit=function(){},e.prototype.onColliderPreSolve=function(){},e.TARGET_PLAYER=0,e.TARGET_MONSTER=1,e.TARGET_BOSS=2,e.TARGET_NONPLAYER=3,e.TARGET_NONPLAYER_ENEMY=4,n([g],e)}(cc.Component));i.default=y,cc._RF.pop()},{"../collider/CCollider":"CCollider","../ecs/ECS":"ECS","../ecs/component/MoveComponent":"MoveComponent","../ecs/component/NodeRenderComponent":"NodeRenderComponent","../ecs/component/TransformComponent":"TransformComponent","./../ecs/component/ColliderComponent":"ColliderComponent","./BaseColliderComponent":"BaseColliderComponent","./StateContext":"StateContext"}],AirExit:[function(t,e,i){"use strict";cc._RF.push(e,"091edkNmgRCZq+fEAizpd4W","AirExit");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Player"),s=t("../logic/Logic"),l=t("./Building"),c=t("../utils/IndexZ"),u=t("../logic/Dungeon"),h=t("../collider/CCollider"),d=cc._decorator,p=d.ccclass,f=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dir=0,e.status=i.STATUS_CLOSE,e.sprite=null,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.sprite=this.getComponent(cc.Sprite),this.node.zIndex=c.default.FLOOR},e.prototype.init=function(t,e){switch(this.dir=t,t){case 0:break;case 1:this.node.scaleY=-8;break;case 2:this.node.angle=90;break;case 3:this.node.angle=90,this.node.scaleY=-8}this.node.opacity=60,this.node.width=u.default.TILE_SIZE/8*e,this.setTargetTags(h.default.TAG.PLAYER);for(var o=0,a=this.ccolliders;o<a.length;o++)a[o].setSize(cc.size(this.node.width,this.node.height));this.node.zIndex=c.default.OVERHEAD,this.changeStatus(i.STATUS_CLOSE)},e.prototype.changeStatus=function(t){this.status=t;var e="";switch(s.default.mapManager.isNeighborRoomExist(this.dir)||(this.status=i.STATUS_WAIT),this.status){case i.STATUS_CLOSE:e="outertips2";break;case i.STATUS_WAIT:e="outertips3";break;case i.STATUS_OPEN:e="outertips1"}for(var o=0,a=this.ccolliders;o<a.length;o++)a[o].sensor=this.status==i.STATUS_OPEN;this.sprite.spriteFrame=s.default.spriteFrameRes(e)},e.prototype.start=function(){},e.prototype.onColliderEnter=function(t){var e=this;if(t.tag==h.default.TAG.PLAYER){var o=t.node.getComponent(r.default);o&&this.status==i.STATUS_OPEN&&this.scheduleOnce(function(){s.default.playerData=o.data.clone(),s.default.loadingNextRoom(e.dir)},.1)}},e.STATUS_CLOSE=0,e.STATUS_WAIT=1,e.STATUS_OPEN=2,i=n([p],e)}(l.default));i.default=f,cc._RF.pop()},{"../collider/CCollider":"CCollider","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../logic/Player":"Player","../utils/IndexZ":"IndexZ","./Building":"Building"}],AoeManager:[function(t,e,i){"use strict";cc._RF.push(e,"418293hoQNDuI0vvcVpCRMh","AoeManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../actor/AreaOfEffect"),s=t("../logic/Logic"),l=t("../collider/CCollider"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aoe=null,e}return a(e,t),e.prototype.clear=function(){},e.prototype.addSpriteFramesAoe=function(t,e,i,o,a,n){var c=cc.instantiate(this.aoe);e.y+=32;var u=c.getChildByName("sprite").getComponent(cc.Sprite),h=c.getComponent(l.default);if(o.length>0){var d=s.default.spriteFrameRes(o[0]);u.node.width=d.getOriginalSize().width,u.node.height=d.getOriginalSize().height,u.node.scale=4,u.node.scaleX=n?4:-4,h.w=3*u.node.width,h.h=3*u.node.height}for(var p=cc.tween(),f=function(t){p.then(cc.tween().delay(.2).call(function(){u.spriteFrame=s.default.spriteFrameRes(t)}))},g=0,y=o;g<y.length;g++)f(y[g]);a?cc.tween(c).repeatForever(p).start():cc.tween(c).then(p).delay(.2).call(function(){u.spriteFrame=null}).start(),c.getComponent(r.default).show(t,e,cc.v3(1,0),0,i)},n([h(cc.Prefab)],e.prototype,"aoe",void 0),n([u],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../actor/AreaOfEffect":"AreaOfEffect","../collider/CCollider":"CCollider","../logic/Logic":"Logic"}],AreaDetector:[function(t,e,i){"use strict";cc._RF.push(e,"77810+lX7JF67u57+eViJLm","AreaDetector");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../collider/CCollider"),s=t("../item/Bullet"),l=t("../logic/NonPlayer"),c=t("../utils/NextStep"),u=t("../utils/Random"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.step=new c.default,e}return a(e,t),e.prototype.onLoad=function(){this.collider=this.getComponent(r.default)},e.prototype.start=function(){},e.prototype.onColliderEnter=function(t){var e=this;this.step.next(function(){var i=t.getComponent(s.default),o=e.node.parent.getComponent(l.default);if(i&&(i.isFromPlayer&&o.data.isEnemy>0||!i.isFromPlayer&&o.data.isEnemy<1)){var a=e.getRoate90Point(i.node.position,o.node.position,u.default.getHalfChance());a=a.sub(o.node.position),o.dodge(a)}},3)},e.prototype.getRoate90Point=function(t,e,i){return i?cc.v3(e.x+t.y-e.y,e.y-t.x+e.x):cc.v3(e.x-t.y+e.y,e.y+t.x-e.x)},n([d],e)}(cc.Component));i.default=p,cc._RF.pop()},{"../collider/CCollider":"CCollider","../item/Bullet":"Bullet","../logic/NonPlayer":"NonPlayer","../utils/NextStep":"NextStep","../utils/Random":"Random"}],AreaOfEffectData:[function(t,e,i){"use strict";cc._RF.push(e,"33991eUauZNwoZkS4LCMfg4","AreaOfEffectData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../utils/IndexZ"),a=t("./DamageData"),n=t("./FromData"),r=function(){function t(){this.duration=0,this.interval=.1,this.delay=0,this.scale=0,this.zIndex=o.default.ACTOR,this.isRotate=!1,this.isFromEnemy=!1,this.canBreakBuilding=!1,this.canBreakBullet=!1,this.canBeatBack=!1,this.damage=new a.default,this.from=new n.default,this.statusList=[]}return t.prototype.init=function(t,e,i,o,a,n,r,s,l,c,u,h,d){return this.duration=t,this.delay=i,this.interval=e,this.scale=o,this.zIndex=a,this.isFromEnemy=n,this.canBreakBuilding=r,this.canBreakBullet=s,this.canBeatBack=l,this.isRotate=c,this.damage=u,this.from=h,this.statusList=d,this},t.prototype.valueCopy=function(t){t&&(this.duration=t.duration?t.duration:0,this.interval=t.interval?t.interval:.1,this.delay=t.delay?t.delay:0,this.scale=t.scale?t.scale:0,this.zIndex=t.zIndex?t.zIndex:o.default.ACTOR,this.isFromEnemy=!!t.isFromEnemy&&t.isFromEnemy,this.canBreakBuilding=!!t.canBreakBuilding&&t.canBreakBuilding,this.canBreakBullet=!!t.canBreakBullet&&t.canBreakBullet,this.isRotate=!!t.isRotate&&t.isRotate,this.canBeatBack=!!t.canBeatBack&&t.canBeatBack,this.statusList=t.statusList?t.statusList:[],this.damage.valueCopy(t.damage),this.from.valueCopy(t.from))},t.prototype.clone=function(){var e=new t;return e.duration=this.duration,e.interval=this.interval,e.delay=this.delay,e.scale=this.scale,e.isFromEnemy=this.isFromEnemy,e.canBreakBuilding=this.canBreakBuilding,e.canBreakBullet=this.canBreakBullet,e.canBeatBack=this.canBeatBack,e.damage=this.damage.clone(),e.from=this.from.clone(),e.statusList=this.statusList,e.zIndex=this.zIndex,e.isRotate=this.isRotate,e},t}();i.default=r,cc._RF.pop()},{"../utils/IndexZ":"IndexZ","./DamageData":"DamageData","./FromData":"FromData"}],AreaOfEffect:[function(t,e,i){"use strict";cc._RF.push(e,"6a73blWLNVEw7zhXpbo521b","AreaOfEffect");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../boss/Boss"),s=t("../data/DamageData"),l=t("../utils/IndexZ"),c=t("../building/HitBuilding"),u=t("../data/AreaOfEffectData"),h=t("../utils/ActorUtils"),d=t("../building/InteractBuilding"),p=t("../collider/CCollider"),f=t("../base/BaseColliderComponent"),g=cc._decorator,y=g.ccclass,m=(g.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasTargetMap=new Map,e.isAttacking=!1,e.data=new u.default,e.usePool=!1,e.checkTimeDelay=0,e}return a(e,t),Object.defineProperty(e.prototype,"IsAttacking",{get:function(){return this.isAttacking},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){t.prototype.onLoad.call(this)},e.prototype.onEnable=function(){this.hasTargetMap.clear(),this.isAttacking=!1},e.prototype.start=function(){},e.prototype.AnimFinish=function(){this.close()},e.prototype.close=function(){var t=this;this.scheduleOnce(function(){t.node&&t.node.isValid&&!t.usePool&&t.destroyEntityNode(),t.destoryCallBack&&t.usePool&&t.destoryCallBack(t.node)},1),this.isAttacking=!1},e.prototype.show=function(t,e,i,o,a,n,r,s){var c=this;if(this.data.valueCopy(a),this.node.active=!0,this.node.parent=t,this.usePool=r,this.isAttacking=!0,this.killCallBack=n,this.destoryCallBack=s,this.node.setPosition(e),this.data.scale>0&&(this.node.scaleX=this.node.scaleX>0?this.data.scale:-this.data.scale,this.node.scaleY=this.node.scaleY>0?this.data.scale:-this.data.scale),this.data.isRotate){var u=this.getHv(i,o),h=cc.v2(u.x,u.y).signAngle(cc.v2(1,0)),d=cc.misc.radiansToDegrees(h);this.node.angle=360-d}this.node.zIndex=this.data.zIndex?this.data.zIndex:l.default.ACTOR,this.scheduleOnce(function(){c.isAttacking=!0},this.data.delay),this.data.duration>0&&this.scheduleOnce(function(){c.close()},this.data.duration);var p=this.getComponent(cc.Animation);p&&!p.playOnLoad&&p.play()},e.prototype.getHv=function(t,e){return cc.v2(t.clone().rotateSelf(e*Math.PI/180)).normalizeSelf()},e.prototype.onColliderStay=function(t,e){if(e.isValid&&this.isAttacking)if(this.hasTargetMap.has(t.id)&&this.hasTargetMap.get(t.id)>0)this.hasTargetMap.set(t.id,this.hasTargetMap.get(t.id)+1);else{this.hasTargetMap.set(t.id,1);var i=!0;this.data.isFromEnemy||t.tag!=p.default.TAG.GOODNONPLAYER&&t.tag!=p.default.TAG.PLAYER||(i=!1),!this.data.isFromEnemy||t.tag!=p.default.TAG.NONPLAYER&&t.tag!=p.default.TAG.BOSS||(i=!1),i&&this.attacking(t.node,t.tag)}},e.prototype.attacking=function(t,e){if(t){var i=new s.default;if(i.valueCopy(this.data.damage),i.isRemote=!0,e==p.default.TAG.PLAYER||e==p.default.TAG.NONPLAYER||e==p.default.TAG.GOODNONPLAYER||e==p.default.TAG.BOSS){var o=t.convertToWorldSpaceAR(cc.Vec2.ZERO).subSelf(this.node.convertToWorldSpaceAR(cc.Vec2.ZERO)).normalizeSelf(),a=h.default.getEnemyActorByNode(t,!this.data.isFromEnemy);if(a&&!a.sc.isDied){a.takeDamage(i,this.data.from)&&(a.data.currentHealth<=0&&this.killCallBack&&this.killCallBack(a),this.data.canBeatBack&&!a.getComponent(r.default)&&this.beatBack(a,o));for(var n=0,l=this.data.statusList;n<l.length;n++){var u=l[n];a.addStatus(u,this.data.from)}}}else if(e==p.default.TAG.BUILDING){var f=t.getComponent(d.default);if(this.data.canBreakBuilding&&f)return void f.takeDamage(i);var g=t.getComponent(c.default);this.data.canBreakBuilding&&g&&g.takeDamage(i)}}},e.prototype.beatBack=function(t,e){var i=e.clone();i.equals(cc.Vec2.ZERO)&&(i=cc.v2(1,0)),i=i.normalizeSelf().mul(100),this.scheduleOnce(function(){t.entity.Move.linearVelocity=cc.v2(i.x,i.y)},.1)},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>this.data.interval&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.isCheckTimeDelay(t)&&this.hasTargetMap.clear()},n([y],e)}(f.default));i.default=m,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../boss/Boss":"Boss","../building/HitBuilding":"HitBuilding","../building/InteractBuilding":"InteractBuilding","../collider/CCollider":"CCollider","../data/AreaOfEffectData":"AreaOfEffectData","../data/DamageData":"DamageData","../utils/ActorUtils":"ActorUtils","../utils/IndexZ":"IndexZ"}],AttributeData:[function(t,e,i){"use strict";cc._RF.push(e,"3df7eU5e+9JzoOx3mUEhHmJ","AttributeData"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(t,e,i,o,a,n){this.name="",this.id=0,this.resName="",this.desc="",this.name1="",this.desc1="",this.id=t,this.name=e,this.resName=i,this.desc=o,this.desc1=n,this.name1=a},cc._RF.pop()},{}],AttributeSelector:[function(t,e,i){"use strict";cc._RF.push(e,"1ba37UErLJKsamr/CQR4tOg","AttributeSelector");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arrowLeft=null,e.arrowRight=null,e.label=null,e.title=null,e.nameList=[],e.currentIndex=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.arrowLeft.on(cc.Node.EventType.TOUCH_START,function(){t.currentIndex--,t.updateAttribute()}),this.arrowRight.on(cc.Node.EventType.TOUCH_START,function(){t.currentIndex++,t.updateAttribute()})},e.prototype.selectRandom=function(){this.currentIndex=r.default.getRandomNum(0,this.nameList.length-1),this.updateAttribute()},e.prototype.selectNext=function(t){t?this.currentIndex--:this.currentIndex++,this.updateAttribute()},e.prototype.init=function(t,e,i){this.title.string=t,this.nameList=e,this.currentIndex=i||0,this.updateAttribute()},e.prototype.updateAttribute=function(){this.currentIndex<0?this.currentIndex=this.nameList.length-1:this.currentIndex>this.nameList.length-1&&(this.currentIndex=0),this.label.string=this.nameList[this.currentIndex].name,this.selectorCallback&&this.selectorCallback(this.nameList[this.currentIndex])},Object.defineProperty(e.prototype,"CurrentData",{get:function(){return this.nameList[this.currentIndex]},enumerable:!1,configurable:!0}),n([c(cc.Node)],e.prototype,"arrowLeft",void 0),n([c(cc.Node)],e.prototype,"arrowRight",void 0),n([c(cc.Label)],e.prototype,"label",void 0),n([c(cc.Label)],e.prototype,"title",void 0),n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../logic/Logic":"Logic"}],AudioPlayer:[function(t,e,i){"use strict";cc._RF.push(e,"76c8da4ThVB/L/QkXaZyrPc","AudioPlayer");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=t("../logic/Logic"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.monsterHit=null,e.monsterHit1=null,e.monsterHit2=null,e.pickUp=null,e.playerHit=null,e.remoteLaser=null,e.shoot=null,e.coin=null,e.boom=null,e.dash=null,e.die=null,e.exit=null,e.pickItem=null,e.melee=null,e.walk=null,e.blink=null,e.select=null,e.selectfail=null,e.bossicedemonattack=null,e.meleereflect=null,e.raindrop=null,e.skillfireball=null,e.skillicethron=null,e.skillmagicball=null,e.skillmagicball1=null,e.bossicedemondash=null,e.bossicedemondefend=null,e.bossicedemonhit=null,e.bossicedemonthron=null,e.wentlineopen=null,e.wentlineshow=null,e.zombieattack=null,e.zombiefall=null,e.zombiespitting=null,e.zombiespitting1=null,e.swordshow=null,e.electricattack=null,e.punch=null,e.punch1=null,e.punch2=null,e.fist=null,e.fist1=null,e.fist2=null,e.swordattack=null,e.swordattack1=null,e.swordattack2=null,e.swordhit=null,e.swordhit1=null,e.swordhit2=null,e.bleeding=null,e.cashiering=null,e.chicken=null,e.closestool=null,e.fireball=null,e.mutant=null,e.reload=null,e.scarabcrawl=null,e.shoot001=null,e.shoot002=null,e.shoot003=null,e.shoot004=null,e.takephoto=null,e.transportship=null,e.tvcolor=null,e.tvwhite=null,e.welcome=null,e.iceboom=null,e.levelup=null,e.complete=null,e.oilgold=null,e.dog=null,e.feedfish=null,e.fishtank=null,e.cat=null,e.waterdispenser=null,e.drink=null,e.trash=null,e.waterfall=null,e.voice=null,e.dollmachine=null,e.dolldown=null,e.mouse=null,e.jump=null,e.bg01=null,e.bg02=null,e.lastName="",e.isSoundNeedPause=!1,e.audioList={},e.lastBgmIndex=-1,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;r.EventHelper.on(r.EventHelper.PLAY_AUDIO,function(e){t.playSound(e.name,e.bgm,e.loop)}),r.EventHelper.on(r.EventHelper.STOP_ALL_AUDIO_EFFECT,function(){t.stopAllEffect()}),cc.audioEngine.setMusicVolume(.1),cc.audioEngine.setEffectsVolume(.4),this.audioList[i.MONSTER_HIT]=this.monsterHit,this.audioList[i.MONSTER_HIT1]=this.monsterHit1,this.audioList[i.MONSTER_HIT2]=this.monsterHit2,this.audioList[i.PICK_UP]=this.pickUp,this.audioList[i.PLAYER_HIT]=this.playerHit,this.audioList[i.REMOTE_LASER]=this.remoteLaser,this.audioList[i.SHOOT]=this.shoot,this.audioList[i.BOOM]=this.boom,this.audioList[i.COIN]=this.coin,this.audioList[i.MELEE]=this.melee,this.audioList[i.WALK]=this.walk,this.audioList[i.EXIT]=this.exit,this.audioList[i.DASH]=this.dash,this.audioList[i.DIE]=this.die,this.audioList[i.PICK_ITEM]=this.pickItem,this.audioList[i.SELECT]=this.select,this.audioList[i.SELECT_FAIL]=this.selectfail,this.audioList[i.BLINK]=this.blink,this.audioList[i.BOSS_ICEDEMON_DASH]=this.bossicedemondash,this.audioList[i.BOSS_ICEDEMON_DEFEND]=this.bossicedemondefend,this.audioList[i.BOSS_ICEDEMON_HIT]=this.bossicedemonhit,this.audioList[i.BOSS_ICEDEMON_THRON]=this.bossicedemonthron,this.audioList[i.BOOS_ICEDEMON_ATTACK]=this.bossicedemonattack,this.audioList[i.MELEE_PARRY]=this.meleereflect,this.audioList[i.RAINDROP]=this.raindrop,this.audioList[i.SKILL_FIREBALL]=this.skillfireball,this.audioList[i.SKILL_ICETHRON]=this.skillicethron,this.audioList[i.SKILL_MAGICBALL]=this.skillmagicball,this.audioList[i.SKILL_MAGICBALL1]=this.skillmagicball1,this.audioList[i.WENTLINE_OPEN]=this.wentlineopen,this.audioList[i.WENTLINE_SHOW]=this.wentlineshow,this.audioList[i.ZOMBIE_ATTACK]=this.zombieattack,this.audioList[i.ZOMBIE_FALL]=this.zombiefall,this.audioList[i.ZOMBIE_SPITTING]=this.zombiespitting,this.audioList[i.ZOMBIE_SPITTING1]=this.zombiespitting1,this.audioList[i.SWORD_SHOW]=this.swordshow,this.audioList[i.ELECTRIC_ATTACK]=this.electricattack,this.audioList[i.PUNCH]=this.punch,this.audioList[i.PUNCH1]=this.punch1,this.audioList[i.PUNCH2]=this.punch2,this.audioList[i.SWORD_ATTACK]=this.swordattack,this.audioList[i.SWORD_ATTACK1]=this.swordattack1,this.audioList[i.SWORD_ATTACK2]=this.swordattack2,this.audioList[i.SWORD_HIT]=this.swordhit,this.audioList[i.SWORD_HIT1]=this.swordhit1,this.audioList[i.SWORD_HIT2]=this.swordhit2,this.audioList[i.FIST]=this.fist,this.audioList[i.FIST1]=this.fist1,this.audioList[i.FIST2]=this.fist2,this.audioList[i.BLEEDING]=this.bleeding,this.audioList[i.CASHIERING]=this.cashiering,this.audioList[i.CHICKEN]=this.chicken,this.audioList[i.CLOSESTOOL]=this.closestool,this.audioList[i.FIREBALL]=this.fireball,this.audioList[i.MUTANT]=this.mutant,this.audioList[i.RELOAD]=this.reload,this.audioList[i.SCARABCRAWL]=this.scarabcrawl,this.audioList[i.SHOOT001]=this.shoot001,this.audioList[i.SHOOT002]=this.shoot002,this.audioList[i.SHOOT003]=this.shoot003,this.audioList[i.SHOOT004]=this.shoot004,this.audioList[i.TAKEPHOTO]=this.takephoto,this.audioList[i.TRANSPORTSHIP]=this.transportship,this.audioList[i.TVCOLOR]=this.tvcolor,this.audioList[i.TVWHITE]=this.tvwhite,this.audioList[i.WELCOME]=this.welcome,this.audioList[i.ICEBOOM]=this.iceboom,this.audioList[i.LEVELUP]=this.levelup,this.audioList[i.COMPLETE]=this.complete,this.audioList[i.OILGOLD]=this.oilgold,this.audioList[i.DOG]=this.dog,this.audioList[i.FEED_FISH]=this.feedfish,this.audioList[i.FISHTANK]=this.fishtank,this.audioList[i.CAT]=this.cat,this.audioList[i.WATERDISPENSER]=this.waterdispenser,this.audioList[i.DRINK]=this.drink,this.audioList[i.TRASH]=this.trash,this.audioList[i.WATERFALL]=this.waterfall,this.audioList[i.VOICE]=this.voice,this.audioList[i.DOLLMACHINE]=this.dollmachine,this.audioList[i.DOLLDOWN]=this.dolldown,this.audioList[i.MOUSE]=this.mouse,this.audioList[i.JUMP]=this.jump},e.prototype.playbg=function(){var t=[this.bg01,this.bg02][s.default.lastBgmIndex];!t||cc.audioEngine.isMusicPlaying()&&this.lastBgmIndex==s.default.lastBgmIndex||(cc.audioEngine.stopMusic(),cc.audioEngine.playMusic(t,!0),this.lastBgmIndex=s.default.lastBgmIndex)},e.prototype.stopAllEffect=function(){cc.audioEngine.stopAllEffects()},e.prototype.playSound=function(t,e,o){var a=this;if(t!=this.lastName||t!=i.COIN||!this.isSoundNeedPause){if(e)switch(t){case i.STOP_BG:cc.audioEngine.stopMusic();break;case i.PLAY_BG:this.playbg()}else this.audioList[t]&&cc.audioEngine.playEffect(this.audioList[t],o);this.lastName=t,this.isSoundNeedPause=!1,t==i.COIN&&(this.isSoundNeedPause=!0,this.scheduleOnce(function(){a.isSoundNeedPause=!1},.05))}},e.play=function(t,e,i){r.EventHelper.emit(r.EventHelper.PLAY_AUDIO,{name:t,bgm:e,loop:i})},e.stopAllEffect=function(){r.EventHelper.emit(r.EventHelper.STOP_ALL_AUDIO_EFFECT,{})},e.MONSTER_HIT="MONSTER_HIT",e.MONSTER_HIT1="MONSTER_HIT1",e.MONSTER_HIT2="MONSTER_HIT2",e.PICK_UP="PICK_UP",e.PLAYER_HIT="PLAYER_HIT",e.REMOTE_LASER="REMOTE_LASER",e.SHOOT="SHOOT",e.BOOM="BOOM",e.COIN="COIN",e.MELEE="MELEE",e.WALK="WALK",e.DASH="DASH",e.DIE="DIE",e.PICK_ITEM="PICK_ITEM",e.EXIT="EXIT",e.STOP_BG="STOP_BG",e.PLAY_BG="PLAY_BG",e.SELECT="SELECT",e.SELECT_FAIL="SELECT_FAIL",e.BLINK="BLINK",e.BOSS_ICEDEMON_DASH="BOSS_ICEDEMON_DASH",e.BOSS_ICEDEMON_DEFEND="BOSS_ICEDEMON_DEFEND",e.BOSS_ICEDEMON_HIT="BOSS_ICEDEMON_HIT",e.BOSS_ICEDEMON_THRON="BOSS_ICEDEMON_THRON",e.BOOS_ICEDEMON_ATTACK="BOOS_ICEDEMON_ATTACK",e.MELEE_PARRY="MELEE_PARRY",e.RAINDROP="RAINDROP",e.SKILL_FIREBALL="SKILL_FIREBALL",e.SKILL_ICETHRON="SKILL_ICETHRON",e.SKILL_MAGICBALL="SKILL_MAGICBALL",e.SKILL_MAGICBALL1="SKILL_MAGICBALL",e.WENTLINE_OPEN="WENTLINE_OPEN",e.WENTLINE_SHOW="WENTLINE_SHOW",e.ZOMBIE_ATTACK="ZOMBIE_ATTACK",e.ZOMBIE_FALL="ZOMBIE_FALL",e.ZOMBIE_SPITTING="ZOMBIE_SPITTING",e.ZOMBIE_SPITTING1="ZOMBIE_SPITTING1",e.SWORD_SHOW="SWORD_SHOW",e.ELECTRIC_ATTACK="ELECTRIC_ATTACK",e.PUNCH="PUNCH",e.PUNCH1="PUNCH1",e.PUNCH2="PUNCH2",e.FIST="FIST",e.FIST1="FIST1",e.FIST2="FIST2",e.SWORD_ATTACK="SWORD_ATTACK",e.SWORD_ATTACK1="SWORD_ATTACK1",e.SWORD_ATTACK2="SWORD_ATTACK2",e.SWORD_HIT="SWORD_HIT",e.SWORD_HIT1="SWORD_HIT1",e.SWORD_HIT2="SWORD_HIT2",e.BLEEDING="BLEEDING",e.CASHIERING="CASHIERING",e.CHICKEN="CHICKEN",e.CLOSESTOOL="CLOSESTOOL",e.FIREBALL="FIREBALL",e.MUTANT="MUTANT ",e.RELOAD="RELOAD ",e.SCARABCRAWL="SCARABCRAWL",e.SHOOT001="SHOOT001",e.SHOOT002="SHOOT002",e.SHOOT003="SHOOT003",e.SHOOT004="SHOOT004",e.TAKEPHOTO="TAKEPHOTO ",e.TRANSPORTSHIP="TRANSPORTSHIP",e.TVCOLOR="TVCOLOR",e.TVWHITE="TVWHITE",e.WELCOME="WELCOME",e.ICEBOOM="ICEBOOM",e.LEVELUP="LEVELUP",e.COMPLETE="COMPLETE",e.OILGOLD="OILGOLD",e.DOG="DOG",e.FEED_FISH="FEED_FISH",e.FISHTANK="FISHTANK",e.CAT="CAT",e.WATERDISPENSER="WATERDISPENSER",e.DRINK="DRINK",e.TRASH="TRASH",e.WATERFALL="WATERFALL",e.VOICE="VOICE",e.DOLLMACHINE="DOLLMACHINE",e.DOLLDOWN="DOLLDOWN",e.MOUSE="MOUSE",e.JUMP="JUMP",n([u({type:cc.AudioClip})],e.prototype,"monsterHit",void 0),n([u({type:cc.AudioClip})],e.prototype,"monsterHit1",void 0),n([u({type:cc.AudioClip})],e.prototype,"monsterHit2",void 0),n([u({type:cc.AudioClip})],e.prototype,"pickUp",void 0),n([u({type:cc.AudioClip})],e.prototype,"playerHit",void 0),n([u({type:cc.AudioClip})],e.prototype,"remoteLaser",void 0),n([u({type:cc.AudioClip})],e.prototype,"shoot",void 0),n([u({type:cc.AudioClip})],e.prototype,"coin",void 0),n([u({type:cc.AudioClip})],e.prototype,"boom",void 0),n([u({type:cc.AudioClip})],e.prototype,"dash",void 0),n([u({type:cc.AudioClip})],e.prototype,"die",void 0),n([u({type:cc.AudioClip})],e.prototype,"exit",void 0),n([u({type:cc.AudioClip})],e.prototype,"pickItem",void 0),n([u({type:cc.AudioClip})],e.prototype,"melee",void 0),n([u({type:cc.AudioClip})],e.prototype,"walk",void 0),n([u({type:cc.AudioClip})],e.prototype,"blink",void 0),n([u({type:cc.AudioClip})],e.prototype,"select",void 0),n([u({type:cc.AudioClip})],e.prototype,"selectfail",void 0),n([u({type:cc.AudioClip})],e.prototype,"bossicedemonattack",void 0),n([u({type:cc.AudioClip})],e.prototype,"meleereflect",void 0),n([u({type:cc.AudioClip})],e.prototype,"raindrop",void 0),n([u({type:cc.AudioClip})],e.prototype,"skillfireball",void 0),n([u({type:cc.AudioClip})],e.prototype,"skillicethron",void 0),n([u({type:cc.AudioClip})],e.prototype,"skillmagicball",void 0),n([u({type:cc.AudioClip})],e.prototype,"skillmagicball1",void 0),n([u({type:cc.AudioClip})],e.prototype,"bossicedemondash",void 0),n([u({type:cc.AudioClip})],e.prototype,"bossicedemondefend",void 0),n([u({type:cc.AudioClip})],e.prototype,"bossicedemonhit",void 0),n([u({type:cc.AudioClip})],e.prototype,"bossicedemonthron",void 0),n([u({type:cc.AudioClip})],e.prototype,"wentlineopen",void 0),n([u({type:cc.AudioClip})],e.prototype,"wentlineshow",void 0),n([u(cc.AudioClip)],e.prototype,"zombieattack",void 0),n([u(cc.AudioClip)],e.prototype,"zombiefall",void 0),n([u(cc.AudioClip)],e.prototype,"zombiespitting",void 0),n([u(cc.AudioClip)],e.prototype,"zombiespitting1",void 0),n([u(cc.AudioClip)],e.prototype,"swordshow",void 0),n([u(cc.AudioClip)],e.prototype,"electricattack",void 0),n([u(cc.AudioClip)],e.prototype,"punch",void 0),n([u(cc.AudioClip)],e.prototype,"punch1",void 0),n([u(cc.AudioClip)],e.prototype,"punch2",void 0),n([u(cc.AudioClip)],e.prototype,"fist",void 0),n([u(cc.AudioClip)],e.prototype,"fist1",void 0),n([u(cc.AudioClip)],e.prototype,"fist2",void 0),n([u(cc.AudioClip)],e.prototype,"swordattack",void 0),n([u(cc.AudioClip)],e.prototype,"swordattack1",void 0),n([u(cc.AudioClip)],e.prototype,"swordattack2",void 0),n([u(cc.AudioClip)],e.prototype,"swordhit",void 0),n([u(cc.AudioClip)],e.prototype,"swordhit1",void 0),n([u(cc.AudioClip)],e.prototype,"swordhit2",void 0),n([u(cc.AudioClip)],e.prototype,"bleeding",void 0),n([u(cc.AudioClip)],e.prototype,"cashiering",void 0),n([u(cc.AudioClip)],e.prototype,"chicken",void 0),n([u(cc.AudioClip)],e.prototype,"closestool",void 0),n([u(cc.AudioClip)],e.prototype,"fireball",void 0),n([u(cc.AudioClip)],e.prototype,"mutant",void 0),n([u(cc.AudioClip)],e.prototype,"reload",void 0),n([u(cc.AudioClip)],e.prototype,"scarabcrawl",void 0),n([u(cc.AudioClip)],e.prototype,"shoot001",void 0),n([u(cc.AudioClip)],e.prototype,"shoot002",void 0),n([u(cc.AudioClip)],e.prototype,"shoot003",void 0),n([u(cc.AudioClip)],e.prototype,"shoot004",void 0),n([u(cc.AudioClip)],e.prototype,"takephoto",void 0),n([u(cc.AudioClip)],e.prototype,"transportship",void 0),n([u(cc.AudioClip)],e.prototype,"tvcolor",void 0),n([u(cc.AudioClip)],e.prototype,"tvwhite",void 0),n([u(cc.AudioClip)],e.prototype,"welcome",void 0),n([u(cc.AudioClip)],e.prototype,"iceboom",void 0),n([u(cc.AudioClip)],e.prototype,"levelup",void 0),n([u(cc.AudioClip)],e.prototype,"complete",void 0),n([u(cc.AudioClip)],e.prototype,"oilgold",void 0),n([u(cc.AudioClip)],e.prototype,"dog",void 0),n([u(cc.AudioClip)],e.prototype,"feedfish",void 0),n([u(cc.AudioClip)],e.prototype,"fishtank",void 0),n([u(cc.AudioClip)],e.prototype,"cat",void 0),n([u(cc.AudioClip)],e.prototype,"waterdispenser",void 0),n([u(cc.AudioClip)],e.prototype,"drink",void 0),n([u(cc.AudioClip)],e.prototype,"trash",void 0),n([u(cc.AudioClip)],e.prototype,"waterfall",void 0),n([u(cc.AudioClip)],e.prototype,"voice",void 0),n([u(cc.AudioClip)],e.prototype,"dollmachine",void 0),n([u(cc.AudioClip)],e.prototype,"dolldown",void 0),n([u(cc.AudioClip)],e.prototype,"mouse",void 0),n([u(cc.AudioClip)],e.prototype,"jump",void 0),n([u(cc.AudioClip)],e.prototype,"bg01",void 0),n([u(cc.AudioClip)],e.prototype,"bg02",void 0),i=n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../logic/EventHelper":"EventHelper","../logic/Logic":"Logic"}],AvatarData:[function(t,e,i){"use strict";cc._RF.push(e,"78b51+ej+hHW50Cw1oQcuRl","AvatarData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./ProfessionData"),a=function(){function t(){this.organizationIndex=0,this.professionData=new o.default,this.skinColor="#ffe1c5",this.hairResName="avatarhair000anim00",this.hairColor="#000000",this.eyesResName="avatareyes000",this.eyesColor="#000000",this.faceResName="avatarface000",this.faceColor="#FBA1DE",this.petName="nonplayer100"}return t.prototype.valueCopy=function(t){t&&(this.organizationIndex=t.organizationIndex?t.organizationIndex:this.organizationIndex,this.professionData.valueCopy(t.professionData),this.skinColor=t.skinColor?t.skinColor:this.skinColor,this.hairResName=t.hairResName?t.hairResName:this.hairResName,this.hairColor=t.hairColor?t.hairColor:this.hairColor,this.eyesResName=t.eyesResName?t.eyesResName:this.eyesResName,this.eyesColor=t.eyesColor?t.eyesColor:this.eyesColor,this.faceResName=t.faceResName?t.faceResName:this.faceResName,this.faceColor=t.faceColor?t.faceColor:this.faceColor,this.petName=t.petName&&t.petName?t.petName:this.petName)},t.prototype.clone=function(){var e=new t;return e.organizationIndex=this.organizationIndex,e.professionData=this.professionData,e.skinColor=this.skinColor,e.hairResName=this.hairResName,e.hairColor=this.hairColor,e.eyesResName=this.eyesResName,e.eyesColor=this.eyesColor,e.faceResName=this.faceResName,e.faceColor=this.faceColor,e.petName=this.petName,e},t.FOLLOWER=0,t.HUNTER=1,t.GURAD=2,t.TECH=3,t.ORGANIZATION=["\u5f25\u4e16\u9010\u6d41","\u5b9d\u85cf\u730e\u4eba","\u5e7d\u5149\u5b88\u62a4","\u7fe0\u91d1\u79d1\u6280"],t}();i.default=a,cc._RF.pop()},{"./ProfessionData":"ProfessionData"}],BaseColliderComponent:[function(t,e,i){"use strict";cc._RF.push(e,"902bcgBo5RK+aOrmHRVahv+","BaseColliderComponent");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../ecs/component/ColliderComponent"),s=t("../collider/CCollider"),l=t("../ecs/component/MoveComponent"),c=t("../ecs/component/NodeRenderComponent"),u=t("../ecs/component/TransformComponent"),h=t("../ecs/ECS"),d=cc._decorator,p=d.ccclass,f=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.entity=h.ecs.createEntityWithComps(c.NodeRenderComponent,l.MoveComponent,u.TransformComponent,r.ColliderComponent),e}return a(e,t),e.prototype.onLoad=function(){this.initCollider()},e.prototype.initCollider=function(){this.ccolliders=[];for(var t=0,e=this.getComponentsInChildren(s.default);t<e.length;t++){var i=e[t];i.tag!=s.default.TAG.LIGHT&&this.ccolliders.push(i)}if(this.ccolliders&&this.ccolliders.length>0){this.entity.Collider.colliders=this.ccolliders;for(var o=s.default.genNonDuplicateID(),a=0,n=this.ccolliders;a<n.length;a++){var l=n[a];l.groupId=o,l.setOnContactListener(this)}}else this.entity.remove(r.ColliderComponent)},e.prototype.setTargetTags=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,o=this.ccolliders;i<o.length;i++){var a=o[i];a.setTargetTags(t)}},e.prototype.setIgnoreTags=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,o=this.ccolliders;i<o.length;i++){var a=o[i];a.setIgnoreTags(t)}},e.prototype.destroyEntityNode=function(){this.entity.destroy(),this.node.destroy()},e.prototype.onColliderEnter=function(){},e.prototype.onColliderStay=function(){},e.prototype.onColliderExit=function(){},e.prototype.onColliderPreSolve=function(){},n([p],e)}(cc.Component));i.default=f,cc._RF.pop()},{"../collider/CCollider":"CCollider","../ecs/ECS":"ECS","../ecs/component/ColliderComponent":"ColliderComponent","../ecs/component/MoveComponent":"MoveComponent","../ecs/component/NodeRenderComponent":"NodeRenderComponent","../ecs/component/TransformComponent":"TransformComponent"}],BaseData:[function(t,e,i){"use strict";cc._RF.push(e,"104f7mgC6BFIYLmzL4FKFUV","BaseData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../utils/Random"),a=function(){function t(){}return t.prototype.genNonDuplicateID=function(){return Number(o.default.rand().toString().substring(3,16)+Date.now()).toString(36)},t}();i.default=a,cc._RF.pop()},{"../utils/Random":"Random"}],BaseDialog:[function(t,e,i){"use strict";cc._RF.push(e,"5de11HhcHdDHbXLJONfG55W","BaseDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bg=null,e.dialogBg=null,e.cancelOutSide=!0,e._isAniming=!1,e}return a(e,t),Object.defineProperty(e.prototype,"isAniming",{get:function(){return this._isAniming},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isShow",{get:function(){return 1==this.node.active},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){var t=this;this.bg=this.node.getChildByName("bg"),this.dialogBg=this.node.getChildByName("dialogbg"),this.bg.on(cc.Node.EventType.TOUCH_END,function(){t.cancelOutSide&&t.dismiss()},this)},e.prototype.start=function(){},e.prototype.setCanceledOnTouchOutside=function(t){this.cancelOutSide=t},e.prototype.show=function(){var t=this;this._isAniming||(this._isAniming=!0,this.node.active=!0,this.node.opacity=255,this.node.scale=0,cc.tween(this.node).to(.1,{scale:.1}).to(.1,{scaleX:1}).to(.1,{scaleY:1}).call(function(){t._isAniming=!1}).start())},e.prototype.dismiss=function(){var t=this;this._isAniming||(this._isAniming=!0,cc.tween(this.node).to(.1,{scaleY:.1}).to(.1,{scaleX:0}).to(.1,{opacity:0}).call(function(){t.node.active=!1,t._isAniming=!1,t.dismissCallBack&&t.dismissCallBack()}).start())},e.prototype.onDismissListener=function(t){this.dismissCallBack=t},n([s],e)}(cc.Component));i.default=l,cc._RF.pop()},{}],BaseManager:[function(t,e,i){"use strict";cc._RF.push(e,"c0fb6uxoAJAR6KX1Qx/juNE","BaseManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),n([s],e)}(cc.Component));i.default=l,cc._RF.pop()},{}],BaseNonPlayerActorState:[function(t,e,i){"use strict";cc._RF.push(e,"920bbZwmdhLNqox7T/WQBj5","BaseNonPlayerActorState");var o=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var a=cc._decorator,n=a.ccclass,r=(a.property,function(){function t(){this._isRunnig=!1,this.showLog=!0}return Object.defineProperty(t.prototype,"isRunnig",{get:function(){return this._isRunnig},enumerable:!1,configurable:!0}),t.prototype.enter=function(){this._isRunnig=!0},t.prototype.update=function(){},t.prototype.exit=function(){this._isRunnig=!1},t.prototype.event=function(){return this._isRunnig=!0,!0},t.prototype.log=function(t){this.showLog&&cc.log(t)},o([n],t)}());i.default=r,cc._RF.pop()},{}],BlockLight:[function(t,e,i){"use strict";cc._RF.push(e,"200a5VPMNZOQ7QKn+qhQpb0","BlockLight");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=cc._decorator,l=s.ccclass,c=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.show=function(){var t=this;this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play(),this.scheduleOnce(function(){cc.director.emit(r.EventHelper.POOL_DESTORY_WALKSMOKE,{detail:{targetNode:t.node}})},.5)},n([l],e)}(cc.Component));i.default=c,cc._RF.pop()},{"../logic/EventHelper":"EventHelper"}],BossAttackCollider:[function(t,e,i){"use strict";cc._RF.push(e,"955f3FE6OVI9rSVX2x0s/2h","BossAttackCollider");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../data/FromData"),l=t("../base/Actor"),c=t("../utils/ActorUtils"),u=t("../collider/CCollider"),h=cc._decorator,d=h.ccclass,p=h.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.damage=9,e.parentNode=null,e.from=new s.default,e.isShow=!1,e}return a(e,t),e.prototype.onLoad=function(){this.collider=this.getComponent(u.default)},e.prototype.start=function(){this.isShow=!1},e.prototype.showCollider=function(t,e){var i=this,o=e||0;this.scheduleOnce(function(){i.isShow=!0},o),this.scheduleOnce(function(){i.isShow=!1},t)},e.prototype.onColliderEnter=function(t){var e=c.default.getEnemyCollisionTarget(t);if(e&&this.isShow&&this.node.active&&this.parentNode){this.isShow=!1;var i=new r.default;i.physicalDamage=this.damage,e.takeDamage(i,this.from,this.parentNode.getComponent(l.default))}},n([p],e.prototype,"damage",void 0),n([p(cc.Node)],e.prototype,"parentNode",void 0),n([d],e)}(cc.Component);i.default=f,cc._RF.pop()},{"../base/Actor":"Actor","../collider/CCollider":"CCollider","../data/DamageData":"DamageData","../data/FromData":"FromData","../utils/ActorUtils":"ActorUtils"}],Boss:[function(t,e,i){"use strict";cc._RF.push(e,"27ef0INO8BDnrQF5OkIl5aV","Boss");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../logic/Dungeon"),l=t("../manager/StatusManager"),c=t("../logic/EventHelper"),u=t("../base/Actor"),h=t("../item/Item"),d=t("../utils/IndexZ"),p=t("../data/NonPlayerData"),f=cc._decorator,g=f.ccclass,y=f.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.statusManager=null,e.healthBar=null,e.pos=cc.v3(0,0),e.data=new p.default,e}return a(e,t),e.prototype.addStatus=function(t,e){this.node&&!this.sc.isDied&&this.statusManager&&this.statusManager.addStatus(t,e)},e.prototype.getNearPlayerDistance=function(t,e){var i=this.node.position.clone();return e&&i.addSelf(e),r.default.getDistanceNoSqrt(this.node.position,t.position)},e.prototype.getCenterPosition=function(){return this.node.position.clone().addSelf(cc.v3(0,32*this.node.scaleY))},e.prototype.playHit=function(t){t&&(t.stopAllActions(),t.position=cc.v3(0,0),cc.tween(t).to(.1,{position:cc.v3(2,0)}).to(.1,{position:cc.v3(-2,0)}).to(.1,{position:cc.v3(2,0)}).to(.1,{position:cc.v3(-2,0)}).to(.1,{position:cc.v3(2,0)}).to(.1,{position:cc.v3(-2,0)}).to(.1,{position:cc.v3(2,0)}).to(.1,{position:cc.v3(0,0)}).start())},e.prototype.updatePlayerPos=function(){this.entity.Transform.position=s.default.getPosInMap(this.pos),this.node.position=this.entity.Transform.position.clone()},e.prototype.transportBoss=function(t,e){this.pos.x=t,this.pos.y=e,this.changeZIndex(),this.updatePlayerPos()},e.prototype.changeZIndex=function(){this.node.zIndex=d.default.getActorZIndex(this.node.position)},e.prototype.start=function(){var t=this;this.changeZIndex(),this.scheduleOnce(function(){t.healthBar&&t.healthBar.refreshHealth(t.data.currentHealth,t.data.Common.maxHealth)},.1)},e.prototype.getLoot=function(t){if(this.dungeon){var e=r.default.mapManager.getRandom4Save(this.seed);c.EventHelper.emit(c.EventHelper.DUNGEON_ADD_COIN,{pos:this.node.position,count:t?9:19}),t||c.EventHelper.emit(c.EventHelper.DUNGEON_ADD_OILGOLD,{pos:this.node.position,count:100}),(r.default.getHalfChance()&&t||!t)&&(c.EventHelper.emit(c.EventHelper.DUNGEON_ADD_ITEM,{res:h.default.HEART}),c.EventHelper.emit(c.EventHelper.DUNGEON_ADD_ITEM,{res:h.default.DREAM})),this.dungeon.addEquipment(r.default.getRandomEquipType(e),null,null,t?0:3)}},e.prototype.showBoss=function(){},e.prototype.fireShooter=function(t,e,i,o,a){t.dungeon=this.dungeon,t.data.bulletType=e,t.data.bulletArcExNum=i,t.data.bulletLineExNum=o,t.fireBullet(a)},e.prototype.takeDizz=function(){},e.prototype.updateStatus=function(t,e){this.data.StatusTotalData.valueCopy(e)},e.prototype.hideSelf=function(){},e.prototype.updateDream=function(){return 0},e.prototype.updateLife=function(){},e.prototype.setLinearVelocity=function(){},n([y(l.default)],e.prototype,"statusManager",void 0),n([g],e)}(u.default);i.default=m,cc._RF.pop()},{"../base/Actor":"Actor","../data/NonPlayerData":"NonPlayerData","../item/Item":"Item","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../manager/StatusManager":"StatusManager","../utils/IndexZ":"IndexZ"}],Box:[function(t,e,i){"use strict";cc._RF.push(e,"84b7dB47rlIALRzq2ZvOGc3","Box");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Logic"),l=t("./Building"),c=t("../utils/AudioPlayer"),u=t("../utils/IndexZ"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeDelay=0,e.isBreaking=!1,e.boxType=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.anim.play("BoxShow")},e.prototype.start=function(){var t="box";switch(this.boxType){case i.BOX:t="box";break;case i.PLANT:t="plant";break;case i.BOXBREAKABLE:t="box"}switch(s.default.chapterIndex){case s.default.CHAPTER00:this.changeRes(t+"000");break;case s.default.CHAPTER01:this.changeRes(t+"001");break;case s.default.CHAPTER02:this.changeRes(t+"002");break;case s.default.CHAPTER03:this.changeRes(t+"003");break;case s.default.CHAPTER04:case s.default.CHAPTER05:this.changeRes(t+"004");break;case s.default.CHAPTER099:this.changeRes(t+"000")}},e.prototype.changeRes=function(t){var e=this.node.getChildByName("sprite").getComponent(cc.Sprite),i=s.default.spriteFrameRes(t);e.spriteFrame=i},e.prototype.setDefaultPos=function(t){this.data.defaultPos=t,this.entity.Transform.position=r.default.getPosInMap(t),this.node.position=this.entity.Transform.position.clone(),this.node.zIndex=u.default.getActorZIndex(this.entity.Transform.position)},e.prototype.BreakingFinish=function(){this.reset()},e.prototype.breakBox=function(){if(!this.isBreaking){var t=[c.default.MONSTER_HIT,c.default.MONSTER_HIT1,c.default.MONSTER_HIT2];c.default.play(t[s.default.getRandomNum(0,2)]),this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play("BoxBroken"),this.isBreaking=!0}},e.prototype.reset=function(){this.entity.Transform.position=r.default.getPosInMap(this.data.defaultPos),this.node.position=this.entity.Transform.position.clone(),this.isBreaking=!1},e.prototype.update=function(t){if(this.timeDelay+=t,this.timeDelay>.2){this.data.position=this.entity.Transform.position;var e=s.default.mapManager.getCurrentMapBuilding(this.data.defaultPos);e&&(e.position=this.data.position),this.node.zIndex=u.default.getActorZIndex(this.entity.Transform.position)}},e.BOX=0,e.PLANT=1,e.BOXBREAKABLE=2,i=n([d],e)}(l.default));i.default=p,cc._RF.pop()},{"../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","./Building":"Building"}],BrightnessBar:[function(t,e,i){"use strict";cc._RF.push(e,"cd2d8XSihFHJ5/ASmPsHcdm","BrightnessBar");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.slider=null,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){},e.prototype.init=function(){},e.prototype.setSelectorCallback=function(t){this.selectorCallback=t,this.updateAttribute()},e.prototype.selectRandom=function(){this.slider.progress=r.default.getRandomNum(0,10)/10,this.updateAttribute()},e.prototype.updateAttribute=function(){if(this.selectorCallback){var t=i.SKIN_COLORS,e=Math.floor(10*this.slider.progress);this.selectorCallback(cc.Color.WHITE.fromHEX(t[e]))}},e.SKIN=0,e.SKIN_COLORS=["#ffe8d2","#ffe1c5","#ebcaac","#e0c1a4","#ccad8f","#ad9075","#997E5B","#664e38","#473524","#291404","#1f1711"],n([c(cc.Slider)],e.prototype,"slider",void 0),i=n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../logic/Logic":"Logic"}],BuildingData:[function(t,e,i){"use strict";cc._RF.push(e,"78dc5pt0FFGDaglLh5AJv4K","BuildingData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./EquipmentData"),a=t("./ItemData"),n=function(){function t(){this.isOpen=!1,this.quality=1,this.price=60,this.shopType=0,this.isSaled=!1,this.maxHealth=1,this.currentHealth=1,this.generatorList=[],this.generatorCount=0,this.generatorInterval=0,this.interact=0,this.rollover=0}return t.prototype.valueCopy=function(t){t&&(this.defaultPos=t.defaultPos?cc.v3(t.defaultPos.x,t.defaultPos.y):cc.v3(0,0),this.position=t.position?cc.v3(t.position.x,t.position.y):cc.v3(0,0),t.equipdata&&(this.equipdata=new o.default,this.equipdata.valueCopy(t.equipdata)),t.itemdata&&(this.itemdata=new a.default,this.itemdata.valueCopy(t.itemdata)),this.price=t.price,this.isSaled=t.isSaled,this.shopType=t.shopType,this.quality=t.quality?t.quality:1,this.isOpen=t.isOpen,this.maxHealth=t.maxHealth?t.maxHealth:0,this.currentHealth=t.currentHealth?t.currentHealth:0,this.generatorList=[],t.generatorList&&(this.generatorList=t.generatorList),this.generatorCount=t.generatorCount?t.generatorCount:0,this.generatorInterval=t.generatorInterval?t.generatorInterval:0,this.interact=t.interact?t.interact:0,this.rollover=t.rollover?t.rollover:0)},t.prototype.clone=function(){var e=new t;return e.defaultPos=this.defaultPos,e.position=this.position,e.isOpen=this.isOpen,e.quality=this.quality,this.equipdata&&(e.equipdata=new o.default,e.equipdata.valueCopy(this.equipdata)),this.itemdata&&(e.itemdata=new a.default,e.itemdata.valueCopy(this.itemdata)),e.price=this.price,e.shopType=this.shopType,e.isSaled=this.isSaled,e.maxHealth=this.maxHealth,e.currentHealth=this.currentHealth,e.generatorInterval=this.generatorInterval,e.generatorCount=this.generatorCount,e.generatorList=this.generatorList,e.interact=this.interact,e.rollover=this.rollover,e},t}();i.default=n,cc._RF.pop()},{"./EquipmentData":"EquipmentData","./ItemData":"ItemData"}],BuildingManager:[function(t,e,i){"use strict";cc._RF.push(e,"ac92cjzIYlNDKOIneo1Pkvl","BuildingManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Logic"),l=t("../building/FootBoard"),c=t("../utils/IndexZ"),u=t("../building/Saw"),h=t("../building/Emplacement"),d=t("../building/DecorationFloor"),p=t("../building/Chest"),f=t("../building/Box"),g=t("../building/ShopTable"),y=t("../building/FallStone"),m=t("../building/MagicLightening"),v=t("../building/HitBuilding"),E=t("../building/ExitDoor"),_=t("../building/Door"),T=t("../building/Wall"),D=t("../building/AirExit"),S=t("../building/Portal"),O=t("../building/RoomBed"),A=t("../building/Building"),C=t("../data/ExitData"),R=t("./BaseManager"),L=t("../boss/DryadGrass"),b=t("../utils/Utils"),P=t("../effect/ShadowOfSight"),I=t("./LightManager"),M=t("../building/SavePoint"),N=t("../building/MartShelves"),w=t("./NonPlayerManager"),H=t("./MonsterManager"),x=t("../building/MgWentLine"),B=t("../building/RoomStool"),F=t("../building/MgCrack"),k=t("../building/InteractBuilding"),j=t("../building/EnergyShield"),G=t("./EquipmentManager"),U=t("../building/Furniture"),W=t("../data/FurnitureData"),q=t("../building/RoomFishtank"),Y=t("../collider/CCollider"),Z=t("../building/WallPaint"),V=t("../building/RoomWaterDispenser"),K=t("../building/RoomClock"),z=t("../building/RoomTrashCan"),X=t("../building/RoomKitchen"),Q=t("../utils/AudioPlayer"),J=cc._decorator,$=J.ccclass,tt=(J.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.footboards=new Array,e.exitdoors=new Array,e.portals=new Array,e.doors=new Array,e.airExits=new Array,e.monsterGeneratorList=new Array,e.colliderCombineMap=new Map,e.coastColliderList=["128,128,0,0","128,128,0,0","128,128,0,0","128,128,0,0","128,64,0,-32","128,64,0,32","64,128,32,0","64,128,-32,0","64,64,-32,32","64,64,32,32","64,64,-32,-32","64,64,32,-32"],e.shelvesFoodIndex=0,e.shelvesDrinkIndex=0,e.drinkList=[],e.foodList=[],e.interactBuildings=[],e.buildingList=[],e.waterIndexList=new Array,e.checkTimeDelay=0,e}var i;return a(e,t),i=e,e.prototype.clear=function(){b.default.clearComponentArray(this.footboards),b.default.clearComponentArray(this.exitdoors),b.default.clearComponentArray(this.portals),b.default.clearComponentArray(this.doors),b.default.clearComponentArray(this.airExits),b.default.clearComponentArray(this.interactBuildings),this.footboards=new Array,this.exitdoors=new Array,this.portals=new Array,this.doors=new Array,this.airExits=new Array,this.drinkList=new Array,this.foodList=new Array,this.interactBuildings=new Array,this.buildingList=new Array,this.shelvesFoodIndex=0,this.shelvesDrinkIndex=0,this.waterIndexList=new Array,this.colliderCombineMap.clear()},e.prototype.isThe=function(t,e){return-1!=t.indexOf(e)},e.prototype.isFirstEqual=function(t,e){return t[0]==e},e.prototype.addBuilding=function(t,e){var i=cc.instantiate(t);i.parent=this.node,i.position=r.default.getPosInMap(e),i.zIndex=c.default.getActorZIndex(i.position);var o=i.getComponent(A.default);return o&&(o.initCollider(),o.entity.NodeRender.node=i,o.entity.Transform.position=r.default.getPosInMap(e),o.seed=s.default.mapManager.getSeedFromRoom(),o.data.defaultPos=e.clone(),o.lights=o.getComponentsInChildren(P.default),o.lights&&I.default.registerLight(o.lights,o.node)),this.buildingList.push(o),i},e.prototype.addBuildingsFromMap=function(t,e,o,a,n,d){var p=this;"=="==o?this.waterIndexList.push(a):this.isFirstEqual(o,"*")||(this.isFirstEqual(o,"#")?this.addDirWalls(o,e,a,n,!1):this.isFirstEqual(o,"-")?s.default.getBuildings(i.DARKNESS,function(t){var e=p.addBuilding(t,a);e.zIndex=c.default.DARKNESS,"-0"==o&&(e.zIndex=c.default.ROOF)}):this.isFirstEqual(o,"~")?this.addWater(o,a):this.isFirstEqual(o,"+")?this.addDecorate(t,o,a):"@@"==o?s.default.getBuildings(i.FOOTBOARD,function(t){var e=p.addBuilding(t,a);e.zIndex=c.default.FLOOR,p.footboards.push(e.getComponent(l.default))}):"@S"==o?s.default.getBuildings(i.SAVEPOINT,function(t){var e=p.addBuilding(t,a);p.savePointS=e.getComponent(M.default)}):this.isFirstEqual(o,"B")?this.addBox(o,a):"C0"==o?this.addChest(a):this.isFirstEqual(o,"D")?this.addDoor(o,a,!1):this.isFirstEqual(o,"E")?this.addExitDoor(o,a,d):"F0"==o?this.addFallStone(a,!1):"F1"==o?this.addLighteningFall(a,!0,!0,!0):this.isFirstEqual(o,"G")?s.default.getBuildings(i.EMPLACEMENT,function(e){var i=p.addBuilding(e,a).getComponent(h.default);i.setDirType(o),i.dungeon=t}):this.isFirstEqual(o,"H")?this.addHitBuilding(t,o,a):"I0"==o?s.default.getBuildings(i.WENTLINE,function(e){var i=p.addBuilding(e,a).getComponent(x.default);i.init(t,1,6,[H.default.MONSTER_ZOOMBIE,H.default.MONSTER_BITE_ZOMBIE]),p.monsterGeneratorList.push(i)}):"I6"==o?s.default.getBuildings(i.CRACK,function(e){var i=p.addBuilding(e,a).getComponent(F.default);i.init(t,.5,15,[H.default.MONSTER_SCARAB]),p.monsterGeneratorList.push(i)}):this.isFirstEqual(o,"J")||this.isFirstEqual(o,"K")||(this.isFirstEqual(o,"L")?this.addLamp(o,a):this.isFirstEqual(o,"O")?s.default.getBuildings(i.DECORATIONOVERHEAD,function(t){var e=p.addBuilding(t,a);"O1"==o&&(e.angle=90),e.opacity=80,e.zIndex=c.default.ROOF}):this.isFirstEqual(o,"P")?s.default.getBuildings(i.PORTAL,function(t){if(s.default.isCheatMode){for(var e=C.default.getRealWorldExitDataFromDream(s.default.chapterIndex,s.default.level),i=0,o=d;i<o.length;i++){var n=o[i];if(n.fromPos.equals(a)&&n.fromRoomPos.equals(cc.v3(s.default.mapManager.getCurrentRoom().x,s.default.mapManager.getCurrentRoom().y))){e.valueCopy(n);break}}var r=p.addBuilding(t,a).getComponent(S.default);r.exitData.valueCopy(e),p.portals.push(r)}}):"Q0"==o?s.default.getBuildings(i.TAROTTABLE,function(t){p.addBuilding(t,a)}):"R0"==o?s.default.getBuildings(i.SHIPSTAIRS,function(t){var e=p.addBuilding(t,a);e.setScale(16),e.zIndex=c.default.WALLINTERNAL}):"R1"==o?s.default.getBuildings(i.SHIPSTAIRS,function(t){var e=p.addBuilding(t,a);e.setScale(-16,16),e.getComponent(Y.default).offset=cc.v2(-8,0),e.zIndex=c.default.WALLINTERNAL}):"S0"==o?this.addShopTable(a):"S1"==o?s.default.getBuildings(i.SHOP,function(t){p.addBuilding(t,a)}):"S2"==o?s.default.getBuildings(i.SHOPMART,function(t){p.addBuilding(t,a).zIndex+=10}):"Sa"==o||"Sb"==o||"Sc"==o?this.addMartShelves(o,a):"Sd"==o?s.default.getBuildings(i.MARTCASHIER,function(e){p.addBuilding(e,a);var i=r.default.getPosInMap(a);t.nonPlayerManager.addNonPlayerFromData(w.default.SHOP_KEEPER,cc.v3(i.x-60,i.y+180),t)}):"Se"==o?s.default.getBuildings(i.MARTTABLE,function(t){p.addBuilding(t,a)}):"T0"==o?s.default.getBuildings(i.TRAP,function(t){p.addBuilding(t,a)}):this.isFirstEqual(o,"W")?this.addInteractBuilding(o,a):"X0"==o?s.default.getBuildings(i.SAW,function(t){p.addBuilding(t,a).getComponent(u.default).setPos(a)}):this.isFirstEqual(o,"Z")&&(0==parseInt(o[1])||1==parseInt(o[1])?s.default.getBuildings(i.ROOMBED,function(e){p.addBuilding(e,a).getComponent(O.default).init(t,1==parseInt(o[1]))}):this.addFurnitures(t,o,a))))},e.prototype.addBuildingsFromSideMap=function(t,e,o,a){var n=this;this.isFirstEqual(t,"#")?this.addDirWalls(t,e,o,a,!0):this.isFirstEqual(t,"-")?s.default.getBuildings(i.DARKNESS,function(e){var i=n.addBuilding(e,o);i.zIndex=c.default.DARKNESS,"-0"==t&&(i.zIndex=c.default.ROOF)}):this.isFirstEqual(t,"~")?this.addWater(t,o):"+3"==t?s.default.getBuildings(i.AIRTRANSPORTMODEL,function(t){n.addBuilding(t,o)}):this.isFirstEqual(t,"D")&&this.addDoor(t,o,!0)},e.prototype.addInteractBuilding=function(t,e){var o=this;s.default.getBuildings(i.INTERACTBUILDING,function(i){var a,n=s.default.mapManager.getCurrentMapBuilding(e),l=s.default.mapManager.getCurrentRoom().isReborn;n?(n.currentHealth>0||l)&&((a=o.addBuilding(i,e).getComponent(k.default)).node.position=n.position.clone(),a.data.valueCopy(n),l&&(a.node.position=r.default.getPosInMap(a.data.defaultPos),a.data.currentHealth=a.data.maxHealth),a.init(!0,parseInt(t[1])),o.interactBuildings.push(a)):((a=o.addBuilding(i,e).getComponent(k.default)).data.currentHealth=5,s.default.mapManager.setCurrentBuildingData(a.data.clone()),a.init(!0,parseInt(t[1])),o.interactBuildings.push(a))})},e.prototype.addBox=function(t,e){var o=this;s.default.getBuildings(i.BOX,function(i){var a=o.addBuilding(i,e).getComponent(f.default);a.setDefaultPos(e),"B1"==t&&(a.boxType=f.default.PLANT);var n=s.default.mapManager.getCurrentMapBuilding(a.data.defaultPos);n?a.node.position=n.position.clone():s.default.mapManager.setCurrentBuildingData(a.data.clone())})},e.prototype.addShopTable=function(t){var e=this;s.default.getBuildings(i.SHOPTABLE,function(i){var o=e.addBuilding(i,t).getComponent(g.default);o.setDefaultPos(t);var a=s.default.mapManager.getCurrentRoom().isReborn,n=s.default.mapManager.getRandom4Save(o.seed);o.data.shopType=n.getRandomNum(0,100)>10?g.default.EQUIPMENT:g.default.ITEM;var r=s.default.mapManager.getCurrentMapBuilding(o.data.defaultPos);r?(a&&r.isSaled&&(r.isSaled=!1,r.equipdata=null,r.itemdata=null,n=s.default.mapManager.getRandom4Save(s.default.mapManager.getRebornSeed(o.seed)),r.shopType=n.getRandomNum(0,100)>10?g.default.EQUIPMENT:g.default.ITEM),o.data.valueCopy(r)):s.default.mapManager.setCurrentBuildingData(o.data.clone()),o.showItem()})},e.prototype.addChest=function(t){var e=this;s.default.getBuildings(i.CHEST,function(i){var o=e.addBuilding(i,t).getComponent(p.default);o.seDefaultPos(t);var a=s.default.mapManager.getRandom4Save(o.seed).rand(),n=1;a>.5&&a<.7?n=2:a>.7&&a<.8?n=3:a>.8&&a<.85&&(n=4),o.setQuality(n,!1);var r=s.default.mapManager.getCurrentMapBuilding(o.data.defaultPos);r?o.setQuality(r.quality,r.isOpen):s.default.mapManager.setCurrentBuildingData(o.data.clone())})},e.prototype.addDecorate=function(t,e,o){var a=this;"+0"==e?s.default.getBuildings(i.CAMPFIRE,function(t){var e=a.addBuilding(t,o),i=e.getChildByName("sprite").getChildByName("shadow");i.position=r.default.getPosInMap(o),i.position=cc.v3(i.position.x,i.position.y+40),i.parent=a.node,i.zIndex=c.default.FLOOR;var n=e.getChildByName("sprite").getChildByName("fallentree");n.position=r.default.getPosInMap(o),n.position=cc.v3(i.position.x,i.position.y+40),n.parent=a.node,n.zIndex=c.default.getActorZIndex(n.position),n.setScale(6,4)}):"+3"==e?s.default.getBuildings(i.AIRTRANSPORTMODEL,function(t){a.addBuilding(t,o)}):"+4"==e?this.addPracticeEquipItem(t,o):"+a"==e?s.default.getBuildings(i.GRASS01,function(t){a.addBuilding(t,o)}):"+b"==e?s.default.getBuildings(i.GRASS02,function(t){a.addBuilding(t,o)}):"+c"==e?s.default.getBuildings(i.GRASS03,function(t){a.addBuilding(t,o)}):"+d"==e?s.default.getBuildings(i.GRASS04,function(t){a.addBuilding(t,o)}):this.isThe(e,"+p")?s.default.getBuildings(i.WALLPAINT,function(t){var i=a.addBuilding(t,o).getComponent(Z.default);i.node.zIndex=c.default.getActorZIndex(i.node.position.add(cc.v3(0,120))),i.init(e)}):s.default.getBuildings(i.DECORATIONFLOOR,function(i){var n=a.addBuilding(i,o).getComponent(d.default);"++"==e?n.init(t,"exitarrow",4,0):"+2"==e?n.init(t,"exitarrow",4,0):"+5"==e?n.init(t,"roomoutside0",32,1,cc.v3(.95,.5),255,c.default.BASE):"+6"==e?n.init(t,"roomoutside1",32,1,cc.v3(.95,.5),255,c.default.BASE):"+7"==e?n.init(t,"roomoutside2",32,1,cc.v3(0,.5),255,c.default.BASE):n.init(t,"dev",4,0)})},e.prototype.addWater=function(t,e){var o=this,a=parseInt(t[1]);a>=0&&a<=9||"~a"==t||"~b"==t?s.default.getBuildings(i.COAST,function(i){var n=o.addBuilding(i,e),r=n.getComponent(Y.default),l=a;"~a"==t?l=10:"~b"==t&&(l=11),n.getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=s.default.spriteFrameRes("coast00"+l);var u=o.coastColliderList[l].split(",");r.setSize(cc.size(parseInt(u[0]),parseInt(u[1]))),r.offset=cc.v2(parseInt(u[2]),parseInt(u[3])),n.zIndex=c.default.WATER}):"~f"==t?s.default.getBuildings(i.WATERFALL,function(t){Q.default.play(Q.default.WATERFALL,!1,!0),o.addBuilding(t,e)}):"~#"==t?s.default.getBuildings(i.WATERCOLLIDER,function(t){o.addBuilding(t,e).zIndex=c.default.WATER}):s.default.getBuildings(i.WATER,function(t){o.addBuilding(t,e).zIndex=c.default.WATER})},e.prototype.addLamp=function(t,e){var o=this,a=i.LAMPLIGHT,n=!1,l=!1,u=!1;switch(t){case"L0":a=i.LAMPLIGHT;break;case"L1":a=i.LAMPSUN,n=!0;break;case"L2":a=i.LAMPSHIP,n=!0;break;case"L3":a=i.MUSHROOM01;break;case"L4":a=i.MUSHROOM02;break;case"L5":a=i.MUSHROOM03;break;case"L6":a=i.MUSHROOM04;break;case"L7":a=i.LAMPSEARCH,n=!0;break;case"L8":a=i.LAMPTORCH,n=!0;break;case"L9":a=i.LAMPFIREPAN;break;case"La":a=i.LAMPROAD;break;case"Lb":a=i.LAMPFIREFLY;break;case"Lc":a=i.LAMPDIRECT;break;case"L001":case"L003":case"L005":case"L007":case"L009":a=i.LAMPLIGHT,u=!0;break;case"L011":case"L013":case"L015":case"L017":case"L019":a=i.LAMPLIGHT,u=!0,l=!0}s.default.getBuildings(a,function(i){var a=o.addBuilding(i,e);if(n&&(a.zIndex=c.default.OVERHEAD+100),u){var s=a.getComponent(A.default);if(s.lights.length>0){var h=parseInt(t[3]),d=r.default.TILE_SIZE*h;s.lights[0].setCustomColliderStyle(l,d,d,d/2)}}})},e.prototype.getGoodsList=function(t){if(this.foodList.length<1&&this.drinkList.length<1)for(var e=0,i=s.default.goodsNameList;e<i.length;e++){var o=i[e],a=o.substring("goods".length,"goods".length+1);"0"==a?this.drinkList.push(o):"1"==a&&this.foodList.push(o)}if(t==N.default.TYPE_FRIDGE){for(var n=[],r=this.shelvesDrinkIndex%N.default.SIZE_FRIDGE;r<N.default.SIZE_FRIDGE;r++)this.shelvesDrinkIndex<this.drinkList.length&&n.push(this.drinkList[this.shelvesDrinkIndex++]);return n}var l=[];for(r=this.shelvesFoodIndex%N.default.SIZE_NORMAL;r<N.default.SIZE_NORMAL;r++)this.shelvesFoodIndex<this.foodList.length&&l.push(this.foodList[this.shelvesFoodIndex++]);return l},e.prototype.addMartShelves=function(t,e){var o=this;t==N.default.TYPE_FRIDGE?s.default.getBuildings(i.MARTFRIDGE,function(i){o.addBuilding(i,e).getComponent(N.default).init(t,o.getGoodsList(t))}):s.default.getBuildings(i.MARTSHELVES,function(i){o.addBuilding(i,e).getComponent(N.default).init(t,o.getGoodsList(t))})},e.prototype.addExitDoor=function(t,e,o){var a=this;s.default.getBuildings(i.EXITDOOR,function(i){var n=parseInt(t[1]);isNaN(n)&&("Ea"==t?n=10:"Eb"==t&&(n=11));for(var r=C.default.getRealWorldExitDataFromDream(s.default.chapterIndex,s.default.level),l=0,c=o;l<c.length;l++){var u=c[l];if(u.fromPos.equals(e)&&u.fromRoomPos.equals(cc.v3(s.default.mapManager.getCurrentRoom().x,s.default.mapManager.getCurrentRoom().y))){r.valueCopy(u);break}}var h=a.addBuilding(i,e).getComponent(E.default);h.init(n,r),a.exitdoors.push(h)})},e.prototype.addAirExit=function(t){var e=this;s.default.getBuildings(i.AIREXIT,function(i){var o=e.addBuilding(i,cc.v3(Math.floor(t.length/2),t[0].length)).getComponent(D.default),a=e.addBuilding(i,cc.v3(Math.floor(t.length/2),-1)).getComponent(D.default),n=e.addBuilding(i,cc.v3(-1,Math.floor(t[0].length/2))).getComponent(D.default),r=e.addBuilding(i,cc.v3(t.length,Math.floor(t[0].length/2))).getComponent(D.default);e.airExits.push(o),e.airExits.push(a),e.airExits.push(n),e.airExits.push(r);for(var s=0;s<e.airExits.length;s++)e.airExits[s].init(s,s<2?t.length+2:t[0].length+2)})},e.getDoorDir=function(t){var e=parseInt(t[1]);return isNaN(e)&&("Da"==t?e=8:"Db"==t?e=9:"Dc"==t?e=10:"Dd"==t?e=11:"De"==t?e=12:"Df"==t?e=13:"Dg"==t?e=14:"Dh"==t?e=15:"Di"==t?e=16:"Dj"==t?e=17:"Dk"==t?e=18:"Dl"==t&&(e=19)),e},e.prototype.addDoor=function(t,e,o){var a=this;s.default.getBuildings(i.DOOR,function(n){var r=i.getDoorDir(t),s=a.addBuilding(n,e).getComponent(_.default);s.isDoor=!0,s.dir=r%4,s.isEmpty=r>3&&r<8,s.isLock=r>7&&r<12,s.isDecorate=o,s.isHidden=r>11&&r<16,s.isTransparent=r>15,a.doors.push(s)})},e.prototype.setDoors=function(t,e){for(var i=0,o=this.doors;i<o.length;i++)o[i].setOpen(t,e);for(var a=0,n=this.airExits;a<n.length;a++)n[a].changeStatus(t?D.default.STATUS_OPEN:D.default.STATUS_CLOSE);if(this.exitdoors.length>0)for(var r=0,s=this.exitdoors;r<s.length;r++){var l=s[r];t?l.openGate():l.closeGate()}if(this.portals.length>0)for(var c=0,u=this.portals;c<u.length;c++)l=u[c],t?l.openGate():l.closeGate()},e.prototype.getReachDir=function(){for(var t=new Map,e=0,i=this.doors;e<i.length;e++){var o=i[e];o.isLock||o.isDecorate||(s.default.mapManager.isNeighborRoomNew(o.dir)?t.set(o.dir,!0):s.default.mapManager.isNeighborRoomExist(o.dir)&&t.set(o.dir,!1))}for(var a=0,n=this.exitdoors;a<n.length;a++){var r=n[a];r.dir<8&&t.set(r.dir%4,!0)}return t},e.prototype.addDirWalls=function(t,e,o,a,n){var r=this;s.default.getBuildings(i.WALL,function(i){var s=r.addBuilding(i,o).getComponent(T.default),l=0,c=0,u=r.colliderCombineMap.has("i"+o.x+"j"+o.y);if(u&&(s.combineWall=r.colliderCombineMap.get("i"+o.x+"j"+o.y)),!u&&!n){for(var h=o.x+1;h<e.length;h++){var d=e[h][o.y];if(t!=d)break;r.colliderCombineMap.set("i"+h+"j"+o.y,s),l++}if(l<1)for(var p=o.y+1;p<e[o.x].length&&(d=e[o.x][p],t==d);p++)r.colliderCombineMap.set("i"+o.x+"j"+p,null),c++}s.init(t,a,n||u,l,c)})},e.prototype.addFurnitures=function(t,e,o){var a,n=this,r=new W.default;switch(e){case"Z2":r.valueCopy(s.default.furnitures[U.default.DESK]);break;case"Z3":r.valueCopy(s.default.furnitures[U.default.TV]);break;case"Z4":r.valueCopy(s.default.furnitures[U.default.SOFA]);break;case"Z5":r.valueCopy(s.default.furnitures[U.default.DINNER_TABLE]);break;case"Z6":r.valueCopy(s.default.furnitures[U.default.FRIDGE]);break;case"Z7":r.valueCopy(s.default.furnitures[U.default.WASHING_MACHINE]);break;case"Z8":r.valueCopy(s.default.furnitures[U.default.CUPBOARD]);break;case"Z9":r.valueCopy(s.default.furnitures[U.default.STOOL]);break;case"Za":r.valueCopy(s.default.furnitures[U.default.COOKING_BENCH]);break;case"Zb":r.valueCopy(s.default.furnitures[U.default.DOLL_MACHINE]);break;case"Zc":r.valueCopy(s.default.furnitures[U.default.COOKING_BENCH_2]);break;case"Zd":r.valueCopy(s.default.furnitures[U.default.COOKING_BENCH_3]);break;case"Ze":r.valueCopy(s.default.furnitures[U.default.BATH]);break;case"Zf":r.valueCopy(s.default.furnitures[U.default.LITTLE_TABLE]);break;case"Zg":r.valueCopy(s.default.furnitures[U.default.LITTLE_TABLE_1]);break;case"Zh":r.valueCopy(s.default.furnitures[U.default.LITTLE_TABLE_2]);break;case"Zi":r.valueCopy(s.default.furnitures[U.default.FISHTANK]);break;case"Zj":r.valueCopy(s.default.furnitures[U.default.BOOKSHELF]);break;case"Zk":r.valueCopy(s.default.furnitures[U.default.WATERDISPENER]);break;case"Zl":r.valueCopy(s.default.furnitures[U.default.TRASHCAN])}"Z3"==e?s.default.getBuildings(i.ROOMTV,function(t){(a=n.addBuilding(t,o)).getComponent(U.default).init(r)}):"Z4"==e?s.default.getBuildings(i.ROOMSOFA,function(t){(a=n.addBuilding(t,o)).zIndex=c.default.ACTOR,a.getComponent(U.default).init(r)}):"Z9"==e?s.default.getBuildings(i.ROOMSTOOL,function(e){(a=n.addBuilding(e,o)).getComponent(B.default).init(o,t),a.getComponent(U.default).init(r)}):"Za"==e?s.default.getBuildings(i.ROOMKITCHEN,function(t){(a=n.addBuilding(t,o)).getComponent(X.default).init(o),a.getComponent(U.default).init(r)}):"Zh"==e?s.default.getBuildings(i.ROOMCLOCK,function(t){(a=n.addBuilding(t,o)).getComponent(K.default).init(o),a.getComponent(U.default).init(r)}):"Zi"==e?s.default.getBuildings(i.ROOMFISHTANK,function(e){(a=n.addBuilding(e,o)).getComponent(q.default).init(o,t),a.getComponent(U.default).init(r)}):"Zk"==e?s.default.getBuildings(i.ROOMWATERDISPENSER,function(t){(a=n.addBuilding(t,o)).getComponent(V.default).init(o),a.getComponent(U.default).init(r)}):"Zl"==e?s.default.getBuildings(i.ROOMTRASHCAN,function(t){(a=n.addBuilding(t,o)).getComponent(z.default).init(o),a.getComponent(U.default).init(r)}):s.default.getBuildings(i.FURNITURE,function(t){(a=n.addBuilding(t,o)).getComponent(U.default).init(r)})},e.prototype.addHitBuilding=function(t,e,o){var a=this;s.default.getBuildings(i.HITBUILDING,function(i){var n=a.addBuilding(i,o).getComponent(v.default);n.setDefaultPos(o);var r="car",l=[],c=[],u=9999,h=4,d=0;switch(e){case"H0":r="car",l=["shield001"],c=[],u=5,h=8,d=3}n.init(t,r,c,l,u,u,h,!1,d);var p=s.default.mapManager.getCurrentMapBuilding(n.data.defaultPos);p?n.init(t,r,c,l,u,p.currentHealth,h,!1,d):s.default.mapManager.setCurrentBuildingData(n.data.clone())})},e.prototype.addFallStone=function(t,e,o){var a=this;this.node&&s.default.getBuildings(i.FALLSTONE,function(i){var n=a.addBuilding(i,t),r=n.getComponent(y.default);r.isAuto=e,n.zIndex=c.default.FLOOR,r.isAuto&&r.fall(o)})},e.prototype.addLighteningFall=function(t,e,o,a,n){var r=this;this.node&&s.default.getBuildings(i.LIGHTENINGFALL,function(i){var s=r.addBuilding(i,t),l=s.getComponent(m.default);s.zIndex=c.default.FLOOR,l.isTrigger=e,l.isTrigger||l.fall(o,a,n)})},e.prototype.addTwineGrass=function(t,e){var o=this;this.node&&s.default.getBuildings(i.DRYADTWINE,function(i){var a=o.addBuilding(i,t),n=a.getComponent(L.default);n.isAuto=e,a.zIndex=c.default.getActorZIndex(t),n.isAuto&&n.fall()})},e.prototype.addEnergyShield=function(t){var e=this;if(!this.node)return null;s.default.getBuildings(i.ENERGYSHIELD,function(i){var o=e.addBuilding(i,t.pos);o.position=t.node.position.clone();var a=o.getComponent(j.default),n=8+Math.floor(s.default.playerData.OilGoldData.level/5);return a.init(t,20+5*s.default.playerData.OilGoldData.level,n),a})},e.prototype.addPracticeEquipItem=function(t,e){t&&(t.addEquipment(G.default.WEAPON_WOOD_SWORD,r.default.getPosInMap(e.add(cc.v3(-2,0)))),t.addEquipment(G.default.WEAPON_WOOD_SPEAR,r.default.getPosInMap(e.add(cc.v3(-1,0)))),t.addEquipment(G.default.WEAPON_WOOD_DAGGER,r.default.getPosInMap(e)),t.addEquipment(G.default.WEAPON_WOOD_HAMMER,r.default.getPosInMap(e.add(cc.v3(1,0)))),t.addEquipment(G.default.WEAPON_WOOD_LONG_CROSS,r.default.getPosInMap(e.add(cc.v3(2,0)))),t.addEquipment(G.default.WEAPON_WOOD_LONG_STICK,r.default.getPosInMap(e.add(cc.v3(-3,0)))))},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.2&&(this.checkTimeDelay=0,!0)},e.prototype.updateLogic=function(t,e){if(this.isCheckTimeDelay(t)){for(var i=200,o=null,a=this.interactBuildings.length-1;a>=0;a--){var n=this.interactBuildings[a];if(n.highLight(!1),!(n.isTaken||!n.isValid||n.data.currentHealth<=0)){var r=s.default.getDistanceNoSqrt(n.node.position,e.node.position);r<i&&(i=r,o=n)}}i<96&&o?(o.highLight(!0),this.lastInteractBuilding=o):this.lastInteractBuilding=null}},e.AIREXIT="AirExit",e.AIRTRANSPORT="AirTransport",e.AIRTRANSPORTMODEL="AirTransportModel",e.BED="Bed",e.BOX="Box",e.CAMPFIRE="CampFire",e.CHEST="Chest",e.COAST="Coast",e.DARKNESS="Darkness",e.INTERACTBUILDING="InteractBuilding",e.DECORATIONFLOOR="DecorationFloor",e.DECORATIONOVERHEAD="DecorationOverHead",e.DOOR="Door",e.DRYADTWINE="DryadTwine",e.EMPLACEMENT="Emplacement",e.EXITDOOR="ExitDoor",e.FALLSTONE="FallStone",e.FOOTBOARD="FootBoard",e.HITBUILDING="HitBuilding",e.ICEDEMONTHRON="IceDemonThron",e.LIGHTENINGFALL="LighteningFall",e.MARTCASHIER="MartCashier",e.MARTFRIDGE="MartFridge",e.MARTSHELVES="MartShelves",e.MARTTABLE="MartTable",e.MIST="Mist",e.PORTAL="Portal",e.ROOMBED="RoomBed",e.ROOMTV="RoomTv",e.ROOMSTOOL="RoomStool",e.ROOMSOFA="RoomSofa",e.ROOMFISHTANK="RoomFishtank",e.ROOMWATERDISPENSER="RoomWaterDispenser",e.ROOMCLOCK="RoomClock",e.ROOMTRASHCAN="RoomTrashCan",e.ROOMKITCHEN="RoomKitchen",e.SAVEPOINT="SavePoint",e.SAW="Saw",e.SHIPSTAIRS="Shipstairs",e.SHOP="Shop",e.SHOPMART="ShopMart",e.SHOPTABLE="ShopTable",e.TAROTTABLE="TarotTable",e.TRAP="Trap",e.WALL="Wall",e.WATER="Water",e.LAMPLIGHT="LampLight",e.LAMPSUN="LampSun",e.LAMPSHIP="LampShip",e.LAMPSEARCH="LampSearch",e.LAMPFIREPAN="LampFirePan",e.LAMPTORCH="LampTorch",e.LAMPROAD="LampRoad",e.LAMPFIREFLY="LampFireFly",e.LAMPDIRECT="LampDirectLight",e.MUSHROOM01="MushRoom01",e.MUSHROOM02="MushRoom02",e.MUSHROOM03="MushRoom03",e.MUSHROOM04="MushRoom04",e.GRASS01="Grass01",e.GRASS02="Grass02",e.GRASS03="Grass03",e.GRASS04="Grass04",e.WENTLINE="WentLine",e.CRACK="Crack",e.WATERCOLLIDER="WaterCollider",e.WATERFALL="WaterFall",e.ENERGYSHIELD="EnergyShield",e.FURNITURE="Furniture",e.WALLPAINT="WallPaint",i=n([$],e)}(R.default));i.default=tt,cc._RF.pop()},{"../boss/DryadGrass":"DryadGrass","../building/AirExit":"AirExit","../building/Box":"Box","../building/Building":"Building","../building/Chest":"Chest","../building/DecorationFloor":"DecorationFloor","../building/Door":"Door","../building/Emplacement":"Emplacement","../building/EnergyShield":"EnergyShield","../building/ExitDoor":"ExitDoor","../building/FallStone":"FallStone","../building/FootBoard":"FootBoard","../building/Furniture":"Furniture","../building/HitBuilding":"HitBuilding","../building/InteractBuilding":"InteractBuilding","../building/MagicLightening":"MagicLightening","../building/MartShelves":"MartShelves","../building/MgCrack":"MgCrack","../building/MgWentLine":"MgWentLine","../building/Portal":"Portal","../building/RoomBed":"RoomBed","../building/RoomClock":"RoomClock","../building/RoomFishtank":"RoomFishtank","../building/RoomKitchen":"RoomKitchen","../building/RoomStool":"RoomStool","../building/RoomTrashCan":"RoomTrashCan","../building/RoomWaterDispenser":"RoomWaterDispenser","../building/SavePoint":"SavePoint","../building/Saw":"Saw","../building/ShopTable":"ShopTable","../building/Wall":"Wall","../building/WallPaint":"WallPaint","../collider/CCollider":"CCollider","../data/ExitData":"ExitData","../data/FurnitureData":"FurnitureData","../effect/ShadowOfSight":"ShadowOfSight","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/Utils":"Utils","./BaseManager":"BaseManager","./EquipmentManager":"EquipmentManager","./LightManager":"LightManager","./MonsterManager":"MonsterManager","./NonPlayerManager":"NonPlayerManager"}],Building:[function(t,e,i){"use strict";cc._RF.push(e,"255a9MnBFxLp4C3tatPRINn","Building");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../base/Actor"),s=t("../data/BuildingData"),l=t("../utils/Random"),c=cc._decorator,u=c.ccclass,h=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=new s.default,e}return a(e,t),e.prototype.takeDamage=function(){return!1},e.prototype.addStatus=function(){},e.prototype.getCenterPosition=function(){return this.entity.Transform.position.clone()},e.prototype.actorName=function(){return""},e.prototype.takeDizz=function(){},e.prototype.updateStatus=function(){},e.prototype.hideSelf=function(){},e.prototype.updateDream=function(){return 0},e.prototype.setLinearVelocity=function(){},e.prototype.updateLife=function(){},e.prototype.disappear=function(){cc.tween(this.node).to(.5+l.default.rand(),{scaleY:0}).start()},n([u],e)}(r.default));i.default=h,cc._RF.pop()},{"../base/Actor":"Actor","../data/BuildingData":"BuildingData","../utils/Random":"Random"}],BulletData:[function(t,e,i){"use strict";cc._RF.push(e,"081a6xA9tZAiZxbsh2+6iXp","BulletData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./DamageData"),a=t("./FromData"),n=function(){function t(){this.speed=0,this.isRect=0,this.isRotate=0,this.rotateAngle=0,this.isLaser=0,this.laserRange=0,this.isDecelerate=0,this.decelerateDelta=0,this.delayDecelerate=0,this.isBoom=0,this.isPhysical=0,this.delaytrack=0,this.isTracking=0,this.lifeTime=0,this.size=1,this.resName="",this.lightName="",this.lightColor="#ffffff",this.fixedRotation=0,this.statusType="",this.statusRate=0,this.canBreakBuilding=0,this.isInvincible=0,this.splitBulletType="",this.splitTime=0,this.splitArcExNum=0,this.splitLineExNum=0,this.damage=new o.default,this.from=new a.default}return t.prototype.valueCopy=function(t){this.speed=t.speed?t.speed:0,this.isRect=t.isRect?t.isRect:0,this.isRotate=t.isRotate?t.isRotate:0,this.rotateAngle=t.rotateAngle?t.rotateAngle:0,this.isDecelerate=t.isDecelerate?t.isDecelerate:0,this.decelerateDelta=t.decelerateDelta?t.decelerateDelta:0,this.delayDecelerate=t.delayDecelerate?t.delayDecelerate:0,this.isLaser=t.isLaser?t.isLaser:0,this.laserRange=t.laserRange?t.laserRange:0,this.isBoom=t.isBoom?t.isBoom:0,this.isTracking=t.isTracking?t.isTracking:0,this.isPhysical=t.isPhysical?t.isPhysical:0,this.delaytrack=t.delaytrack?t.delaytrack:0,this.fixedRotation=t.fixedRotation?t.fixedRotation:0,this.size=t.size?t.size:1,this.lifeTime=t.lifeTime?t.lifeTime:0,this.resName=t.resName?t.resName:"",this.lightName=t.lightName?t.lightName:"",this.statusType=t.statusType?t.statusType:"",this.statusRate=t.statusRate?t.statusRate:0,this.canBreakBuilding=t.canBreakBuilding?t.canBreakBuilding:0,this.isInvincible=t.isInvincible?t.isInvincible:0,this.splitTime=t.splitTime?t.splitTime:0,this.splitBulletType=t.splitBulletType?t.splitBulletType:"",this.splitArcExNum=t.splitArcExNum?t.splitArcExNum:0,this.splitLineExNum=t.splitLineExNum?t.splitLineExNum:0,this.lightColor=t.lightColor?t.lightColor:"#ffffff",this.damage.valueCopy(t.damage),this.from.valueCopy(t.from)},t.prototype.clone=function(){var e=new t;return e.speed=this.speed,e.isRect=this.isRect,e.isRotate=this.isRotate,e.rotateAngle=this.rotateAngle,e.decelerateDelta=this.decelerateDelta,e.isDecelerate=this.isDecelerate,e.delayDecelerate=this.delayDecelerate,e.size=this.size,e.isLaser=this.isLaser,e.laserRange=this.laserRange,e.isBoom=this.isBoom,e.isTracking=this.isTracking,e.resName=this.resName,e.lightName=this.lightName,e.lightColor=this.lightColor,e.lifeTime=this.lifeTime,e.isPhysical=this.isPhysical,e.delaytrack=this.delaytrack,e.fixedRotation=this.fixedRotation,e.statusType=this.statusType,e.statusRate=this.statusRate,e.canBreakBuilding=this.canBreakBuilding,e.isInvincible=this.isInvincible,e.splitBulletType=this.splitBulletType,e.splitTime=this.splitTime,e.splitArcExNum=this.splitArcExNum,e.splitLineExNum=this.splitLineExNum,e.damage=this.damage.clone(),e.from=this.from.clone(),e},t}();i.default=n,cc._RF.pop()},{"./DamageData":"DamageData","./FromData":"FromData"}],Bullet:[function(t,e,i){"use strict";cc._RF.push(e,"d243aeNu+tEJJbz1ng6i61f","Bullet");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=t("../logic/NonPlayer"),l=t("../logic/Player"),c=t("../data/DamageData"),u=t("../logic/Logic"),h=t("../boss/Boss"),d=t("../data/BulletData"),p=t("../manager/StatusManager"),f=t("../utils/AudioPlayer"),g=t("../data/FromData"),y=t("../building/HitBuilding"),m=t("../building/Wall"),v=t("../actor/AreaOfEffect"),E=t("../data/AreaOfEffectData"),_=t("../utils/IndexZ"),T=t("../building/ExitDoor"),D=t("../utils/ActorUtils"),S=t("../building/InteractBuilding"),O=t("../building/EnergyShield"),A=t("../utils/Utils"),C=t("../logic/MeleeShadowWeapon"),R=t("../logic/MeleeWeapon"),L=t("../logic/Shield"),b=t("../collider/CCollider"),P=t("../base/BaseColliderComponent"),I=t("../data/TriggerData"),M=cc._decorator,N=M.ccclass,w=M.property,H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boom=null,e.data=new d.default,e.dir=0,e.tagetPos=cc.v3(0,0),e.hv=cc.v2(0,0),e.isFromPlayer=!1,e.startPos=cc.v3(0,0),e.isTrackDelay=!1,e.isDecelerateDelay=!1,e.isHit=!1,e.isReserved=!1,e.aoeData=new E.default,e.currentLinearVelocity=cc.v2(0,0),e.timeDelay=0,e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.anim=this.getComponent(cc.Animation),this.collider=this.getComponent(b.default),this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.sprite.node.opacity=255,this.sprite.node.angle=0,this.light=this.node.getChildByName("light").getComponent(cc.Sprite),this.light.node.opacity=0},e.prototype.onEnable=function(){this.tagetPos=cc.v3(0,0),this.entity.NodeRender.node=this.node,this.entity.Move.linearVelocity=cc.v2(0,0),this.currentLinearVelocity=cc.v2(0,0),this.sprite||(this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite)),this.sprite.node.opacity=255,this.sprite.node.angle=0,this.light||(this.light=this.node.getChildByName("light").getComponent(cc.Sprite)),this.light.node.opacity=0,this.isTrackDelay=!1,this.isDecelerateDelay=!1,this.isHit=!1,this.isReserved=!1},e.prototype.update=function(t){if(u.default.isGamePause)this.entity.Move.linearVelocity=cc.v2(0,0);else{if(this.checkTimeDelay+=t,this.checkTimeDelay>.5&&(this.checkTraking(),this.checkTimeDelay=0),1==this.data.fixedRotation&&(this.node.angle=0),1==this.data.isDecelerate&&this.isDecelerateDelay&&(this.timeDelay+=t,this.timeDelay>.016)){this.timeDelay=0;var e=this.data.decelerateDelta>0?this.data.decelerateDelta:1;this.currentLinearVelocity=this.currentLinearVelocity.lerp(cc.v2(0,0),e*t)}this.entity.Move.linearVelocity=this.currentLinearVelocity}},e.prototype.checkTraking=function(){if(1==this.data.isTracking&&this.isTrackDelay&&!this.isHit){var t=this.hasNearEnemy();t.equals(cc.Vec3.ZERO)||(this.rotateCollider(cc.v2(t.x,t.y)),this.hv=cc.v2(t.x,t.y).normalize(),this.currentLinearVelocity=cc.v2(this.data.speed*this.hv.x,this.data.speed*this.hv.y))}},e.prototype.changeBullet=function(t){this.data=t,this.changeRes(t.resName,t.lightName,t.lightColor),this.collider.type=1!=t.isRect?b.default.TYPE.CIRCLE:b.default.TYPE.RECT,this.light.node.position=1==t.isRect?cc.v3(8,0):cc.v3(0,0),this.node.scale=t.size>0?t.size:1,this.collider.radius=16,this.collider.w=30,this.collider.h=14,this.collider.sensor=0==t.isPhysical},e.prototype.changeRes=function(t,e,i,o){if(this.sprite||(this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite)),this.sprite&&!(t.length<1)){var a=this.getSpriteFrameByName(t,o),n=this.getSpriteFrameByName(e,o);if(a&&(this.sprite.spriteFrame=a),n){this.light.spriteFrame=n;var r=cc.color(255,255,255).fromHEX(i);this.light.node.color=r}}},e.prototype.getSpriteFrameByName=function(t,e,i){var o=u.default.spriteFrameRes(t+e);return o||(o=u.default.spriteFrameRes(i?t+"anim000":t)),o},e.prototype.MeleeFinish=function(){this.shooter.addDestroyBullet(this.node)},e.prototype.showBullet=function(t){this.hv=t,this.rotateCollider(cc.v2(this.hv.x,this.hv.y)),this.fire(this.hv.clone())},e.prototype.BulletDestory=function(){this.sprite&&(this.sprite.spriteFrame=null),this.shooter.addDestroyBullet(this.node)},e.prototype.fire=function(t){var e=this;this.currentLinearVelocity=cc.v2(t.x,t.y).mul(this.data.speed),this.entity.Move.linearVelocity=this.currentLinearVelocity,this.startPos=this.node.convertToWorldSpaceAR(cc.v3(0,0)),this.sprite.node.stopAllActions(),this.node.stopAllActions();var i=this.sprite,o=cc.tween().delay(.1).call(function(){i.spriteFrame=e.getSpriteFrameByName(e.data.resName,"anim000",!0)}).delay(.1).call(function(){i.spriteFrame=e.getSpriteFrameByName(e.data.resName,"anim001",!0)}).delay(.1).call(function(){i.spriteFrame=e.getSpriteFrameByName(e.data.resName,"anim002",!0)}),a=cc.tween(this.sprite).parallel(o,cc.tween().by(.3,{angle:this.data.rotateAngle>0?this.data.rotateAngle:15}));this.data.isRotate>0?cc.tween(this.sprite.node).repeatForever(a).start():cc.tween(this.sprite.node).repeatForever(o).start(),this.unscheduleAllCallbacks(),this.data.lifeTime>0?this.scheduleOnce(function(){e.bulletHit()},this.data.lifeTime):this.scheduleOnce(function(){e.bulletHit()},30),this.isTrackDelay=!1,1==this.data.isTracking&&this.scheduleOnce(function(){e.isTrackDelay=!0},this.data.delaytrack),this.isDecelerateDelay=!1,1==this.data.isDecelerate&&this.scheduleOnce(function(){e.isDecelerateDelay=!0},this.data.delayDecelerate),this.data.splitTime>0&&this.data.splitBulletType.length>0&&this.scheduleOnce(function(){e.bulletHit();var t=e.node.convertToWorldSpaceAR(cc.Vec3.ZERO);e.shooter.fireSplitBullet(e.data.splitBulletType,e.node.angle,e.shooter.node.convertToNodeSpaceAR(t),e.data.splitArcExNum,e.data.splitLineExNum)},this.data.splitTime)},e.prototype.start=function(){},e.prototype.onColliderPreSolve=function(t,e){this.isFromPlayer||t.tag!=b.default.TAG.NONPLAYER&&t.tag!=b.default.TAG.BOSS||(e.disabledOnce=!0),!this.isFromPlayer||t.tag!=b.default.TAG.PLAYER&&t.tag!=b.default.TAG.GOODNONPLAYER||(e.disabledOnce=!0)},e.prototype.onColliderEnter=function(t){if(!t.sensor){var e=!0;if((t.tag==b.default.TAG.PLAYER||t.tag==b.default.TAG.NONPLAYER||t.tag==b.default.TAG.BOSS||t.tag==b.default.TAG.BULLET||t.tag==b.default.TAG.WARTER||t.sensor||this.data.isInvincible>0||t.tag==b.default.TAG.WALL_TOP)&&(e=!1),e)return void this.bulletHit()}var i=!0;this.isFromPlayer||t.tag!=b.default.TAG.NONPLAYER&&t.tag!=b.default.TAG.BOSS||(i=!1),!this.isFromPlayer||t.tag!=b.default.TAG.PLAYER&&t.tag!=b.default.TAG.GOODNONPLAYER||(i=!1),t.tag==b.default.TAG.BULLET&&(i=!1),i&&this.attacking(t.node,t.tag,t.sensor)},e.prototype.attacking=function(t,e,i){if(t&&!this.isHit){var o=new c.default,a=!1;o.valueCopy(this.data.damage),o.isRemote=!0;var n=!1;if(this.data.isInvincible>0)n=!1;else if(e==b.default.TAG.NONPLAYER||e==b.default.TAG.GOODNONPLAYER){var r=t.getComponent(s.default);r&&!r.sc.isDied&&((a=r.takeDamage(o))&&(this.addTargetAllStatus(r,new g.default),this.shooter.player&&this.shooter.player.exTrigger(I.default.GROUP_HIT,o.isCriticalStrike?I.default.TYPE_HIT_CRIT_REMOTE:I.default.TYPE_HIT_REMOTE,new g.default,r)),n=!0)}else if(e==b.default.TAG.PLAYER){var u=t.getComponent(l.default);if(u&&!u.sc.isDied){var d=!1;u.shield.Status==L.default.STATUS_PARRY&&1==u.shield.data.isReflect&&(d=this.revserseBullet(u.node.convertToWorldSpaceAR(cc.Vec2.ZERO))),d||((a=u.takeDamage(o,this.data.from))&&this.addTargetAllStatus(u,this.data.from),n=!0)}}else if(e==b.default.TAG.AOE){var p=t.getComponent(v.default);p&&p.IsAttacking&&p.data.canBreakBullet&&(n=!0)}else if(e==b.default.TAG.BOSS){var f=t.getComponent(h.default);f&&!f.sc.isDied&&((a=f.takeDamage(o))&&(this.addTargetAllStatus(f,new g.default),this.shooter.player&&this.shooter.player.exTrigger(I.default.GROUP_HIT,o.isCriticalStrike?I.default.TYPE_HIT_CRIT_REMOTE:I.default.TYPE_HIT_REMOTE,new g.default,f)),n=!0)}else if(e==b.default.TAG.PLAYER_HIT){var E=t.getComponent(R.default),_=void 0;if(E||(_=t.getComponent(C.default))&&(E=_.meleeWeapon),E&&E.IsAttacking&&!this.isFromPlayer){if(d=!1,E.IsReflect){var D=_?_.meleeWeapon.node:E.node;d=this.revserseBullet(D.convertToWorldSpaceAR(cc.Vec2.ZERO))}d||(n=!0)}}else if(e==b.default.TAG.BUILDING||e==b.default.TAG.WALL||e==b.default.TAG.WALL_TOP){var A=t.getComponent(S.default);if(1==this.data.canBreakBuilding&&A&&(a=!0,A.takeDamage(o)),!a){var P=t.getComponent(y.default);1==this.data.canBreakBuilding&&P&&(a=!0,P.takeDamage(o))}if(!a){var M=t.getComponent(m.default);M&&(n=M.isTop()?i:M.isSide()),n&&t.getComponent(T.default)&&(n=!1)}}else if(!this.isFromPlayer&&e==b.default.TAG.ENERGY_SHIELD){var N=t.getComponent(O.default);N&&N.isValid&&(a=N.takeDamage(o)),a&&(n=!0)}n&&this.bulletHit()}},e.prototype.revserseBullet=function(){if(this.isReserved)return this.isReserved=!0,!1;var t=-180+u.default.getRandomNum(0,10)-20;return this.node.angle+=t,this.currentLinearVelocity=this.currentLinearVelocity.rotate(t*Math.PI/180),this.isFromPlayer=!0,this.data.isTracking=0,!0},e.prototype.bulletHit=function(){if(!this.isHit){if(this.isHit=!0,this.anim&&!this.anim.getAnimationState("Bullet001Hit").isPlaying&&(this.currentLinearVelocity=cc.v2(0,0),this.entity.Move.linearVelocity=cc.v2(0,0),this.anim.play("Bullet001Hit")),this.data.isBoom>0){var t=cc.instantiate(this.boom).getComponent(v.default);t&&(t.show(this.node.parent,this.node.position,this.hv,0,(new E.default).init(1,.2,0,0,_.default.OVERHEAD,!this.isFromPlayer,!0,!0,!1,!1,new c.default(2),g.default.getClone("\u7206\u70b8","boom000anim004"),[])),cc.director.emit(r.EventHelper.PLAY_AUDIO,{detail:{name:f.default.BOOM}}),cc.director.emit(r.EventHelper.CAMERA_SHAKE,{detail:{isHeavyShaking:!0}}))}if(this.aoePrefab){var e=cc.instantiate(this.aoePrefab).getComponent(v.default);e&&e.show(this.node.parent,this.node.position,this.hv,0,this.aoeData)}}},e.prototype.hasNearEnemy=function(){return 1==this.data.isTracking&&this.dungeon?D.default.getDirectionFromNearestEnemy(this.node.position,!this.isFromPlayer,this.dungeon,!1,500):cc.Vec3.ZERO},e.prototype.rotateCollider=function(t){t.equals(cc.Vec2.ZERO)||1!=this.data.fixedRotation&&(this.node.angle=A.default.getRotateAngle(t,this.node.scaleX<0))},e.prototype.addTargetAllStatus=function(t,e){this.addTargetStatus(this.data.damage.iceRate,t,p.default.FROZEN,e),this.addTargetStatus(this.data.damage.fireRate,t,p.default.BURNING,e),this.addTargetStatus(this.data.damage.lighteningRate,t,p.default.DIZZ,e),this.addTargetStatus(this.data.damage.toxicRate,t,p.default.TOXICOSIS,e),this.addTargetStatus(this.data.damage.curseRate,t,p.default.CURSING,e),this.addTargetStatus(this.data.damage.realRate,t,p.default.BLEEDING,e),this.addTargetStatus(this.data.statusRate,t,this.data.statusType,e)},e.prototype.addTargetStatus=function(t,e,i,o){u.default.getRandomNum(0,100)<t&&e.addStatus(i,o)},n([w(cc.Prefab)],e.prototype,"boom",void 0),n([N],e)}(P.default);i.default=H,cc._RF.pop()},{"../actor/AreaOfEffect":"AreaOfEffect","../base/BaseColliderComponent":"BaseColliderComponent","../boss/Boss":"Boss","../building/EnergyShield":"EnergyShield","../building/ExitDoor":"ExitDoor","../building/HitBuilding":"HitBuilding","../building/InteractBuilding":"InteractBuilding","../building/Wall":"Wall","../collider/CCollider":"CCollider","../data/AreaOfEffectData":"AreaOfEffectData","../data/BulletData":"BulletData","../data/DamageData":"DamageData","../data/FromData":"FromData","../data/TriggerData":"TriggerData","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/MeleeShadowWeapon":"MeleeShadowWeapon","../logic/MeleeWeapon":"MeleeWeapon","../logic/NonPlayer":"NonPlayer","../logic/Player":"Player","../logic/Shield":"Shield","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/Utils":"Utils"}],CCollider:[function(t,e,i){"use strict";cc._RF.push(e,"8b89bNPNd5CPpD7MGNVsQ0f","CCollider");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../utils/Random"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tag=i.TAG.DEFAULT,e.offsetX=0,e.offsetY=0,e.type=i.TYPE.RECT,e.radius=64,e.w=128,e.h=128,e.bounce=0,e.sensor=!1,e.isStatic=!1,e.ignoreSameTag=!1,e.targetTagList=[],e.ignoreTagList=[],e.inColliders=new Map,e.id=i.genNonDuplicateID(),e.targetTags=new Map,e.ignoreTags=new Map,e.isStaying=!1,e._points=[],e.isRotate=!1,e._disableOnce=!1,e}var i;return a(e,t),i=e,Object.defineProperty(e.prototype,"disabledOnce",{get:function(){return this._disableOnce},set:function(t){this._disableOnce=t},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t){this.w=t.width,this.h=t.height},Object.defineProperty(e.prototype,"offset",{get:function(){return cc.v2(this.offsetX,this.offsetY)},set:function(t){this.offsetX=t.x,this.offsetY=t.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"w_radius",{get:function(){return this._radius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"w_center",{get:function(){return cc.v2(this._center)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._points},enumerable:!1,configurable:!0}),e.prototype.setOnContactListener=function(t){this.onContactListener=t},e.prototype.setEntityNode=function(t){this.entity.NodeRender.node=t},e.prototype.fixCenterAndScale=function(){this.isStaying=!1;var t=cc.v3(this.offsetX,this.offsetY);this._center=this.node.convertToWorldSpaceAR(cc.v3(this.offsetX,this.offsetY));var e=this.node.convertToWorldSpaceAR(t);this._radius=this.node.convertToWorldSpaceAR(t.add(cc.v3(this.radius,0))).sub(e).mag();var i=this.node.convertToWorldSpaceAR(t.add(cc.v3(this.w,0))).sub(e).mag(),o=this.node.convertToWorldSpaceAR(t.add(cc.v3(this.h,0))).sub(e).mag();if(this.isCircle)this.isRotate=!1,this._points=[],this._aabb=cc.rect(this._center.x-this._radius,this._center.y-this._radius,2*this._radius,2*this._radius);else{this._aabb=cc.rect(this._center.x-i/2,this._center.y-o/2,i,o);var a=this.node.convertToWorldSpaceAR(t.add(cc.v3(-this.w/2,-this.h/2))),n=this.node.convertToWorldSpaceAR(t.add(cc.v3(-this.w/2,this.h/2))),r=this.node.convertToWorldSpaceAR(t.add(cc.v3(this.w/2,this.h/2))),s=this.node.convertToWorldSpaceAR(t.add(cc.v3(this.w/2,-this.h/2)));if(this._points=[cc.v2(a),cc.v2(n),cc.v2(r),cc.v2(s)],this.isRotate=a.x!=n.x,this.isRotate){for(var l=[],c=this._points[0].clone(),u=0,h=1;h<this._points.length;h++)this._points[h].x<c.x&&(c=this._points[h].clone(),u=h);for(h=u;h<this._points.length;h++)l.push(this._points[h].clone());for(h=0;h<u;h++)l.push(this._points[h].clone());var d=Math.abs(l[0].x-l[2].x),p=Math.abs(l[1].y-l[3].y);this._aabb=cc.rect(l[0].x,l[1].y<l[3].y?l[1].y:l[3].y,d,p)}}},e.prototype.updateChildOffset=function(){},e.prototype.onLoad=function(){this.setTargetTags(this.targetTagList),this.setIgnoreTags(this.ignoreTagList)},e.prototype.setTargetTags=function(t,e){for(var i=0,o=t;i<o.length;i++){var a=o[i];e?this.targetTags.delete(a):this.targetTags.set(a,!0)}},e.prototype.setIgnoreTags=function(t,e){for(var i=0,o=t;i<o.length;i++){var a=o[i];e?this.ignoreTags.delete(a):this.ignoreTags.set(a,!0)}},e.prototype.preSolve=function(t){this.onContactListener&&this.onContactListener.onColliderPreSolve(t,this)},e.prototype.contact=function(t){this._disableOnce||t.disabledOnce||(this.inColliders.has(t.id)?(this.isStaying=!0,this.onContactListener&&this.onContactListener.onColliderStay(t,this)):(this.inColliders.set(t.id,!0),this.onContactListener&&this.onContactListener.onColliderEnter(t,this)))},e.prototype.physicTest=function(t){if(!(this._disableOnce||t.disabledOnce||!this.entity||!t.entity||this.sensor||t.sensor||this.isStatic)){var e=this._points,o=t._points;(this.isRotate||this.type==i.TYPE.CIRCLE||this.node.scaleX<0||this.node.scaleY<0)&&(e=[cc.v2(this.Aabb.x,this.Aabb.y),cc.v2(this.Aabb.x,this.Aabb.y+this.Aabb.height),cc.v2(this.Aabb.x+this.Aabb.width,this.Aabb.y+this.Aabb.height),cc.v2(this.Aabb.x+this.Aabb.width,this.Aabb.y)]),(t.isRotate||t.type==i.TYPE.CIRCLE||t.node.scaleX<0||t.node.scaleY<0)&&(o=[cc.v2(t.Aabb.x,t.Aabb.y),cc.v2(t.Aabb.x,t.Aabb.y+t.Aabb.height),cc.v2(t.Aabb.x+t.Aabb.width,t.Aabb.y+t.Aabb.height),cc.v2(t.Aabb.x+t.Aabb.width,t.Aabb.y)]);var a=e[3].x-e[0].x,n=o[3].x-o[0].x,r=e[1].y-e[0].y,s=o[1].y-o[0].y,l=cc.v2(e[0].x+a/2,e[0].y+r/2),c=cc.v2(o[0].x+n/2,o[0].y+s/2),u=cc.rect(e[0].x,e[0].y,a,r),h=cc.rect(o[0].x,o[0].y,n,s),d=e[0].x<o[0].x,p=e[2].x>o[2].x,f=e[1].y>o[1].y,g=e[0].y<o[0].y,y=this.entity.Move.linearVelocity.clone(),m=this.bounce>0?this.bounce:10,v=(r+s)/2-Math.abs(l.y-c.y),E=(a+n)/2-Math.abs(l.x-c.x);u.contains(c)||h.contains(l)?y=l.sub(c).normalizeSelf().mul(m):d&&y.x>=0&&E>0&&E<v?y.x=-m:p&&y.x<=0&&E>0&&E<v?y.x=m:f&&y.y<=0&&v>0&&E>v?y.y=m:g&&y.y>=0&&v>0&&E>v&&(y.y=-m),this.entity.Move.linearVelocity=y}},e.prototype.exit=function(t){this.inColliders.has(t.id)&&(this.inColliders.delete(t.id),this.disabledOnce=!1,this.onContactListener&&this.onContactListener.onColliderExit(t,this))},e.prototype.drawDebug=function(t){if(t){if(t.strokeColor=cc.color(255,255,255,160),t.fillColor=cc.color(255,255,255,60),t.lineWidth=4,this.type==i.TYPE.CIRCLE){var e=t.node.convertToNodeSpaceAR(cc.v3(this.w_radius,0)),o=t.node.convertToNodeSpaceAR(cc.v3(0,0)),a=t.node.convertToNodeSpaceAR(this.w_center);t.circle(a.x,a.y,e.sub(o).mag()),this.isStaying&&t.fill(),t.stroke()}else{var n=t.node.convertToNodeSpaceAR(this.points[0]);t.moveTo(n.x,n.y);for(var r=1;r<this.points.length;r++){var s=t.node.convertToNodeSpaceAR(this.points[r]);t.lineTo(s.x,s.y)}t.close(),this.isStaying&&t.fill(),t.stroke()}t.strokeColor=cc.color(255,0,0,160);var l=this.Aabb,c=t.node.convertToNodeSpaceAR(cc.v3(l.x,l.y)),u=t.node.convertToNodeSpaceAR(cc.v3(0,0)),h=t.node.convertToNodeSpaceAR(cc.v3(l.width,0)),d=t.node.convertToNodeSpaceAR(cc.v3(l.height,0));t.rect(c.x,c.y,h.sub(u).mag(),d.sub(u).mag()),t.stroke()}},Object.defineProperty(e.prototype,"Aabb",{get:function(){return this._aabb},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCircle",{get:function(){return this.type==i.TYPE.CIRCLE},enumerable:!1,configurable:!0}),e.prototype.start=function(){},e.genNonDuplicateID=function(){return Number(~~(1e6*r.default.rand())+Date.now())},e.TYPE=cc.Enum({CIRCLE:0,RECT:1}),e.GROUP=cc.Enum({DEFAULT:0,ACTOR:1}),e.TAG=cc.Enum({DEFAULT:0,WALL:1,WALL_TOP:2,PLAYER:3,PLAYER_HIT:4,NONPLAYER:5,NONPLAYER_HIT:6,GOODNONPLAYER:7,GOODNONPLAYER_HIT:8,BOSS:9,BOSS_HIT:10,BULLET:11,BUILDING:12,AOE:13,ITEM:14,EQUIPMENT:15,COIN:16,TIPS:17,WARTER:18,ENERGY_SHIELD:19,LIGHT:20,PLAYER_INTERACT:21,INTERACT:22}),n([c({type:i.TAG,displayName:"Collider Tag"})],e.prototype,"tag",void 0),n([c],e.prototype,"offsetX",void 0),n([c],e.prototype,"offsetY",void 0),n([c({type:i.TYPE,displayName:"Shape Type"})],e.prototype,"type",void 0),n([c({visible:function(){return this.type==i.TYPE.CIRCLE}})],e.prototype,"radius",void 0),n([c({visible:function(){return this.type==i.TYPE.RECT}})],e.prototype,"w",void 0),n([c({visible:function(){return this.type==i.TYPE.RECT}})],e.prototype,"h",void 0),n([c],e.prototype,"bounce",void 0),n([c],e.prototype,"sensor",void 0),n([c],e.prototype,"isStatic",void 0),n([c],e.prototype,"ignoreSameTag",void 0),n([c({type:[i.TAG],displayName:"Target Tag"})],e.prototype,"targetTagList",void 0),n([c({type:[i.TAG],displayName:"Ignore Tag",visible:function(){return this.targetTagList.length<1}})],e.prototype,"ignoreTagList",void 0),i=n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../utils/Random":"Random"}],CameraControl:[function(t,e,i){"use strict";cc._RF.push(e,"aaca098lw9M94SueX+ajVM7","CameraControl");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Dungeon"),s=t("./EventHelper"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dungeon=null,e.isShaking=!1,e.isHeavyShaking=!1,e.addOffset=cc.v3(0,0),e.offsetIndex=0,e.offsetArr=[cc.v3(0,2),cc.v3(0,2),cc.v3(0,-3),cc.v3(0,-3),cc.v3(1,2),cc.v3(1,2),cc.v3(-1,-1),cc.v3(-1,-1)],e.offsetArr1=[cc.v3(0,3),cc.v3(0,3),cc.v3(0,-6),cc.v3(0,-6),cc.v3(3,6),cc.v3(3,6),cc.v3(-3,-3),cc.v3(-3,-3)],e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.camera=this.getComponent(cc.Camera),s.EventHelper.on(s.EventHelper.CAMERA_SHAKE,function(e){t.shakeCamera(e.isHeavyShaking)}),s.EventHelper.on(s.EventHelper.CAMERA_LOOK,function(){t.addOffset=cc.v3(0,0),t.followTarget(!0)}),s.EventHelper.on(s.EventHelper.HUD_CAMERA_ZOOM_IN,function(){t.dungeon&&(t.dungeon.CameraZoom=r.default.DEFAULT_ZOOM_MAX)}),s.EventHelper.on(s.EventHelper.HUD_CAMERA_ZOOM_OUT,function(){t.dungeon&&(t.dungeon.CameraZoom=t.dungeon.needZoomIn?r.default.DEFAULT_ZOOM_MIN:r.default.DEFAULT_ZOOM)})},e.prototype.onEnable=function(){},e.prototype.onDisable=function(){},e.prototype.start=function(){},e.prototype.lateUpdate=function(){this.dungeon.cameraTargetNode&&this.followTarget(!1),this.camera.zoomRatio=this.lerpNumber(this.camera.zoomRatio,this.dungeon.CameraZoom,.05)},e.prototype.followTarget=function(t){if(this.dungeon&&this.dungeon.cameraTargetNode){var e=r.default.getPosInMap(cc.v3(r.default.WIDTH_SIZE-4,0)).x,i=r.default.getPosInMap(cc.v3(3,0)).x,o=r.default.getPosInMap(cc.v3(0,r.default.HEIGHT_SIZE-3)).y,a=r.default.getPosInMap(cc.v3(0,2)).y,n=cc.v3(0,0);this.dungeon.cameraTargetNode.x<i&&(n.x=i-this.dungeon.cameraTargetNode.x),this.dungeon.cameraTargetNode.x>e&&(n.x=e-this.dungeon.cameraTargetNode.x),this.dungeon.cameraTargetNode.y<a&&(n.y=a-this.dungeon.cameraTargetNode.y),this.dungeon.cameraTargetNode.y>o&&(n.y=o-this.dungeon.cameraTargetNode.y);var s=this.dungeon.node.convertToWorldSpaceAR(this.dungeon.cameraTargetNode.position.clone().addSelf(n));this.node.position=t?this.node.parent.convertToNodeSpaceAR(s):this.lerp(this.node.position,this.node.parent.convertToNodeSpaceAR(s),.1),this.isShaking&&(this.offsetIndex>this.offsetArr.length-1&&(this.offsetIndex=0),this.node.position=this.node.position.addSelf(this.isHeavyShaking?this.offsetArr1[this.offsetIndex]:this.offsetArr[this.offsetIndex]),this.offsetIndex++)}},e.prototype.shakeCamera=function(t){var e=this;this.node&&(this.isHeavyShaking=t,this.isShaking=!0,this.scheduleOnce(function(){e.isShaking=!1},.2))},e.prototype.lerpNumber=function(t,e,i){return t+(e-t)*i},e.prototype.lerp=function(t,e,i){var o=cc.v3(0,0),a=t.x,n=t.y;return o.x=a+(e.x-a)*i,o.y=n+(e.y-n)*i,o},n([u(r.default)],e.prototype,"dungeon",void 0),n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"./Dungeon":"Dungeon","./EventHelper":"EventHelper"}],CampFire:[function(t,e,i){"use strict";cc._RF.push(e,"1c424MJYhhGnYiXSF5IIdkC","CampFire");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Building"),s=t("../collider/CCollider"),l=t("../data/FromData"),c=t("../logic/Player"),u=t("../manager/StatusManager"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isAddTime=!0,e.timeDelay=0,e}return a(e,t),e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>5&&(this.timeDelay=0,!0)},e.prototype.update=function(t){this.isTimeDelay(t)&&(this.isAddTime=!0)},e.prototype.onColliderEnter=function(){},e.prototype.onColliderStay=function(t,e){if(e.sensor&&t.tag==s.default.TAG.PLAYER&&this.isAddTime){this.isAddTime=!1;var i=t.getComponent(c.default);i&&i.addStatus(u.default.CAMP_FIRE,new l.default)}},e.prototype.onColliderExit=function(){},n([d],e)}(r.default));i.default=p,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/FromData":"FromData","../logic/Player":"Player","../manager/StatusManager":"StatusManager","./Building":"Building"}],CaptainSword:[function(t,e,i){"use strict";cc._RF.push(e,"e541b/KaoRBdL9VgXHoN6dM","CaptainSword");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../data/FromData"),l=t("./Captain"),c=t("../utils/ActorUtils"),u=t("../base/BaseColliderComponent"),h=cc._decorator,d=h.ccclass,p=h.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.damage=3,e.parentNode=null,e.isShow=!1,e}return a(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this)},e.prototype.start=function(){this.isShow=!1},e.prototype.onColliderEnter=function(t){var e=c.default.getEnemyCollisionTarget(t);if(e&&this.isShow&&this.node.active){this.isShow=!1;var i=new r.default;i.physicalDamage=this.damage,e.takeDamage(i,s.default.getClone(this.actorName(),"captain_head"),this.parentNode.getComponent(l.default))}},e.prototype.actorName=function(){return"\u90aa\u6076\u8239\u957f"},n([p],e.prototype,"damage",void 0),n([p(cc.Node)],e.prototype,"parentNode",void 0),n([d],e)}(u.default);i.default=f,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../data/DamageData":"DamageData","../data/FromData":"FromData","../utils/ActorUtils":"ActorUtils","./Captain":"Captain"}],Captain:[function(t,e,i){"use strict";cc._RF.push(e,"6d826iFR+pBDJHGFIoYZ400","Captain");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./CaptainSword"),s=t("../logic/Dungeon"),l=t("../logic/EventHelper"),c=t("../logic/Shooter"),u=t("../data/DamageData"),h=t("./Boss"),d=t("../utils/NextStep"),p=t("../utils/AudioPlayer"),f=t("../data/FromData"),g=t("../logic/Achievement"),y=t("../utils/ActorUtils"),m=t("../logic/Logic"),v=t("../collider/CCollider"),E=cc._decorator,_=E.ccclass,T=E.property,D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sword=null,e.healthBar=null,e.isFaceRight=!0,e.isMoving=!1,e.timeDelay=0,e.isFall=!1,e.shooter=null,e.exshooter=null,e.attackSkill=new d.default,e.fireSkill=new d.default,e.jumpSkill=new d.default,e}return a(e,t),e.prototype.init=function(){},e.prototype.onLoad=function(){this.attackSkill.IsExcuting=!1,this.sc.isDied=!1,this.anim=this.getComponent(cc.Animation),this.shooter=this.node.getChildByName("Shooter").getComponent(c.default),this.exshooter=this.node.getChildByName("ExShooter").getComponent(c.default),this.shooter.from.valueCopy(f.default.getClone(this.actorName(),"captain_head")),this.exshooter.from.valueCopy(f.default.getClone(this.actorName(),"captain_head")),this.updatePlayerPos(),this.entity.NodeRender.node=this.node,this.entity.Move.linearDamping=10},e.prototype.start=function(){t.prototype.start.call(this)},e.prototype.AttackDamageStart=function(){this.sword.isShow=!0},e.prototype.AttackDamageFinish=function(){this.sword.isShow=!1},e.prototype.AttackStart=function(){this.attackSkill.IsExcuting=!0,cc.director.emit(l.EventHelper.PLAY_AUDIO,{detail:{name:p.default.MELEE}})},e.prototype.AttackFinish=function(){this.attackSkill.IsExcuting=!1},e.prototype.JumpStart=function(){this.jumpSkill.IsExcuting=!0,this.getComponent(v.default).sensor=!0},e.prototype.FireSwordLight=function(){this.shooter.setHv(cc.v2(this.isFaceRight?1:-1,0)),this.shooter.dungeon=this.dungeon,this.shooter.data.bulletType="bullet043",this.shooter.fireBullet(0,cc.v3(16,0))},e.prototype.JumpFinish=function(){var t=this;if(this.jumpSkill.IsExcuting=!1,this.isFall=!0,this.scheduleOnce(function(){t.isFall=!1},.1),this.getComponent(v.default).sensor=!1,this.dungeon&&this.exshooter){var e=this.dungeon.player.getCenterPosition().sub(this.node.position);e.equals(cc.Vec3.ZERO)||(e=e.normalizeSelf(),this.exshooter.setHv(cc.v2(e)),this.exshooter.dungeon=this.dungeon,this.exshooter.data.bulletType="bullet033",this.exshooter.data.bulletArcOffsetX=64,this.exshooter.data.bulletArcExNum=99,this.exshooter.data.bulletArcOffsetX=32,this.exshooter.data.bulletLineInterval=1,this.data.currentHealth<this.data.Common.maxHealth/2&&(this.exshooter.data.bulletLineExNum=1),this.exshooter.fireBullet(0,cc.v3(16,0)))}},e.prototype.fireWithGun=function(){if(this.dungeon&&this.shooter){var t=this.dungeon.player.getCenterPosition().sub(this.entity.Transform.position);t.equals(cc.Vec3.ZERO)||(this.shooter.setHv(cc.v2(t).normalize()),this.shooter.dungeon=this.dungeon,this.shooter.data.bulletType="bullet102",this.shooter.fireBullet(0,cc.v3(16,0)))}},e.prototype.OpenFire=function(){var t=this;this.dungeon&&this.shooter&&(this.shooter.data.bulletArcExNum=0,this.fireWithGun(),this.data.currentHealth<this.data.Common.maxHealth/2&&this.scheduleOnce(function(){t.fireWithGun()},.5))},e.prototype.onColliderStay=function(t,e){if(e.tag==v.default.TAG.BOSS_HIT){var i=y.default.getEnemyCollisionTarget(t);if(i&&this.isFall&&!this.sc.isDied){this.isFall=!1;var o=new u.default;o.physicalDamage=2,i.takeDamage(o,f.default.getClone(this.actorName(),"captain_head"),this)}}},e.prototype.updateLogic=function(t){m.default.isGamePause||(this.healthBar.node.active=!this.sc.isDied,this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,this.bossAction(),this.JumpMove()),this.dungeon&&this.getNearPlayerDistance(this.dungeon.player.node)<96&&(this.entity.Move.linearVelocity=cc.Vec2.ZERO),this.sc.isDied&&(this.entity.Move.linearVelocity=cc.Vec2.ZERO),this.healthBar.node.active=!this.sc.isDied,this.data.currentHealth<1&&this.killed(),this.node.scaleX=this.isFaceRight?1:-1)},e.prototype.takeDamage=function(t){var e=this.anim.getAnimationState("CaptainJump").isPlaying;if(this.sc.isDied||e)return!1;this.data.currentHealth-=this.data.getDamage(t).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth);var i=[p.default.MONSTER_HIT,p.default.MONSTER_HIT1,p.default.MONSTER_HIT2];return p.default.play(i[m.default.getRandomNum(0,2)]),!0},e.prototype.killed=function(){var t=this;this.sc.isDied||(g.default.addMonsterKillAchievement(this.data.resName),this.sc.isDied=!0,this.anim.play("CaptainDie"),this.getComponent(v.default).sensor=!0,this.scheduleOnce(function(){t.node&&(t.node.active=!1)},5),this.getLoot())},e.prototype.bossAction=function(){var t=this;if(!this.sc.isDied&&this.dungeon){this.entity.Transform.position=s.default.fixOuterMap(this.entity.Transform.position),this.pos=s.default.getIndexInMap(this.entity.Transform.position),this.changeZIndex();var e=this.dungeon.player.pos.clone(),i=s.default.getPosInMap(e).sub(this.entity.Transform.position),o=this.getNearPlayerDistance(this.dungeon.player.node),a=this.anim.getAnimationState("CaptainJump").isPlaying,n=this.anim.getAnimationState("CaptainFire").isPlaying,r=i.x,l=i.y;if(Math.abs(r),Math.abs(l),this.isFaceRight=r>0,!a&&!n){var c=200;a||this.fireSkill.next(function(){c=50,t.anim.play("CaptainFire")},5),o<140&&!this.dungeon.player.sc.isDied?this.attackSkill.next(function(){t.attackSkill.IsExcuting=!0,t.anim.play("CaptainAttack")},1):(o>300&&this.jumpSkill.next(function(){t.anim.play("CaptainJump"),a=!0},8),i.equals(cc.Vec3.ZERO)||a||this.attackSkill.IsExcuting||(i=i.normalizeSelf(),this.move(i,c)))}}},e.prototype.JumpMove=function(){if(this.dungeon&&this.jumpSkill.IsExcuting){var t=this.dungeon.player.pos.clone(),e=s.default.getPosInMap(t).sub(this.entity.Transform.position);e.equals(cc.Vec3.ZERO)||(this.pos=s.default.getIndexInMap(this.entity.Transform.position));var i=e.x,o=e.y,a=(Math.abs(i),Math.abs(o),cc.v2(i,o)),n=200;this.data.currentHealth<this.data.Common.maxHealth/2&&(n=240),a=a.normalize().mul(n),this.entity.Move.linearVelocity=a,this.isMoving=0!=i||0!=o}},e.prototype.move=function(t,e){if(!this.sc.isDied){this.attackSkill.IsExcuting&&!t.equals(cc.Vec3.ZERO)&&(t=t.mul(.5)),t.equals(cc.Vec3.ZERO)||(this.pos=s.default.getIndexInMap(this.entity.Transform.position));var i=t.x,o=t.y,a=(Math.abs(i),Math.abs(o),cc.v2(i,o));a=a.normalize().mul(e),this.entity.Move.linearVelocity=a,this.isMoving=0!=i||0!=o,this.isMoving&&(this.isFaceRight=i>0),this.isMoving?this.anim.getAnimationState("CaptainMove").isPlaying||this.anim.playAdditive("CaptainMove"):this.anim.getAnimationState("CaptainMove").isPlaying&&this.anim.play("CaptainIdle"),this.changeZIndex()}},e.prototype.actorName=function(){return"\u90aa\u6076\u8239\u957f"},n([T(r.default)],e.prototype,"sword",void 0),n([_],e)}(h.default);i.default=D,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/NextStep":"NextStep","./Boss":"Boss","./CaptainSword":"CaptainSword"}],CellphoneData:[function(t,e,i){"use strict";cc._RF.push(e,"ca606JzDZxBpJXGyzhO8Xom","CellphoneData");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("./BaseData"),r=t("./FurnitureData"),s=t("./ItemData"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.createTime=0,e.type=0,e}return a(e,t),e.prototype.valueCopy=function(t){t&&(this.type=t.type?t.type:0,this.price=t.price?t.price:0,t.furnitureData&&(this.furnitureData=new r.default,this.furnitureData.valueCopy(t.furnitureData),this.price=this.furnitureData.price),t.itemData&&(this.itemData=new s.default,this.itemData.valueCopy(t.itemData)),this.itemData=t.itemData,this.createTime=t.createTime?t.createTime:0)},e.prototype.clone=function(){var t=new e;return t.furnitureData=this.furnitureData,t.itemData=this.itemData,t.createTime=this.createTime,t.type=this.type,t.price=this.price,t},e.prototype.setEmpty=function(){this.type=0,this.furnitureData=null,this.itemData=null,this.createTime=0,this.price=0},e}(n.default);i.default=l,cc._RF.pop()},{"./BaseData":"BaseData","./FurnitureData":"FurnitureData","./ItemData":"ItemData"}],CellphoneDialog:[function(t,e,i){"use strict";cc._RF.push(e,"7e27cFOFVVGe4YHWxa4+CC5","CellphoneDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../../logic/Achievement"),s=t("../../data/CellphoneData"),l=t("../../data/FurnitureData"),c=t("../../logic/EventHelper"),u=t("../../logic/Logic"),h=t("../../utils/AudioPlayer"),d=t("../../utils/LocalStorage"),p=t("../../utils/Utils"),f=t("../CellphoneItem"),g=t("./BaseDialog"),y=t("./EquipmentAndItemDialog"),m=cc._decorator,v=m.ccclass,E=m.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.item=null,e.content=null,e.equipmentAndItemDialogPrefab=null,e.buyButton=null,e.list=[],e.itemSelect=null,e.tabSelect=null,e.priceLabel=null,e.hourLabel=null,e.dayLabel=null,e.equipmentAndItemDialog=null,e.itemList=[],e.tabIndex=0,e.checkTimeChangeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){this.itemSelect.opacity=0,this.equipmentAndItemDialog=this.initDialog(),this.dayLabel.string=p.default.getDay(u.default.realTime),this.hourLabel.string=p.default.getHour(u.default.realTime),this.updateList(this.tabIndex)},e.prototype.initDialog=function(){var t=cc.instantiate(this.equipmentAndItemDialogPrefab);t.parent=this.node;var e=t.getComponent(y.default);return e.changeBgAndAnchor(y.default.BG_TYPE_ARROW_NONE),e.hideDialog(),e},e.prototype.getItem=function(t,e){var i=cc.instantiate(this.item);i.parent=this.content;var o=i.getComponent(f.default);return o.init(this,t,e),o},e.prototype.start=function(){},e.prototype.show=function(){t.prototype.show.call(this),this.updateList(this.tabIndex)},e.prototype.changeTab=function(t,e){0==e?(this.tabSelect.position=cc.v3(-96,320),h.default.play(h.default.SELECT)):(this.tabSelect.position=cc.v3(96,320),h.default.play(h.default.SELECT_FAIL)),this.updateList(e)},e.prototype.clearSelect=function(){this.currentSelectIndex=-1,this.equipmentAndItemDialog.hideDialog(),this.buyButton.active=!1,this.priceLabel.string="",this.itemSelect.opacity=0},e.prototype.showSelect=function(t){this.currentSelectIndex=t.index,this.itemSelect.parent=t.node,this.itemSelect.position=cc.Vec3.ZERO,this.itemSelect.opacity=200,h.default.play(h.default.SELECT),this.priceLabel.string=""+Math.floor(t.data.price),this.buyButton.active=!0,this.equipmentAndItemDialog.showDialog(cc.v3(-240,160),null,t.data.itemData,null,t.data.furnitureData)},e.prototype.updateList=function(t){this.clearSelect(),this.list=[],this.content.removeAllChildren(),this.tabIndex=t;var e=[];if(0==t){var i=[],o=[],a=0;for(var n in u.default.furnitures){var r=new l.default;if(r.valueCopy(u.default.furnitures[n]),!(r.price<=0)){var c=d.default.getFurnitureData(r.id);c&&(r.isOpen=c.isOpen,r.purchased=c.purchased);var h=new s.default;h.createTime=(new Date).getTime(),h.type=f.default.TYPE_FURNITURE,h.furnitureData=r,r.purchased?o.push(h):i.push(h),this.list.push(this.getItem(a++,h))}}e=i.concat(o);for(var g=0;g<this.list.length;g++)this.list[g].updateData(e[g])}else p.default.toast("\u8fd9\u91cc\u7a7a\u7a7a\u5982\u4e5f\u3002",!0)},e.prototype.sale=function(){if(-1!=this.currentSelectIndex&&this.list[this.currentSelectIndex].data.type!=f.default.TYPE_EMPTY){var t=this.list[this.currentSelectIndex];if(t.data.type==f.default.TYPE_FURNITURE){var e=t.data.furnitureData;!e.purchased&&u.default.coins>=e.price?(c.EventHelper.emit(c.EventHelper.HUD_ADD_COIN,{count:-e.price}),h.default.play(h.default.COIN),t.data.furnitureData.purchased=!0,t.updateData(),r.default.addFurnituresAchievement(e.id),d.default.saveFurnitureData(e),this.clearSelect(),p.default.toast("\u8d2d\u4e70\u6210\u529f,\u5feb\u9012\u5728\u7728\u773c\u4e4b\u95f4\u5c31\u5230\u4e86",!0,!0),h.default.play(h.default.CASHIERING),c.EventHelper.emit(c.EventHelper.HUD_FURNITURE_REFRESH,{id:e.id})):(p.default.toast("\u8d2d\u4e70\u5931\u8d25\uff0c\u4f59\u989d\u4e0d\u8db3",!0,!0),h.default.play(h.default.SELECT_FAIL))}}},e.prototype.update=function(t){this.isCheckTimeChangeDelay(t)&&(this.dayLabel.string=p.default.getDay(u.default.realTime),this.hourLabel.string=p.default.getHour(u.default.realTime))},e.prototype.isCheckTimeChangeDelay=function(t){return this.checkTimeChangeDelay+=t,this.checkTimeChangeDelay>1&&(this.checkTimeChangeDelay=0,!0)},e.prototype.close=function(){h.default.play(h.default.SELECT),this.dismiss(),this.content.removeAllChildren()},e.prototype.waitOneHour=function(){u.default.realTime+=36e5,this.dayLabel.string=p.default.getDay(u.default.realTime),this.hourLabel.string=p.default.getHour(u.default.realTime)},n([E(cc.Prefab)],e.prototype,"item",void 0),n([E(cc.Node)],e.prototype,"content",void 0),n([E(cc.Prefab)],e.prototype,"equipmentAndItemDialogPrefab",void 0),n([E(cc.Node)],e.prototype,"buyButton",void 0),n([E(cc.Node)],e.prototype,"itemSelect",void 0),n([E(cc.Node)],e.prototype,"tabSelect",void 0),n([E(cc.Label)],e.prototype,"priceLabel",void 0),n([E(cc.Label)],e.prototype,"hourLabel",void 0),n([E(cc.Label)],e.prototype,"dayLabel",void 0),n([v],e)}(g.default);i.default=_,cc._RF.pop()},{"../../data/CellphoneData":"CellphoneData","../../data/FurnitureData":"FurnitureData","../../logic/Achievement":"Achievement","../../logic/EventHelper":"EventHelper","../../logic/Logic":"Logic","../../utils/AudioPlayer":"AudioPlayer","../../utils/LocalStorage":"LocalStorage","../../utils/Utils":"Utils","../CellphoneItem":"CellphoneItem","./BaseDialog":"BaseDialog","./EquipmentAndItemDialog":"EquipmentAndItemDialog"}],CellphoneItem:[function(t,e,i){"use strict";cc._RF.push(e,"998cfMDHbFCeYkBTaoitXnc","CellphoneItem");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/CellphoneData"),s=t("../logic/Logic"),l=t("../utils/AudioPlayer"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isSelect=!1,e.sprite=null,e.label=null,e.disableCover=null,e.index=0,e.data=new r.default,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_END,function(){t.isSelect&&t.index==t.dialog.currentSelectIndex?t.isSelect=!1:t.isSelect=t.data.type!=i.TYPE_EMPTY,t.data.type==i.TYPE_FURNITURE&&t.data.furnitureData&&t.data.furnitureData.purchased&&(t.isSelect=!1),t.dialog.clearSelect(),t.isSelect?t.dialog.showSelect(t):l.default.play(l.default.SELECT_FAIL)},this)},e.prototype.init=function(t,e,i){this.dialog=t,this.index=e,this.isSelect=!1,this.updateData(i)},e.prototype.updateData=function(t){this.isSelect=!1,this.data.valueCopy(t),this.label.string="",this.sprite.spriteFrame=null,this.disableCover.active=!1;var e=null;if(this.data.type==i.TYPE_ITEM&&this.data.itemData?(this.label.string=this.data.itemData.nameCn+"\n"+this.data.itemData.price,e=s.default.spriteFrameRes(this.data.itemData.resName)):this.data.type==i.TYPE_FURNITURE&&this.data.furnitureData&&(e=s.default.spriteFrameRes(this.data.furnitureData.resName),this.label.string=this.data.furnitureData.nameCn+"\n"+this.data.furnitureData.price,this.disableCover.active=this.data.furnitureData.purchased),e){this.sprite.spriteFrame=e;var o=e.getOriginalSize().width,a=e.getOriginalSize().height;this.sprite.node.width=4*o,this.sprite.node.height=4*a,this.sprite.node.height>128&&(this.sprite.node.height=128,this.sprite.node.width=128/e.getOriginalSize().height*e.getOriginalSize().width)}},e.prototype.setEmpty=function(){this.label.string="",this.sprite.spriteFrame=null},e.prototype.start=function(){},e.TYPE_EMPTY=0,e.TYPE_FURNITURE=1,e.TYPE_ITEM=2,n([h(cc.Sprite)],e.prototype,"sprite",void 0),n([h(cc.Label)],e.prototype,"label",void 0),n([h(cc.Node)],e.prototype,"disableCover",void 0),i=n([u],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../data/CellphoneData":"CellphoneData","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer"}],Cellphone:[function(t,e,i){"use strict";cc._RF.push(e,"d0343ZPI0tH4L2hhGPghjrG","Cellphone");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=t("../utils/AudioPlayer"),l=t("./dialog/CellphoneDialog"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dialog=null,e.isOpen=!1,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.anim=this.getComponent(cc.Animation),r.EventHelper.on(r.EventHelper.HUD_CELLPHONE_SHOW,function(){t.node&&(t.isOpen||(s.default.play(s.default.SELECT),t.anim.play("CellphoneShow")))}),this.node.on(cc.Node.EventType.TOUCH_END,function(){t.isOpen||(s.default.play(s.default.SELECT),t.anim.play("CellphoneShow"))},this),this.dialog.onDismissListener(function(){t.anim.play("CellphoneHide")})},e.prototype.Show=function(){this.dialog.show()},e.prototype.Hide=function(){this.isOpen=!1},n([h(l.default)],e.prototype,"dialog",void 0),n([u],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../logic/EventHelper":"EventHelper","../utils/AudioPlayer":"AudioPlayer","./dialog/CellphoneDialog":"CellphoneDialog"}],ChapterData:[function(t,e,i){"use strict";cc._RF.push(e,"fb6073McgVKOpRjZZ5su/Nf","ChapterData"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(t){this.chapter=0,this.list=[],this.chapter=t},cc._RF.pop()},{}],Chapter:[function(t,e,i){"use strict";cc._RF.push(e,"e966c6tQ3FASbN1WCJi24PI","Chapter");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Logic"),s=t("../utils/AudioPlayer"),l=t("../ui/StartBackground"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.chapter00=null,e.chapter01=null,e.chapter02=null,e.chapter03=null,e.chapter04=null,e.timeDelay=0,e}return a(e,t),e.prototype.start=function(){},e.prototype.clickChapter=function(t,e){if(e){r.default.profileManager.clearData(),r.default.jumpChapter=parseInt(e),s.default.play(s.default.SELECT);var i=this.getComponentInChildren(l.default);i&&i.startPressed(),this.scheduleOnce(function(){cc.director.loadScene("pickavatar")},1)}},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},n([h(cc.Button)],e.prototype,"chapter00",void 0),n([h(cc.Button)],e.prototype,"chapter01",void 0),n([h(cc.Button)],e.prototype,"chapter02",void 0),n([h(cc.Button)],e.prototype,"chapter03",void 0),n([h(cc.Button)],e.prototype,"chapter04",void 0),n([u],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../ui/StartBackground":"StartBackground","../utils/AudioPlayer":"AudioPlayer","./Logic":"Logic"}],Chest:[function(t,e,i){"use strict";cc._RF.push(e,"a259fOC11hFpJCy2hycs7kH","Chest");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/EventHelper"),l=t("../logic/Logic"),c=t("./Building"),u=t("../utils/AudioPlayer"),h=t("../utils/IndexZ"),d=t("../collider/CCollider"),p=cc._decorator,f=p.ccclass,g=p.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.openSpriteFrame=null,e.closeSpriteFrame=null,e}return a(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite")},e.prototype.start=function(){},e.prototype.setQuality=function(t,e){this.data.quality=t,this.data.isOpen=e,this.sprite||(this.sprite=this.node.getChildByName("sprite"));var i="chest001",o="chestopen001";switch(t){case 1:i="chest001",o="chestopen001";break;case 2:i="chest003",o="chestopen003";break;case 3:case 4:i="chest002",o="chestopen002"}var a=l.default.spriteFrameRes(i),n=l.default.spriteFrameRes(o);this.openSpriteFrame=a,this.closeSpriteFrame=n,this.sprite.getComponent(cc.Sprite).spriteFrame=this.openSpriteFrame,e&&(this.sprite.getComponent(cc.Sprite).spriteFrame=this.closeSpriteFrame)},e.prototype.seDefaultPos=function(t){this.data.defaultPos=t,this.entity.Transform.position=r.default.getPosInMap(t),this.node.position=this.entity.Transform.position.clone(),this.node.zIndex=h.default.getActorZIndex(this.entity.Transform.position)},e.prototype.openChest=function(){var t=this;if(!this.data.isOpen){this.data.isOpen=!0,cc.director.emit(s.EventHelper.PLAY_AUDIO,{detail:{name:u.default.PICK_UP}}),cc.tween(this.sprite).to(.1,{position:cc.v3(5,16)}).to(.1,{position:cc.v3(-5,0)}).to(.1,{position:cc.v3(5,0)}).to(.1,{position:cc.v3(-5,0)}).to(.1,{position:cc.v3(0,0)}).call(function(){if(t.sprite.getComponent(cc.Sprite).spriteFrame=t.closeSpriteFrame,t.node.parent){var e=t.node.parent.getComponent(r.default);if(e){var i=l.default.mapManager.getRandom4Save(t.seed);l.default.isCheatMode&&(e.addEquipment("weapon016",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("weapon017",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("weapon018",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("weapon019",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("weapon033",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("shield004",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("shield007",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("helmet006",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("clothes010",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("clothes025",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("shoes003",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("shoes006",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("clothes011",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("trousers005",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality),e.addEquipment("gloves006",r.default.getPosInMap(t.data.defaultPos),null,t.data.quality)),e.addEquipment(l.default.getRandomEquipType(i),r.default.getPosInMap(t.data.defaultPos),null,t.data.quality)}}}).start();var e=l.default.mapManager.getCurrentMapBuilding(this.data.defaultPos);e?(e.isOpen=this.data.isOpen,e.quality=this.data.quality):l.default.mapManager.setCurrentBuildingData(this.data.clone())}},e.prototype.onColliderStay=function(t){t.tag==d.default.TAG.PLAYER&&(this.data.isOpen||this.openChest())},n([g(cc.SpriteFrame)],e.prototype,"openSpriteFrame",void 0),n([g(cc.SpriteFrame)],e.prototype,"closeSpriteFrame",void 0),n([f],e)}(c.default);i.default=y,cc._RF.pop()},{"../collider/CCollider":"CCollider","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","./Building":"Building"}],ChunkData:[function(t,e,i){"use strict";cc._RF.push(e,"2e5707we6VLmaJfbSZnGeFv","ChunkData"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(){},cc._RF.pop()},{}],ChunkLookCamera:[function(t,e,i){"use strict";cc._RF.push(e,"86753OU1JJLlZ74OEo6fP9C","ChunkLookCamera");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.target=null,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.camera=this.getComponent(cc.Camera),cc.director.on(r.EventHelper.CAMERA_LOOK,function(e){t.lookAt(e.detail.position)})},e.prototype.lookAt=function(t){this.targetPosition=t},e.prototype.lateUpdate=function(){this.targetPosition,this.node.position=this.lerp(this.node.position,this.node.parent.convertToNodeSpaceAR(this.target.convertToWorldSpaceAR(cc.Vec3.ZERO)),.1)},e.prototype.lerp=function(t,e,i){var o=cc.v3(0,0),a=t.x,n=t.y;return o.x=a+(e.x-a)*i,o.y=n+(e.y-n)*i,o},n([c(cc.Node)],e.prototype,"target",void 0),n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../logic/EventHelper":"EventHelper"}],ChunkWorld:[function(t,e,i){"use strict";cc._RF.push(e,"8888aikYhVNfJXCQphMoSyV","ChunkWorld");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Chunk"),s=t("../logic/EventHelper"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.chunkPrefab=null,e.worldMap=new Array,e.currentMap=new Array,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;Math.floor(i.SIZE/2),cc.director.on(s.EventHelper.CHUNK_LOAD,function(e){var o=e.detail.pos,a=i.getIndexInMap(o,t.currentMap[0][0].targetPosition);cc.log(a),t.changeMap(a.x,a.y)}),this.initMap()},e.prototype.initMap=function(){for(var t=0;t<i.SIZE;t++){this.currentMap[t]=new Array(t);for(var e=0;e<i.SIZE;e++){var o=cc.instantiate(this.chunkPrefab);o.parent=this.node,o.position=i.getPosInMap(cc.v3(t,e)),o.zIndex=100;var a=o.getComponent(r.default);a.data.x=t,a.data.y=e,this.currentMap[t][e]=a,a.targetPosition=o.position.clone(),a.loadMap()}}this.printMapIndex()},e.prototype.getTargetChunkPos=function(){cc.v3(this.currentMap[0][0].data.x,this.currentMap[0][0].data.y)},e.prototype.changeMap=function(t,e){var o=Math.floor(i.SIZE/2);if(t!=o||e!=o){for(var a=this.currentMap[t][e].targetPosition.clone(),n=new Array,r=0;r<i.SIZE;r++){n[r]=new Array(r);for(var s=0;s<i.SIZE;s++){var l=this.getCorrectIndex(cc.v3(t,e),cc.v3(r,s));if(n[r][s]=this.currentMap[l.x][l.y],n[r][s].data.x=r,n[r][s].data.y=s,1==l.z){var c=cc.v3(r,s).subSelf(cc.v3(o,o)),u=i.getPosInMap(c);n[r][s].targetPosition=a.clone().addSelf(u),n[r][s].loadMap()}}}this.printMapIndex(),this.currentMap=n}},e.prototype.printMapIndex=function(){for(var t=i.SIZE-1;t>=0;t--)for(var e=0;e<i.SIZE;e++)this.currentMap[e][t].data.x,this.currentMap[e][t].data.y},e.prototype.getCorrectIndex=function(t,e){var o=Math.floor(i.SIZE/2),a=e.clone(),n=t.x-o,r=t.y-o;a.x=a.x+n,a.y=a.y+r;var s=!1;return a.x<0?(a.x=a.x+i.SIZE,s=!0):a.x>=i.SIZE&&(a.x=a.x-i.SIZE,s=!0),a.y<0?(a.y=a.y+i.SIZE,s=!0):a.y>=i.SIZE&&(a.y=a.y-i.SIZE,s=!0),new cc.Vec3(a.x,a.y,s?1:0)},e.getPosInMap=function(t){var e=t.x*r.default.WIDTH*r.default.TILE_SCALE*r.default.TILE_SIZE,i=t.y*r.default.HEIGHT*r.default.TILE_SCALE*r.default.TILE_SIZE;return cc.v3(e,i)},e.fixOuterMap=function(t,e){var o=(t.x-e.x)/(r.default.WIDTH*r.default.TILE_SCALE*r.default.TILE_SIZE),a=(t.y-e.y)/(r.default.WIDTH*r.default.TILE_SCALE*r.default.TILE_SIZE);o=Math.round(o),a=Math.round(a);var n=!1;return o<0&&(o=0,n=!0),o>=i.SIZE&&(o=i.SIZE-1,n=!0),a<0&&(a=0,n=!0),a>=i.SIZE&&(a=i.SIZE-1,n=!0),n?i.getPosInMap(cc.v3(o,a)):t},e.getIndexInMap=function(t,e){var o=(t.x-e.x)/(r.default.WIDTH*r.default.TILE_SCALE*r.default.TILE_SIZE),a=(t.y-e.y)/(r.default.WIDTH*r.default.TILE_SCALE*r.default.TILE_SIZE);return o=Math.round(o),a=Math.round(a),o<0&&(o=0),o>=i.SIZE&&(o=i.SIZE-1),a<0&&(a=0),a>=i.SIZE&&(a=i.SIZE-1),cc.v3(o,a)},e.prototype.start=function(){},e.SIZE=5,n([u(cc.Prefab)],e.prototype,"chunkPrefab",void 0),i=n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../logic/EventHelper":"EventHelper","./Chunk":"Chunk"}],Chunk:[function(t,e,i){"use strict";cc._RF.push(e,"f8d511RPE5CG7SWZpmVYfu9","Chunk");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/ChunkData"),s=t("../utils/Random"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.floor=null,e.label=null,e.select=null,e.wall=null,e.data=new r.default,e.targetPosition=cc.v3(0,0),e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.layer=this.node.getChildByName("layer"),this.floor.scale=i.TILE_SCALE,this.floor.width=i.TILE_SIZE*i.WIDTH,this.floor.height=i.TILE_SIZE*i.HEIGHT,this.select.scale=i.TILE_SCALE,this.select.width=i.TILE_SIZE*i.WIDTH,this.select.height=i.TILE_SIZE*i.HEIGHT,this.node.width=i.TILE_SCALE*i.TILE_SIZE*i.WIDTH,this.node.height=i.TILE_SCALE*i.TILE_SIZE*i.HEIGHT},e.prototype.onClicked=function(){var t=this;this.floor.color=cc.Color.GREEN,this.scheduleOnce(function(){t.floor.color=cc.Color.WHITE},1)},e.prototype.loadMap=function(){this.label.node.position=cc.v3(this.node.width/2,this.node.height/2),this.label.string=this.targetPosition.x+","+this.targetPosition.y,this.node.position=this.targetPosition.clone(),this.layer.removeAllChildren();for(var t=0;t<2;t++){var e=cc.instantiate(this.wall);e.parent=this.layer,e.position=cc.v3(s.default.getRandomNum(0,this.node.width),s.default.getRandomNum(0,this.node.height)),e.zIndex=100}},e.prototype.lateUpdate=function(){},e.prototype.lerp=function(t,e,i){var o=cc.v3(0,0),a=t.x,n=t.y;return o.x=a+(e.x-a)*i,o.y=n+(e.y-n)*i,o},e.TYPE_EMPTY=0,e.TYPE_NORMAL=1,e.TYPE_WALL_VERTICAL=2,e.TYPE_WALL_HORIZONTAL=3,e.TYPE_WALL_CROSS=4,e.WIDTH=5,e.HEIGHT=5,e.TILE_SIZE=16,e.TILE_SCALE=4,n([u(cc.Node)],e.prototype,"floor",void 0),n([u(cc.Label)],e.prototype,"label",void 0),n([u(cc.Node)],e.prototype,"select",void 0),n([u(cc.Prefab)],e.prototype,"wall",void 0),i=n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../data/ChunkData":"ChunkData","../utils/Random":"Random"}],CoinCount:[function(t,e,i){"use strict";cc._RF.push(e,"91131vqXzhODZpby3U0hjQL","CoinCount");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Logic"),s=t("./EventHelper"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.anim=this.getComponent(cc.Animation),cc.director.on(s.EventHelper.HUD_ADD_COIN,function(e){t.addCount(e.detail.count)})},e.prototype.start=function(){},e.prototype.addCount=function(t){if(this.anim){var e=parseInt(t);r.default.coins+=e,e>0&&(r.default.coinDreamCount+=e,r.default.coinDreamCount>=1&&(r.default.coinDreamCount=0,s.EventHelper.emit(s.EventHelper.PLAYER_USEDREAM,{value:-1})))}},e.prototype.update=function(){this.label&&(this.label.string=""+r.default.coins)},n([u(cc.Label)],e.prototype,"label",void 0),n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"./EventHelper":"EventHelper","./Logic":"Logic"}],Coin:[function(t,e,i){"use strict";cc._RF.push(e,"586a7ZPuVJNUIhnMRyd39J4","Coin");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../logic/EventHelper"),l=t("../utils/Random"),c=t("../utils/AudioPlayer"),u=t("../base/BaseColliderComponent"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=0,e.valueRes=["gem01","gem02","gem03","gem04"],e.isReady=!1,e.soundPlaying=!1,e.checkTimeDelay=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.initCollider()},e.prototype.onEnable=function(){var t=this;this.anim=this.getComponent(cc.Animation);var e=l.default.rand()*(r.default.getHalfChance()?1:-1)*300,i=l.default.rand()*(r.default.getHalfChance()?1:-1)*300;this.entity.Move.linearVelocity=cc.v2(e,i),this.entity.Move.linearDamping=3,this.isReady=!1,this.scheduleOnce(function(){t.isReady=!0,t.entity.Transform.position=t.node.position.clone(),t.entity.NodeRender.node=t.node},.5)},e.prototype.changeValue=function(t){this.value=t;var e=1;this.value==i.FACE_VALUE?(e=3,this.node.scale=1.2):(e=1,this.node.scale=1),this.node.getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=r.default.spriteFrameRes(this.valueRes[e])},e.prototype.start=function(){},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.2&&(this.checkTimeDelay=0,this.soundPlaying=!1,!0)},e.prototype.getNearPlayerDistance=function(t){return r.default.getDistanceNoSqrt(this.node.position,t.position.clone().addSelf(cc.v3(0,32)))},e.prototype.update=function(t){if(this.isCheckTimeDelay(t)&&this.player&&this.getNearPlayerDistance(this.player.node)<800&&this.node.active&&this.isReady){var e=this.player.node.position.clone();e.y+=10;var i=e.sub(this.node.position);i.equals(cc.Vec3.ZERO)||(this.entity.Move.linearVelocity=cc.v2(i.x,i.y).normalize().mul(800),this.entity.Move.linearDamping=1)}this.player&&this.getNearPlayerDistance(this.player.node)<64&&this.node.active&&this.isReady&&(this.isReady=!1,this.soundPlaying||(this.soundPlaying=!0,cc.director.emit(s.EventHelper.PLAY_AUDIO,{detail:{name:c.default.COIN}})),cc.director.emit(s.EventHelper.HUD_ADD_COIN,{detail:{count:this.value}}),cc.director.emit("destorycoin",{detail:{coinNode:this.node}}))},e.FACE_VALUE=10,i=n([d],e)}(u.default));i.default=p,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer","../utils/Random":"Random"}],ColliderComponent:[function(t,e,i){"use strict";cc._RF.push(e,"a502cZks55PtqeBjSSgGyf/","ColliderComponent");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0}),i.ColliderComponent=void 0;var r=t("../ECS"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ignoreTagMap=new Map,e.targetTagMap=new Map,e.colliders=[],e}return a(e,t),e.prototype.reset=function(){this.colliders=[],this.ignoreTagMap=new Map},n([r.ecs.register("Collider")],e)}(r.ecs.IComponent);i.ColliderComponent=s,cc._RF.pop()},{"../ECS":"ECS"}],ColliderSystem:[function(t,e,i){"use strict";cc._RF.push(e,"84262UUMLRLS4Wni7FYD6tj","ColliderSystem");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("./../component/ColliderComponent"),r=t("../ECS"),s=t("../../collider/Quadtree"),l=t("../../collider/CCollider"),c=t("./RayCastResult"),u=t("../../logic/Logic"),h=function(t){function e(e,i,o){var a=t.call(this)||this;a.tempColliders=new Map,a.list=[],a.isDebug=!1,a.allCount=0,a.collisionCount=0,a.activeCount=0,a.checkTimeDelay=0;var n={x:-e,y:-i,width:2*e,height:2*i};return a.quadTree=new s.default(n),a.graphics=o,a}return a(e,t),e.prototype.init=function(){this.isDebug=u.default.isDebug},e.prototype.filter=function(){return r.ecs.allOf(n.ColliderComponent)},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.04&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.initCollider(t),this.collisionCheck(),this.updateDebug()},e.prototype.updateDebug=function(){if(this.isDebug&&this.graphics){this.graphics.clear();for(var t=0,e=this.list;t<e.length;t++)e[t].drawDebug(this.graphics)}},e.prototype.initCollider=function(t){this.list=[];for(var e=0,i=t;e<i.length;e++)for(var o=i[e],a=0,n=o.Collider.colliders;a<n.length;a++){var r=n[a];r.entity=o,r.enabled&&r.node.active&&(r.fixCenterAndScale(),this.list.push(r),this.quadTree.insert(r))}},e.prototype.collisionCheck=function(){this.tempColliders.clear();for(var t=0,e=this.list;t<e.length;t++){var i=e[t];if(i.enabled)for(var o=0,a=this.quadTree.retrieve(i);o<a.length;o++){var n=a[o];if(n.enabled&&n!==i&&n.groupId!=i.groupId&&!(this.tempColliders.has(1e8*i.id+n.id)||this.tempColliders.has(1e8*n.id+i.id)||i.ignoreSameTag&&i.tag==n.tag)){if(i.targetTags.size>0){if(!i.targetTags.has(n.tag))continue}else if(i.ignoreTags.has(n.tag))continue;if(n.targetTags.size>0){if(!n.targetTags.has(i.tag))continue}else if(n.ignoreTags.has(i.tag))continue;var r=!1;i.type==l.default.TYPE.RECT&&n.type==l.default.TYPE.RECT?r=i.isRotate&&n.isRotate?this.polygonPolygon(i.points,n.points):i.isRotate&&!n.isRotate?this.rectPolygon(n.Aabb,i.points):!i.isRotate&&n.isRotate?this.rectPolygon(i.Aabb,n.points):this.recHit(i.Aabb,n.Aabb):i.type==l.default.TYPE.CIRCLE&&n.type==l.default.TYPE.CIRCLE?r=this.circleHit(i.w_center,n.w_center,i.w_radius,n.w_radius):i.type==l.default.TYPE.RECT&&n.type==l.default.TYPE.CIRCLE?r=this.polygonCircle(i.points,n.w_center,n.w_radius):i.type==l.default.TYPE.CIRCLE&&n.type==l.default.TYPE.RECT&&(r=this.polygonCircle(n.points,i.w_center,i.w_radius)),r?(i.preSolve(n,this.dt),n.preSolve(i,this.dt),i.contact(n,this.dt),n.contact(i,this.dt),i.physicTest(n,this.dt),n.physicTest(i,this.dt),i.disabledOnce=!1,n.disabledOnce=!1):(i.exit(n),n.exit(i)),this.tempColliders.set(1e8*i.id+n.id,!0)}}}this.quadTree.clear()},e.prototype.recHit=function(t,e){return!(t.width<=0||t.height<=0||e.width<=0||e.height<=0)&&cc.Intersection.rectRect(t,e)},e.prototype.rectPolygon=function(t,e){return!(t.width<=0||t.height<=0)&&cc.Intersection.rectPolygon(t,e)},e.prototype.polygonCircle=function(t,e,i){return!(i<=0)&&cc.Intersection.polygonCircle(t,{position:e,radius:i})},e.prototype.polygonPolygon=function(t,e){return cc.Intersection.polygonPolygon(t,e)},e.prototype.circleHit=function(t,e,i,o){return!(i<=0||o<=0)&&cc.Intersection.circleCircle({position:t,radius:i},{position:e,radius:o})},e.prototype.rayCast=function(t,e,i){if(t.equals(e))return[];for(var o=new Array,a=0,n=this.list;a<n.length;a++){var r=n[a];if(i.has(r.tag)&&this.rayCastCollision(r,t,e)){var s=new c.default(r,r.w_center);o.push(s)}}return o},e.prototype.rayCastCollision=function(t,e,i){var o=!1;return t.type==l.default.TYPE.RECT?o=cc.Intersection.linePolygon(e,i,t.points):t.type==l.default.TYPE.CIRCLE&&(o=cc.Intersection.lineRect(e,i,t.Aabb)),o},e.prototype.nearestRayCast=function(t,e,i,o,a){if(t.equals(e))return null;for(var n,r=-1,s=0,l=this.list;s<l.length;s++){var u=l[s];if(i.has(u.tag)&&(o.has(u.tag)||!u.sensor)&&!a.has(u.id)&&this.rayCastCollision(u,t,e)){var h=u.w_center.sub(t).magSqr();(r<0||r>h)&&(r=h,n=new c.default(u,u.w_center))}}if(n)for(var d=n.collider.points.length,p=0;p<d;++p){var f=n.collider.points[p],g=n.collider.points[(p+1)%d],y=this.getLineLinePoint(t,n.point,f,g);if(y){n.point=y;break}}return n},e.prototype.getLineLinePoint=function(t,e,i,o){var a=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x),n=(t.x-o.x)*(e.y-o.y)-(t.y-o.y)*(e.x-o.x);if(a*n>=0)return null;var r=(i.x-t.x)*(o.y-t.y)-(i.y-t.y)*(o.x-t.x);if(r*(r+a-n)>=0)return null;var s=r/(n-a),l=s*(e.x-t.x),c=s*(e.y-t.y);return cc.v2(t.x+l,t.y+c)},e}(r.ecs.ComblockSystem);i.default=h,cc._RF.pop()},{"../../collider/CCollider":"CCollider","../../collider/Quadtree":"Quadtree","../../logic/Logic":"Logic","../ECS":"ECS","./../component/ColliderComponent":"ColliderComponent","./RayCastResult":"RayCastResult"}],ColliderTag:[function(t,e,i){"use strict";cc._RF.push(e,"30fe7gJEPJDaIQxIDcTlk/U","ColliderTag"),Object.defineProperty(i,"__esModule",{value:!0}),i.ColliderTag=void 0,function(t){t[t.DEFAULT=0]="DEFAULT",t[t.WALL=1]="WALL",t[t.WALL_TOP=2]="WALL_TOP",t[t.PLAYER=3]="PLAYER",t[t.NONPLAYER=4]="NONPLAYER",t[t.BOSS_ATTACK=5]="BOSS_ATTACK",t[t.BOSS=6]="BOSS",t[t.BULLET=7]="BULLET",t[t.BUILDING=8]="BUILDING",t[t.AOE=9]="AOE",t[t.ITEM=10]="ITEM",t[t.EQUIPMENT=11]="EQUIPMENT",t[t.COIN=12]="COIN",t[t.TIPS=13]="TIPS",t[t.MELEE=14]="MELEE",t[t.GOODNONPLAYER=15]="GOODNONPLAYER",t[t.WARTER=16]="WARTER",t[t.ENERGY_SHIELD=17]="ENERGY_SHIELD",t[t.LIGHT=20]="LIGHT"}(i.ColliderTag||(i.ColliderTag={})),cc._RF.pop()},{}],CommonData:[function(t,e,i){"use strict";cc._RF.push(e,"b86e6PjawlOxqFoYPp0y0Jk","CommonData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.maxHealth=0,this.maxDream=0,this.maxAmmo=0,this.damageMin=0,this.damageMax=0,this.damageBack=0,this.criticalStrikeRate=0,this.defence=0,this.blockPhysical=0,this.blockMagic=0,this.blockDamage=0,this.lifeDrain=0,this.moveSpeed=0,this.attackSpeed=0,this.dodge=0,this.remoteCooldown=0,this.remoteDamage=0,this.remoteCritRate=0,this.remoteInterval=0,this.remoteAngle=0,this.realDamage=0,this.realRate=0,this.magicDamage=0,this.magicDefence=0,this.iceRate=0,this.fireRate=0,this.lighteningRate=0,this.toxicRate=0,this.curseRate=0}return t.prototype.valueCopy=function(t){t&&(this.maxHealth=t.maxHealth?t.maxHealth:0,this.maxDream=t.maxDream?t.maxDream:0,this.maxAmmo=t.maxAmmo?t.maxAmmo:0,this.damageMin=t.damageMin?t.damageMin:0,this.damageMax=t.damageMax?t.damageMax:0,this.remoteDamage=t.remoteDamage?t.remoteDamage:0,this.criticalStrikeRate=t.criticalStrikeRate?t.criticalStrikeRate:0,this.remoteCritRate=t.remoteCritRate?t.remoteCritRate:0,this.remoteAngle=t.remoteAngle?t.remoteAngle:0,this.remoteCooldown=t.remoteCooldown?t.remoteCooldown:0,this.remoteInterval=t.remoteInterval?t.remoteInterval:0,this.defence=t.defence?t.defence:0,this.lifeDrain=t.lifeDrain?t.lifeDrain:0,this.damageBack=t.damageBack?t.damageBack:0,this.moveSpeed=t.moveSpeed?t.moveSpeed:0,this.attackSpeed=t.attackSpeed?t.attackSpeed:0,this.dodge=t.dodge?t.dodge:0,this.realDamage=t.realDamage?t.realDamage:0,this.realRate=t.realRate?t.realRate:0,this.magicDefence=t.magicDefence?t.magicDefence:0,this.iceRate=t.iceRate?t.iceRate:0,this.magicDamage=t.magicDamage?t.magicDamage:0,this.fireRate=t.fireRate?t.fireRate:0,this.lighteningRate=t.lighteningRate?t.lighteningRate:0,this.toxicRate=t.toxicRate?t.toxicRate:0,this.curseRate=t.curseRate?t.curseRate:0,this.blockPhysical=t.blockPhysical?t.blockPhysical:0,this.blockMagic=t.blockMagic?t.blockMagic:0,this.blockDamage=t.blockDamage?t.blockDamage:0)},t.prototype.clone=function(){var e=new t;return e.maxHealth=this.maxHealth,e.maxDream=this.maxDream,e.maxAmmo=this.maxAmmo,e.damageMin=this.damageMin,e.damageMax=this.damageMax,e.criticalStrikeRate=this.criticalStrikeRate,e.defence=this.defence,e.lifeDrain=this.lifeDrain,e.damageBack=this.damageBack,e.moveSpeed=this.moveSpeed,e.attackSpeed=this.attackSpeed,e.remoteCooldown=this.remoteCooldown,e.remoteInterval=this.remoteInterval,e.remoteAngle=this.remoteAngle,e.dodge=this.dodge,e.realDamage=this.realDamage,e.realRate=this.realRate,e.magicDefence=this.magicDefence,e.magicDamage=this.magicDamage,e.iceRate=this.iceRate,e.fireRate=this.fireRate,e.lighteningRate=this.lighteningRate,e.toxicRate=this.toxicRate,e.curseRate=this.curseRate,e.remoteDamage=this.remoteDamage,e.remoteCritRate=this.remoteCritRate,e.blockPhysical=this.blockPhysical,e.blockMagic=this.blockMagic,e.blockDamage=this.blockDamage,e},t.prototype.add=function(e){return this.maxHealth+=e.maxHealth?e.maxHealth:0,this.maxDream+=e.maxDream?e.maxDream:0,this.damageMin+=e.damageMin?e.damageMin:0,this.damageMax+=e.damageMax?e.damageMax:0,this.maxAmmo+=e.maxAmmo?e.maxAmmo:0,this.remoteDamage+=e.remoteDamage?e.remoteDamage:0,this.criticalStrikeRate=e.criticalStrikeRate?t.addPercent(this.criticalStrikeRate,e.criticalStrikeRate):this.criticalStrikeRate,this.remoteCritRate=e.remoteCritRate?t.addPercent(this.remoteCritRate,e.remoteCritRate):this.remoteCritRate,this.lifeDrain=e.lifeDrain?t.addPercent(this.lifeDrain,e.lifeDrain):this.lifeDrain,this.dodge=e.dodge?t.addPercent(this.dodge,e.dodge):this.dodge,this.defence+=e.defence?e.defence:0,this.damageBack+=e.damageBack?e.damageBack:0,this.moveSpeed+=e.moveSpeed?e.moveSpeed:0,this.attackSpeed+=e.attackSpeed?e.attackSpeed:0,this.remoteCooldown+=e.remoteCooldown?e.remoteCooldown:0,this.remoteInterval+=e.remoteInterval?e.remoteInterval:0,this.remoteAngle+=e.remoteAngle?e.remoteAngle:0,this.realDamage+=e.realDamage?e.realDamage:0,this.realRate+=e.realRate?e.realRate:0,this.magicDefence+=e.magicDefence?e.magicDefence:0,this.magicDamage+=e.magicDamage?e.magicDamage:0,this.iceRate+=e.iceRate?e.iceRate:0,this.fireRate+=e.fireRate?e.fireRate:0,this.lighteningRate+=e.lighteningRate?e.lighteningRate:0,this.toxicRate+=e.toxicRate?e.toxicRate:0,this.curseRate+=e.curseRate?e.curseRate:0,this.blockPhysical+=e.blockPhysical?e.blockPhysical:0,this.blockMagic+=e.blockMagic?e.blockMagic:0,this.blockDamage+=e.blockDamage?e.blockDamage:0,this.iceRate=t.fixRateRange(this.iceRate),this.fireRate=t.fixRateRange(this.fireRate),this.lighteningRate=t.fixRateRange(this.lighteningRate),this.toxicRate=t.fixRateRange(this.toxicRate),this.curseRate=t.fixRateRange(this.curseRate),this.blockPhysical=t.fixRateRange(this.blockPhysical),this.blockMagic=t.fixRateRange(this.blockMagic),this.magicDefence=t.fixRateRange(this.magicDefence),this.realRate=t.fixRateRange(this.realRate),this.lifeDrain=t.fixRateRange(this.lifeDrain),this.dodge=t.fixRateRange(this.dodge),this.remoteCritRate=t.fixRateRange(this.remoteCritRate),this.criticalStrikeRate=t.fixRateRange(this.criticalStrikeRate),this},t.addPercent=function(t,e){var i=1;return 100*(1-(i*=1-t/100)*(1-e/100))},t.getPercentRate=function(t){return t/100},t.fixRateRange=function(t){return(t=t<0?0:t)>100?100:t},t}();i.default=o,cc._RF.pop()},{}],Controller:[function(t,e,i){"use strict";cc._RF.push(e,"12f66EVamVPmoXVKYdoGHk5","Controller");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=r.property,c=t("./EventHelper"),u=t("./Logic"),h=t("../ui/CoolDownView"),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.attackAction=null,e.attackActionTouched=!1,e.shootAction=null,e.shootActionTouched=!1,e.interactAction=null,e.interactActionTouched=!1,e.interactEmpty=null,e.interactKey=null,e.skillAction=null,e.skillAction1=null,e.coolDown=null,e.coolDown1=null,e.skillActionTouched=!1,e.skillActionTouched1=!1,e.mouseArea=null,e.curseArea=null,e.cursor=null,e.mouseInArea=!1,e.timeDelay=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.coolDown.init(h.default.PROFESSION),this.coolDown1.init(h.default.ORGANIZATION),this.attackAction.on(cc.Node.EventType.TOUCH_START,function(){t.attackActionTouched=!0},this),this.attackAction.on(cc.Node.EventType.TOUCH_END,function(){t.attackActionTouched=!1},this),this.attackAction.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.attackActionTouched=!1},this),this.shootAction.on(cc.Node.EventType.TOUCH_START,function(){t.shootActionTouched=!0},this),this.shootAction.on(cc.Node.EventType.TOUCH_END,function(){t.shootActionTouched=!1,cc.director.emit(c.EventHelper.PLAYER_REMOTEATTACK_CANCEL)},this),this.shootAction.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.shootActionTouched=!1,cc.director.emit(c.EventHelper.PLAYER_REMOTEATTACK_CANCEL)},this),this.skillAction.on(cc.Node.EventType.TOUCH_START,function(){t.skillActionTouched=!0},this),this.skillAction.on(cc.Node.EventType.TOUCH_END,function(){t.skillActionTouched=!1},this),this.skillAction.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.skillActionTouched=!1},this),this.skillAction1.on(cc.Node.EventType.TOUCH_START,function(){t.skillActionTouched1=!0},this),this.skillAction1.on(cc.Node.EventType.TOUCH_END,function(){t.skillActionTouched1=!1},this),this.skillAction1.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.skillActionTouched1=!1},this);var e=!1,o=!1;this.interactAction.on(cc.Node.EventType.TOUCH_START,function(){t.interactActionTouched=!0,o=!0,t.scheduleOnce(function(){o&&(e=!0,c.EventHelper.emit(c.EventHelper.PLAYER_TRIGGER,{isLongPress:!0}))},.3)},this),this.interactAction.on(cc.Node.EventType.TOUCH_END,function(){t.interactActionTouched=!1,e||c.EventHelper.emit(c.EventHelper.PLAYER_TRIGGER),o=!1,e=!1},this),this.interactAction.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.interactActionTouched=!1,o=!1,e=!1},this),c.EventHelper.on(c.EventHelper.HUD_CHANGE_CONTROLLER_SHIELD,function(e){t.node&&t.changeRes(e.isShield)}),c.EventHelper.on(c.EventHelper.HUD_CONTROLLER_UPDATE_GAMEPAD,function(){t.node&&t.updateGamepad()}),c.EventHelper.on(c.EventHelper.HUD_CONTROLLER_INTERACT_SHOW,function(e){t.node&&(t.interactAction.active=e.isShow,t.interactEmpty.active=!e.iiShow,t.interactKey.active=e.isShow&&i.isMouseMode())}),c.EventHelper.on(c.EventHelper.HUD_CONTROLLER_REMOTE_SHOW,function(e){t.node&&(t.shootAction.active=e.isShow&&!i.isMouseMode())}),this.mouseArea.on(cc.Node.EventType.MOUSE_DOWN,function(e){e.getButton()==cc.Event.EventMouse.BUTTON_LEFT?t.attackActionTouched=!0:e.getButton()==cc.Event.EventMouse.BUTTON_RIGHT&&(t.shootActionTouched=!0)},this),this.curseArea.on(cc.Node.EventType.MOUSE_UP,function(e){e.getButton()==cc.Event.EventMouse.BUTTON_LEFT?t.attackActionTouched=!1:e.getButton()==cc.Event.EventMouse.BUTTON_RIGHT&&(t.shootActionTouched=!1,cc.director.emit(c.EventHelper.PLAYER_REMOTEATTACK_CANCEL))},this),this.curseArea.on(cc.Node.EventType.MOUSE_LEAVE,function(){t.attackActionTouched=!1,t.shootActionTouched=!1},this),this.curseArea.on(cc.Node.EventType.MOUSE_MOVE,function(e){t.cursor.position=cc.v3(t.curseArea.convertToNodeSpaceAR(e.getLocation())),i.mousePos=e.getLocation()},this),this.updateGamepad()},e.isMouseMode=function(){return!cc.sys.isMobile&&!u.default.settings.showGamepad},e.prototype.updateGamepad=function(){i.isMouseMode()?(this.attackAction.active=!1,this.shootAction.active=!1,this.skillAction.active=!1,this.skillAction1.active=!1,this.coolDown.node.position=cc.v3(-100,-80),this.coolDown1.node.position=cc.v3(60,-80),this.coolDown.changeKeyShow(!0),this.coolDown1.changeKeyShow(!0),this.mouseArea.active=!0,this.curseArea.active=!0):(this.attackAction.active=!0,this.shootAction.active=!0,this.skillAction.active=!0,this.skillAction1.active=!0,this.coolDown.node.position=this.skillAction.position.clone(),this.coolDown1.node.position=this.skillAction1.position.clone(),this.coolDown.changeKeyShow(!1),this.coolDown1.changeKeyShow(!1),this.mouseArea.active=!1,this.curseArea.active=!1)},e.prototype.changeRes=function(t){if(this.shootAction){var e=this.shootAction.getComponent(cc.Button);e&&(e.normalSprite=u.default.spriteFrameRes(t?"uishield":"uiremote"),e.pressedSprite=u.default.spriteFrameRes(t?"uishieldpress":"uiremotepress"),e.hoverSprite=u.default.spriteFrameRes(t?"uishieldlight":"uiremotelight"),e.disabledSprite=u.default.spriteFrameRes(t?"uishieldpress":"uiremotepress"))}},e.prototype.drawSkillCoolDown=function(t,e,i,o,a,n,r){var s=this;if(r&&(r.string=e>0?""+e:""),!(t<0)&&a){o&&this.unschedule(o),0==t&&i&&i.clear();var l=cc.Vec3.ZERO,c=100,u=100/t*.1;o=function(){c-=u,i&&i.clear(),s.drawArc(360*c/100,l,i),n.node.opacity=200,c<0&&(n.node.opacity=0,i&&i.clear(),s.unschedule(o))},this.schedule(o,.1,cc.macro.REPEAT_FOREVER)}},e.prototype.drawArc=function(t,e,i){if(i&&(i.clear(),!(t<0))){var o=2*t*Math.PI/360;i.arc(e.x,e.y,48,2*Math.PI,2*Math.PI-o),i.stroke()}},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.03&&(this.timeDelay=0,!0)},e.prototype.update=function(t){this.isTimeDelay(t)&&!u.default.isGamePause&&(this.attackActionTouched&&cc.director.emit(c.EventHelper.PLAYER_ATTACK),this.shootActionTouched&&cc.director.emit(c.EventHelper.PLAYER_REMOTEATTACK),this.skillActionTouched&&cc.director.emit(c.EventHelper.PLAYER_SKILL),this.skillActionTouched1&&cc.director.emit(c.EventHelper.PLAYER_SKILL1))},n([l(cc.Node)],e.prototype,"attackAction",void 0),n([l(cc.Node)],e.prototype,"shootAction",void 0),n([l(cc.Node)],e.prototype,"interactAction",void 0),n([l(cc.Node)],e.prototype,"interactEmpty",void 0),n([l(cc.Node)],e.prototype,"interactKey",void 0),n([l(cc.Node)],e.prototype,"skillAction",void 0),n([l(cc.Node)],e.prototype,"skillAction1",void 0),n([l(h.default)],e.prototype,"coolDown",void 0),n([l(h.default)],e.prototype,"coolDown1",void 0),n([l(cc.Node)],e.prototype,"mouseArea",void 0),n([l(cc.Node)],e.prototype,"curseArea",void 0),n([l(cc.Node)],e.prototype,"cursor",void 0),i=n([s],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../ui/CoolDownView":"CoolDownView","./EventHelper":"EventHelper","./Logic":"Logic"}],CoolDownView:[function(t,e,i){"use strict";cc._RF.push(e,"58d32PM1/ZHL6BBvFTBgSIk","CoolDownView");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=t("../logic/Logic"),l=cc._decorator,c=l.ccclass,u=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=i.PROFESSION,e.skillIcon=null,e.graphics=null,e.coolDownFuc=null,e.label=null,e.labelBg=null,e.lastTime=0,e.duration=0,e.storePoint=1,e.storePointMax=1,e.timeDelay=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.graphics=this.getComponent(cc.Graphics),this.label=this.node.getChildByName("label").getComponent(cc.Label),this.labelBg=this.node.getChildByName("labelbg"),this.labelBg.active=!1,this.skillIcon=this.node.getChildByName("mask").getChildByName("sprite").getComponent(cc.Sprite),this.skillIcon.node.opacity=255,r.EventHelper.on(r.EventHelper.HUD_CONTROLLER_COOLDOWN,function(e){t.node&&e.id==t.id&&t.setData(e.duration,e.lastTime,e.storePoint,e.storePointMax)})},e.prototype.init=function(t){this.id=t,this.skillIcon||(this.skillIcon=this.node.getChildByName("mask").getChildByName("sprite").getComponent(cc.Sprite)),t==i.PROFESSION?this.setSkillIcon(s.default.playerData.AvatarData.professionData.talent):t==i.ORGANIZATION&&this.setSkillIcon("talent10"+s.default.playerData.AvatarData.organizationIndex)},e.prototype.setSkillIcon=function(t){this.skillIcon.spriteFrame=s.default.spriteFrameRes(t)},e.prototype.setData=function(t,e,i,o){this.node&&(t<=0&&(t=0),this.storePointMax=o,this.duration=t,this.lastTime=e,this.storePoint=i,this.drawSkillCoolDown())},e.prototype.drawSkillCoolDown=function(){if(!(this.duration<=0)){this.label.string=this.storePoint>0&&this.storePointMax>1?""+this.storePoint:"",this.labelBg.active=this.label.string.length>0,this.graphics&&this.graphics.clear();var t=cc.Vec3.ZERO,e=(Date.now()-this.lastTime)/(1e3*this.duration);e>1&&(e=1),e<1&&this.drawArc(360*(1-e),t,this.graphics)}},e.prototype.drawArc=function(t,e,i){if(i&&(i.clear(),!(t<0))){var o=2*t*Math.PI/360;i.arc(e.x,e.y,48,2*Math.PI,2*Math.PI-o),i.stroke()}},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.1&&(this.timeDelay=0,!0)},e.prototype.changeKeyShow=function(t){this.node.getChildByName("btn").active=t},e.prototype.start=function(){},e.prototype.update=function(t){this.isTimeDelay(t)&&this.drawSkillCoolDown()},e.PROFESSION=0,e.ORGANIZATION=1,i=n([c],e)}(cc.Component));i.default=u,cc._RF.pop()},{"../logic/EventHelper":"EventHelper","../logic/Logic":"Logic"}],CutScene:[function(t,e,i){"use strict";cc._RF.push(e,"cb0c7YcdndBfpVkO+dBgo79","CutScene");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isSkip=!1,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.skipNode=this.node.getChildByName("skip"),this.cut001=this.node.getChildByName("sprite").getChildByName("cut001"),this.cut002=this.node.getChildByName("sprite").getChildByName("cut002"),this.cut003=this.node.getChildByName("sprite").getChildByName("cut003"),this.cut004=this.node.getChildByName("sprite").getChildByName("cut004"),this.cut006=this.node.getChildByName("sprite").getChildByName("cut006"),this.cut007=this.node.getChildByName("sprite").getChildByName("cut007"),this.cut008=this.node.getChildByName("sprite").getChildByName("cut008"),this.cut009=this.node.getChildByName("sprite").getChildByName("cut009"),this.cutList=new Array,this.cutList.push(this.cut001),this.cutList.push(this.cut002),this.cutList.push(this.cut003),this.cutList.push(this.cut004),this.cutList.push(this.cut006),this.cutList.push(this.cut007),this.cutList.push(this.cut008),this.cutList.push(this.cut009),this.skipNode.opacity=0,this.node.opacity=0,this.hideAllCuts(),this.node.on(cc.Node.EventType.TOUCH_START,function(){255==t.skipNode.opacity&&(t.isSkip=!0),t.skipNode.opacity=255},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){},this),this.node.on(cc.Node.EventType.TOUCH_END,function(){},this)},e.prototype.playShow=function(){var t=this;this.node.opacity=255,this.getComponent(cc.Animation).play(),this.scheduleOnce(function(){t.isSkip=!0},12)},e.prototype.unregisterClick=function(){this.node.off(cc.Node.EventType.TOUCH_START),this.node.off(cc.Node.EventType.TOUCH_CANCEL),this.node.off(cc.Node.EventType.TOUCH_END)},e.prototype.hideAllCuts=function(){for(var t=0,e=this.cutList;t<e.length;t++)e[t].opacity=0},e.prototype.start=function(){},n([s],e)}(cc.Component));i.default=l,cc._RF.pop()},{}],DamageData:[function(t,e,i){"use strict";cc._RF.push(e,"140ebm8pJ5CBb4RE4tI9c22","DamageData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.realDamage=0,this.physicalDamage=0,this.magicDamage=0,this.realRate=0,this.iceRate=0,this.fireRate=0,this.lighteningRate=0,this.toxicRate=0,this.curseRate=0,this.stoneRate=0,this.isCriticalStrike=!1,this.isBackAttack=!1,this.isRemote=!1,this.isStab=!1,this.isFar=!1,this.isFist=!1,this.isBlunt=!1,this.isMelee=!1,this.comboType=0,this.realDamage=t||0}return t.prototype.valueCopy=function(t){this.realDamage=t.realDamage?t.realDamage:0,this.physicalDamage=t.physicalDamage?t.physicalDamage:0,this.magicDamage=t.magicDamage?t.magicDamage:0,this.realRate=t.realRate?t.realRate:0,this.iceRate=t.iceRate?t.iceRate:0,this.fireRate=t.fireRate?t.fireRate:0,this.lighteningRate=t.lighteningRate?t.lighteningRate:0,this.toxicRate=t.toxicRate?t.toxicRate:0,this.curseRate=t.curseRate?t.curseRate:0,this.stoneRate=t.stoneRate?t.stoneRate:0,this.isCriticalStrike=!!t.isCriticalStrike,this.isBackAttack=!!t.isBackAttack,this.isRemote=!!t.isRemote,this.isStab=!!t.isStab,this.isFar=!!t.isFar,this.isFist=!!t.isFist,this.isBlunt=!!t.isBlunt,this.isMelee=!!t.isMelee,this.comboType=t.comboType?t.comboType:0},t.prototype.clone=function(){var e=new t;return e.realDamage=this.realDamage,e.physicalDamage=this.physicalDamage,e.magicDamage=this.magicDamage,e.realRate=this.realRate,e.iceRate=this.iceRate,e.fireRate=this.fireRate,e.lighteningRate=this.lighteningRate,e.toxicRate=this.toxicRate,e.curseRate=this.curseRate,e.stoneRate=this.stoneRate,e.isCriticalStrike=this.isCriticalStrike,e.isBackAttack=this.isBackAttack,e.isRemote=this.isRemote,e.isBlunt=this.isBlunt,e.isFar=this.isFar,e.isFist=this.isFist,e.isStab=this.isStab,e.isMelee=this.isMelee,e.comboType=this.comboType,e},t.prototype.getTotalDamage=function(){var t=this.physicalDamage+this.magicDamage+this.realDamage;return isNaN(t)&&(console.log(t),t=0),t},t}();i.default=o,cc._RF.pop()},{}],DashShadow:[function(t,e,i){"use strict";cc._RF.push(e,"909e64n9VxBGoAX7rWiFEbf","DashShadow");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../logic/Dungeon"),l=t("../talent/Talent"),c=t("../logic/Shooter"),u=t("../utils/IndexZ"),h=t("../base/BaseColliderComponent"),d=cc._decorator,p=d.ccclass,f=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hv=cc.v2(1,0),e.shooter=null,e}return a(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.motionStreak=this.getComponent(cc.MotionStreak),this.sprite=this.node.getChildByName("sprite")},e.prototype.init=function(t){this.talentDash=t,this.shooter.dungeon=this.talentDash.player.node.parent.getComponent(s.default)},e.prototype.changeDashPerformance=function(t){this.motionStreak.color=cc.Color.BLACK;for(var e=0,i=t;e<i.length;e++)i[e]},e.prototype.onEnable=function(){},e.prototype.start=function(){},e.prototype.getPlayerPosition=function(){return this.talentDash.player.node.position.clone().addSelf(cc.v3(8,8))},e.prototype.getNearPlayerDistance=function(){return r.default.getDistanceNoSqrt(this.node.position,this.getPlayerPosition())},e.prototype.show=function(){var t=this;this.node.active=!0,this.node.parent=this.talentDash.player.node.parent;var e=this.talentDash.player.isFaceRight;this.sprite.scaleX=e?1:-1,this.node.setPosition(this.getPlayerPosition());var i=1200;this.talentDash.hashTalent(l.default.DASH_14)&&(i=2e3);var o=this.hv.mul(i);this.entity.Move.linearVelocity=cc.v2(o.x,o.y),this.node.zIndex=u.default.OVERHEAD,this.fire(this.shooter),this.scheduleOnce(function(){t.hide()},.45)},e.prototype.hide=function(){this.talentDash.player.node.setPosition(s.default.fixOuterMap(this.node.position.clone())),this.node.active=!1,this.entity.Move.linearVelocity=cc.Vec2.ZERO},e.prototype.onColliderEnter=function(t){this.talentDash&&this.talentDash.hashTalent(l.default.DASH_02)&&this.talentDash.attacking(t,this.node)},e.prototype.fire=function(t){t.data.bulletLineExNum=5,t.data.bulletLineInterval=.05,this.talentDash.hashTalent(l.default.DASH_11)&&(t.data.bulletLineExNum=10,t.data.bulletLineInterval=.03);var e=!1;this.talentDash.hashTalent(l.default.DASH_09)?(e=!0,t.data.bulletType="bullet025"):this.talentDash.hashTalent(l.default.DASH_10)&&(e=!0,t.data.bulletType="bullet026"),e&&t.fireBullet(0,cc.v3(0,0))},e.prototype.setHv=function(t){t.equals(cc.Vec2.ZERO)?this.hv=cc.v2(1,0):this.hv=t},n([f(c.default)],e.prototype,"shooter",void 0),n([p],e)}(h.default);i.default=g,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../talent/Talent":"Talent","../utils/IndexZ":"IndexZ"}],DecorationFloor:[function(t,e,i){"use strict";cc._RF.push(e,"c0e43WuUrFGu7HrB9h8NrBh","DecorationFloor");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Logic"),l=t("./Building"),c=cc._decorator,u=c.ccclass,h=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.parallexLevel=0,e.RANGE=300,e}return a(e,t),e.prototype.init=function(t,e,i,o,a,n,r){this.dungeon=t,this.parallexLevel=o,r&&(this.node.zIndex=r),this.node.scale=i,a&&(this.node.anchorX=a.x,this.node.anchorY=a.y);var l=this.getComponent(cc.Sprite);l.spriteFrame=s.default.spriteFrameRes(e),this.node.width=l.spriteFrame.getOriginalSize().width,this.node.height=l.spriteFrame.getOriginalSize().height,this.node.opacity=n||255,this.originPos=this.entity.Transform.position.clone()},e.prototype.update=function(t){if(this.dungeon&&this.parallexLevel>0){var e=this.dungeon.player.node.position.sub(this.entity.Transform.position);e.x>this.RANGE&&(e.x=this.RANGE),e.x<-this.RANGE&&(e.x=-this.RANGE),e.y>this.RANGE&&(e.y=this.RANGE),e.y<-this.RANGE&&(e.y=-this.RANGE);var i=cc.v3(e.x/this.RANGE*r.default.TILE_SIZE*this.parallexLevel,-e.y/this.RANGE*r.default.TILE_SIZE*this.parallexLevel/2);this.entity.Transform.position=s.default.lerpPos(this.entity.Transform.position,this.originPos.add(i),5*t)}},n([u],e)}(l.default));i.default=h,cc._RF.pop()},{"../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","./Building":"Building"}],DefaultStateMachine:[function(t,e,i){"use strict";cc._RF.push(e,"4327d7ykMVKAbwAJoU8o/85","DefaultStateMachine"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e,i){this.owner=t,this.setInitialState(e),this.setGlobalState(i)}return t.prototype.getOwner=function(){return this.owner},t.prototype.setOwner=function(t){this.owner=t},t.prototype.setInitialState=function(t){this.previousState=null,this.currentState=t},t.prototype.setGlobalState=function(t){this.globalState=t},t.prototype.getCurrentState=function(){return this.currentState},t.prototype.getGlobalState=function(){return this.globalState},t.prototype.getPreviousState=function(){return this.previousState},t.prototype.update=function(){this.globalState&&this.globalState.update(this.owner),this.currentState&&this.currentState.update(this.owner)},t.prototype.changeState=function(t){this.previousState=this.currentState,this.currentState&&this.currentState.exit(this.owner),this.currentState=t,this.currentState&&this.currentState.enter(this.owner)},t.prototype.revertToPreviousState=function(){return!!this.previousState&&(this.changeState(this.previousState),!0)},t.prototype.isInState=function(t){return this.currentState==t},t.prototype.handleEvent=function(t){return!(!this.currentState||!this.currentState.event(this.owner,t))||!(!this.globalState||!this.globalState.event(this.owner,t))},t}();i.default=o,cc._RF.pop()},{}],DialogueData:[function(t,e,i){"use strict";cc._RF.push(e,"c3fcf/QYfRGfaZUJs22LWOn","DialogueData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../utils/IndexZ"),a=t("./FromData"),n=function(){function t(){this.id=0,this.interval=.1,this.delay=0,this.count=0,this.type=0,this.isRotate=!1,this.isFromEnemy=!1,this.canBreakBuilding=!1,this.canBreakBullet=!1,this.canBeatBack=!1,this.from=new a.default,this.statusList=[]}return t.prototype.valueCopy=function(t){t&&(this.interval=t.interval?t.interval:.1,this.delay=t.delay?t.delay:0,this.count=t.count?t.count:0,this.type=t.type?t.type:o.default.ACTOR,this.isFromEnemy=!!t.isFromEnemy&&t.isFromEnemy,this.canBreakBuilding=!!t.canBreakBuilding&&t.canBreakBuilding,this.canBreakBullet=!!t.canBreakBullet&&t.canBreakBullet,this.isRotate=!!t.isRotate&&t.isRotate,this.canBeatBack=!!t.canBeatBack&&t.canBeatBack,this.statusList=t.statusList?t.statusList:[],this.from.valueCopy(t.from))},t.prototype.clone=function(){var e=new t;return e.interval=this.interval,e.delay=this.delay,e.count=this.count,e.isFromEnemy=this.isFromEnemy,e.canBreakBuilding=this.canBreakBuilding,e.canBreakBullet=this.canBreakBullet,e.canBeatBack=this.canBeatBack,e.from=this.from.clone(),e.statusList=this.statusList,e.type=this.type,e.isRotate=this.isRotate,e},t}();i.default=n,cc._RF.pop()},{"../utils/IndexZ":"IndexZ","./FromData":"FromData"}],Dialogue:[function(t,e,i){"use strict";cc._RF.push(e,"631f6Hdi4dH9rqEJFMGhsDk","Dialogue");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.next=null,e.topbg=null,e.bottombg=null,e.avatarSprite=null,e.buttonLayout=null,e.button0=null,e.button1=null,e.button2=null,e.button3=null,e.anim=null,e}return a(e,t),e.prototype.onLoad=function(){var t=this;r.EventHelper.on(r.EventHelper.HUD_DIALOGUE_SHOW,function(e){t.node&&t.show(e.data)}),this.node.active=!1,this.anim=this.getComponent(cc.Animation),this.node.on(cc.Node.EventType.TOUCH_END,function(){t.tap()},this)},e.prototype.show=function(){this.node.active=!0,this.anim.play("DialogueShow")},e.prototype.hide=function(){this.node.active=!1,this.anim.play("DialogueHide")},e.prototype.ShowFinish=function(){this.playDialogue()},e.prototype.HideFinish=function(){this.node.active=!1},e.prototype.tap=function(){},e.prototype.playDialogue=function(){},e.prototype.showToast=function(t,e,i){var o=this;if(!(t.length<1)){this.label.node.width=e?300:600;var a=this.node;a.stopAllActions();var n=3;if(i){(n=.07*t.length)<3&&(n=3);var r=0;this.schedule(function(){o.label.string=""+t.substr(0,r++),a.width=o.label.node.width+10,a.height=o.label.node.height+10,a.opacity=255,a.active=!0},.05,t.length,.3)}else this.scheduleOnce(function(){o.label.string=""+t,a.width=o.label.node.width+10,a.height=o.label.node.height+10,a.opacity=255,a.active=!0},.05);var s=e?360:100;a.y=s-100,a.scale=0,cc.tween(a).to(.1,{scaleX:1}).to(.1,{scaleY:1}).to(.2,{y:s}).delay(n).call(function(){cc.tween(a).to(.1,{scaleY:.1}).to(.1,{scaleX:0}).to(.1,{opacity:0}).call(function(){a.active=!1}).start()}).start()}},n([c(cc.Label)],e.prototype,"label",void 0),n([c(cc.Node)],e.prototype,"next",void 0),n([c(cc.Node)],e.prototype,"topbg",void 0),n([c(cc.Node)],e.prototype,"bottombg",void 0),n([c(cc.Sprite)],e.prototype,"avatarSprite",void 0),n([c(cc.Node)],e.prototype,"buttonLayout",void 0),n([c(cc.Button)],e.prototype,"button0",void 0),n([c(cc.Button)],e.prototype,"button1",void 0),n([c(cc.Button)],e.prototype,"button2",void 0),n([c(cc.Button)],e.prototype,"button3",void 0),n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../logic/EventHelper":"EventHelper"}],DollJoyStick:[function(t,e,i){"use strict";cc._RF.push(e,"a4c84CciM1Ne6aS3ei6/bWa","DollJoyStick");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.head=null,e.bar=null,e.isPressing=!1,e.timeDelay=0,e.movePos=cc.v2(0,0),e.stopCount=0,e}return a(e,t),e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.03&&(this.timeDelay=0,!0)},e.prototype.onLoad=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_START,function(e){t.startPos=e.getLocation(),t.isPressing=!0},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){var i=e.getLocation().sub(t.startPos);i.mag()>t.node.width/10?t.movePos=i.normalize():t.movePos=cc.Vec2.ZERO},this),this.node.on(cc.Node.EventType.TOUCH_END,function(){t.isPressing=!1,t.movePos=cc.Vec2.ZERO},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.isPressing=!1,t.movePos=cc.Vec2.ZERO},this)},e.prototype.updateUi=function(t){this.sprite.angle=-45*t.x,this.head.y=16*(1+t.y),this.bar.scaleY=1+t.y,this.head.y>24&&(this.head.y=24),this.bar.scaleY>1.5&&(this.bar.scaleY=1.5)},e.prototype.update=function(t){this.isTimeDelay(t)&&(this.movePos.equals(cc.Vec2.ZERO)?this.stopCount++:this.stopCount=0,this.stopCount<2&&r.EventHelper.emit(r.EventHelper.KEYBOARD_MOVE,{pos:this.movePos}))},n([c(cc.Node)],e.prototype,"sprite",void 0),n([c(cc.Node)],e.prototype,"head",void 0),n([c(cc.Node)],e.prototype,"bar",void 0),n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../logic/EventHelper":"EventHelper"}],DollMachineDialog:[function(t,e,i){"use strict";cc._RF.push(e,"78eb7fVRwVOurYS85kmreTD","DollMachineDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../../logic/Logic"),s=t("../../utils/AudioPlayer"),l=t("../../utils/Utils"),c=t("../Doll"),u=t("../DollJoyStick"),h=t("./../../logic/EventHelper"),d=t("./BaseDialog"),p=cc._decorator,f=p.ccclass,g=p.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hook=null,e.hookSprite=null,e.claw=null,e.clawLeft=null,e.clawRight=null,e.clawCenter=null,e.hookLine=null,e.topLayout=null,e.layout=null,e.joyStick=null,e.joyStickSmall=null,e.coinLayout=null,e.countDown=null,e.countDownSmall=null,e.dollPrefab=null,e.isHooking=!1,e.lastMovePos=cc.Vec3.ZERO,e.hookSwingAngle=0,e.clawSwingAngle=0,e.dollList=[],e.isCoinInserted=!1,e.isCoinAniming=!1,e}return a(e,t),e.prototype.onLoad=function(){var t=this;h.EventHelper.on(h.EventHelper.KEYBOARD_MOVE,function(e){t.node&&t.node.active&&t.joystickMove(e.pos)}),h.EventHelper.on(h.EventHelper.KEYBOARD_INTERACT,function(){t.node&&t.node.active&&t.buttonClick()}),this.coinLayout.on(cc.Node.EventType.TOUCH_END,function(){t.node&&t.insertCoin()},this),this.initDolls()},e.prototype.initDolls=function(){this.dollList=[],this.layout.removeAllChildren();for(var t=0,e=r.default.dollNameList;t<e.length;t++){var i=e[t],o=cc.instantiate(this.dollPrefab).getComponent(c.default).init(r.default.items[i]);o.node.parent=this.layout,this.dollList.push(o)}for(var a=0;a<3;a++)for(var n=0;n<6;n++)0==n&&0==a||n+a<this.dollList.length+1&&(this.dollList[n+6*a-1].node.position=cc.v3(n*c.default.RECT.width,a*c.default.RECT.width).add(cc.v3(c.default.RECT.width/2,c.default.RECT.width/2)))},e.prototype.insertCoin=function(){var t=this;this.isCoinAniming||(this.anim||(this.anim=this.coinLayout.getComponent(cc.Animation)),this.isCoinAniming=!0,this.anim.play("DollMachineCoinIn"),s.default.play(s.default.COIN),h.EventHelper.emit(h.EventHelper.HUD_ADD_COIN,{count:-2}),this.scheduleOnce(function(){t.coinIn()},1))},e.prototype.coinIn=function(){var t=this;if(this.isCoinInserted)s.default.play(s.default.SELECT_FAIL),this.anim.play("DollMachineCoinOut"),l.default.toast("\u5df2\u6295\u5e01\uff0c\u8bf7\u7a0d\u540e"),this.scheduleOnce(function(){t.isCoinAniming=!1,s.default.play(s.default.COIN)},1);else{this.isCoinAniming=!1,this.isCoinInserted=!0,s.default.play(s.default.CASHIERING),this.unscheduleAllCallbacks();var e=30;this.countDown.string=""+e,this.countDownSmall.string=""+e;var i=function(){--e<=0?(e=0,t.buttonClick()):e<6&&s.default.play(s.default.SELECT_FAIL),t.countDown.string=(e>9?"":"0")+e,t.countDownSmall.string=(e>9?"":"0")+e,t.isHooking&&t.unschedule(i)};this.schedule(i,1,e,1)}},e.prototype.joystickMove=function(t){if(this.joyStick.updateUi(t),this.joyStickSmall.updateUi(t),this.isCoinInserted&&!this.isHooking){var e=l.default.clampPos(this.hook.position.add(t.mul(10)),cc.v3(this.topLayout.width-this.hook.width/2,this.topLayout.height-this.hook.height/2),cc.v3(this.hook.width/2,this.hook.height/2));this.hook.position=e,t.equals(cc.Vec3.ZERO)||(t.x>0?this.lastMovePos.x<0?this.hookSwingAngle<0?this.hookSwingAngle-=30:0==this.hookSwingAngle&&(this.hookSwingAngle+=30):0==this.lastMovePos.x&&0==this.hookSwingAngle&&(this.hookSwingAngle+=30):t.x<0&&(this.lastMovePos.x>0?this.hookSwingAngle>0?this.hookSwingAngle+=30:0==this.hookSwingAngle&&(this.hookSwingAngle-=30):0==this.lastMovePos.x&&0==this.hookSwingAngle&&(this.hookSwingAngle-=30)),this.hookSwingAngle=l.default.clamp(this.hookSwingAngle,75,-75)),this.lastMovePos=t.clone()}},e.prototype.buttonClick=function(){var t=this;if(!this.isCoinInserted)return s.default.play(s.default.SELECT_FAIL),void l.default.toast("\u70b9\u51fb\u53f3\u4e0b\u89d2\u6295\u5e01");if(this.isHooking)s.default.play(s.default.SELECT_FAIL);else{s.default.play(s.default.SELECT),this.isHooking=!0,this.clawLeft.angle=60,this.clawRight.angle=-60,this.clawCenter.scaleY=.5,this.claw.y=0,this.claw.angle=0;var e=null,i=!1,o=!1;cc.tween(this.claw).to(1,{y:-80}).call(function(){cc.tween(t.clawLeft).to(.5,{angle:0}).start(),cc.tween(t.clawRight).to(.5,{angle:0}).start(),cc.tween(t.clawCenter).to(.5,{scaleY:1}).call(function(){var i=t.hook.convertToWorldSpaceAR(t.claw.position),o=t.hook.convertToWorldSpaceAR(cc.v3(0,0)),a=i.x-o.x,n=(e=t.getGrabDoll(cc.v3(t.hook.x+a,t.hook.y)))?45:60;cc.tween(t.clawLeft).to(.5,{angle:n}).start(),cc.tween(t.clawRight).to(.5,{angle:-n}).start()}).to(.5,{scaleY:.5}).call(function(){cc.tween(t.claw).call(function(){cc.tween(t.hook).to(t.hook.position.mag()/120,{position:cc.v3(t.hook.width/2,t.hook.height/2)}).call(function(){i=!0,o&&(t.isHooking=!1,t.isCoinInserted=!1)}).start()}).to(.5,{y:-50}).call(function(){cc.tween(t.clawLeft).to(.2,{angle:0}).to(.1,{angle:60}).start(),cc.tween(t.clawRight).to(.2,{angle:0}).to(.1,{angle:-60}).start(),cc.tween(t.clawCenter).to(.2,{scaleY:1}).to(.1,{scaleY:.5}).start(),e&&e.drop(t.hook.position.y)}).to(1,{y:0}).call(function(){o=!0,i&&(t.isHooking=!1,t.isCoinInserted=!1)}).start(),cc.tween(t.hookLine).to(2,{height:0}).start()}).start()}).start(),cc.tween(this.hookLine).to(1,{height:80}).start()}},e.prototype.getGrabDoll=function(t){cc.log(t.x+","+t.y);for(var e=0,i=this.dollList;e<i.length;e++){var o=i[e];if(r.default.getDistance(o.node.position,t)<30)return o.grabed(this.claw),o}return null},e.prototype.update=function(){var t=this.getSwingAngle(this.hookSprite.angle,this.hookSwingAngle,.2);this.hookSprite.angle=t.x,this.hookSwingAngle=t.y},e.prototype.getSwingAngle=function(t,e,i){var o=0,a=e;return e>0?(o=t+1)>e&&(o=e,a*=i-1):e<0?(o=t-1)<e&&(o=e,a*=i-1):t>0?o=t-1:t<0&&(o=t+1),a=a>0?Math.floor(a):Math.ceil(a),cc.v2(o,a)},e.prototype.show=function(){t.prototype.show.call(this),s.default.stopAllEffect(),s.default.play(s.default.DOLLMACHINE,!1,!0)},e.prototype.dismiss=function(){t.prototype.dismiss.call(this),s.default.stopAllEffect()},n([g(cc.Node)],e.prototype,"hook",void 0),n([g(cc.Node)],e.prototype,"hookSprite",void 0),n([g(cc.Node)],e.prototype,"claw",void 0),n([g(cc.Node)],e.prototype,"clawLeft",void 0),n([g(cc.Node)],e.prototype,"clawRight",void 0),n([g(cc.Node)],e.prototype,"clawCenter",void 0),n([g(cc.Node)],e.prototype,"hookLine",void 0),n([g(cc.Node)],e.prototype,"topLayout",void 0),n([g(cc.Node)],e.prototype,"layout",void 0),n([g(u.default)],e.prototype,"joyStick",void 0),n([g(u.default)],e.prototype,"joyStickSmall",void 0),n([g(cc.Node)],e.prototype,"coinLayout",void 0),n([g(cc.Label)],e.prototype,"countDown",void 0),n([g(cc.Label)],e.prototype,"countDownSmall",void 0),n([g(cc.Prefab)],e.prototype,"dollPrefab",void 0),n([f],e)}(d.default);i.default=y,cc._RF.pop()},{"../../logic/Logic":"Logic","../../utils/AudioPlayer":"AudioPlayer","../../utils/Utils":"Utils","../Doll":"Doll","../DollJoyStick":"DollJoyStick","./../../logic/EventHelper":"EventHelper","./BaseDialog":"BaseDialog"}],Doll:[function(t,e,i){"use strict";cc._RF.push(e,"ac317QzJatNd7oqz6bJXovF","Doll");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./../logic/EventHelper"),s=t("../data/ItemData"),l=t("../utils/AudioPlayer"),c=t("../utils/Random"),u=t("../logic/Logic"),h=cc._decorator,d=h.ccclass,p=h.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.isAniming=!1,e.isGrabing=!1,e.data=new s.default,e}var i;return a(e,t),i=e,e.prototype.grabed=function(t){this.isAniming||(this.clawNode=t,this.node.zIndex=100,this.isAniming=!0,this.isGrabing=!0)},e.prototype.init=function(t){return t?(this.data.valueCopy(t),this.sprite.spriteFrame=u.default.spriteFrameRes(t.resName),this):this},e.prototype.drop=function(t){var e=this;this.isGrabing=!1,i.RECT.contains(cc.v2(cc.v3(this.node.position.x,t)))?cc.tween(this.node).to(.5,{y:t}).to(.5,{y:-100}).call(function(){l.default.play(l.default.DOLLDOWN),e.addItem()}).start():cc.tween(this.node).to(.5,{y:t}).call(function(){e.isAniming=!1,cc.tween(e.sprite.node).to(.3,{angle:c.default.getRandomNum(-30,30)}).start()}).start()},e.prototype.addItem=function(){l.default.play(l.default.CASHIERING),cc.director.emit(r.EventHelper.PLAYER_CHANGEITEM,{detail:{itemData:this.data}})},e.prototype.update=function(){if(this.clawNode&&this.isGrabing){var t=this.clawNode.convertToWorldSpaceAR(cc.v3(0,-16));this.node.position=this.node.parent.convertToNodeSpaceAR(t)}},e.RECT=cc.rect(0,0,100,100),n([p(cc.Sprite)],e.prototype,"sprite",void 0),i=n([d],e)}(cc.Component);i.default=f,cc._RF.pop()},{"../data/ItemData":"ItemData","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer","../utils/Random":"Random","./../logic/EventHelper":"EventHelper"}],Door:[function(t,e,i){"use strict";cc._RF.push(e,"f14f52tIg1Ivb0Rnl80O8tL","Door");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("./Building"),l=t("../utils/IndexZ"),c=t("../collider/CCollider"),u=t("../utils/Random"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isOpen=!1,e.isDoor=!0,e.isHidden=!1,e.isEmpty=!1,e.isLock=!1,e.isTransparent=!1,e.isDecorate=!1,e.dir=0,e.sprite=null,e.roof=null,e.leftside=null,e.rightside=null,e.lockInfo=null,e}return a(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.roof=this.node.getChildByName("roof").getComponent(cc.Sprite),this.leftside=this.node.getChildByName("leftside").getComponent(cc.Sprite),this.rightside=this.node.getChildByName("rightside").getComponent(cc.Sprite),this.lockInfo=this.node.getChildByName("roof").getChildByName("info"),this.arrow=this.node.getChildByName("doorarrow"),this.arrow.opacity=0,this.boxCollider=this.getComponent(c.default),this.node.zIndex=l.default.FLOOR},e.prototype.start=function(){this.sprite&&(this.sprite.spriteFrame=r.default.spriteFrameRes("door"+(this.dir>1?"side":"")+"0"+r.default.chapterIndex+"anim000"),this.sprite.node.width=128,this.sprite.node.height=this.dir>1?384:128,this.isDecorate&&(this.sprite.node.opacity=0)),this.roof||(this.roof=this.node.getChildByName("roof").getComponent(cc.Sprite));var t=r.default.spriteFrameRes("roof"+r.default.worldLoader.getCurrentLevelData().wallRes1+"anim000"),e=r.default.spriteFrameRes("wall"+r.default.worldLoader.getCurrentLevelData().wallRes1+"anim002");this.dir>1?(t=null,e=null,this.node.zIndex-=120):this.node.zIndex+=4,this.leftside.spriteFrame=e,this.rightside.spriteFrame=e,this.roof.spriteFrame=t,this.roof.node.parent=this.node.parent;var i=this.node.convertToWorldSpaceAR(cc.v3(0,128));switch(this.roof.node.position=this.roof.node.parent.convertToNodeSpaceAR(i),this.roof.node.zIndex=l.default.OVERHEAD,this.dir){case 0:break;case 1:this.roof.node.angle=180,this.lockInfo.angle=-180;break;case 2:break;case 3:this.sprite.node.scaleX=-1}!this.lockInfo||!this.isLock||r.default.mapManager.isNeighborRoomStateClear(this.dir)||this.isDecorate||this.isTransparent||(this.lockInfo.opacity=255),1==this.dir&&(this.roof.node.opacity=128);var o=this.boxCollider;o.offset=cc.v2(0,7),o.setSize(cc.size(128,114)),this.dir>1&&(o.offset=cc.v2(0,-64),o.setSize(cc.size(64,256))),this.isTransparent&&(this.node.active=!1,this.roof.node.active=!1)},e.prototype.setOpen=function(t,e){this.isDoor&&(t?this.openGate(e):this.closeGate(e))},e.prototype.openGate=function(t){var e=this;if(!this.lockInfo||!this.isLock||r.default.mapManager.isNeighborRoomStateClear(this.dir)||this.isDecorate){if(!this.isOpen){this.sprite||(this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite)),this.lockInfo&&(this.lockInfo.opacity=0),this.isOpen=!0;var i=0;this.schedule(function(){e.sprite.spriteFrame=r.default.spriteFrameRes("door"+(e.dir>1?"side":"")+"0"+r.default.chapterIndex+"anim00"+i++),i>4&&(e.boxCollider.sensor=!0)},t?0:.15,4)}}else this.lockInfo.opacity=255},e.prototype.closeGate=function(t){var e=this;if(this.isOpen&&!this.isEmpty&&!this.isTransparent){this.isOpen=!1;var i=4;this.schedule(function(){e.sprite.spriteFrame=r.default.spriteFrameRes("door"+(e.dir>1?"side":"")+"0"+r.default.chapterIndex+"anim00"+i--),i<0&&(e.boxCollider.sensor=!1)},t?0:.1,4)}},e.prototype.onColliderEnter=function(t){this.dir<2&&(t.tag==c.default.TAG.PLAYER||t.tag==c.default.TAG.NONPLAYER)&&(this.roof.node.opacity=this.isTransparent?0:128)},e.prototype.onColliderStay=function(t){this.dir<2&&(t.tag==c.default.TAG.PLAYER||t.tag==c.default.TAG.NONPLAYER)&&(this.roof.node.opacity=this.isTransparent?0:128)},e.prototype.onColliderExit=function(t){this.dir<2&&(t.tag==c.default.TAG.PLAYER||t.tag==c.default.TAG.NONPLAYER)&&(this.roof.node.opacity=this.isTransparent?0:255,(this.lockInfo&&this.lockInfo.opacity<1||this.isDecorate)&&(this.roof.node.opacity=this.isTransparent?0:180))},e.prototype.disappear=function(){t.prototype.disappear.call(this),cc.tween(this.roof.node).to(.5+u.default.rand(),{scaleY:0}).start()},n([d],e)}(s.default));i.default=p,cc._RF.pop()},{"../collider/CCollider":"CCollider","../logic/Logic":"Logic","../utils/IndexZ":"IndexZ","../utils/Random":"Random","./Building":"Building"}],Dragon:[function(t,e,i){"use strict";cc._RF.push(e,"a38f40rLRxEErH92pL9pLeC","Dragon");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Boss"),s=t("../data/DamageData"),l=t("../logic/Shooter"),c=t("../logic/Dungeon"),u=t("../manager/StatusManager"),h=t("../utils/NextStep"),d=t("../utils/Random"),p=t("../utils/AudioPlayer"),f=t("../data/FromData"),g=t("../logic/Achievement"),y=t("../utils/IndexZ"),m=t("../utils/ActorUtils"),v=t("../logic/Logic"),E=t("../collider/CCollider"),_=cc._decorator,T=_.ccclass,D=(_.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeDelay=0,e.isMoving=!1,e.fireSkill=new h.default,e.rainSkill=new h.default,e.isRainReady=!1,e.actionCount=0,e.actionTimeDelay=0,e}return a(e,t),e.prototype.init=function(){},e.prototype.onLoad=function(){this.sc.isDied=!1,this.sc.isShow=!1,this.anim=this.getComponent(cc.Animation),this.shooter01=this.node.getChildByName("Shooter01").getComponent(l.default),this.shooter01.from.valueCopy(f.default.getClone(this.actorName(),"dragonhead")),this.statusManager=this.node.getChildByName("StatusManager").getComponent(u.default),this.physicBox=this.getComponent(E.default)},e.prototype.start=function(){},e.prototype.takeDamage=function(t){if(this.sc.isDied||!this.sc.isShow||this.rainSkill.IsExcuting)return!1;this.data.currentHealth-=this.data.getDamage(t).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth);var e=[p.default.MONSTER_HIT,p.default.MONSTER_HIT1,p.default.MONSTER_HIT2];return p.default.play(e[v.default.getRandomNum(0,2)]),!0},e.prototype.killed=function(){var t=this;this.sc.isDied||(g.default.addMonsterKillAchievement(this.data.resName),this.sc.isDied=!0,this.scheduleOnce(function(){t.node&&(t.node.active=!1)},5),this.getLoot())},e.prototype.fireFire=function(){var t=this;this.fireSkill.next(function(){t.fireSkill.IsExcuting=!0,t.anim.play("DragonFire"),t.scheduleOnce(function(){t.shooter01.setHv(cc.v2(0,-1)),t.shooter01.data.bulletLineInterval=.5,t.fireShooter(t.shooter01,"bullet200",2,5)},1.1),t.scheduleOnce(function(){t.fireSkill.IsExcuting=!1,t.anim.play("DragonIdle")},2)},5,!0)},e.prototype.fireRain=function(){var t=this;this.isRainReady&&this.rainSkill.next(function(){t.rainSkill.IsExcuting=!0,t.physicBox.sensor=!0,t.entity.Move.linearVelocity=cc.v2(0,0),t.anim.stop(),t.anim.play("DragonFlyHigh"),t.scheduleOnce(function(){t.anim.play("DragonFlyLow"),t.physicBox.sensor=!1},13),t.scheduleOnce(function(){t.rainSkill.IsExcuting=!1},15),t.schedule(function(){t.dungeon.addFallStone(t.dungeon.player.node.position,!0,!0),t.dungeon.addFallStone(c.default.getPosInMap(cc.v3(d.default.getRandomNum(0,c.default.WIDTH_SIZE-1),d.default.getRandomNum(0,c.default.HEIGHT_SIZE-1))),!0,!0),t.dungeon.addFallStone(c.default.getPosInMap(cc.v3(d.default.getRandomNum(0,c.default.WIDTH_SIZE-1),d.default.getRandomNum(0,c.default.HEIGHT_SIZE-1))),!0,!0),t.dungeon.addFallStone(c.default.getPosInMap(cc.v3(d.default.getRandomNum(0,c.default.WIDTH_SIZE-1),d.default.getRandomNum(0,c.default.HEIGHT_SIZE-1))),!0,!0)},.5,20,2)},30)},e.prototype.bossAction=function(){if(!this.sc.isDied&&this.sc.isShow&&this.dungeon){if(this.changeZIndex(),this.fireRain(),this.rainSkill.IsExcuting||this.fireFire(),!this.rainSkill.IsExcuting){this.actionCount++;var t=cc.v3(1,0);this.actionCount>10&&(t=cc.v3(-1,0)),this.actionCount>20&&(this.actionCount=0),t.equals(cc.Vec3.ZERO)||(t=t.normalizeSelf(),this.move(t,800))}}else this.actionCount=0},e.prototype.changeZIndex=function(){this.node.zIndex=y.default.OVERHEAD},e.prototype.move=function(t,e){if(!this.sc.isDied){t.equals(cc.Vec3.ZERO)||(this.pos=c.default.getIndexInMap(this.entity.Transform.position));var i=t.x,o=t.y,a=cc.v2(i,o);a=a.normalize().mul(e),this.entity.Move.linearVelocity=a,this.isMoving=0!=i||0!=o,this.changeZIndex()}},e.prototype.fireShooter=function(t,e,i,o,a){t.dungeon=this.dungeon,t.data.bulletType=e,t.data.bulletArcExNum=i,t.data.bulletLineExNum=o,t.setHv(cc.v2(0,-1)),t.fireBullet(a,cc.Vec3.ZERO)},e.prototype.showBoss=function(){var t=this;this.sc.isShow=!0,this.entity.NodeRender.node=this.node,this.entity.Move.linearDamping=10,this.healthBar&&(this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.healthBar.node.active=!this.sc.isDied),this.scheduleOnce(function(){t.isRainReady=!0},10)},e.prototype.isActionTimeDelay=function(t){return this.actionTimeDelay+=t,this.actionTimeDelay>.2&&(this.actionTimeDelay=0,!0)},e.prototype.updateLogic=function(t){this.timeDelay+=t,this.timeDelay>1&&(this.timeDelay=0),this.isActionTimeDelay(t)&&this.bossAction(),this.data.currentHealth<1&&this.killed(),this.healthBar.node.active=!this.sc.isDied},e.prototype.onColliderEnter=function(t,e){if(e.tag==E.default.TAG.BOSS_HIT){var i=m.default.getEnemyCollisionTarget(t);if(i&&!this.sc.isDied&&!this.physicBox.sensor){var o=new s.default;o.physicalDamage=3,i.takeDamage(o,f.default.getClone(this.actorName(),"dragonhead"),this)}}},e.prototype.actorName=function(){return"\u672b\u65e5\u9ed1\u9f99"},n([T],e)}(r.default));i.default=D,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/NextStep":"NextStep","../utils/Random":"Random","./Boss":"Boss"}],DryadGrass:[function(t,e,i){"use strict";cc._RF.push(e,"d7d90DMrjlILYsaGuEm//pn","DryadGrass");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../manager/StatusManager"),l=t("../data/FromData"),c=t("../utils/ActorUtils"),u=t("../building/Building"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isUp=!1,e.isAuto=!0,e.isUping=!1,e}return a(e,t),e.prototype.onLoad=function(){this.initCollider(),this.isUp=!1},e.prototype.takeDamage=function(){return!1},e.prototype.fall=function(){this.anim=this.getComponent(cc.Animation),this.anim.play(),this.isUping=!0},e.prototype.TwineUp=function(){var t=this;this.isUp=!0,this.scheduleOnce(function(){t.isUp=!1},.1),this.scheduleOnce(function(){t.node&&t.destroyEntityNode()},6)},e.prototype.start=function(){},e.prototype.onColliderEnter=function(t){!c.default.getEnemyCollisionTarget(t)||this.isAuto||this.isUping||this.fall()},e.prototype.onColliderStay=function(t){var e=c.default.getEnemyCollisionTarget(t);if(e&&this.isUp&&this.isValid){this.isUp=!1;var i=l.default.getClone(this.actorName(),"dryadtwine03");e.takeDamage(new r.default(2),i)&&e.addStatus(s.default.TWINE,i)}},e.prototype.actorName=function(){return"\u6811\u6839\u7f20\u7ed5"},n([d],e)}(u.default));i.default=p,cc._RF.pop()},{"../building/Building":"Building","../data/DamageData":"DamageData","../data/FromData":"FromData","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils"}],Dryad:[function(t,e,i){"use strict";cc._RF.push(e,"d1a62Oo+gRDI5+v2dxAMRw+","Dryad");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Boss"),s=t("../logic/Shooter"),l=t("../logic/Logic"),c=t("../manager/StatusManager"),u=t("../utils/NextStep"),h=t("./BossAttackCollider"),d=t("../logic/EventHelper"),p=t("../utils/AudioPlayer"),f=t("../data/FromData"),g=t("../logic/Achievement"),y=t("../collider/CCollider"),m=cc._decorator,v=m.ccclass,E=m.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hand01=null,e.hand02=null,e.timeDelay=0,e.isMoving=!1,e.flower01=null,e.flower02=null,e.twoFlowerSkill=new u.default,e.twineGrassSkill=new u.default,e.meleeSkill=new u.default,e.stoneSkill=new u.default,e.actionTimeDelay=0,e}return a(e,t),e.prototype.init=function(){throw new Error("Method not implemented.")},e.prototype.onLoad=function(){this.sc.isDied=!1,this.sc.isShow=!1,this.anim=this.getComponent(cc.Animation),this.shooter01=this.node.getChildByName("Shooter01").getComponent(s.default),this.shooter02=this.node.getChildByName("Shooter02").getComponent(s.default),this.shooter03=this.node.getChildByName("Shooter03").getComponent(s.default);var t=f.default.getClone(this.actorName(),"dryadflower04");this.shooter01.from.valueCopy(t),this.shooter02.from.valueCopy(t),this.shooter03.from.valueCopy(t),this.statusManager=this.node.getChildByName("StatusManager").getComponent(c.default),this.hand01.from.valueCopy(t),this.hand02.from.valueCopy(t)},e.prototype.start=function(){},e.prototype.takeDamage=function(t){if(this.sc.isDied||!this.sc.isShow)return!1;this.data.currentHealth-=this.data.getDamage(t).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.playHit(this.node.getChildByName("sprite"));var e=[p.default.MONSTER_HIT,p.default.MONSTER_HIT1,p.default.MONSTER_HIT2];return p.default.play(e[l.default.getRandomNum(0,2)]),!0},e.prototype.killed=function(){var t=this;this.sc.isDied||(g.default.addMonsterKillAchievement(this.data.resName),this.sc.isDied=!0,this.scheduleOnce(function(){t.node&&(t.node.active=!1)},5),this.getLoot())},e.prototype.bossAction=function(){!this.sc.isDied&&this.sc.isShow&&this.dungeon&&(this.changeZIndex(),this.twoFlowerSkill.IsExcuting||this.stoneSkill.IsExcuting||this.attack(),this.meleeSkill.IsExcuting||this.stoneSkill.IsExcuting||this.twoFlowers(),this.meleeSkill.IsExcuting||this.twoFlowerSkill.IsExcuting||this.fireStone(),this.twineGrass())},e.prototype.attack=function(){var t=this;this.meleeSkill.next(function(){cc.director.emit(d.EventHelper.PLAY_AUDIO,{detail:{name:p.default.MELEE}}),t.meleeSkill.IsExcuting=!0,t.anim||(t.anim=t.getComponent(cc.Animation)),l.default.getHalfChance()?(t.anim.play("DryadAttack01"),t.hand01.showCollider(2,1)):(t.anim.play("DryadAttack02"),t.hand02.showCollider(2,1)),t.scheduleOnce(function(){t.anim.play("DryadIdle"),t.meleeSkill.IsExcuting=!1},1)},2,!0)},e.prototype.twineGrass=function(){var t=this;this.twineGrassSkill.next(function(){t.schedule(function(){t.dungeon.buildingManager.addTwineGrass(t.dungeon.player.pos.clone(),!0)},1,2)},8,!0)},e.prototype.twoFlowers=function(){var t=this;this.twoFlowerSkill.next(function(){t.twoFlowerSkill.IsExcuting=!0,t.shooter02.setHv(cc.v2(0,-1)),t.shooter03.setHv(cc.v2(0,-1)),t.anim.play("DryadOpen"),t.flower01.getComponent(cc.Animation).play(),t.flower02.getComponent(cc.Animation).play(),t.scheduleOnce(function(){t.shooter02.data.bulletLineInterval=.5,t.shooter03.data.bulletLineInterval=.5,t.fireShooter(t.shooter02,"bullet021",99,2),t.fireShooter(t.shooter03,"bullet021",99,2)},2),t.scheduleOnce(function(){t.anim.play("DryadIdle"),t.twoFlowerSkill.IsExcuting=!1},4)},6,!0)},e.prototype.fireStone=function(){var t=this;this.stoneSkill.next(function(){t.stoneSkill.IsExcuting=!0,t.anim.play("DryadStone"),t.scheduleOnce(function(){var e=t.entity.Transform.position.clone().add(t.shooter01.node.position),i=t.dungeon.player.getCenterPosition().sub(e);i.equals(cc.Vec3.ZERO)||(t.shooter01.setHv(cc.v2(i).normalize()),t.fireShooter(t.shooter01,"bullet022",0,0))},.55),t.scheduleOnce(function(){t.stoneSkill.IsExcuting=!1,t.anim.play("DryadIdle")},1)},4,!0)},e.prototype.fireShooter=function(t,e,i,o,a){t.dungeon=this.dungeon,t.data.bulletType=e,t.data.bulletArcExNum=i,t.data.bulletLineExNum=o,t.fireBullet(a,cc.Vec3.ZERO)},e.prototype.showBoss=function(){this.sc.isShow=!0,this.entity.NodeRender.node=this.node,this.entity.Move.linearDamping=10,this.healthBar&&(this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.healthBar.node.active=!this.sc.isDied)},e.prototype.isActionTimeDelay=function(t){return this.actionTimeDelay+=t,this.actionTimeDelay>.2&&(this.actionTimeDelay=0,!0)},e.prototype.updateLogic=function(t){this.timeDelay+=t,this.timeDelay>1&&(this.timeDelay=0),this.isActionTimeDelay(t)&&this.bossAction(),this.data.currentHealth<1&&this.killed(),this.healthBar.node.active=!this.sc.isDied,this.entity.Move.linearVelocity=cc.Vec2.ZERO},e.prototype.actorName=function(){return"\u8fdc\u53e4\u4e4b\u6811"},e.prototype.onColliderEnter=function(t,e){e.tag==y.default.TAG.BOSS_HIT&&(e.id==this.hand01.collider.id?this.hand01.onColliderEnter(t,e):this.hand02.onColliderEnter(t,e))},n([E(h.default)],e.prototype,"hand01",void 0),n([E(h.default)],e.prototype,"hand02",void 0),n([E(cc.Node)],e.prototype,"flower01",void 0),n([E(cc.Node)],e.prototype,"flower02",void 0),n([v],e)}(r.default);i.default=_,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/FromData":"FromData","../logic/Achievement":"Achievement","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../manager/StatusManager":"StatusManager","../utils/AudioPlayer":"AudioPlayer","../utils/NextStep":"NextStep","./Boss":"Boss","./BossAttackCollider":"BossAttackCollider"}],DungeonStyleData:[function(t,e,i){"use strict";cc._RF.push(e,"6e0bc4Ume5FZZHLhQzz4NXv","DungeonStyleData"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(t,e,i,o,a,n,r){this.background=t,this.topwall=e,this.doorframe=a,this.sidewall=i,this.door=o,this.bg02color=n,this.floor=r},cc._RF.pop()},{}],DungeonStyleManager:[function(t,e,i){"use strict";cc._RF.push(e,"96118QtbixO743MdRQKBctE","DungeonStyleManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../logic/Dungeon"),l=t("../data/DungeonStyleData"),c=t("../ui/ParallaxBackground"),u=t("../utils/IndexZ"),h=t("./BaseManager"),d=cc._decorator,p=d.ccclass,f=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.background01=null,e.floor=null,e.parallaxBackground=null,e.darksides="darksides",e}return a(e,t),e.prototype.clear=function(){},e.prototype.runBackgroundAnim=function(t){if(this.background01){var e=r.default.spriteFrameRes(t),i=r.default.spriteFrameRes(t+"1");if(i||(i=r.default.spriteFrameRes(t)),e){this.background01.stopAllActions();var o=this.background01.getComponent(cc.Sprite);cc.tween(this.background01).repeatForever(cc.tween().delay(.4).call(function(){o.spriteFrame=e}).delay(.4).call(function(){o.spriteFrame=i})).start()}}},e.prototype.addDecorations=function(){switch(r.default.chapterIndex){case r.default.CHAPTER00:this.styleData=new l.default("pipeline","restwall1","restsides","restdoor","restdoorframe","#000000","tile_lab001");break;case r.default.CHAPTER01:this.styleData=new l.default("sea","shipwall1","shipsides","shipdoor","shipdoorframe","#000000","tile_deck001");break;case r.default.CHAPTER02:this.styleData=new l.default("grass","junglewall1","junglesides","jungledoor","jungledoorframe","#000000","tile_dirt001");break;case r.default.CHAPTER03:this.styleData=new l.default("sandsea","pyramidwall1","pyramidsides","pyramiddoor","pyramiddoorframe","#000000","tile003");break;case r.default.CHAPTER04:case r.default.CHAPTER05:this.styleData=new l.default("magmasea","dungeonwall1","dungeonsides","dungeondoor","dungeondoorframe","#000000","tile004");break;case r.default.CHAPTER099:this.styleData=new l.default("pipeline","restwall1","restsides","restdoor","restdoorframe","#000000","tile_lab001")}this.styleData&&(this.addFloor(),this.background01.getComponent(cc.Sprite).spriteFrame=null)},e.prototype.addDecorateBg=function(){var t=cc.instantiate(this.parallaxBackground);t.parent=this.node;var e=s.default.getPosInMap(cc.v3(s.default.WIDTH_SIZE/2,s.default.HEIGHT_SIZE/2));t.setPosition(e),t.zIndex=u.default.BACKGROUND;var i=t.getComponent(c.default);i.background.width=s.default.TILE_SIZE/2*s.default.WIDTH_SIZE,i.background.height=s.default.TILE_SIZE/2*(s.default.HEIGHT_SIZE+4),i.background.color=cc.Color.WHITE.fromHEX(this.styleData.bg02color),i.init()},e.prototype.addFloor=function(){var t=r.default.worldLoader.getCurrentLevelData(),e=r.default.mapManager.getCurrentRoom(),i=s.default.getPosInMap(cc.v3(-4,-4));0==e.x?(i=s.default.getPosInMap(cc.v3(0,-4)),0==e.y?i=s.default.getPosInMap(cc.v3(0,0)):e.y==t.height-1&&(i=s.default.getPosInMap(cc.v3(0,-8)))):e.x==t.width-1&&(i=s.default.getPosInMap(cc.v3(-8,-4)),0==e.y?i=s.default.getPosInMap(cc.v3(-8,-8)):e.y==t.height-1&&(i=s.default.getPosInMap(cc.v3(-8,0)))),0==e.x?(i=s.default.getPosInMap(cc.v3(0,-4)),0==e.y?i=s.default.getPosInMap(cc.v3(0,0)):e.y==t.height-1&&(i=s.default.getPosInMap(cc.v3(0,-8)))):e.x==t.width-1&&(i=s.default.getPosInMap(cc.v3(-8,-4)),0==e.y?i=s.default.getPosInMap(cc.v3(-8,-8)):e.y==t.height-1&&(i=s.default.getPosInMap(cc.v3(-8,0)))),0==e.y?(i=s.default.getPosInMap(cc.v3(-4,0)),0==e.x?i=s.default.getPosInMap(cc.v3(0,0)):e.x==t.width-1&&(i=s.default.getPosInMap(cc.v3(-8,-8)))):e.y==t.height-1&&(i=s.default.getPosInMap(cc.v3(-4,-8)),0==e.x?i=s.default.getPosInMap(cc.v3(0,-8)):e.x==t.width-1&&(i=s.default.getPosInMap(cc.v3(-8,0)))),this.floor.width=s.default.TILE_SIZE/4*(s.default.WIDTH_SIZE+12),this.floor.height=s.default.TILE_SIZE/4*(s.default.HEIGHT_SIZE+12),this.floor.position=cc.v3(i.x-s.default.TILE_SIZE/2,i.y-s.default.TILE_SIZE/2),this.floor.zIndex=u.default.BACKGROUNDFLOOR;var o=this.floor.getComponent(cc.Sprite);if(o.spriteFrame=r.default.spriteFrameRes(t.floorRes+"001"),t.isWater){o.spriteFrame=r.default.spriteFrameRes("wateridle000");var a=cc.tween().delay(.2).call(function(){o.spriteFrame=r.default.spriteFrameRes("wateridle000")}).delay(.2).call(function(){o.spriteFrame=r.default.spriteFrameRes("wateridle001")}).delay(.2).call(function(){o.spriteFrame=r.default.spriteFrameRes("wateridle002")}).delay(.2).call(function(){o.spriteFrame=r.default.spriteFrameRes("wateridle003")});this.floor.stopAllActions(),cc.tween(this.floor).repeatForever(a).start()}},n([f(cc.Node)],e.prototype,"background01",void 0),n([f(cc.Node)],e.prototype,"floor",void 0),n([f(cc.Prefab)],e.prototype,"parallaxBackground",void 0),n([p],e)}(h.default);i.default=g,cc._RF.pop()},{"../data/DungeonStyleData":"DungeonStyleData","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../ui/ParallaxBackground":"ParallaxBackground","../utils/IndexZ":"IndexZ","./BaseManager":"BaseManager"}],Dungeon:[function(t,e,i){"use strict";cc._RF.push(e,"6dd52klzMJJgafrk2kw2YVi","Dungeon");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Player"),s=t("./Tile"),l=t("./Logic"),c=t("./EventHelper"),u=t("../manager/MonsterManager"),h=t("../manager/EquipmentManager"),d=t("../manager/DungeonStyleManager"),p=t("../utils/AudioPlayer"),f=t("../rect/RoomType"),g=t("../utils/IndexZ"),y=t("../manager/BuildingManager"),m=t("../manager/NonPlayerManager"),v=t("../manager/ItemManager"),E=t("../utils/Utils"),_=t("../manager/LightManager"),T=t("../data/DamageData"),D=t("../ecs/system/GameWorldSystem"),S=t("../utils/Random"),O=t("../manager/LoadingManager"),A=t("../ui/StatusIconList"),C=cc._decorator,R=C.ccclass,L=C.property,b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tile=null,e.playerPrefab=null,e.fog=null,e.statusIconList=null,e.mainCamera=null,e.mapData=[],e.tilesmap=new Array,e.floorIndexMap=new Array,e.timeDelay=0,e.checkTimeDelay=0,e.player=null,e.monsterManager=null,e.nonPlayerManager=null,e.equipmentManager=null,e.dungeonStyleManager=null,e.itemManager=null,e.buildingManager=null,e.lightManager=null,e.CameraZoom=i.DEFAULT_ZOOM,e.needZoomIn=!1,e.isInitFinish=!1,e.isClear=!1,e.isComplete=!1,e.currentPos=cc.v3(0,0),e.isDisappeared=!1,e.cameraTargetNode=null,e.rootSystem=null,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.anim=this.getComponent(cc.Animation),c.EventHelper.on(c.EventHelper.PLAYER_MOVE,function(e){t.playerAction(e.dir,e.pos,e.dt)}),c.EventHelper.on(c.EventHelper.DUNGEON_SETEQUIPMENT,function(e){t.node&&t.addEquipment(e.res,e.pos,e.equipmentData)}),c.EventHelper.on(c.EventHelper.DUNGEON_ADD_COIN,function(e){t.addCoin(e.pos,e.count)}),c.EventHelper.on(c.EventHelper.DUNGEON_ADD_OILGOLD,function(e){t.addOilGold(e.pos,e.count)}),c.EventHelper.on(c.EventHelper.DUNGEON_ADD_ITEM,function(e){t.node&&t.addItem(e.pos,e.res,e.count)}),c.EventHelper.on(c.EventHelper.DUNGEON_ADD_FALLSTONE,function(e){t.addFallStone(e.pos,e.isAuto)}),c.EventHelper.on(c.EventHelper.DUNGEON_ADD_LIGHTENINGFALL,function(e){t.addLighteningFall(e.pos,!1,!1,e.showArea,e.damage)}),c.EventHelper.on(c.EventHelper.DUNGEON_SHAKEONCE,function(){t.anim&&t.anim.play("DungeonShakeOnce")}),c.EventHelper.on(c.EventHelper.BOSS_ADDSLIME,function(e){t.addBossSlime(e.slimeType,e.posIndex)}),c.EventHelper.on(c.EventHelper.TEST_SHOW_NODE_COUNT,function(){t.logNodeCount()}),c.EventHelper.on(c.EventHelper.DUNGEON_DISAPPEAR,function(){if(t.node){t.isDisappeared=!0;for(var e=0,i=t.buildingManager.buildingList;e<i.length;e++){var o=i[e];o&&o.node&&o.disappear()}for(var a=0,n=t.tilesmap;a<n.length;a++)for(var r=0,s=n[a];r<s.length;r++){var l=s[r];l&&l.node&&l.disappear()}cc.tween(t.dungeonStyleManager.floor).to(.5+S.default.rand(),{opacity:0}).start()}}),this.monsterManager=this.getComponent(u.default),this.nonPlayerManager=this.getComponent(m.default),this.equipmentManager=this.getComponent(h.default),this.itemManager=this.getComponent(v.default),this.dungeonStyleManager=this.getComponent(d.default),this.buildingManager=this.getComponent(y.default),this.lightManager=this.getComponent(_.default),this.reset()},e.prototype.reset=function(){var t=this;l.default.lastBgmIndex=l.default.chapterIndex==l.default.CHAPTER099?1:0,p.default.stopAllEffect(),p.default.play(p.default.PLAY_BG,!0),this.monsterManager.clear(),this.nonPlayerManager.clear(),this.equipmentManager.clear(),this.itemManager.clear(),this.dungeonStyleManager.clear(),this.buildingManager.clear(),this.lightManager.clear(),this.fog.zIndex=g.default.FOG,this.fog.scale=.6,this.fog.opacity=255,this.lightManager.shadow.node.zIndex=g.default.SHADOW,this.lightManager.shadowRay.node.zIndex=g.default.SHADOW+10,this.currentPos=cc.v3(l.default.mapManager.getCurrentRoom().x,l.default.mapManager.getCurrentRoom().y);var e=l.default.mapManager.getCurrentMapStringArray();this.mapData=e;var o=l.default.worldLoader.getCurrentLevelData(),a=o.getExitList();l.default.changeDungeonSize(),this.dungeonStyleManager.addDecorations();for(var n=0,s=this.tilesmap;n<s.length;n++){var c=s[n];E.default.clearComponentArray(c)}var u=this.node.getChildByName("colliderdebug");u.zIndex=g.default.UI,this.rootSystem=new D.default(i.WIDTH_SIZE*i.TILE_SIZE,i.HEIGHT_SIZE*i.TILE_SIZE,u.getComponent(cc.Graphics)),this.rootSystem.init(),this.tilesmap=new Array,this.floorIndexMap=new Array,this.addItemListOnGround(),this.addEquipmentListOnGround(),l.default.getBuildings(y.default.AIREXIT,function(){l.default.getBuildings(y.default.WALL,function(){l.default.getBuildings(y.default.DOOR,function(){t.buildingManager.addAirExit(e);for(var n=0;n<i.WIDTH_SIZE;n++){t.tilesmap[n]=new Array(n);for(var r=0;r<i.HEIGHT_SIZE;r++)t.addTiles(e[n][r],cc.v3(n,r),o,!1),t.buildingManager.addBuildingsFromMap(t,e,e[n][r],cc.v3(n,r),o,a),l.default.mapManager.isCurrentRoomStateClear()&&!l.default.mapManager.getCurrentRoomType().isEqual(f.default.TEST_ROOM)||t.itemManager.addItemFromMap(e[n][r],cc.v3(n,r)),(!l.default.mapManager.isCurrentRoomStateClear()||l.default.mapManager.getCurrentRoomType().isEqual(f.default.TEST_ROOM)||l.default.mapManager.getCurrentRoomType().isEqual(f.default.START_ROOM))&&t.monsterManager.addMonstersAndBossFromMap(t,e[n][r],cc.v3(n,r)),t.nonPlayerManager.addNonPlayerFromMap(t,e[n][r],cc.v3(n,r))}for(var s=0,c=[cc.v3(-1,-1,4),cc.v3(-1,0,2),cc.v3(-1,1,6),cc.v3(0,-1,0),cc.v3(0,1,1),cc.v3(1,-1,5),cc.v3(1,0,3),cc.v3(1,1,7)];s<c.length;s++){var u=c[s];t.addBuildingsFromSideMap(u)}l.default.mapManager.isCurrentRoomStateClear()&&!l.default.mapManager.getCurrentRoom().isReborn||!f.default.isMonsterGenerateRoom(l.default.mapManager.getCurrentRoomType())||l.default.isTour||t.monsterManager.addRandomMonsters(t,l.default.mapManager.getCurrentRoom().reborn);var h=(new Array).concat(l.default.nonPlayerList);t.scheduleOnce(function(){t.nonPlayerManager.addNonPlayerListFromSave(t,h,t.player.node.position)},1),t.setDoors(!0,!0),cc.log("load finished"),t.scheduleOnce(function(){t.isInitFinish=!0,cc.tween(t.fog).to(3,{scale:5}).start();var e=t.fog.getChildByName("sprite").getChildByName("blackcenter");cc.tween(e).delay(.1).to(.5,{opacity:0}).start(),t.logNodeCount(),t.addOilGoldOnGround()},.3)})})}),this.player=cc.instantiate(this.playerPrefab).getComponent(r.default),this.player.statusIconList=this.statusIconList,this.player.node.parent=this.node,this.cameraTargetNode=this.player.node,this.fog.setPosition(this.player.node.position.clone())},e.prototype.addTiles=function(t,e,o,a){if(i.isFirstEqual(t,"*")&&"**"!=t){var n=cc.instantiate(this.tile);n.parent=this.node,n.position=i.getPosInMap(e.clone()),n.zIndex=g.default.BASE+10*(i.HEIGHT_SIZE-e.y);var r=n.getComponent(s.default);r.isAutoShow=!1,r.tileType=t,r.coverPrefix=o.floorCoverRes,r.cover1=o.floorCoverRes1,r.cover2=o.floorCoverRes2,r.cover3=o.floorCoverRes3,r.cover4=o.floorCoverRes4,r.cover5=o.floorCoverRes5,r.floorPrefix=o.floorRes,a||(this.tilesmap[e.x][e.y]=r)}if(!a&&i.isFirstEqual(t,"*")){var l=parseInt(t[1]);(isNaN(l)||l<5)&&this.floorIndexMap.push(e.clone())}},e.prototype.logNodeCount=function(){if(this.node){for(var t={},e="childrenCount:"+this.node.childrenCount+" children:\n",i=0,o=this.node.children;i<o.length;i++){var a=o[i];t[a.name]?t[a.name]++:t[a.name]=1}for(var n in t)e+=n+"("+t[n]+")\n";console.log(e)}},e.prototype.addBuildingsFromSideMap=function(t){var e=l.default.mapManager.getCurrentSideMapStringArray(t),o=l.default.worldLoader.getCurrentLevelData();if(e[0])for(var a=0;a<i.WIDTH_SIZE;a++)for(var n=0;n<i.HEIGHT_SIZE;n++){var r=!1;switch(t.z){case 0:r=n>i.HEIGHT_SIZE-4;break;case 1:r=n<4;break;case 2:r=a>i.WIDTH_SIZE-4;break;case 3:r=a<4;break;case 4:r=a>i.WIDTH_SIZE-4&&n>i.HEIGHT_SIZE-4;break;case 5:r=a<4&&n>i.HEIGHT_SIZE-4;break;case 6:r=a>i.WIDTH_SIZE-4&&n<4;break;case 7:r=a<4&&n<4}if(r){var s=cc.v3(a+i.WIDTH_SIZE*t.x,n+i.HEIGHT_SIZE*t.y);this.addTiles(e[a][n],s.clone(),o,!0),this.buildingManager.addBuildingsFromSideMap(e[a][n],e,s.clone(),o)}}},e.prototype.darkAfterKill=function(){cc.tween(this.fog).to(1,{scale:.6}).start();var t=this.fog.getChildByName("sprite").getChildByName("blackcenter");cc.tween(t).delay(.2).to(1,{opacity:255}).start()},e.isFirstEqual=function(t,e){return t[0]==e},e.prototype.addItem=function(t,e,i,o){this.itemManager&&(t||(t=this.player.node.position.clone()),this.itemManager.addItem(t,e,i,o))},e.prototype.addFallStone=function(t,e,o){this.buildingManager.addFallStone(i.getIndexInMap(t),e,o)},e.prototype.addLighteningFall=function(t,e,o,a,n){this.buildingManager&&this.buildingManager.addLighteningFall(i.getIndexInMap(t),e,o,a,n)},e.prototype.addCoin=function(t,e){this.itemManager&&this.itemManager.getValueCoin(e,t,this.node)},e.prototype.addOilGold=function(t,e){this.itemManager&&this.itemManager.getValueOilGold(e,t,this.node)},e.prototype.addEquipmentListOnGround=function(){var t=l.default.mapManager.getCurrentMapEquipments();if(t)for(var e=0,o=t;e<o.length;e++){var a=o[e];a.test>0&&(l.default.chapterIndex==l.default.CHAPTER099||l.default.chapterIndex==l.default.CHAPTER00&&0==l.default.level)||this.equipmentManager&&this.equipmentManager.getEquipment(a.img,i.getPosInMap(a.pos),this.node,a,null,null).data}},e.prototype.addItemListOnGround=function(){var t=l.default.mapManager.getCurrentMapItems();if(l.default.mapManager.setCurrentItemsArr(new Array),t)for(var e=0,o=t;e<o.length;e++){var a=o[e];a.isTaken||this.addItem(i.getPosInMap(a.pos),a.resName,a.count)}},e.prototype.addOilGoldOnGround=function(){this.scheduleOnce(function(){var t=l.default.groundOilGoldData.clone();t.chapter==l.default.chapterIndex&&t.level==l.default.level&&t.x==l.default.mapManager.rectDungeon.currentPos.x&&t.y==l.default.mapManager.rectDungeon.currentPos.y&&t.value>0&&(c.EventHelper.emit(c.EventHelper.HUD_ADD_OILGOLD,{count:t.value}),l.default.saveGroundOilGold(0),cc.director.emit(c.EventHelper.HUD_OILGOLD_RECOVERY_SHOW))},1)},e.prototype.addEquipment=function(t,e,i,o,a){if(this.equipmentManager){e||(e=this.player.node.position.clone());var n=this.equipmentManager.getEquipment(t,e,this.node,i,o,a).data;if(a)return;var r=l.default.mapManager.getCurrentMapEquipments();r?r.push(n):((r=new Array).push(n),l.default.mapManager.setCurrentEquipmentsArr(r))}},e.prototype.addBossSlime=function(t,e){this.monsterManager&&this.monsterManager.addBossSlime(t,e,this)},e.prototype.shakeForKraken=function(){var t=this;this.CameraZoom=i.DEFAULT_ZOOM_MIN,this.needZoomIn=!0,this.anim.playAdditive("DungeonShakeOnce"),this.scheduleOnce(function(){t.anim.playAdditive("DungeonShakeOnce")},1),this.scheduleOnce(function(){t.anim.playAdditive("DungeonShakeOnce")},2)},e.getPosInMap=function(t){var e=i.MAPX+t.x*i.TILE_SIZE,o=i.MAPY+t.y*i.TILE_SIZE;return cc.v3(e,o)},e.getIndexInMap=function(t,e){var o=(t.x-i.MAPX)/i.TILE_SIZE,a=(t.y-i.MAPY)/i.TILE_SIZE;return o=Math.round(o),a=Math.round(a),e||(o<0&&(o=0),o>=i.WIDTH_SIZE&&(o=i.WIDTH_SIZE-1),a<0&&(a=0),a>=i.HEIGHT_SIZE&&(a=i.HEIGHT_SIZE-1)),cc.v3(o,a)},e.fixOuterMap=function(t){var e=(t.x-i.MAPX)/i.TILE_SIZE,o=(t.y-i.MAPY)/i.TILE_SIZE;e=Math.round(e),o=Math.round(o);var a=!1;return e<0&&(e=0,a=!0),e>=i.WIDTH_SIZE&&(e=i.WIDTH_SIZE-1,a=!0),o<0&&(o=0,a=!0),o>=i.HEIGHT_SIZE&&(o=i.HEIGHT_SIZE-1,a=!0),a?i.getPosInMap(cc.v3(e,o)):t},e.prototype.start=function(){var t=this;this.scheduleOnce(function(){cc.director.emit(c.EventHelper.CHANGE_MINIMAP,{detail:{x:t.currentPos.x,y:t.currentPos.y}}),t.isInitFinish&&!l.default.isGamePause&&!t.isDisappeared&&O.default.allResourceDone()&&t.checkRoomClear()},.1)},e.prototype.breakTile=function(t){var e=this.tilesmap[t.x][t.y];e&&!e.isBroken&&e.breakTile()},e.prototype.playerAction=function(t,e,i){this.player&&this.player.playerAction(t,e,i,this)},e.prototype.getMonsterAliveNum=function(){for(var t=0,e=0,i=this.monsterManager.monsterList;e<i.length;e++){var o=i[e];(!o||!o.node||o.sc.isDied||o.data.isTest>0)&&t++}return this.monsterManager.monsterList.length-t},e.prototype.checkRoomClear=function(){var t=this.getMonsterAliveNum();if(this.isClear=t<=0,this.isClear&&this.monsterManager.bossList.length>0){for(var e=0,i=this.monsterManager.bossList;e<i.length;e++)i[e].sc.isDied&&t++;this.isClear=t>=this.monsterManager.bossList.length}for(var o=0,a=this.buildingManager.monsterGeneratorList;o<a.length;o++){var n=a[o];n.addFinish||(this.isClear&&n.open(),this.isClear=!1)}for(var r=0,s=this.buildingManager.footboards;r<s.length;r++){var u=s[r];u.isOpen||u.hasActive||(this.isClear=!1)}l.default.mapManager.getCurrentRoomType().isEqual(f.default.TEST_ROOM)&&(this.isClear=!0),this.setDoors(this.isClear),this.isClear&&(this.monsterManager.isRoomInitWithEnemy&&l.default.mapManager.getCurrentRoomType().isNotEqual(f.default.TEST_ROOM)&&(c.EventHelper.emit(c.EventHelper.HUD_COMPLETE_SHOW,{map:this.buildingManager.getReachDir()}),!this.isComplete&&this.player&&this.player.data&&this.player.data.StatusTotalData.clearHealth>0&&(this.isComplete=!0,this.player.takeDamage(new T.default(-this.player.data.StatusTotalData.clearHealth)))),this.buildingManager.savePointS&&this.buildingManager.savePointS.open(),l.default.mapManager.setRoomClear(this.currentPos.x,this.currentPos.y))},e.prototype.setDoors=function(t,e){this.buildingManager&&this.buildingManager.setDoors(t,e)},e.prototype.checkPlayerPos=function(t){if(this.tilesmap&&this.player&&this.node){this.fog.setPosition(this.lerp(this.fog.position,this.player.node.position,3*t));var e=i.getIndexInMap(this.player.node.position);if(c.EventHelper.emit(c.EventHelper.CHANGE_MINIMAP,{x:e.x,y:e.y}),this.tilesmap[e.x]&&this.tilesmap[e.x][e.y]){var o=this.tilesmap[e.x][e.y];o&&o.isBroken&&this.player.fall(),o&&o.isAutoShow&&this.breakTile(e)}}},e.prototype.lerp=function(t,e,i){var o=cc.v3(0,0),a=t.x,n=t.y;return o.x=a+(e.x-a)*i,o.y=n+(e.y-n)*i,o},e.prototype.checkMonstersPos=function(){for(var t=0,e=this.monsterManager.monsterList;t<e.length;t++){var i=e[t];if(i&&i.node&&i.node.active&&i.sc.isDied)return}},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.isInitFinish&&!l.default.isGamePause&&!this.isDisappeared&&O.default.allResourceDone()&&(this.isTimeDelay(t)&&(this.checkPlayerPos(t),this.monsterManager.updateLogic(t),this.nonPlayerManager.updateLogic(t),this.buildingManager.updateLogic(t,this.player),this.equipmentManager.updateLogic(t,this.player),this.itemManager.updateLogic(t,this.player)),this.isCheckTimeDelay(t)&&this.checkRoomClear(),this.rootSystem.execute(t))},e.WIDTH_SIZE=7,e.HEIGHT_SIZE=7,e.MAPX=64,e.MAPY=64,e.TILE_SIZE=128,e.DEFAULT_ZOOM_MAX=2,e.DEFAULT_ZOOM_MIN=.6,e.DEFAULT_ZOOM=.9,n([L(cc.Prefab)],e.prototype,"tile",void 0),n([L(cc.Prefab)],e.prototype,"playerPrefab",void 0),n([L(cc.Node)],e.prototype,"fog",void 0),n([L(A.default)],e.prototype,"statusIconList",void 0),n([L(cc.Camera)],e.prototype,"mainCamera",void 0),i=n([R],e)}(cc.Component);i.default=b,cc._RF.pop()},{"../data/DamageData":"DamageData","../ecs/system/GameWorldSystem":"GameWorldSystem","../manager/BuildingManager":"BuildingManager","../manager/DungeonStyleManager":"DungeonStyleManager","../manager/EquipmentManager":"EquipmentManager","../manager/ItemManager":"ItemManager","../manager/LightManager":"LightManager","../manager/LoadingManager":"LoadingManager","../manager/MonsterManager":"MonsterManager","../manager/NonPlayerManager":"NonPlayerManager","../rect/RoomType":"RoomType","../ui/StatusIconList":"StatusIconList","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/Random":"Random","../utils/Utils":"Utils","./EventHelper":"EventHelper","./Logic":"Logic","./Player":"Player","./Tile":"Tile"}],ECS:[function(t,e,i){"use strict";cc._RF.push(e,"01c10Dxz45KbYQrKeyNy/kg","ECS");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var o=Array(t),a=0;for(e=0;e<i;e++)for(var n=arguments[e],r=0,s=n.length;r<s;r++,a++)o[a]=n[r];return o};Object.defineProperty(i,"__esModule",{value:!0}),i.ecs=void 0,function(t){var e=function(){function t(){}return t.tid=-1,t.matcher=null,t}();t.IComponent=e;var i=new Map,o=0,r=[],s=new Map,l=new Map;t.register=function(t){return function(e){if(-1!==e.tid)throw new Error("\u91cd\u590d\u6ce8\u518c\u7ec4\u4ef6\uff1a "+t+".");if(e.tid=o++,e.compName=t,r.push(e),i.set(e.tid,[]),s.set(e.tid,[]),e.matcher){var a=e.matcher,n=a.clone();a.excludeOf(e),n.allOf(e),d.set(a.mid,e),p.set(n.mid,e),v(a),v(n)}}},t.registerTag=function(){return function(t){var e=o;for(var a in t)e=o++,t[a]=e,r.push(e),i.set(e,[]),s.set(e,[]),l.set(e,a)}};var c=[],u=new Map,h=new Map,d=new Map,p=new Map,f=1;function g(){var t=c.pop();return t||((t=new D).eid=f++),u.set(t.eid,t),t}function y(t){return i.get(t.tid).pop()||new r[t.tid]}function m(t){return g().add(t)}function v(t){var e=h.get(t.mid);if(!e){e=new S(t),h.set(t.mid,e);for(var i=t.indices,o=0,a=i.length;o<a;o++)s.get(i[o]).push(e.onComponentAddOrRemove.bind(e))}return e}function E(t,e){for(var i=s.get(e),o=i.length-1;o>=0;o--)i[o](t);_.has(e)&&_.delete(e)}t.createEntity=g,t.createEntityWithComp=m,t.createEntityWithComps=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=g(),o=0,a=t;o<a.length;o++){var n=a[o];"number"==typeof n?i.addTag(n):i.add(n)}return i},t.createGroup=v,t.query=function(t){var e=h.get(t.mid);return e||(e=v(t),u.forEach(e.onComponentAddOrRemove,e)),e.matchEntities},t.clear=function(){u.forEach(function(t){t.destroy()}),h.forEach(function(t){t.clear()}),s.forEach(function(t){t.length=0}),u.clear(),h.clear()},t.getEntityByEid=function(t){return u.get(t)},t.activeEntityCount=function(){return u.size},t.allOf=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return(t=new b).allOf.apply(t,e)},t.anyOf=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return(t=new b).anyOf.apply(t,e)},t.onlyOf=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return(t=new b).onlyOf.apply(t,e)},t.excludeOf=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return(t=new b).excludeOf.apply(t,e)};var _=new Map;t.getSingleton=function(t){if(!_.has(t.tid)){var e=m(t);_.set(t.tid,e)}return _.get(t.tid)};var T=function(){function t(){this.size=0;var t=Math.ceil(o/31);this.mask=new Uint32Array(t),this.size=t}return t.prototype.set=function(t){this.mask[t/31>>>0]|=1<<t%31},t.prototype.delete=function(t){this.mask[t/31>>>0]&=~(1<<t%31)},t.prototype.has=function(t){return!!(this.mask[t/31>>>0]&1<<t%31)},t.prototype.or=function(t){for(var e=0;e<this.size;e++)if(this.mask[e]&t.mask[e])return!0;return!1},t.prototype.and=function(t){for(var e=0;e<this.size;e++)if((this.mask[e]&t.mask[e])!=this.mask[e])return!1;return!0},t.prototype.clear=function(){for(var t=0;t<this.size;t++)this.mask[t]=0},t}(),D=function(){function t(){this.eid=-1,this.mask=new T,this.compTid2Ctor=new Map}return t.prototype.add=function(t,e){void 0===e&&(e=!1);var i=t.tid;if(-1===t.tid)throw Error("\u7ec4\u4ef6\u672a\u6ce8\u518c\uff01");if(this.compTid2Ctor.has(i)){if(!e)return console.log("\u5df2\u7ecf\u5b58\u5728\u7ec4\u4ef6\uff1a"+t.compName),this[t.compName];this.remove(t)}this.mask.set(i);var o=y(t);return this[t.compName]=o,this.compTid2Ctor.set(i,t),E(this,i),o.ent=this,o},t.prototype.addComponents=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,o=t;i<o.length;i++){var a=o[i];"number"==typeof a?this.addTag(a):this.add(a)}},t.prototype.get=function(t){return this[t.compName]},t.prototype.has=function(t){return this.compTid2Ctor.has(t.tid)},t.prototype.remove=function(t){var e=t.tid;this.mask.has(e)&&(this[t.compName].reset(),this[t.compName].ent=null,i.get(e).push(this[t.compName]),this[t.compName]=null,this.mask.delete(e),E(this,e),this.compTid2Ctor.delete(e))},t.prototype.addTag=function(t){if(!l.has(t))throw Error("\u4e0d\u5b58\u5728\u7684tag\uff01");return this.mask.set(t),this.compTid2Ctor.set(t,t),this[l.get(t)]=t,E(this,t),this},t.prototype.hasTag=function(t){return this.mask.has(t)},t.prototype.removeTag=function(t){this.mask.has(t)&&(this.mask.delete(t),this.compTid2Ctor.delete(t),this[l.get(t)]=null,E(this,t))},t.prototype._remove=function(t){"number"==typeof t?this.removeTag(t):this.remove(t)},t.prototype.destroy=function(){this.compTid2Ctor.forEach(this._remove,this),u.has(this.eid)?(c.push(this),u.delete(this.eid)):console.warn("\u8bd5\u56fe\u9500\u6bc1\u4e0d\u5b58\u5728\u7684\u5b9e\u4f53\uff01")},t}();t.Entity=D;var S=function(){function t(t){this._matchEntities=new Map,this._entitiesCache=null,this.count=0,this._enteredEntities=null,this._removedEntities=null,this.matcher=t}return Object.defineProperty(t.prototype,"matchEntities",{get:function(){return null===this._entitiesCache&&(this._entitiesCache=Array.from(this._matchEntities.values())),this._entitiesCache},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"entity",{get:function(){return this.matchEntities[0]},enumerable:!1,configurable:!0}),t.prototype.onComponentAddOrRemove=function(t){this.matcher.isMatch(t)?(this._matchEntities.set(t.eid,t),this._entitiesCache=null,this.count++,this._enteredEntities&&(this._enteredEntities.set(t.eid,t),this._removedEntities.delete(t.eid)),d.has(this.matcher.mid)&&t.add(d.get(this.matcher.mid))):this._matchEntities.has(t.eid)&&(this._matchEntities.delete(t.eid),this._entitiesCache=null,this.count--,this._enteredEntities&&(this._enteredEntities.delete(t.eid),this._removedEntities.set(t.eid,t)),p.has(this.matcher.mid)&&t.remove(p.get(this.matcher.mid)))},t.prototype.watchEntityEnterAndRemove=function(t,e){this._enteredEntities=t,this._removedEntities=e},t.prototype.clear=function(){var t,e;this._matchEntities.clear(),this._entitiesCache=null,this.count=0,null===(t=this._enteredEntities)||void 0===t||t.clear(),null===(e=this._removedEntities)||void 0===e||e.clear()},t}();t.Group=S;var O=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mask=new T,this.indices=[];for(var i=-1,o=t.length,a=0;a<o;a++){if(-1==(i="number"==typeof t[a]?t[a]:t[a].tid))throw Error("\u5b58\u5728\u6ca1\u6709\u6ce8\u518c\u7684\u7ec4\u4ef6\uff01");this.mask.set(i),this.indices.indexOf(i)<0&&this.indices.push(i)}o>1&&this.indices.sort(function(t,e){return t-e})}return t.prototype.toString=function(){return this.indices.join("-")},t}(),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.isMatch=function(t){return this.mask.or(t.mask)},e.prototype.getKey=function(){return"anyOf:"+this.toString()},e}(O),C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.isMatch=function(t){return this.mask.and(t.mask)},e.prototype.getKey=function(){return"allOf:"+this.toString()},e}(O),R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getKey=function(){return"excludeOf:"+this.toString()},e.prototype.isMatch=function(t){return!this.mask.or(t.mask)},e}(O),L=1,b=function(){function t(){this.rules=[],this._indices=null,this.mid=-1,this._key=null,this.mid=L++}return Object.defineProperty(t.prototype,"key",{get:function(){if(!this._key){for(var t="",e=0;e<this.rules.length;e++)t+=this.rules[e].getKey(),e<this.rules.length-1&&(t+=" && ");this._key=t}return this._key},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indices",{get:function(){var t=this;return null===this._indices&&(this._indices=[],this.rules.forEach(function(e){Array.prototype.push.apply(t._indices,e.indices)}),this.bindMatchMethod()),this._indices},enumerable:!1,configurable:!0}),t.prototype.anyOf=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.rules.push(new(A.bind.apply(A,n([void 0],t)))),this},t.prototype.allOf=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.rules.push(new(C.bind.apply(C,n([void 0],t)))),this},t.prototype.onlyOf=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.rules.push(new(C.bind.apply(C,n([void 0],t))));for(var i=[],o=0,a=r;o<a.length;o++){var s=a[o];t.indexOf(s)<0&&i.push(s)}return this.rules.push(new(R.bind.apply(R,n([void 0],i)))),this},t.prototype.excludeOf=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.rules.push(new(R.bind.apply(R,n([void 0],t)))),this},t.prototype.bindMatchMethod=function(){1===this.rules.length?this.isMatch=this.isMatch1:2===this.rules.length?this.isMatch=this.isMatch2:this.isMatch=this.isMatchMore},t.prototype.isMatch1=function(t){return this.rules[0].isMatch(t)},t.prototype.isMatch2=function(t){return this.rules[0].isMatch(t)&&this.rules[1].isMatch(t)},t.prototype.isMatchMore=function(t){for(var e=0,i=this.rules;e<i.length;e++)if(!i[e].isMatch(t))return!1;return!0},t.prototype.clone=function(){var e=new t;return e.mid=L++,this.rules.forEach(function(t){return e.rules.push(t)}),e},t}(),P=function(){function t(){this.dt=0,this.enteredEntities=null,this.removedEntities=null,this.hasEntityEnter=!1,this.hasEntityRemove=!1,this.tmpExecute=null;var t=Object.hasOwnProperty,e=Object.getPrototypeOf(this),i=t.call(e,"entityEnter"),o=t.call(e,"entityRemove"),a=t.call(e,"firstUpdate");this.hasEntityEnter=i,this.hasEntityRemove=o,i||o?(this.enteredEntities=new Map,this.removedEntities=new Map,this.execute=this.execute1,this.group=v(this.filter()),this.group.watchEntityEnterAndRemove(this.enteredEntities,this.removedEntities)):(this.execute=this.execute0,this.group=v(this.filter())),a&&(this.tmpExecute=this.execute,this.execute=this.updateOnce)}return t.prototype.init=function(){},t.prototype.onDestroy=function(){},t.prototype.hasEntity=function(){return this.group.count>0},t.prototype.updateOnce=function(t){0!==this.group.count&&(this.dt=t,this.enteredEntities.size>0&&(this.entityEnter(Array.from(this.enteredEntities.values())),this.enteredEntities.clear()),this.firstUpdate(this.group.matchEntities),this.execute=this.tmpExecute,this.execute(t),this.tmpExecute=null)},t.prototype.execute0=function(t){0!==this.group.count&&(this.dt=t,this.update(this.group.matchEntities))},t.prototype.execute1=function(t){this.removedEntities.size>0&&(this.hasEntityRemove&&this.entityRemove(Array.from(this.removedEntities.values())),this.removedEntities.clear()),0!==this.group.count&&(this.dt=t,this.enteredEntities.size>0&&(this.hasEntityEnter&&this.entityEnter(Array.from(this.enteredEntities.values())),this.enteredEntities.clear()),this.update(this.group.matchEntities))},t}();t.ComblockSystem=P;var I=function(){function t(){this.executeSystemFlows=[],this.systemCnt=0}return t.prototype.add=function(t){return t instanceof M?Array.prototype.push.apply(this.executeSystemFlows,t.comblockSystems):this.executeSystemFlows.push(t),this.systemCnt=this.executeSystemFlows.length,this},t.prototype.init=function(){this.executeSystemFlows.forEach(function(t){return t.init()})},t.prototype.execute=function(t){for(var e=0;e<this.systemCnt;e++)this.executeSystemFlows[e].execute(t)},t.prototype.clear=function(){this.executeSystemFlows.forEach(function(t){return t.onDestroy()})},t}();t.RootSystem=I;var M=function(){function t(){this._comblockSystems=[]}return Object.defineProperty(t.prototype,"comblockSystems",{get:function(){return this._comblockSystems},enumerable:!1,configurable:!0}),t.prototype.add=function(e){return e instanceof t?(Array.prototype.push.apply(this._comblockSystems,e._comblockSystems),e._comblockSystems.length=0):this._comblockSystems.push(e),this},t}();t.System=M}(i.ecs||(i.ecs={})),cc._RF.pop()},{}],Emplacement:[function(t,e,i){"use strict";cc._RF.push(e,"78b9bpQ7+BAGrpzYzxR/1mq","Emplacement");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Shooter"),l=t("../logic/Logic"),c=t("./Building"),u=t("../data/FromData"),h=t("../utils/IndexZ"),d=cc._decorator,p=d.ccclass,f=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shooterTop=null,e.shooterBottom=null,e.shooterLeft=null,e.shooterRight=null,e.isOpen=!1,e.pos=cc.v3(0,0),e.timeDelay=0,e.dirType=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.setShooterHv(this.shooterTop,cc.v2(0,1)),this.setShooterHv(this.shooterBottom,cc.v2(0,-1)),this.setShooterHv(this.shooterLeft,cc.v2(-1,0)),this.setShooterHv(this.shooterRight,cc.v2(1,0));var t=u.default.getClone("\u70ae\u53f0","emplacement");this.shooterTop.from.valueCopy(t),this.shooterBottom.from.valueCopy(t),this.shooterLeft.from.valueCopy(t),this.shooterRight.from.valueCopy(t)},e.prototype.setDirType=function(t){switch(t){case"G0":this.dirType=i.ALL,this.hideOrShowShooter(1,1,1,1);break;case"G1":this.dirType=i.TOP,this.hideOrShowShooter(1,0,0,0);break;case"G2":this.dirType=i.BOTTOM,this.hideOrShowShooter(0,1,0,0);break;case"G3":this.dirType=i.LEFT,this.hideOrShowShooter(0,0,1,0);break;case"G4":this.dirType=i.RIGHT,this.hideOrShowShooter(0,0,0,1);break;case"G5":this.dirType=i.TOPBOTTOM,this.hideOrShowShooter(1,1,0,0);break;case"G6":this.dirType=i.TOPLEFT,this.hideOrShowShooter(1,0,1,0);break;case"G7":this.dirType=i.TOPRIGHT,this.hideOrShowShooter(1,0,0,1);break;case"G8":this.dirType=i.BOTTOMLEFT,this.hideOrShowShooter(0,1,1,0);break;case"G9":this.dirType=i.BOTTOMRIGHT,this.hideOrShowShooter(0,1,0,1);break;case"Ga":this.dirType=i.LEFTRIGHT,this.hideOrShowShooter(0,0,1,1)}},e.prototype.hideOrShowShooter=function(t,e,i,o){this.shooterTop.node.active=t>0,this.shooterBottom.node.active=e>0,this.shooterLeft.node.active=i>0,this.shooterRight.node.active=o>0},e.prototype.start=function(){var t=this;this.anim=this.getComponent(cc.Animation),this.scheduleOnce(function(){t.fire()},1)},e.prototype.setPos=function(t){this.pos=t,this.entity.Transform.position=r.default.getPosInMap(t),this.node.position=this.entity.Transform.position.clone(),this.node.zIndex=h.default.getActorZIndex(this.entity.Transform.position)},e.prototype.OpenFire=function(){if(this.dungeon)switch(this.dirType){case i.ALL:this.fireShooter(this.shooterTop),this.fireShooter(this.shooterBottom),this.fireShooter(this.shooterLeft),this.fireShooter(this.shooterRight);break;case i.TOP:this.fireShooter(this.shooterTop);break;case i.BOTTOM:this.fireShooter(this.shooterBottom);break;case i.LEFT:this.fireShooter(this.shooterLeft);break;case i.RIGHT:this.fireShooter(this.shooterRight);break;case i.TOPBOTTOM:this.fireShooter(this.shooterTop),this.fireShooter(this.shooterBottom);break;case i.TOPLEFT:this.fireShooter(this.shooterTop),this.fireShooter(this.shooterLeft);break;case i.TOPRIGHT:this.fireShooter(this.shooterTop),this.fireShooter(this.shooterRight);break;case i.BOTTOMLEFT:this.fireShooter(this.shooterBottom),this.fireShooter(this.shooterLeft);break;case i.BOTTOMRIGHT:this.fireShooter(this.shooterBottom),this.fireShooter(this.shooterRight);break;case i.LEFTRIGHT:this.fireShooter(this.shooterLeft),this.fireShooter(this.shooterRight);break;default:this.fireShooter(this.shooterTop),this.fireShooter(this.shooterBottom),this.fireShooter(this.shooterLeft),this.fireShooter(this.shooterRight)}},e.prototype.fire=function(){this.anim&&this.anim.play()},e.prototype.fireShooter=function(t){if(!t.dungeon)switch(t.dungeon=this.dungeon,t.data.bulletType="bullet010",t.data.bulletLineExNum=0,t.data.bulletLineInterval=.5,t.data.img="emplacement",t.isBuilding=!0,l.default.chapterIndex){case l.default.CHAPTER00:t.data.bulletLineExNum=0,t.data.bulletType="laser001";break;case l.default.CHAPTER01:t.data.bulletType="bullet010";break;case l.default.CHAPTER02:t.data.bulletType="bullet013";break;case l.default.CHAPTER03:t.data.bulletType="bullet006",t.data.bulletLineExNum=1;break;case l.default.CHAPTER04:case l.default.CHAPTER05:t.data.bulletType="bullet024",t.data.bulletLineExNum=1;break;case l.default.CHAPTER099:t.data.bulletType="bullet010"}t.fireBullet(0,cc.v3(64,0))},e.prototype.setShooterHv=function(t,e){t.setHv(e)},e.prototype.update=function(t){l.default.isGamePause||(this.timeDelay+=t,this.timeDelay>3&&(this.timeDelay=0,this.fire()))},e.ALL=0,e.TOP=1,e.BOTTOM=2,e.LEFT=3,e.RIGHT=4,e.TOPBOTTOM=5,e.TOPLEFT=6,e.TOPRIGHT=7,e.BOTTOMLEFT=8,e.BOTTOMRIGHT=9,e.LEFTRIGHT=10,n([f(s.default)],e.prototype,"shooterTop",void 0),n([f(s.default)],e.prototype,"shooterBottom",void 0),n([f(s.default)],e.prototype,"shooterLeft",void 0),n([f(s.default)],e.prototype,"shooterRight",void 0),i=n([p],e)}(c.default);i.default=g,cc._RF.pop()},{"../data/FromData":"FromData","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../utils/IndexZ":"IndexZ","./Building":"Building"}],EnergyShield:[function(t,e,i){"use strict";cc._RF.push(e,"b7ba1woN/lIqoplh/wf+2rX","EnergyShield");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../collider/CCollider"),s=t("../utils/AudioPlayer"),l=t("../utils/IndexZ"),c=t("./Building"),u=cc._decorator,h=u.ccclass,d=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShow=!1,e.timeDelay=0,e.recoveryTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){this.cover=this.node.getChildByName("sprite").getChildByName("cover"),this.element=this.node.getChildByName("sprite").getChildByName("cover").getChildByName("element"),this.anim=this.getComponent(cc.Animation),this.collider=this.getComponent(r.default)},e.prototype.init=function(t,e,i){this.player=t,this.data.currentHealth=e,this.data.maxHealth=e,this.node.scale=i,this.anim=this.getComponent(cc.Animation),this.node.zIndex=l.default.getActorZIndex(cc.v3(this.entity.Transform.position.x,this.entity.Transform.position.y-8*i)),this.base=this.node.getChildByName("base"),this.base.parent=this.node.parent,this.base.position=this.entity.Transform.position,cc.tween(this.base).to(1,{scale:i,opacity:255}).start(),this.base.zIndex=l.default.FLOOR},e.prototype.hitLight=function(t){this.mat||(this.mat=this.node.getChildByName("sprite").getChildByName("cover").getComponent(cc.Sprite).getMaterial(0)),this.mat.setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT)},e.prototype.ShowFinish=function(){this.isShow=!0,this.changeIdle()},e.prototype.changeIdle=function(){this.isShow&&(this.checkTargetIn(this.player.node)?this.anim.getAnimationState("EnergyShieldIdle").isPlaying||this.anim.play("EnergyShieldIdle"):this.anim.getAnimationState("EnergyShieldIdle1").isPlaying||this.anim.play("EnergyShieldIdle1"))},e.prototype.checkTargetIn=function(t){var e=this.entity.Transform.position.x-this.collider.w/2*this.node.scale,i=this.entity.Transform.position.y-(this.collider.h/2-this.collider.offset.y)*this.node.scale,o=this.collider.w*this.node.scale,a=this.collider.h*this.node.scale;return cc.rect(e,i,o,a).contains(cc.v2(t.position.x,t.position.y))},e.prototype.takeDamage=function(t){var e=this;return!(!this.isShow||this.data.currentHealth<=0||(s.default.play(s.default.BOSS_ICEDEMON_HIT),this.hitLight(!0),this.scheduleOnce(function(){e.hitLight(!1)},.15),this.data.currentHealth-=t.getTotalDamage(),this.changeColor(),this.data.currentHealth<=0&&(this.data.currentHealth=0,this.isShow=!1,this.node.active=!1,this.base.active=!1,this.scheduleOnce(function(){e.destroyEntityNode(),e.base.destroy()},1)),0))},e.prototype.changeColor=function(){var t=Math.floor(255*this.data.currentHealth/this.data.maxHealth);t<0?t=0:t>255&&(t=255),this.cover.color=cc.color(255,t,t),this.element.color=cc.color(255,t,t),this.base.color=cc.color(255,t,t)},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.isRecoveryTimeDelay=function(t){return this.recoveryTimeDelay+=t,this.recoveryTimeDelay>2&&(this.recoveryTimeDelay=0,!0)},e.prototype.update=function(t){this.isTimeDelay(t)&&this.changeIdle(),this.isRecoveryTimeDelay(t)&&this.checkTargetIn(this.player.node)&&this.player.updateDream(-1)},n([h],e)}(c.default));i.default=d,cc._RF.pop()},{"../collider/CCollider":"CCollider","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","./Building":"Building"}],EquipmentAndItemDialog:[function(t,e,i){"use strict";cc._RF.push(e,"af5ccf4cCpAz5dS6cSfKkBs","EquipmentAndItemDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../../logic/Logic"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layout=null,e.labelTitle=null,e.requireLevel=null,e.price=null,e.infoBase=null,e.info1=null,e.info2=null,e.info3=null,e.extraInfo=null,e.infoSuit1=null,e.infoSuit2=null,e.infoSuit3=null,e.infoDesc=null,e.count=null,e.arrowNoneBg=null,e.arrowRightBg=null,e.arrowDownBg=null,e.arrowLeftBg=null,e.bgType=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){},e.prototype.changeBgAndAnchor=function(t){this.bgType=t;var e=this.layout.getComponent(cc.Sprite);switch(this.layout.anchorX=1,this.layout.anchorY=1,this.bgType){case i.BG_TYPE_NONE:e.spriteFrame=null;break;case i.BG_TYPE_ARROW_NONE:e.spriteFrame=this.arrowNoneBg;break;case i.BG_TYPE_ARROW_RIGHT:e.spriteFrame=this.arrowRightBg;break;case i.BG_TYPE_ARROW_DOWN:e.spriteFrame=this.arrowDownBg,this.layout.anchorX=0,this.layout.anchorY=0;break;case i.BG_TYPE_ARROW_LEFT:e.spriteFrame=this.arrowLeftBg,this.layout.anchorX=0,this.layout.anchorY=1}},e.prototype.refreshEquipInfo=function(t){this.layout.color=t.requireLevel>r.default.playerData.OilGoldData.level?cc.Color.RED:this.layout.color.fromHEX(t.titlecolor),this.requireLevel.node.color=t.requireLevel>r.default.playerData.OilGoldData.level?cc.Color.RED:cc.Color.WHITE,this.infoBase.node.active=!0,this.requireLevel.node.active=!0,this.info1.node.active=!0,this.info2.node.active=!0,this.info3.node.active=!0,this.extraInfo.node.active=!0,this.infoSuit1.node.active=!0,this.infoSuit2.node.active=!0,this.infoSuit3.node.active=!0,this.requireLevel.string="\u6240\u9700\u7b49\u7ea7\uff1a"+t.requireLevel,this.price.string="\u4ef7\u683c\uff1a"+t.price,this.labelTitle.string=t.prefix+t.nameCn,this.labelTitle.node.color=this.labelTitle.node.color.fromHEX(t.titlecolor),this.infoBase.string=""+t.infobase,this.infoBase.node.color=this.infoBase.node.color.fromHEX(t.infobasecolor),this.info1.string=t.info1,this.info1.node.color=this.info1.node.color.fromHEX(t.infocolor1),this.info2.string=t.info2,this.info2.node.color=this.info2.node.color.fromHEX(t.infocolor2),this.info3.string=t.info3,this.info3.node.color=this.info3.node.color.fromHEX(t.infocolor3),this.extraInfo.string=t.extraInfo,this.infoSuit1.string=t.suit1,this.infoSuit2.string=t.suit2,this.infoSuit3.string=t.suit3,this.infoSuit1.node.color=this.infoSuit1.node.color.fromHEX(t.suitcolor1),this.infoSuit2.node.color=this.infoSuit2.node.color.fromHEX(t.suitcolor2),this.infoSuit3.node.color=this.infoSuit3.node.color.fromHEX(t.suitcolor3),this.infoDesc.string=t.desc,this.infoBase.node.active=this.infoBase.string.length>0,this.info1.node.active=this.info1.string.length>0,this.info2.node.active=this.info2.string.length>0,this.info3.node.active=this.info3.string.length>0,this.extraInfo.node.active=this.extraInfo.string.length>0,this.infoSuit1.node.active=this.infoSuit1.string.length>0,this.infoSuit2.node.active=this.infoSuit2.string.length>0,this.infoSuit3.node.active=this.infoSuit3.string.length>0,this.count.string=""},e.prototype.showDialogEquipInfo=function(t,e){if(this.refreshEquipInfo(t),this.node.active=!0,e){var i=0;t.suitType.length>0&&e.suitMap[t.suitType]&&(i=e.suitMap[t.suitType].count),this.infoSuit1.node.opacity=i>1?255:50,this.infoSuit2.node.opacity=i>2?255:50,this.infoSuit3.node.opacity=i>3?255:50}},e.prototype.refreshItemInfo=function(t){this.layout.color=cc.Color.WHITE,this.infoBase.node.active=!0,this.info1.node.active=!1,this.info2.node.active=!1,this.info3.node.active=!1,this.requireLevel.node.active=!1,this.extraInfo.node.active=!1,this.infoSuit1.node.active=!1,this.infoSuit2.node.active=!1,this.infoSuit3.node.active=!1,this.labelTitle.string=""+t.nameCn;var e="\u4ef7\u683c\uff1a"+t.price+"\n"+t.info;t.solidSatiety>0&&(e+="\n\u9971\u98df\u5ea6\uff1a"+t.solidSatiety),t.liquidSatiety>0&&(e+="\n\u89e3\u6e34\u5ea6\uff1a"+t.liquidSatiety),this.infoBase.string=e,this.infoDesc.string=t.desc,this.count.string=t.count>0?"\xd7"+t.count:"\u221e",this.labelTitle.node.color=this.labelTitle.node.color.fromHEX("#F4C021")},e.prototype.showDialogItemInfo=function(t){this.node.active=!0,this.refreshItemInfo(t)},e.prototype.showDialogNonPlayerInfo=function(t){this.node.active=!0,this.refreshNonPlayerInfo(t)},e.prototype.refreshNonPlayerInfo=function(t){this.layout.color=cc.Color.WHITE,this.infoBase.node.active=!0,this.requireLevel.node.active=!1,this.info1.node.active=!1,this.info2.node.active=!1,this.info3.node.active=!1,this.extraInfo.node.active=!1,this.infoSuit1.node.active=!1,this.infoSuit2.node.active=!1,this.infoSuit3.node.active=!1,this.labelTitle.string=""+t.nameCn,this.infoBase.string="",this.infoDesc.string="",this.count.string="",this.labelTitle.node.color=this.labelTitle.node.color.fromHEX("#F4C021")},e.prototype.showDialogFurnitureInfo=function(t){this.node.active=!0,this.refreshFurnitureInfo(t)},e.prototype.refreshFurnitureInfo=function(t){this.layout.color=cc.Color.WHITE,this.infoBase.node.active=!0,this.info1.node.active=!1,this.info2.node.active=!1,this.info3.node.active=!1,this.requireLevel.node.active=!1,this.extraInfo.node.active=!1,this.infoSuit1.node.active=!1,this.infoSuit2.node.active=!1,this.infoSuit3.node.active=!1,this.labelTitle.string=""+t.nameCn,this.infoBase.string="\u4ef7\u683c\uff1a"+t.price+"\n"+t.info,this.infoDesc.string=""+t.desc,this.count.string="",this.labelTitle.node.color=this.labelTitle.node.color.fromHEX("#F4C021")},e.prototype.showDialog=function(t,e,i,o,a,n,r){(r||0==r)&&this.changeBgAndAnchor(r),this.node.position=t.clone(),e?this.showDialogNonPlayerInfo(e):i?this.showDialogItemInfo(i):o?this.showDialogEquipInfo(o,n):a&&this.showDialogFurnitureInfo(a)},e.prototype.hideDialog=function(){this.node.active=!1},e.BG_TYPE_NONE=0,e.BG_TYPE_ARROW_NONE=1,e.BG_TYPE_ARROW_RIGHT=2,e.BG_TYPE_ARROW_DOWN=3,e.BG_TYPE_ARROW_LEFT=4,n([c(cc.Node)],e.prototype,"layout",void 0),n([c(cc.Label)],e.prototype,"labelTitle",void 0),n([c(cc.Label)],e.prototype,"requireLevel",void 0),n([c(cc.Label)],e.prototype,"price",void 0),n([c(cc.Label)],e.prototype,"infoBase",void 0),n([c(cc.Label)],e.prototype,"info1",void 0),n([c(cc.Label)],e.prototype,"info2",void 0),n([c(cc.Label)],e.prototype,"info3",void 0),n([c(cc.Label)],e.prototype,"extraInfo",void 0),n([c(cc.Label)],e.prototype,"infoSuit1",void 0),n([c(cc.Label)],e.prototype,"infoSuit2",void 0),n([c(cc.Label)],e.prototype,"infoSuit3",void 0),n([c(cc.Label)],e.prototype,"infoDesc",void 0),n([c(cc.Label)],e.prototype,"count",void 0),n([c(cc.SpriteFrame)],e.prototype,"arrowNoneBg",void 0),n([c(cc.SpriteFrame)],e.prototype,"arrowRightBg",void 0),n([c(cc.SpriteFrame)],e.prototype,"arrowDownBg",void 0),n([c(cc.SpriteFrame)],e.prototype,"arrowLeftBg",void 0),i=n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../../logic/Logic":"Logic"}],EquipmentData:[function(t,e,i){"use strict";cc._RF.push(e,"a5970exQi1ISK2QZd4VAwv9","EquipmentData");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("./CommonData"),r=t("./BaseData"),s=t("./TriggerData"),l=function(t){function e(){var e=t.call(this)||this;return e.uuid="",e.id=1e7,e.pos=cc.v3(0,0),e.nameCn="",e.nameEn="",e.equipmetType="empty",e.equipmetTypeCn="",e.prefix="",e.desc="",e.color="#ffffff",e.lightcolor="#ffffff",e.titlecolor="#ffffff",e.img="emptyequipment",e.level=0,e.requireLevel=0,e.stab=0,e.far=0,e.blunt=0,e.isLocked=0,e.isReflect=0,e.trouserslong=0,e.bulletType="",e.bulletSize=0,e.bulletArcExNum=0,e.bulletArcOffsetX=0,e.bulletLineExNum=0,e.bulletLineInterval=0,e.exBulletOffsetX=0,e.bulletExSpeed=0,e.showShooter=0,e.isHeavy=0,e.isLineAim=0,e.hideHair=0,e.exTriggers=[],e.ignoreTrap=0,e.remoteAudio="",e.exBeatBack=0,e.test=0,e.canUse=0,e.lastTime=0,e.cooldown=0,e.price=0,e.info1="",e.info2="",e.info3="",e.extraInfo="",e.suitType="",e.suit1="",e.suit2="",e.suit3="",e.infobase="",e.infocolor1="#ffffff",e.infocolor2="#ffffff",e.infocolor3="#ffffff",e.suitcolor1="#ffffff",e.suitcolor2="#ffffff",e.suitcolor3="#ffffff",e.infobasecolor="#ffffff",e.common=new n.default,e}return a(e,t),Object.defineProperty(e.prototype,"Common",{get:function(){return this.common},enumerable:!1,configurable:!0}),e.prototype.valueCopy=function(t){if(t){if(this.uuid=t.uuid?t.uuid:"",this.id=t.id?t.id:1e7,this.pos=t.pos?cc.v3(t.pos.x,t.pos.y):cc.v3(0,0),this.common.valueCopy(t.common),this.nameCn=t.nameCn?t.nameCn:"",this.nameEn=t.nameEn?t.nameEn:"",this.equipmetType=t.equipmetType?t.equipmetType:"",this.equipmetTypeCn=t.equipmetTypeCn?t.equipmetTypeCn:"",this.prefix=t.prefix?t.prefix:"",this.desc=t.desc?t.desc:"",this.color=t.color?t.color:"#ffffff",this.titlecolor=t.titlecolor?t.titlecolor:"#ffffff",this.lightcolor=t.lightcolor?t.lightcolor:"#ffffff",this.img=t.img?t.img:"emptyequipment",this.stab=t.stab?t.stab:0,this.far=t.far?t.far:0,this.blunt=t.blunt?t.blunt:0,this.isLocked=t.isLocked?t.isLocked:0,this.bulletArcExNum=t.bulletArcExNum?t.bulletArcExNum:0,this.bulletLineExNum=t.bulletLineExNum?t.bulletLineExNum:0,this.bulletLineInterval=t.bulletLineInterval?t.bulletLineInterval:0,this.bulletSize=t.bulletSize?t.bulletSize:0,this.bulletExSpeed=t.bulletExSpeed?t.bulletExSpeed:0,this.bulletArcOffsetX=t.bulletArcOffsetX?t.bulletArcOffsetX:0,this.level=t.level?t.level:0,this.trouserslong=t.trouserslong?t.trouserslong:0,this.showShooter=t.showShooter?t.showShooter:0,this.isHeavy=t.isHeavy?t.isHeavy:0,this.bulletType=t.bulletType?t.bulletType:"",this.isLineAim=t.isLineAim?t.isLineAim:0,this.hideHair=t.hideHair?t.hideHair:0,this.isReflect=t.isReflect?t.isReflect:0,this.exBulletOffsetX=t.exBulletOffsetX?t.exBulletOffsetX:0,this.ignoreTrap=t.ignoreTrap?t.ignoreTrap:0,this.price=t.price?t.price:0,this.info1=t.info1?t.info1:"",this.info2=t.info2?t.info2:"",this.info3=t.info3?t.info3:"",this.extraInfo=t.extraInfo?t.extraInfo:"",this.suit1=t.suit1?t.suit1:"",this.suit2=t.suit2?t.suit2:"",this.suit3=t.suit3?t.suit3:"",this.suitType=t.suitType?t.suitType:"",this.infobase=t.infobase?t.infobase:"",this.infocolor1=t.infocolor1?t.infocolor1:"#ffffff",this.infocolor2=t.infocolor2?t.infocolor2:"#ffffff",this.infocolor3=t.infocolor3?t.infocolor3:"#ffffff",this.suitcolor1=t.suitcolor1?t.suitcolor1:"#ffffff",this.suitcolor2=t.suitcolor2?t.suitcolor2:"#ffffff",this.suitcolor3=t.suitcolor3?t.suitcolor3:"#ffffff",this.infobasecolor=t.infobasecolor?t.infobasecolor:"#ffffff",this.remoteAudio=t.remoteAudio?t.remoteAudio:"",this.exBeatBack=t.exBeatBack?t.exBeatBack:0,this.test=t.test?t.test:0,this.requireLevel=t.requireLevel?t.requireLevel:0,this.exTriggers=[],t.exTriggers)for(var e=0,i=t.exTriggers;e<i.length;e++){var o=i[e],a=new s.default;a.valueCopy(o),this.exTriggers.push(a)}this.lastTime=t.lastTime?t.lastTime:0,this.canUse=t.canUse?t.canUse:0}},e.prototype.clone=function(){var t=new e;return t.uuid=this.uuid,t.id=this.id,t.pos=this.pos,t.common=this.common.clone(),t.nameCn=this.nameCn,t.nameEn=this.nameEn,t.equipmetType=this.equipmetType,t.equipmetTypeCn=this.equipmetTypeCn,t.prefix=this.prefix,t.desc=this.desc,t.color=this.color,t.titlecolor=this.titlecolor,t.lightcolor=this.lightcolor,t.img=this.img,t.stab=this.stab,t.far=this.far,t.blunt=this.blunt,t.isLocked=this.isLocked,t.level=this.level,t.trouserslong=this.trouserslong,t.showShooter=this.showShooter,t.bulletType=this.bulletType,t.isHeavy=this.isHeavy,t.isLineAim=this.isLineAim,t.bulletArcExNum=this.bulletArcExNum,t.bulletLineExNum=this.bulletLineExNum,t.bulletLineInterval=this.bulletLineInterval,t.hideHair=this.hideHair,t.bulletSize=this.bulletSize,t.bulletExSpeed=this.bulletExSpeed,t.bulletArcOffsetX=this.bulletArcOffsetX,t.isReflect=this.isReflect,t.exBulletOffsetX=this.exBulletOffsetX,t.ignoreTrap=this.ignoreTrap,t.suitType=this.suitType,t.price=this.price,t.info1=this.info1,t.info2=this.info2,t.info3=this.info3,t.extraInfo=this.extraInfo,t.suit1=this.suit1,t.suit2=this.suit2,t.suit3=this.suit3,t.infobase=this.infobase,t.infocolor1=this.infocolor1,t.infocolor2=this.infocolor2,t.infocolor3=this.infocolor3,t.suitcolor1=this.suitcolor1,t.suitcolor2=this.suitcolor2,t.suitcolor3=this.suitcolor3,t.infobasecolor=this.infobasecolor,t.remoteAudio=this.remoteAudio,t.exBeatBack=this.exBeatBack,t.test=this.test,t.requireLevel=this.requireLevel,t.exTriggers=this.exTriggers,t.lastTime=this.lastTime,t.canUse=this.lastTime,t},e.prototype.add=function(t){this.common=this.common.clone().add(t.Common),this.ignoreTrap=this.ignoreTrap+t.ignoreTrap,this.exBeatBack=this.exBeatBack+t.exBeatBack;for(var e=0,i=t.exTriggers;e<i.length;e++){var o=i[e];this.exTriggers.push(o)}return this},e}(r.default);i.default=l,cc._RF.pop()},{"./BaseData":"BaseData","./CommonData":"CommonData","./TriggerData":"TriggerData"}],EquipmentDescData:[function(t,e,i){"use strict";cc._RF.push(e,"d7742jFusdGiIE+18obcC2k","EquipmentDescData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./CommonData");i.default=function(){this.nameCn="",this.nameEn="",this.titlecolor="#ffffff",this.color="#ffffff",this.prefix="",this.level=0,this.requireLevel=0,this.common=new o.default,this.info1="",this.info2="",this.info3="",this.suit1="",this.suit2="",this.suit3="",this.infobase="",this.infocolor1="#ffffff",this.infocolor2="#ffffff",this.infocolor3="#ffffff",this.suitcolor1="#ffffff",this.suitcolor2="#ffffff",this.suitcolor3="#ffffff",this.infobasecolor="#ffffff"},cc._RF.pop()},{"./CommonData":"CommonData"}],EquipmentManager:[function(t,e,i){"use strict";cc._RF.push(e,"29c053rRnlLqrw1VkMXkISC","EquipmentManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Logic"),l=t("../data/EquipmentData"),c=t("../data/EquipmentDescData"),u=t("../equipment/Equipment"),h=t("../utils/IndexZ"),d=t("./BaseManager"),p=t("../logic/EventHelper"),f=t("./InventoryManager"),g=t("../data/SuitData"),y=cc._decorator,m=y.ccclass,v=y.property,E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.equipment=null,e.groundList=[],e.checkTimeDelay=0,e}var i;return a(e,t),i=e,e.prototype.clear=function(){this.groundList=[]},e.getRandomDesc=function(t,e){var o=new c.default,a=0,n=s.default.mapManager.getCurrentRoomRandom4Save(),r=cc.v3(0,0);if(i.isTheEquipType(t.equipmetType,[f.default.WEAPON,f.default.HELMET,f.default.GLOVES,f.default.CLOAK,f.default.REMOTE])&&t.Common.criticalStrikeRate>0){var l=20-t.Common.criticalStrikeRate;l<5&&(l=5),a=(r=i.getRandomQuality(0,l,e,n)).y>a?r.y:a,o.prefix+=r.y>2?"\u66b4\u51fb":"",o.color=i.getMixColor("#000000",r.y>2?i.COLOR_CRITICALSTRIKE:"#000000")}var u=cc.v3(0,0);i.isTheEquipType(t.equipmetType,[f.default.WEAPON,f.default.GLOVES,f.default.CLOTHES,f.default.REMOTE])&&t.Common.damageMin>0&&(a=(u=i.getRandomQuality(0,i.getRandomRange(),e,n)).y>a?u.y:a);var h=cc.v3(0,0);i.isTheEquipType(t.equipmetType,[f.default.GLOVES,f.default.REMOTE])&&t.Common.remoteDamage>0&&(a=(h=n.rand()<.2?i.getRandomQuality(0,i.getRandomRange(),e,n):cc.v3(0,0)).y>a?h.y:a);var d=cc.v3(0,0);i.isTheEquipType(t.equipmetType,[f.default.WEAPON,f.default.GLOVES,f.default.CLOTHES,f.default.REMOTE])&&t.Common.damageMax>0&&(a=(d=i.getRandomQuality(u.x,u.x+i.getRandomRange(),e,n)).y>a?d.y:a,o.prefix+=d.y>2?"\u5f3a\u529b":"",o.color=i.getMixColor(o.color,d.y>2?i.COLOR_POWERFUL:"#000000"));var p=cc.v3(0,0);i.isTheEquipType(t.equipmetType,[f.default.HELMET,f.default.GLOVES,f.default.CLOAK,f.default.TROUSERS,f.default.SHOES,f.default.SHIELD,f.default.CLOTHES])&&t.Common.defence>0&&(a=(p=i.getRandomQuality(0,i.getRandomRange(),e,n)).y>a?p.y:a,o.prefix+=p.y>2?"\u575a\u56fa":"",o.color=i.getMixColor(o.color,p.y>5?i.COLOR_STABLE:"#000000"));var g=cc.v3(0,0);if(i.isTheEquipType(t.equipmetType,[f.default.WEAPON,f.default.HELMET,f.default.GLOVES,f.default.REMOTE])&&t.Common.lifeDrain>0){var y=50-t.Common.lifeDrain;y<5&&(y=5),a=(g=i.getRandomQuality(0,y,e,n)).y>a?g.y:a,o.prefix+=g.y>2?"\u90aa\u6076":"",o.color=i.getMixColor(o.color,g.y>2?i.COLOR_LIFEDRAIN:"#000000")}var m=cc.v3(0,0);i.isTheEquipType(t.equipmetType,[f.default.WEAPON,f.default.GLOVES,f.default.CLOTHES,f.default.REMOTE])&&t.Common.damageBack>0&&(a=(m=i.getRandomQuality(0,i.getRandomRange(),e,n)).y>a?m.y:a,o.prefix+=m.y>2?"\u9634\u51b7":"",o.color=i.getMixColor(o.color,m.y>2?i.COLOR_BACK:"#000000"));var v=cc.v3(0,0);if(i.isTheEquipType(t.equipmetType,[f.default.CLOAK,f.default.TROUSERS,f.default.SHOES,f.default.CLOTHES])&&t.Common.moveSpeed>0){var E=80-t.Common.moveSpeed;E<10&&(E=10),a=(v=i.getRandomQuality(0,E,e,n)).y>a?v.y:a,o.prefix+=v.y>2?"\u7075\u52a8":"",o.color=i.getMixColor(o.color,v.y>2?i.COLOR_MOVESPEED:"#000000")}var _=cc.v3(0,0);if(i.isTheEquipType(t.equipmetType,[f.default.WEAPON,f.default.GLOVES,f.default.CLOTHES,f.default.REMOTE])&&t.Common.attackSpeed>0){var T=30-t.Common.attackSpeed;T<5&&(T=5),a=(_=i.getRandomQuality(0,T,e,n)).y>a?_.y:a,o.prefix+=_.y>2?"\u8fc5\u6377":"",o.color=i.getMixColor(o.color,_.y>2?i.COLOR_ATTACKSPPED:"#000000")}var D=cc.v3(0,0);if(i.isTheEquipType(t.equipmetType,[f.default.HELMET,f.default.CLOAK,f.default.TROUSERS,f.default.SHOES,f.default.CLOTHES])&&t.Common.dodge>0){var S=30-t.Common.dodge;S<10&&(S=10),a=(D=i.getRandomQuality(0,S,e,n)).y>a?D.y:a,o.prefix+=D.y>2?"\u98d8\u9038":"",o.color=i.getMixColor(o.color,D.y>2?i.COLOR_DODGE:"#000000")}var O=cc.v3(0,0);i.isTheEquipType(t.equipmetType,[f.default.HELMET,f.default.GLOVES,f.default.CLOAK,f.default.TROUSERS,f.default.SHIELD,f.default.SHOES,f.default.CLOTHES])&&t.Common.maxHealth>0&&(a=(O=i.getRandomQuality(0,i.getRandomRange(),e,n)).y>a?O.y:a,o.prefix+=O.y>2?"\u5065\u5eb7":"",o.color=i.getMixColor(o.color,O.y>2?i.COLOR_HEALTHY:"#000000"));var A=cc.v3(0,0);t.Common.maxDream>0&&(a=(A=i.getRandomQuality(0,i.getRandomRange(),e,n)).y>a?A.y:a,o.prefix+=A.y>2?"\u68a6\u5e7b":"",o.color=i.getMixColor(o.color,A.y>2?i.COLOR_DREAM:"#000000"));var C=i.getRandomRange();if(i.isTheEquipType(t.equipmetType,[f.default.GLOVES,f.default.REMOTE,f.default.WEAPON])){var R=n.rand()<.1?i.getRandomQuality(0,C,e,n):cc.v3(0,0);a=R.y>a?R.y:a,o.prefix+=R.y>C/2?"\u950b\u5229":"";var L=n.rand()<.1?i.getRandomQuality(0,C,e,n):cc.v3(0,0);a=L.y>a?L.y:a,o.prefix+=L.y>C/2?"\u795e\u79d8":"",o.common.realDamage=R.x,o.common.magicDamage=L.x}var b=n.rand()<.1?i.getRandomQuality(30,60,e,n):cc.v3(0,0);a=b.y>a?b.y:a;var P=n.rand()<.05?i.getRandomQuality(10,60,e,n):cc.v3(0,0);a=P.y>a?P.y:a;var I=n.rand()<.05?i.getRandomQuality(10,60,e,n):cc.v3(0,0);a=I.y>a?I.y:a,o.prefix+=I.y>30?"\u5bd2\u51b7":"";var M=n.rand()<.05?i.getRandomQuality(10,60,e,n):cc.v3(0,0);a=M.y>a?M.y:a,o.prefix+=M.y>30?"\u708e\u70ed":"";var N=n.rand()<.05?i.getRandomQuality(10,60,e,n):cc.v3(0,0);a=N.y>a?N.y:a,o.prefix+=N.y>30?"\u95ea\u7535":"";var w=n.rand()<.05?i.getRandomQuality(10,60,e,n):cc.v3(0,0);a=w.y>a?w.y:a,o.prefix+=w.y>30?"\u5267\u6bd2":"";var H=n.rand()<.05?i.getRandomQuality(10,60,e,n):cc.v3(0,0);return a=H.y>a?H.y:a,o.prefix+=H.y>30?"\u8bc5\u5492":"",o.prefix=["","\u666e\u901a\u7684","\u7cbe\u826f\u7684","\u4f18\u79c0\u7684","\u53f2\u8bd7\u7684","\u4f20\u8bf4\u7684"][a]+o.prefix,o.titlecolor=["#dcdcdc","#ffffff","#00ff00","#0000ff","#800080","#ffa500"][a],o.level=a,o.color="#000000"==o.color?"#ffffff":o.color,o.common.criticalStrikeRate=r.x,o.common.damageMin=u.x,o.common.damageMax=d.x,o.common.defence=p.x,o.common.lifeDrain=g.x,o.common.damageBack=m.x,o.common.moveSpeed=v.x,o.common.attackSpeed=_.x,o.common.dodge=D.x,o.common.maxHealth=O.x,o.common.magicDefence=b.x,o.common.realRate=P.x,o.common.iceRate=I.x,o.common.fireRate=M.x,o.common.lighteningRate=N.x,o.common.toxicRate=w.x,o.common.curseRate=H.x,o.common.maxDream=A.x,o.requireLevel=s.default.playerData.OilGoldData.level,o},e.getRandomRange=function(){return 5+s.default.chapterMaxIndex+Math.floor(s.default.playerData.OilGoldData.level/5)},e.isTheEquipType=function(t,e){for(var i=!1,o=0,a=e;o<a.length;o++)a[o]==t&&(i=!0);return i},e.getRandomQuality=function(t,e,i,o){var a=(e-t)/5,n=o.rand();if(i&&i>0)switch(i){case 1:n=o.rand()>.5?.06:n;break;case 2:n=o.rand()>.5?.08:n;break;case 3:n=o.rand()>.5?.086:n;break;case 4:n=o.rand()>.5?.09:n}var r=cc.v3(0,0);return n<.05?(r.x=o.getRandomNum(0,a),a>5&&r.x<5&&(r.x=5),r.y=1):n>=.05&&n<.075?(r.x=o.getRandomNum(a,2*a),r.y=2):n>=.075&&n<.085?(r.x=o.getRandomNum(2*a,3*a),r.y=3):n>=.085&&n<.09?(r.x=o.getRandomNum(3*a,4*a),r.y=4):n>=.09&&n<.091&&(r.x=o.getRandomNum(4*a,5*a),r.y=5),r.x=parseFloat(r.x.toFixed(0)),r},e.prototype.getEquipment=function(t,e,o,a,n,s){var l=cc.instantiate(this.equipment);l.parent=o,l.position=e,l.zIndex=h.default.OVERHEAD;var c=l.getComponent(u.default);if(c.pos=r.default.getIndexInMap(e),a)s&&(c.shopTable=s,a.price=30*(a.level+1),s.data.equipdata=a.clone()),c.refresh(a);else{var d=i.getNewEquipData(t,n);s&&(c.shopTable=s,s.data.equipdata=d.clone(),s.data.price=d.price),c.refresh(d)}return this.groundList.push(c),c},e.getNewEquipData=function(t,e){if(0!=t.length){var o=new l.default;o.valueCopy(s.default.equipments[t]);var a=o.img.substring(o.equipmetType.length);a.length>0&&(o.id=o.id+parseInt(a)),o.uuid=o.genNonDuplicateID();for(var n=0,r=o.exTriggers;n<r.length;n++)r[n].uuid=o.genNonDuplicateID();var c=i.getRandomDesc(o,e),u=o.Common.clone().add(c.common);return o.infobase=i.getInfoBase(u),o.info1=i.getInfo1(u),o.info2=i.getInfo2(u,o),o.info3=i.getInfo3(u),o.suit1=i.getSuitDesc(o.suitType,0),o.suit2=i.getSuitDesc(o.suitType,1),o.suit3=i.getSuitDesc(o.suitType,2),o.infobasecolor="#fffff0",o.infocolor1="#9370DB",o.infocolor2="#87CEFA",o.infocolor3="#BC8F8F",o.suitcolor1="#FFD700",o.suitcolor2="#FFD700",o.suitcolor3="#FFD700",o.Common.add(c.common),o.prefix=c.prefix,o.titlecolor=c.titlecolor,"#ffffff"!=c.color&&(o.color=c.color,"#ffffff"!=o.lightcolor?o.lightcolor=i.getMixColor(c.color,o.lightcolor):o.lightcolor=c.color),o.level=c.level,o.requireLevel=c.requireLevel,o.price+=i.getPrice(o),o}},e.getOriginEquipData=function(t){if(0!=t.length){var e=new l.default;e.valueCopy(s.default.equipments[t]);var o=e.img.substring(e.equipmetType.length);o.length>0&&(e.id=e.id+parseInt(o)),e.uuid=e.genNonDuplicateID();for(var a=0,n=e.exTriggers;a<n.length;a++)n[a].uuid=e.genNonDuplicateID();var r=e.Common.clone();return e.infobase=i.getInfoBase(r),e.info1=i.getInfo1(r),e.info2=i.getInfo2(r,e),e.info3=i.getInfo3(r),e.suit1=i.getSuitDesc(e.suitType,0),e.suit2=i.getSuitDesc(e.suitType,1),e.suit3=i.getSuitDesc(e.suitType,2),e.infobasecolor="#fffff0",e.infocolor1="#9370DB",e.infocolor2="#87CEFA",e.infocolor3="#BC8F8F",e.suitcolor1="#FFD700",e.suitcolor2="#FFD700",e.suitcolor3="#FFD700",e.titlecolor="#FFFFFF",e.price+=i.getPrice(e),e}},e.getSuitDesc=function(t,e){if(!s.default.suits[t])return"";var o=new g.default;if(o.valueCopy(s.default.suits[t]),e>=o.EquipList.length)return"";var a="",n=0==e?o.nameCn+"\n":"";return a+=i.getInfoBase(o.EquipList[e].Common)+" ",a+=i.getInfo1(o.EquipList[e].Common)+" ",a+=i.getInfo2(o.EquipList[e].Common,o.EquipList[e])+" ",a+=i.getInfo3(o.EquipList[e].Common)+" ",n+(a+=o.EquipList[e].extraInfo).replace("\n","")},e.getInfoBase=function(t){var e="";return e+=0==t.remoteDamage?"":"\u5b50\u5f39\u4f24\u5bb3"+t.remoteDamage+"\n",e+=0==t.remoteCritRate?"":"\u5b50\u5f39\u66b4\u51fb\u7387"+t.remoteCritRate.toFixed(1).replace(".0","")+"\n",e+=0==t.remoteCooldown?"":"\u88c5\u586b\u65f6\u95f4"+t.remoteCooldown/1e3+"s\n",e+=0==t.remoteInterval?"":"\u5c04\u51fb\u95f4\u9694"+t.remoteInterval/1e3+"s\n",e+=0==t.remoteAngle?"":"\u8bef\u5dee\u89d2\u5ea6"+t.remoteAngle+"\n",e+=0==t.maxAmmo?"":"\u5f39\u5939\u5bb9\u91cf"+(t.maxAmmo>0?t.maxAmmo:"\u221e")+"\n",e+=0==t.damageMin?"":"\u653b\u51fb"+t.damageMin+" \u6700\u5927\u653b\u51fb\u529b"+t.damageMax+"\n",e+=0==t.damageMin&&0!=t.damageMax?"\u6700\u5927\u653b\u51fb\u529b"+t.damageMax+"\n":"",e+=0==t.defence?"":"\u9632\u5fa1"+t.defence+"\n",e+=0==t.maxHealth?"":"\u751f\u547d"+t.maxHealth+"\n",(e+=0==t.maxDream?"":"\u68a6\u5883"+t.maxDream+"\n").length>0&&-1!=e.lastIndexOf("\n")&&(e=e.substring(0,e.lastIndexOf("\n"))),e.replace("+-","-")},e.getInfo1=function(t){var e="";return e+=0==t.criticalStrikeRate?"":"\u66b4\u51fb"+t.criticalStrikeRate.toFixed(1).replace(".0","")+"%\n",e+=0==t.lifeDrain?"":"\u5438\u8840"+t.lifeDrain.toFixed(1).replace(".0","")+"%\n",e+=0==t.damageBack?"":"\u80cc\u523a"+t.damageBack+"\n",e+=0==t.moveSpeed?"":"\u79fb\u901f"+t.moveSpeed+"\n",e+=0==t.attackSpeed?"":"\u653b\u901f"+t.attackSpeed+"\n",e+=0==t.dodge?"":"\u95ea\u907f"+t.dodge.toFixed(1).replace(".0","")+"%\n",e+=0==t.blockDamage?"":"\u5f39\u53cd\u4f24\u5bb3"+t.blockDamage+"\n",e+=0==t.blockPhysical?"":"\u683c\u6321\u7269\u514d"+t.blockPhysical+"%\n",(e+=0==t.blockMagic?"":"\u683c\u6321\u9b54\u514d"+t.blockMagic+"%\n").length>0&&-1!=e.lastIndexOf("\n")&&(e=e.substring(0,e.lastIndexOf("\n"))),e.replace("+-","-")},e.getInfo2=function(t,e){var i="";return i+=e&&e.isReflect>0?"\u53cd\u5f39\u5b50\u5f39\n":"",i+=0==t.realDamage?"":"\u653b\u51fb\u9644\u52a0"+t.realDamage+"\u70b9\u6d41\u8840\u4f24\u5bb3\n",i+=0==t.realRate?"":"\u653b\u51fb\u6709"+t.realRate+"%\u51e0\u7387\u91ca\u653e\u6d41\u8840\n",i+=0==t.magicDamage?"":"\u653b\u51fb\u9644\u52a0"+t.magicDamage+"\u70b9\u5143\u7d20\u4f24\u5bb3\n",i+=0==t.iceRate?"":"\u653b\u51fb\u6709"+t.iceRate+"%\u51e0\u7387\u91ca\u653e\u51b0\u51bb\n",i+=0==t.fireRate?"":"\u653b\u51fb\u6709"+t.fireRate+"%\u51e0\u7387\u91ca\u653e\u71c3\u70e7\n",i+=0==t.lighteningRate?"":"\u653b\u51fb\u6709"+t.lighteningRate+"%\u51e0\u7387\u91ca\u653e\u95ea\u7535\n",i+=0==t.toxicRate?"":"\u6bd2\u653b\u51fb\u6709"+t.toxicRate+"%\u51e0\u7387\u91ca\u653e\u6bd2\u7d20\n",(i+=0==t.curseRate?"":"\u653b\u51fb\u6709"+t.curseRate+"%\u51e0\u7387\u91ca\u653e\u8bc5\u5492\n").length>0&&-1!=i.lastIndexOf("\n")&&(i=i.substring(0,i.lastIndexOf("\n"))),i.replace("+-","-")},e.getInfo3=function(t){var e="";return(e+=0==t.magicDefence?"":"\u5143\u7d20\u6297\u6027"+t.magicDefence+"%\n").length>0&&-1!=e.lastIndexOf("\n")&&(e=e.substring(0,e.lastIndexOf("\n"))),e.replace("+-","-")},e.prototype.start=function(){},e.getMixColor=function(t,e){var i=cc.color().fromHEX(t),o=cc.color().fromHEX(e),a=cc.color(),n=i.getR()+o.getR(),r=i.getG()+o.getG(),s=i.getB()+o.getB();return a.setR(n>255?255:n),a.setG(r>255?255:r),a.setB(s>255?255:s),"#"+a.toHEX("#rrggbb")},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.2&&(this.checkTimeDelay=0,!0)},e.getPrice=function(t){var e=0;return t.test>0?0:(e+=5*t.Common.maxHealth,e+=10*t.Common.maxDream,e+=10*t.Common.damageMin,e+=5*t.Common.damageMax,e+=5*t.Common.damageBack,e+=3*t.Common.criticalStrikeRate,e+=5*t.Common.defence,e+=t.Common.blockPhysical/2,e+=t.Common.blockMagic/2,e+=5*t.Common.blockDamage,e+=t.Common.lifeDrain,t.Common.moveSpeed<0?e+=-20:e+=t.Common.moveSpeed,t.Common.attackSpeed<0?e+=-10:e+=t.Common.attackSpeed,e+=2*t.Common.dodge,t.Common.remoteCooldown>0?e+=Math.floor(1e3/t.Common.remoteCooldown*20):e+=Math.floor(t.Common.remoteCooldown/20),t.Common.remoteInterval>0?e+=Math.floor(1e3/t.Common.remoteInterval*20):e+=Math.floor(t.Common.remoteInterval/20),e+=2*t.Common.maxAmmo,e+=30*t.Common.remoteDamage,e+=t.Common.remoteCritRate,e+=20*t.Common.realDamage,e+=2*t.Common.realRate,e+=10*t.Common.magicDamage,e+=t.Common.magicDefence,e+=t.Common.iceRate,e+=2*t.Common.fireRate,e+=t.Common.lighteningRate,e+=2*t.Common.toxicRate,(e+=2*t.Common.curseRate)>0?Math.floor(e):0)},e.prototype.updateLogic=function(t,e){if(this.isCheckTimeDelay(t)){for(var i=200,o=null,a=this.groundList.length-1;a>=0;a--){var n=this.groundList[a];if(n.highLight(!1),!n.isTaken&&n.isValid){var r=s.default.getDistanceNoSqrt(n.node.position,e.node.position);r<i&&(i=r,o=n)}else this.groundList.splice(a,1)}i<64&&o?(o.highLight(!0),o.taketips||(o.taketips=this.node.getChildByName("sprite").getChildByName("taketips")),this.lastGroundEquip&&this.lastGroundEquip.uuid==o.uuid||(cc.tween(o.taketips).to(.2,{opacity:255}).delay(1).to(.2,{opacity:0}).start(),cc.director.emit(p.EventHelper.HUD_GROUND_EQUIPMENT_INFO_SHOW,{detail:{worldPos:o.node.convertToWorldSpaceAR(cc.v3(0,32)),equipData:o.data}})),this.lastGroundEquip=o):(this.lastGroundEquip=null,cc.director.emit(p.EventHelper.HUD_GROUND_EQUIPMENT_INFO_HIDE))}},e.EMPTY="emptyequipment",e.WEAPON_DINNERFORK="weapon000",e.WEAPON_KNIFE="weapon001",e.WEAPON_CHOPPER="weapon002",e.WEAPON_HUGEBLADE="weapon003",e.WEAPON_PITCHFORK="weapon004",e.WEAPON_HUGEAXE="weapon005",e.WEAPON_CROWBAR="weapon006",e.WEAPON_KATANA="weapon007",e.WEAPON_FRUITKNIFE="weapon008",e.WEAPON_HAPPYFIRE="weapon009",e.WEAPON_SADICE="weapon010",e.WEAPON_EGYPTWAND="weapon011",e.WEAPON_TOXICDAGGER="weapon012",e.WEAPON_OLDROOTDAGGER="weapon013",e.WEAPON_COOKCHOPPER="weapon014",e.WEAPON_LIGHTENINGBLADE="weapon015",e.WEAPON_JUNGLEFORK="weapon016",e.WEAPON_KUNAI="weapon017",e.WEAPON_DEATH="weapon018",e.WEAPON_SHADOW="weapon019",e.WEAPON_BLOOD="weapon020",e.WEAPON_WINE_BOTTLE="weapon032",e.WEAPON_WOOD_SWORD="weapon039",e.WEAPON_WOOD_HAMMER="weapon040",e.WEAPON_WOOD_DAGGER="weapon041",e.WEAPON_WOOD_SPEAR="weapon042",e.WEAPON_WOOD_LONG_STICK="weapon043",e.WEAPON_WOOD_LONG_CROSS="weapon044",e.WEAPON_BROKEN_GLASS="weapon045",e.REMOTE_CROSSBOW="remote001",e.REMOTE_LONGBOW="remote002",e.REMOTE_WAND="remote003",e.REMOTE_ALIENGUN="remote004",e.REMOTE_WINCHESTER="remote005",e.REMOTE_RPG="remote006",e.REMOTE_SHURIKEN="remote007",e.REMOTE_CHICKEN="remote008",e.REMOTE_OLDGUN="remote009",e.REMOTE_BASKETBALL="remote011",e.SHIELD_CIRCLE="shield000",e.SHIELD_CARDOOR="shield001",e.SHIELD_POLICE="shield002",e.CLOTHES_VEST="clothes001",e.CLOTHES_SHIRT="clothes002",e.CLOTHES_NAVY="clothes003",e.CLOTHES_PIRATE="clothes004",e.CLOTHES_BUCKET="clothes005",e.CLOTHES_REDROBE="clothes006",e.CLOTHES_WHITEROBE="clothes007",e.CLOTHES_GENTLEMAN="clothes008",e.CLOTHES_RADIATION="clothes009",e.CLOTHES_JUNGLE="clothes010",e.CLOTHES_PHARAOH="clothes011",e.CLOTHES_KNIGHT="clothes012",e.CLOTHES_DEATH="clothes013",e.CLOTHES_ENERGY="clothes014",e.CLOTHES_CAI="clothes026",e.HELMET_BUCKETHAT="helmet002",e.HELMET_PIRATEHAT="helmet003",e.HELMET_REDHAT="helmet004",e.HELMET_WHITEHAT="helmet005",e.HELMET_PHARAOH="helmet006",e.HELMET_CAT="helmet007",e.HELMET_CHIEF="helmet008",e.HELMET_HORUS="helmet009",e.HELMET_GENTLEMAN="helmet010",e.HELMET_CHICKEN="helmet011",e.HELMET_DUCK="helmet012",e.HELMET_GOOSE="helmet013",e.HELMET_RADIATION="helmet014",e.HELMET_JUNGLE="helmet015",e.HELMET_ANUBIS="helmet016",e.HELMET_KNIGHT="helmet017",e.HELMET_DEATH="helmet018",e.HELMET_ENERY="helmet019",e.CLOAK_WARRIOR="cloak001",e.TROUSERS_LONG="trousers001",e.TROUSERS_SHORT="trousers002",e.TROUSERS_RADIATION="trousers003",e.TROUSERS_JUNGLE="trousers004",e.TROUSERS_PHARAOH="trousers005",e.TROUSERS_KNIGHT="trousers006",e.TROUSERS_DEATH="trousers007",e.TROUSERS_ENERGY="trousers008",e.GLOVES_WARRIOR="gloves001",e.GLOVES_DEMON="gloves002",e.GLOVES_BLOODCRAW="gloves003",e.GLOVES_RADIATION="gloves004",e.GLOVES_JUNGLE="gloves005",e.GLOVES_PHARAOH="gloves006",e.GLOVES_KNIGHT="gloves007",e.GLOVES_DEATH="gloves008",e.GLOVES_ENERGY="gloves009",e.SHOES_WARRIOR="shoes001",e.SHOES_SKATEBOARD="shoes002",e.SHOES_DEMON="shoes003",e.SHOES_RADIATION="shoes004",e.SHOES_JUNGLE="shoes005",e.SHOES_PHARAOH="shoes006",e.SHOES_KNIGHT="shoes007",e.SHOES_DEATH="shoes008",e.SHOES_ENERGY="shoes009",e.COLOR_CRITICALSTRIKE="#DC143C",e.COLOR_ATTACKSPPED="#5F9EA0",e.COLOR_MOVESPEED="#00BFFF",e.COLOR_DODGE="#FFFF00",e.COLOR_STABLE="#DEB887",e.COLOR_POWERFUL="#ADFF2F",e.COLOR_HEALTHY="#90EE90",e.COLOR_LIFEDRAIN="#FFC0CB",e.COLOR_BACK="#9370DB",e.COLOR_DREAM="#800080",n([v(cc.Prefab)],e.prototype,"equipment",void 0),i=n([m],e)}(d.default);i.default=E,cc._RF.pop()},{"../data/EquipmentData":"EquipmentData","../data/EquipmentDescData":"EquipmentDescData","../data/SuitData":"SuitData","../equipment/Equipment":"Equipment","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../utils/IndexZ":"IndexZ","./BaseManager":"BaseManager","./InventoryManager":"InventoryManager"}],EquipmentStringData:[function(t,e,i){"use strict";cc._RF.push(e,"92198gP7T1AvKS5hasHWtsb","EquipmentStringData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.nameCn="",this.nameEn="",this.equipmetType="empty",this.desc="",this.img="emptyequipment",this.maxHealth=0,this.maxDream=0,this.damageMin=0,this.damageMax=0,this.criticalStrikeRate=0,this.defence=0,this.lifeDrain=0,this.damageBack=0,this.moveSpeed=0,this.attackSpeed=0,this.dodge=0,this.remoteCooldown=0,this.remoteDamage=0,this.remoteCritRate=0,this.remoteInterval=0,this.realDamage=0,this.realRate=0,this.magicDamage=0,this.magicDefence=0,this.iceRate=0,this.fireRate=0,this.lighteningRate=0,this.toxicRate=0,this.curseRate=0,this.stab=0,this.far=0,this.trouserslong=0,this.bulletType="",this.bulletSize=0,this.bulletArcExNum=0,this.bulletLineExNum=0,this.bulletLineInterval=0,this.showShooter=0,this.isHeavy=0,this.isLineAim=0,this.hideHair=0,this.bulletExSpeed=0}return t.prototype.valueCopy=function(t){this.maxHealth=t.Common.maxHealth?t.Common.maxHealth:0,this.maxDream=t.Common.maxDream?t.Common.maxDream:0,this.damageMin=t.Common.damageMin?t.Common.damageMin:0,this.damageMax=t.Common.damageMax?t.Common.damageMax:0,this.criticalStrikeRate=t.Common.criticalStrikeRate?t.Common.criticalStrikeRate:0,this.defence=t.Common.defence?t.Common.defence:0,this.lifeDrain=t.Common.lifeDrain?t.Common.lifeDrain:0,this.damageBack=t.Common.damageBack?t.Common.damageBack:0,this.moveSpeed=t.Common.moveSpeed?t.Common.moveSpeed:0,this.attackSpeed=t.Common.attackSpeed?t.Common.attackSpeed:0,this.remoteCooldown=t.Common.remoteCooldown?t.Common.remoteCooldown:0,this.remoteDamage=t.Common.remoteDamage?t.Common.remoteDamage:0,this.remoteCritRate=t.Common.remoteCritRate?t.Common.remoteCritRate:0,this.remoteInterval=t.Common.remoteInterval?t.Common.remoteInterval:0,this.dodge=t.Common.dodge?t.Common.dodge:0,this.realDamage=t.Common.realDamage?t.Common.realDamage:0,this.realRate=t.Common.realRate?t.Common.realRate:0,this.magicDefence=t.Common.magicDefence?t.Common.magicDefence:0,this.iceRate=t.Common.iceRate?t.Common.iceRate:0,this.magicDamage=t.Common.magicDamage?t.Common.magicDamage:0,this.fireRate=t.Common.fireRate?t.Common.fireRate:0,this.lighteningRate=t.Common.lighteningRate?t.Common.lighteningRate:0,this.toxicRate=t.Common.toxicRate?t.Common.toxicRate:0,this.curseRate=t.Common.curseRate?t.Common.curseRate:0,this.nameCn=t.nameCn?t.nameCn:"",this.nameEn=t.nameEn?t.nameEn:"",this.equipmetType=t.equipmetType?t.equipmetType:"",this.desc=t.desc?t.desc:"",this.img=t.img?t.img:"emptyequipment",this.stab=t.stab?t.stab:0,this.far=t.far?t.far:0,this.bulletArcExNum=t.bulletArcExNum?t.bulletArcExNum:0,this.bulletLineExNum=t.bulletLineExNum?t.bulletLineExNum:0,this.bulletLineInterval=t.bulletLineInterval?t.bulletLineInterval:0,this.trouserslong=t.trouserslong?t.trouserslong:0,this.showShooter=t.showShooter?t.showShooter:0,this.isHeavy=t.isHeavy?t.isHeavy:0,this.bulletType=t.bulletType?t.bulletType:"",this.isLineAim=t.isLineAim?t.isLineAim:0,this.hideHair=t.hideHair?t.hideHair:0,this.bulletSize=t.bulletSize?t.bulletSize:0,this.bulletExSpeed=t.bulletExSpeed?t.bulletExSpeed:0},t.prototype.clone=function(){var e=new t;return e.nameCn=this.nameCn,e.nameEn=this.nameEn,e.equipmetType=this.equipmetType,e.desc=this.desc,e.img=this.img,e.stab=this.stab,e.far=this.far,e.trouserslong=this.trouserslong,e.showShooter=this.showShooter,e.bulletType=this.bulletType,e.isHeavy=this.isHeavy,e.isLineAim=this.isLineAim,e.bulletArcExNum=this.bulletArcExNum,e.bulletLineExNum=this.bulletLineExNum,e.bulletLineInterval=this.bulletLineInterval,e.hideHair=this.hideHair,e.bulletSize=this.bulletSize,e.bulletExSpeed=this.bulletExSpeed,e.maxHealth=this.maxHealth,e.damageMin=this.damageMin,e.damageMax=this.damageMax,e.criticalStrikeRate=this.criticalStrikeRate,e.defence=this.defence,e.lifeDrain=this.lifeDrain,e.damageBack=this.damageBack,e.moveSpeed=this.moveSpeed,e.attackSpeed=this.attackSpeed,e.remoteCooldown=this.remoteCooldown,e.remoteCritRate=this.remoteCritRate,e.remoteDamage=this.realDamage,e.remoteInterval=this.remoteInterval,e.dodge=this.dodge,e.realDamage=this.realDamage,e.realRate=this.realRate,e.magicDefence=this.magicDefence,e.iceRate=this.iceRate,e.magicDamage=this.magicDamage,e.fireRate=this.fireRate,e.lighteningRate=this.lighteningRate,e.toxicRate=this.toxicRate,e.curseRate=this.curseRate,e},t}();i.default=o,cc._RF.pop()},{}],Equipment:[function(t,e,i){"use strict";cc._RF.push(e,"46d3aM6X2VOCJtzuWiGZaWE","Equipment");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../data/EquipmentData"),l=t("../logic/EventHelper"),c=t("../logic/Dungeon"),u=t("../utils/AudioPlayer"),h=t("../logic/Achievement"),d=cc._decorator,p=d.ccclass,f=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=new s.default,e.pos=cc.v3(0,0),e.isTaken=!1,e}return a(e,t),e.prototype.onLoad=function(){this.isTaken=!1,this.sprite=this.node.getChildByName("sprite"),this.taketips=this.node.getChildByName("sprite").getChildByName("taketips")},e.prototype.refresh=function(t){this.data.valueCopy(t);var e=r.default.spriteFrameRes(this.data.img);"trousers"==t.equipmetType&&(e=1==t.trouserslong?r.default.spriteFrameRes("trousers000"):e),"clothes"==t.equipmetType?e=r.default.spriteFrameRes(this.data.img+"anim0"):"helmet"==t.equipmetType?e=r.default.spriteFrameRes(this.data.img+"anim0"):"remote"==t.equipmetType&&(e=r.default.spriteFrameRes(this.data.img+"anim0")),this.sprite.getComponent(cc.Sprite).spriteFrame=e,this.sprite.width=e.getOriginalSize().width,this.sprite.height=e.getOriginalSize().height;var i=cc.color(255,255,255).fromHEX(this.data.color);this.sprite.color=i,this.mat=this.sprite.getComponent(cc.Sprite).getMaterial(0),this.mat.setProperty("textureSizeWidth",e.getTexture().width*this.sprite.scaleX),this.mat.setProperty("textureSizeHeight",e.getTexture().height*this.sprite.scaleY),this.mat.setProperty("outlineColor",cc.color(200,200,200)),this.highLight(!1),"remote"==t.equipmetType&&(this.sprite.width=this.sprite.width/2,this.sprite.height=this.sprite.height/2),this.data.pos=c.default.getIndexInMap(this.node.position.clone())},e.prototype.highLight=function(t){this.mat||(this.mat=this.sprite.getComponent(cc.Sprite).getMaterial(0)),this.mat.setProperty("openOutline",t?1:0)},e.prototype.start=function(){this.anim=this.getComponent(cc.Animation)},e.prototype.onEnable=function(){},e.prototype.taken=function(t){return!this.isTaken&&(this.shopTable?r.default.coins>=this.data.price&&(cc.director.emit(l.EventHelper.HUD_ADD_COIN,{detail:{count:-this.data.price}}),cc.director.emit(l.EventHelper.PLAY_AUDIO,{detail:{name:u.default.COIN}}),this.shopTable.sale(!0),this._taken(t),!0):(this._taken(t),!0))},e.prototype._taken=function(t){var e=this;this.isTaken=!0,this.anim.play("EquipmentTaken"),h.default.addEquipsAchievement(this.data.img),cc.director.emit(l.EventHelper.PLAYER_CHANGEEQUIPMENT,{detail:{equipmetType:this.data.equipmetType,equipData:this.data,isReplace:t}}),this.node.getChildByName("shadow").active=!1,cc.director.emit(l.EventHelper.HUD_GROUND_EQUIPMENT_INFO_HIDE),this.scheduleOnce(function(){e.node&&e.destroy()},1);var i=r.default.mapManager.getCurrentMapEquipments(),o=new Array;if(i)for(var a=0,n=i;a<n.length;a++){var s=n[a];s.uuid&&s.uuid!=this.data.uuid&&o.push(s)}r.default.mapManager.setCurrentEquipmentsArr(o),cc.director.emit(l.EventHelper.PLAY_AUDIO,{detail:{name:u.default.PICK_UP}})},n([p],e)}(cc.Component));i.default=f,cc._RF.pop()},{"../data/EquipmentData":"EquipmentData","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer"}],EventHelper:[function(t,e,i){"use strict";cc._RF.push(e,"4128feS00VLAILEQToHDge5","EventHelper");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0}),i.EventHelper=void 0;var r=cc._decorator,s=r.ccclass,l=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.emit=function(t,e){e?cc.director.emit(t,{detail:e}):cc.director.emit(t)},e.on=function(t,e){cc.director.on(t,function(t){e(t?t.detail:{})})},e.PLAYER_MOVE="PLAYER_MOVE",e.PLAYER_ROTATE="PLAYER_ROTATE",e.PLAYER_TRIGGER="PLAYER_TRIGGER",e.PLAYER_USEITEM="PLAYER_USEITEM",e.USEITEM_KEYBOARD="USEITEM_KEYBOARD",e.KEYBOARD_INTERACT="KEYBOARD_INTERACT",e.KEYBOARD_MOVE="KEYBOARD_MOVE",e.PLAYER_SKILL="PLAYER_SKILL",e.PLAYER_SKILL1="PLAYER_SKILL1",e.PLAYER_ATTACK="PLAYER_ATTACK",e.PLAYER_REMOTEATTACK="PLAYER_REMOTEATTACK",e.PLAYER_REMOTEATTACK_CANCEL="PLAYER_REMOTEATTACK_CANCEL",e.PLAYER_GETITEM="PLAYER_GETITEM",e.PLAYER_USEDREAM="PLAYER_USEDREAM",e.PLAYER_CHANGEITEM="PLAYER_CHANGEITEM",e.PLAYER_CHANGEEQUIPMENT="PLAYER_CHANGEEQUIPMENT",e.PLAYER_EQUIPMENT_REFRESH="PLAYER_EQUIPMENT_REFRESH",e.PLAYER_ITEM_REFRESH="PLAYER_ITEM_REFRESH",e.PLAYER_STATUSUPDATE="PLAYER_STATUSUPDATE",e.PLAYER_EXIT_FROM_SETTINGS="PLAYER_EXIT_FROM_SETTINGS",e.PLAYER_UPDATE_OILGOLD_DATA="PLAYER_UPDATE_OILGOLD_DATA",e.INVENTORY_CHANGEITEM="INVENTORY_CHANGEITEM",e.CHANGE_MINIMAP="CHANGE_MINIMAP",e.OPEN_MINIMAP="OPEN_MINIMAP",e.HUD_ADD_COIN="HUD_ADD_COIN",e.HUD_ADD_OILGOLD="HUD_ADD_OILGOLD",e.HUD_LOSE_OILGOLD="HUD_LOSE_OILGOLD",e.HUD_OILGOLD_LOSE_SHOW="HUD_OILGOLD_LOSE_SHOW",e.HUD_OILGOLD_RECOVERY_SHOW="HUD_OILGOLD_RECOVERY_SHOW",e.HUD_STOP_COUNTTIME="HUD_STOP_COUNTTIME",e.HUD_LIGHT_CONTROLLER="HUD_LIGHT_CONTROLLER",e.HUD_CHANGE_CONTROLLER_SHIELD="HUD_CHANGE_CONTROLLER_SHIELD",e.HUD_CONTROLLER_COOLDOWN="HUD_CONTROLLER_COOLDOWN",e.HUD_CONTROLLER_UPDATE_GAMEPAD="HUD_CONTROLLER_UPDATE_GAMEPAD",e.HUD_CONTROLLER_INTERACT_SHOW="HUD_CONTROLLER_INTERACT_SHOW",e.HUD_CONTROLLER_REMOTE_SHOW="HUD_CONTROLLER_REMOTE_SHOW",e.HUD_DAMAGE_CORNER_SHOW="HUD_DAMAGE_CORNER_SHOW",e.HUD_GROUND_EQUIPMENT_INFO_SHOW="HUD_GROUND_EQUIPMENT_INFO_SHOW",e.HUD_GROUND_EQUIPMENT_INFO_HIDE="HUD_GROUND_EQUIPMENT_INFO_HIDE",e.HUD_GROUND_ITEM_INFO_SHOW="HUD_GROUND_ITEM_INFO_SHOW",e.HUD_GROUND_ITEM_INFO_HIDE="HUD_GROUND_ITEM_INFO_HIDE",e.HUD_FADE_IN="HUD_FADE_IN",e.HUD_FADE_OUT="HUD_FADE_OUT",e.HUD_COMPLETE_SHOW="HUD_COMPLETE_SHOW",e.HUD_DOLL_MACHINE_DIALOG="HUD_DOLL_MACHINE_DIALOG",e.HUD_MART_SHELVES_DIALOG="HUD_MART_SHELVES_DIALOG",e.HUD_MART_SHELVES_DIALOG_PAY="HUD_MART_SHELVES_DIALOG_BUY",e.HUD_CAMERA_ZOOM_IN="HUD_CAMERA_ZOOM_IN",e.HUD_CAMERA_ZOOM_OUT="HUD_CAMERA_ZOOM_OUT",e.HUD_CANCEL_OR_PAUSE="HUD_CANCEL_OR_PAUSE",e.DUNGEON_SETEQUIPMENT="DUNGEON_SETEQUIPMENT",e.DUNGEON_ADD_ITEM="DUNGEON_ADD_ITEM",e.DUNGEON_SHAKEONCE="DUNGEON_SHAKEONCE",e.DUNGEON_ADD_COIN="DUNGEON_ADD_COIN",e.DUNGEON_ADD_OILGOLD="DUNGEON_ADD_OILGOLD",e.DUNGEON_ADD_FALLSTONE="DUNGEON_ADD_FALLSTONE",e.DUNGEON_ADD_LIGHTENINGFALL="DUNGEON_ADD_LIGHTENINGFALL",e.DUNGEON_WALL_COLLIDER="DUNGEON_WALL_COLLIDER",e.DUNGEON_DISAPPEAR="DUNGEON_DISAPPEAR",e.MONSTER_STATUSUPDATE="MONSTER_STATUSUPDATE",e.BOSS_ADDSLIME="BOSS_ADDSLIME",e.HUD_UPDATE_PLAYER_INFODIALOG="HUD_UPDATE_PLAYER_INFO_DIALOG",e.HUD_UPDATE_PLAYER_HEALTHBAR="HUD_UPDATE_PLAYER_HEALTHBAR",e.HUD_UPDATE_PLAYER_DREAMBAR="HUD_UPDATE_PLAYER_DREAMBAR",e.HUD_SHAKE_PLAYER_DREAMBAR="HUD_SHAKE_PLAYER_DREAMBAR",e.HUD_UPDATE_PLAYER_LIFE_BAR="HUD_UPDATE_PLAYER_LIFE_BAR",e.HUD_UPDATE_PLAYER_AMMO="HUD_UPDATE_PLAYER_AMMO",e.HUD_INVENTORY_SHOW="HUD_INVENTORY_SHOW",e.HUD_CELLPHONE_SHOW="HUD_CELLPHONE_SHOW",e.HUD_INVENTORY_SELECT_UPDATE="HUD_INVENTORY_SELECT_UPDATE",e.HUD_INVENTORY_ITEM_UPDATE="HUD_INVENTORY_ITEM_UPDATE",e.HUD_INVENTORY_EQUIP_UPDATE="HUD_INVENTORY_EQUIP_UPDATE",e.HUD_INVENTORY_ALL_UPDATE="HUD_INVENTORY_ALL_UPDATE",e.HUD_TOAST="HUD_TOAST",e.HUD_TIME_TICK="HUD_TIME_TICK",e.HUD_DIALOGUE_SHOW="HUD_DIALOGUE_SHOW",e.HUD_FURNITURE_REFRESH="HUD_FURNITURE_REFRESH",e.TALENT_TREE_UPDATE="TALENT_TREE_UPDATE",e.TALENT_TREE_SELECT="TALENT_TREE_SELECT",e.PLAY_AUDIO="PLAY_AUDIO",e.STOP_ALL_AUDIO_EFFECT="STOP_AUDIO_EFFECT",e.CAMERA_SHAKE="CAMERA_SHAKE",e.CAMERA_LOOK="CAMERA_LOOK",e.CHUNK_LOAD="CHUNK_LOAD",e.POOL_DESTORY_WALKSMOKE="destorysmoke",e.POOL_DESTORY_BLOCKLIGHT="destoryblocklight",e.TEST_SHOW_NODE_COUNT="TEST_SHOW_NODE_COUNT",e.SETTINGS_LOW_POWER="SETTINGS_LOW_POWER",e.eventHandler=new cc.Node,n([s],e)}(cc.Component));i.EventHelper=l,cc._RF.pop()},{}],EvilEye:[function(t,e,i){"use strict";cc._RF.push(e,"4c205mgXoJFWIARHvt3fCFo","EvilEye");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/EventHelper"),l=t("../logic/Shooter"),c=t("../data/DamageData"),u=t("../manager/StatusManager"),h=t("./Boss"),d=t("../utils/NextStep"),p=t("../utils/AudioPlayer"),f=t("../data/FromData"),g=t("../logic/Achievement"),y=t("../utils/ActorUtils"),m=t("../logic/Logic"),v=t("../collider/CCollider"),E=cc._decorator,_=E.ccclass,T=(E.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeDelay=0,e.isMoving=!1,e.viceEyesFireSkill=new d.default,e.mainEyesFireSkill=new d.default,e.dashSkill=new d.default,e.isHalfBlood=!1,e.actionTimeDelay=0,e}return a(e,t),e.prototype.init=function(){throw new Error("Method not implemented.")},e.prototype.onLoad=function(){this.sc.isDied=!1,this.sc.isShow=!1,this.graphics=this.getComponent(cc.Graphics),this.anim=this.getComponent(cc.Animation),this.shooter=this.node.getChildByName("Shooter").getComponent(l.default),this.statusManager=this.node.getChildByName("StatusManager").getComponent(u.default),this.viceEyes=new Array,this.viceEyes.push(this.node.getChildByName("sprite").getChildByName("limb1").getChildByName("tentacle1").getChildByName("tentacle2").getChildByName("tentacle3").getChildByName("eye")),this.viceEyes.push(this.node.getChildByName("sprite").getChildByName("limb2").getChildByName("tentacle1").getChildByName("tentacle2").getChildByName("tentacle3").getChildByName("eye")),this.viceEyes.push(this.node.getChildByName("sprite").getChildByName("limb3").getChildByName("tentacle1").getChildByName("tentacle2").getChildByName("tentacle3").getChildByName("eye")),this.viceEyes.push(this.node.getChildByName("sprite").getChildByName("limb4").getChildByName("tentacle1").getChildByName("tentacle2").getChildByName("tentacle3").getChildByName("eye")),this.viceEyes.push(this.node.getChildByName("sprite").getChildByName("limb5").getChildByName("tentacle1").getChildByName("tentacle2").getChildByName("tentacle3").getChildByName("eye")),this.viceEyes.push(this.node.getChildByName("sprite").getChildByName("limb6").getChildByName("tentacle1").getChildByName("tentacle2").getChildByName("tentacle3").getChildByName("eye")),this.viceShooters=new Array,this.viceShooters.push(this.node.getChildByName("Shooter1").getComponent(l.default)),this.viceShooters.push(this.node.getChildByName("Shooter2").getComponent(l.default)),this.viceShooters.push(this.node.getChildByName("Shooter3").getComponent(l.default)),this.viceShooters.push(this.node.getChildByName("Shooter4").getComponent(l.default)),this.viceShooters.push(this.node.getChildByName("Shooter5").getComponent(l.default)),this.viceShooters.push(this.node.getChildByName("Shooter6").getComponent(l.default));var t=f.default.getClone(this.actorName(),"evileyeeye");this.shooter.from.valueCopy(t);for(var e=0,i=this.viceShooters;e<i.length;e++)i[e].from.valueCopy(t)},e.prototype.start=function(){t.prototype.start.call(this)},e.prototype.takeDamage=function(t){var e=this;if(this.sc.isDied||!this.sc.isShow||this.anim.getAnimationState("EvilEyeHurt").isPlaying)return!1;this.data.currentHealth-=this.data.getDamage(t).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.data.currentHealth<this.data.Common.maxHealth/2&&!this.isHalfBlood&&(this.isHalfBlood=!0,this.anim.play("EvilEyeHurt"),this.scheduleOnce(function(){e.anim.play("EvilEyeBite")},2.5));var i=[p.default.MONSTER_HIT,p.default.MONSTER_HIT1,p.default.MONSTER_HIT2];return p.default.play(i[m.default.getRandomNum(0,2)]),!0},e.prototype.killed=function(){var t=this;this.sc.isDied||(g.default.addMonsterKillAchievement(this.data.resName),cc.tween(this.node).to(3,{opacity:0}).start(),this.sc.isDied=!0,this.scheduleOnce(function(){t.node&&(t.node.active=!1)},5),this.getLoot())},e.prototype.bossAction=function(){if(!this.sc.isDied&&this.sc.isShow&&this.dungeon){this.entity.Transform.position=r.default.fixOuterMap(this.entity.Transform.position),this.pos=r.default.getIndexInMap(this.entity.Transform.position),this.changeZIndex();var t=this.getMovePos(),e=this.getNearPlayerDistance(this.dungeon.player.node),i=this.data.currentHealth<this.data.Common.maxHealth/2;e<100&&(this.entity.Move.linearVelocity=cc.Vec2.ZERO),this.mainEyesFireSkill.IsExcuting||!i||this.anim.getAnimationState("EvilEyeHurt").isPlaying||this.dash(),this.fireWithViceEyes(i),this.dashSkill.IsExcuting||this.fireWithMainEye(),!t.equals(cc.Vec3.ZERO)&&e>100&&!this.shooter.isAiming&&!this.dashSkill.IsExcuting&&(t=t.normalizeSelf(),this.move(t,20))}},e.prototype.getMovePos=function(){var t=this.dungeon.player.pos.clone(),e=r.default.getPosInMap(t);return e.y+=32,(e=e.sub(this.entity.Transform.position)).x,e},e.prototype.fireWithViceEyes=function(t){var e=this;this.viceEyesFireSkill.next(function(){e.viceEyesFireSkill.IsExcuting=!0,e.scheduleOnce(function(){e.viceEyesFireSkill.IsExcuting=!1},2),t?e.schedule(function(){e.fireViceBullet()},.5,2,0):e.fireViceBullet()},3)},e.prototype.fireViceBullet=function(){for(var t=0;t<this.viceShooters.length;t++){var e=this.viceEyes[t].convertToWorldSpaceAR(cc.v3(0,0));e=this.node.convertToNodeSpaceAR(e),this.viceShooters[t].node.setPosition(e);var i=this.entity.Transform.position.clone().add(e),o=this.dungeon.player.getCenterPosition().sub(i);o.equals(cc.Vec3.ZERO)||(this.viceShooters[t].setHv(cc.v2(o).normalize()),this.fireShooter(this.viceShooters[t],"bullet101",0,0,0,cc.v3(0,0)))}},e.prototype.fireWithMainEye=function(){var t=this;this.mainEyesFireSkill.next(function(){t.mainEyesFireSkill.IsExcuting=!0,t.scheduleOnce(function(){t.mainEyesFireSkill.IsExcuting=!1},3);var e=t.shooter.node.convertToWorldSpaceAR(cc.v3(0,0));e=t.node.convertToNodeSpaceAR(e),t.shooter.node.setPosition(e);var i=t.entity.Transform.position.clone().add(e),o=t.dungeon.player.getCenterPosition().sub(i);o.equals(cc.Vec3.ZERO)||(t.shooter.setHv(cc.v2(o).normalize()),t.shooter.data.isLineAim=1,t.fireShooter(t.shooter,"laser003",0,3,0,cc.v3(0,0)),t.anim.playAdditive("EvilEyeStone"))},7)},e.prototype.dash=function(){var t=this;this.dashSkill.next(function(){cc.director.emit(s.EventHelper.PLAY_AUDIO,{detail:{name:p.default.MELEE}}),t.dashSkill.IsExcuting=!0,t.anim||(t.anim=t.getComponent(cc.Animation)),t.anim.play("EvilEyeBite");var e=t.getMovePos(),i=e.x,o=e.y,a=cc.v2(i,o);a=a.normalize().mul(2e3),t.entity.Move.linearVelocity=a,t.scheduleOnce(function(){t.dashSkill.IsExcuting=!1},2)},3,!0)},e.prototype.fireShooter=function(t,e,i,o,a,n){t.dungeon=this.dungeon,t.data.bulletType=e,t.data.bulletArcExNum=i,t.data.bulletLineExNum=o,t.fireBullet(a,n)},e.prototype.showBoss=function(){this.sc.isShow=!0,this.entity.NodeRender.node=this.node,this.entity.Move.linearDamping=10,this.healthBar&&(this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.healthBar.node.active=!this.sc.isDied)},e.prototype.isActionTimeDelay=function(t){return this.actionTimeDelay+=t,this.actionTimeDelay>.2&&(this.actionTimeDelay=0,!0)},e.prototype.updateLogic=function(t){this.timeDelay+=t,this.timeDelay>1&&(this.timeDelay=0),this.isActionTimeDelay(t)&&this.bossAction(),this.data.currentHealth<1&&this.killed(),this.healthBar.node.active=!this.sc.isDied,this.sc.isDied&&(this.entity.Move.linearVelocity=cc.Vec2.ZERO)},e.prototype.move=function(t,e){if(!this.sc.isDied){t.equals(cc.Vec3.ZERO)||(this.pos=r.default.getIndexInMap(this.entity.Transform.position));var i=t.x,o=t.y,a=(Math.abs(i),Math.abs(o),cc.v2(i,o));a=a.mul(e),this.entity.Move.linearVelocity=a,this.isMoving=0!=i||0!=o,this.changeZIndex()}},e.prototype.onColliderEnter=function(t,e){if(e.tag==v.default.TAG.BOSS_HIT){var i=y.default.getEnemyCollisionTarget(t);if(i&&this.dashSkill.IsExcuting){var o=new c.default;o.physicalDamage=15;var a=f.default.getClone(this.actorName(),"evileyeeye");i.takeDamage(o,a,this)&&i.addStatus(u.default.BLEEDING,a)}}},e.prototype.actorName=function(){return"\u90aa\u773c"},n([_],e)}(h.default));i.default=T,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/NextStep":"NextStep","./Boss":"Boss"}],ExitData:[function(t,e,i){"use strict";cc._RF.push(e,"76ad8SnMG9NL67Zj9BTup1j","ExitData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../logic/Logic"),a=function(){function t(){this.fromRoomPos=cc.v3(0,0),this.fromPos=cc.v3(0,0),this.fromChapter=0,this.fromLevel=0,this.toChapter=0,this.toLevel=0,this.toPos=cc.v3(0,0)}return t.prototype.valueCopy=function(t){this.fromChapter=t.fromChapter?t.fromChapter:0,this.fromLevel=t.fromLevel?t.fromLevel:0,this.toChapter=t.toChapter?t.toChapter:0,this.toLevel=t.toLevel?t.toLevel:0,this.fromRoomPos=t.fromRoomPos?cc.v3(t.fromRoomPos.x,t.fromRoomPos.y):cc.v3(0,0),this.toPos=t.toPos?cc.v3(t.toPos.x,t.toPos.y):cc.v3(0,0),this.fromPos=t.fromPos?cc.v3(t.fromPos.x,t.fromPos.y):cc.v3(0,0)},t.prototype.clone=function(){var e=new t;return e.toPos=this.toPos.clone(),e.fromRoomPos=this.fromRoomPos.clone(),e.fromPos=this.fromPos.clone(),e.fromChapter=this.fromChapter,e.fromLevel=this.fromLevel,e.toChapter=this.toChapter,e.toLevel=this.toLevel,e},t.getRealWorldExitDataFromDream=function(e,i){var a=new t;return a.fromChapter=e,a.fromLevel=i,a.toChapter=o.default.CHAPTER099,a.toLevel=0,a.toPos=cc.v3(6,17),a},t.getDreamExitDataFromReal=function(){var e=new t;return e.fromChapter=o.default.CHAPTER099,e.fromLevel=0,e.toChapter=o.default.savePoinitData.chapter,e.toLevel=o.default.savePoinitData.level,e.toPos=cc.v3(o.default.savePoinitData.x,o.default.savePoinitData.y),e},t}();i.default=a,cc._RF.pop()},{"../logic/Logic":"Logic"}],ExitDoor:[function(t,e,i){"use strict";cc._RF.push(e,"479c1KI84hEjY9sMAyTcSmq","ExitDoor");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Player"),s=t("../logic/EventHelper"),l=t("../logic/Logic"),c=t("./Building"),u=t("../utils/AudioPlayer"),h=t("../utils/IndexZ"),d=t("../data/ExitData"),p=t("../logic/Dungeon"),f=t("../collider/CCollider"),g=t("../utils/Random"),y=cc._decorator,m=y.ccclass,v=(y.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isOpen=!1,e.isDoor=!0,e.bgSprite=null,e.closeSprite=null,e.openSprite=null,e.spriteNode=null,e.roof=null,e.isBackToUpLevel=!1,e.dir=0,e.exitData=new d.default,e}return a(e,t),e.prototype.init=function(t,e){if(this.dir=t,this.exitData.valueCopy(e),this.isBackToUpLevel=4==t||5==t||6==t||7==t,this.dir>7){this.node.opacity=0,this.roof.node.opacity=0;var i=this.data.defaultPos.clone(),o=this.node.getComponent(f.default);o.setSize(cc.size(128,128)),o.offset=cc.v2(0,0),8==this.dir&&(i.y+=1),9==this.dir&&(i.y-=1),10==this.dir&&(i.x-=1),11==this.dir&&(i.x+=1),this.entity.Transform.position=p.default.getPosInMap(i),this.node.position=this.entity.Transform.position.clone()}this.roof.getComponentInChildren(cc.Label).string="-"+l.default.worldLoader.getLevelData(this.exitData.toChapter,this.exitData.toLevel).name},e.prototype.onLoad=function(){this.spriteNode=this.node.getChildByName("sprite"),this.bgSprite=this.node.getChildByName("sprite").getChildByName("exitbg").getComponent(cc.Sprite),this.closeSprite=this.node.getChildByName("sprite").getChildByName("exitopen").getComponent(cc.Sprite),this.openSprite=this.node.getChildByName("sprite").getChildByName("exitclose").getComponent(cc.Sprite),this.roof=this.node.getChildByName("roof").getComponent(cc.Sprite),this.openSprite.node.zIndex=h.default.FLOOR,this.closeSprite.node.zIndex=h.default.ACTOR},e.prototype.start=function(){switch(l.default.chapterIndex){case l.default.CHAPTER00:this.changeRes("exit000");break;case l.default.CHAPTER01:this.changeRes("exit001");break;case l.default.CHAPTER02:this.changeRes("exit002");break;case l.default.CHAPTER03:this.changeRes("exit003");break;case l.default.CHAPTER04:case l.default.CHAPTER05:this.changeRes("exit004");break;case l.default.CHAPTER099:this.changeRes("exit000")}var t=l.default.spriteFrameRes("roof"+l.default.worldLoader.getCurrentLevelData().wallRes1+"anim000");(this.dir%4>1||this.dir>7)&&(t=null),this.roof.spriteFrame=t,this.roof.node.parent=this.node.parent;var e=this.node.convertToWorldSpaceAR(cc.v3(0,128));switch(this.roof.node.position=this.roof.node.parent.convertToNodeSpaceAR(e),this.roof.node.zIndex=h.default.OVERHEAD,this.roof.node.opacity=255,this.dir%4){case 0:break;case 1:this.roof.node.angle=180,this.roof.node.opacity=128,this.roof.node.getChildByName("info").angle=180}},e.prototype.openGate=function(t){this.isOpen||(this.isOpen=!0,this.getComponent(f.default).sensor=!0,cc.tween(this.closeSprite.node).to(t?0:1,{opacity:0}).start())},e.prototype.closeGate=function(t){this.isOpen&&(this.isOpen=!1,this.getComponent(f.default).sensor=!1,cc.tween(this.closeSprite.node).to(t?0:1,{opacity:255}).start())},e.prototype.onColliderEnter=function(t,e){if(e.sensor&&t.tag==f.default.TAG.PLAYER){var i=t.node.getComponent(r.default);i&&this.isOpen&&(this.isOpen=!1,cc.director.emit(s.EventHelper.PLAY_AUDIO,{detail:{name:u.default.EXIT}}),l.default.playerData=i.data.clone(),l.default.loadingNextLevel(this.exitData))}},e.prototype.changeRes=function(t){this.bgSprite.spriteFrame=l.default.spriteFrameRes(t+"bg"),this.openSprite.spriteFrame=l.default.spriteFrameRes(t+"open"),this.closeSprite.spriteFrame=l.default.spriteFrameRes(t+"close")},e.prototype.disappear=function(){t.prototype.disappear.call(this),cc.tween(this.roof.node).to(.5+g.default.rand(),{scaleY:0}).start()},n([m],e)}(c.default));i.default=v,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/ExitData":"ExitData","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Player":"Player","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/Random":"Random","./Building":"Building"}],FallStone:[function(t,e,i){"use strict";cc._RF.push(e,"606fd8guh5COozFgkmej6tZ","FallStone");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("./Building"),l=t("../utils/AudioPlayer"),c=t("../data/FromData"),u=t("../logic/NonPlayer"),h=t("../utils/ActorUtils"),d=cc._decorator,p=d.ccclass,f=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFall=!1,e.isAuto=!0,e.isFalling=!1,e}return a(e,t),e.prototype.onLoad=function(){this.isFall=!1},e.prototype.fall=function(t){t&&(this.node.getChildByName("stone").getChildByName("fire").active=!0,this.node.getChildByName("stone").color=cc.color(253,122,37)),this.anim=this.getComponent(cc.Animation),this.anim.play(),this.isFalling=!0},e.prototype.FallFinish=function(){var t=this;l.default.play(l.default.BOOM),this.isFall=!0,this.scheduleOnce(function(){t.isFall=!1},.1),this.scheduleOnce(function(){t.node&&t.destroyEntityNode()},2)},e.prototype.onColliderEnter=function(t){!h.default.getEnemyCollisionTarget(t)||this.isAuto||this.isFalling||this.fall()},e.prototype.onColliderStay=function(t){var e=h.default.getEnemyCollisionTarget(t);e&&this.isFall&&this.isValid&&(this.isFall=!1,e.takeDamage(new r.default(2),c.default.getClone("\u843d\u77f3","stone")));var i=t.getComponent(u.default);i&&this.isFall&&this.isValid&&(this.isFall=!1,i.takeDamage(new r.default(2)))},n([p],e)}(s.default));i.default=f,cc._RF.pop()},{"../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/NonPlayer":"NonPlayer","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","./Building":"Building"}],FireGhost:[function(t,e,i){"use strict";cc._RF.push(e,"63945bTi0VH3q4BT6nw6+98","FireGhost");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../manager/StatusManager"),l=t("../data/FromData"),c=t("../logic/Logic"),u=t("../utils/IndexZ"),h=t("../utils/ActorUtils"),d=t("../base/BaseColliderComponent"),p=cc._decorator,f=p.ccclass,g=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isRotating=!1,e.isAttacking=!1,e.angleOffset=0,e.angle=0,e.isDied=!1,e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this)},e.prototype.start=function(){},e.prototype.init=function(t,e){var i=this;this.player=t,this.node.setPosition(t.node.position.clone()),this.node.zIndex=u.default.OVERHEAD,this.angleOffset=e,this.scheduleOnce(function(){i.node.setPosition(i.getPlayerFarPosition(i.player,50,i.angle+i.angleOffset)),i.isRotating=!0},.2)},e.prototype.getPlayerFarPosition=function(t,e,i){var o=t.Hv.clone(),a=cc.v3(cc.v2(o).rotateSelf(i*Math.PI/180).mul(e));return t.node.position.clone().addSelf(cc.v3(8,48).addSelf(a))},e.prototype.onColliderEnter=function(t,e){e.radius>0&&this.isAttacking&&this.isRotating&&h.default.getEnemyCollisionTarget(t,!0)&&(this.isAttacking=!1,this.attacking(t.node))},e.prototype.attacking=function(t){if(t){var e=new r.default,i=s.default.BURNING;e.magicDamage=1;var o=h.default.getEnemyActorByNode(t,!0);o&&!o.sc.isDied&&(o.takeDamage(e),o.addStatus(i,new l.default)),this.isDied=!0,cc.director.emit("destoryfireghost",{detail:{coinNode:this.node}})}},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.2&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){if(!c.default.isGamePause&&this.isCheckTimeDelay(t)){var e=this.hasNearEnemy();if(e.equals(cc.Vec3.ZERO))this.isRotating&&this.player&&(this.angle+=5,this.angle>360&&(this.angle=0),i=(e=this.getPlayerFarPosition(this.player,50,this.angle+this.angleOffset)).sub(this.node.position).normalizeSelf().mulSelf(200),this.entity.Move.linearVelocity=cc.v2(i.x,i.y));else{this.isAttacking=!0;var i=e.normalizeSelf().mulSelf(400);this.entity.Move.linearVelocity=cc.v2(i.x,i.y)}}},e.prototype.hasNearEnemy=function(){return this.player&&this.isRotating?h.default.getDirectionFromNearestEnemy(this.player.node.position,!1,this.player.dungeon,!1,400):cc.Vec3.ZERO},n([f],e)}(d.default));i.default=g,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/Logic":"Logic","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/IndexZ":"IndexZ"}],FloatingLabelManager:[function(t,e,i){"use strict";cc._RF.push(e,"70be4qc1pdJGpxF0vSkBTb1","FloatingLabelManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../ui/FloatingLabel"),s=t("../utils/IndexZ"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}return a(e,t),e.prototype.clear=function(){},e.prototype.onLoad=function(){var t=this;this.labelPool=new cc.NodePool,cc.director.on("destorylabel",function(e){t.destroyLabel(e.detail.labelNode)})},e.prototype.getFloaingLabel=function(t){var e=this.node.position.clone();e=this.node.convertToWorldSpaceAR(e),e=t.convertToNodeSpaceAR(e);var i=null;this.labelPool.size()>0&&(i=this.labelPool.get()),i&&!i.active||(i=cc.instantiate(this.label)),i.parent=t,i.position=e.clone();var o=i.getComponent(r.default);return i.zIndex=s.default.UI,i.opacity=255,i.active=!0,o},e.prototype.destroyLabel=function(t){t.active=!1,this.labelPool&&this.labelPool.put(t)},e.prototype.start=function(){},n([u(cc.Prefab)],e.prototype,"label",void 0),n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../ui/FloatingLabel":"FloatingLabel","../utils/IndexZ":"IndexZ"}],FloatingLabel:[function(t,e,i){"use strict";cc._RF.push(e,"cae6fbyiQhHL5VOrhWuq2d6","FloatingLabel");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.label=this.node.getChildByName("label").getComponent(cc.Label)},e.prototype.start=function(){},e.prototype.showLabel=function(t,e,i){i&&(i>3&&(i=3),this.node.scale=i);var o=this.node.scale;this.node.scale=1.5*o,this.label.node.opacity=255,this.label.node.position=cc.v3(0,0),this.label.string=t,this.label.node.color=e,this.anim.play("FontFloating"),cc.tween(this.node).to(.1,{scale:o}).start()},e.prototype.showMiss=function(){this.showLabel("\u4e22\u5931",cc.color(255,255,255),1)},e.prototype.showDoge=function(){this.showLabel("\u95ea\u907f",cc.color(255,255,255),1)},e.prototype.showBlock=function(){this.showLabel("\u683c\u6321",cc.color(211,211,211),1)},e.prototype.showAvoidDeath=function(){this.showLabel("\u683c\u6321\u81f4\u547d\u4f24",cc.color(255,0,0),5)},e.prototype.showDamage=function(t,e,i){var o=t<0?cc.color(255,0,0):cc.color(0,255,0),a=1;e&&(o=cc.color(255,255,0),a=2),i&&(o=cc.color(186,85,211));var n=Math.abs(t),r=parseFloat(t.toFixed(1));this.showLabel((t>0?"+":"")+(0!=r?r:""),o,a+n/50)},e.prototype.hideLabel=function(){this.node.active=!1,cc.director.emit("destorylabel",{detail:{labelNode:this.node}})},e.prototype.FloatingFinish=function(){this.hideLabel()},n([s],e)}(cc.Component));i.default=l,cc._RF.pop()},{}],FootBoard:[function(t,e,i){"use strict";cc._RF.push(e,"a20d6iwPAJLg7AtbBgYX0yS","FootBoard");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("./Building"),l=t("../utils/IndexZ"),c=t("../collider/CCollider"),u=cc._decorator,h=u.ccclass,d=u.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.openSpriteFrame=null,e.closeSpriteFrame=null,e.isOpen=!1,e.hasActive=!1,e.pos=cc.v3(0,0),e.timeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){this.spriteNode=this.node.getChildByName("sprite"),this.sprite=this.spriteNode.getComponent(cc.Sprite)},e.prototype.start=function(){},e.prototype.setPos=function(t){this.pos=t,this.entity.Transform.position=r.default.getPosInMap(t),this.node.position=this.entity.Transform.position.clone(),this.node.zIndex=l.default.FLOOR},e.prototype.openTrap=function(){this.isOpen||(this.isOpen=!0,this.sprite.spriteFrame=this.isOpen?this.openSpriteFrame:this.closeSpriteFrame)},e.prototype.onColliderEnter=function(t){t.tag==c.default.TAG.BUILDING&&(this.isOpen=!0,this.hasActive=!0),t.tag==c.default.TAG.PLAYER&&(this.isOpen=!0,this.hasActive=!0)},e.prototype.onColliderStay=function(t){t.tag==c.default.TAG.BUILDING&&(this.isOpen=!0,this.hasActive=!0),t.tag==c.default.TAG.PLAYER&&(this.isOpen=!0,this.hasActive=!0)},e.prototype.onColliderExit=function(t){t.tag==c.default.TAG.BUILDING&&(this.isOpen=!1),t.tag==c.default.TAG.PLAYER&&(this.isOpen=!1)},e.prototype.update=function(t){this.timeDelay+=t,this.timeDelay>.2&&(this.timeDelay=0,this.sprite.spriteFrame=this.isOpen?this.openSpriteFrame:this.closeSpriteFrame)},n([d(cc.SpriteFrame)],e.prototype,"openSpriteFrame",void 0),n([d(cc.SpriteFrame)],e.prototype,"closeSpriteFrame",void 0),n([h],e)}(s.default);i.default=p,cc._RF.pop()},{"../collider/CCollider":"CCollider","../logic/Dungeon":"Dungeon","../utils/IndexZ":"IndexZ","./Building":"Building"}],FromData:[function(t,e,i){"use strict";cc._RF.push(e,"cf8a1Noa0FD6qIEI4bqHV5c","FromData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.name="",this.res="",this.id=0}return t.prototype.valueCopy=function(t){t&&(this.name=t.name?t.name:"",this.res=t.res?t.res:"",this.id=t.id?t.id:0)},t.getClone=function(e,i,o){var a=new t;return a.name=e,a.res=i,a.id=o,a},t.prototype.clone=function(){var e=new t;return e.name=this.name,e.res=this.res,e.id=this.id,e},t}();i.default=o,cc._RF.pop()},{}],FsmEvent:[function(t,e,i){"use strict";cc._RF.push(e,"b77f3K+NxhBaYwLRNLbbGxg","FsmEvent"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(){},cc._RF.pop()},{}],FurnitureData:[function(t,e,i){"use strict";cc._RF.push(e,"995a0Fy66ZBko3/UdM2GS2a","FurnitureData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./InventoryData"),a=function(){function t(){this.id="",this.price=0,this.nameCn="",this.nameEn="",this.resName="",this.info="",this.desc="",this.scale=1,this.collider="",this.isOpen=!1,this.purchased=!1,this.storageList=[],this.storage=0}return t.prototype.valueCopy=function(t){if(t&&(this.id=t.id?t.id:"",this.purchased=t.purchased,this.price=t.price,this.nameCn=t.nameCn?t.nameCn:"",this.nameEn=t.nameEn?t.nameEn:"",this.resName=t.resName?t.resName:"",this.info=t.info?t.info:"",this.scale=t.scale?t.scale:1,this.collider=t.collider?t.collider:"",this.isOpen=t.isOpen,this.storage=t.storage?t.storage:0,this.storage>32&&(this.storage=32),t.storageList&&t.storage>0)){this.storageList=[];for(var e=0,i=t.storageList;e<i.length;e++){var a=i[e],n=new o.default;n.valueCopy(a),this.storageList.push(n)}}},t.prototype.clone=function(){var e=new t;if(e.purchased=this.purchased,e.scale=this.scale,e.price=this.price,e.nameCn=this.nameCn,e.nameEn=this.nameEn,e.info=this.info,e.scale=this.scale,e.collider=this.collider,e.isOpen=this.isOpen,e.resName=this.resName,e.id=this.id,e.storage=this.storage,this.storageList&&this.storage>0){e.storageList=[];for(var i=0,a=this.storageList;i<a.length;i++){var n=a[i],r=new o.default;r.valueCopy(n),e.storageList.push(r)}}return e},t}();i.default=a,cc._RF.pop()},{"./InventoryData":"InventoryData"}],Furniture:[function(t,e,i){"use strict";cc._RF.push(e,"12170bzXSpDtaz5MoM+l14L","Furniture");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./../logic/EventHelper"),s=t("../logic/Achievement"),l=t("../data/FurnitureData"),c=t("../logic/Dungeon"),u=t("../logic/Logic"),h=t("../ui/Tips"),d=t("../utils/AudioPlayer"),p=t("../utils/LocalStorage"),f=t("../utils/Utils"),g=t("./Building"),y=t("./RoomFishtank"),m=t("./RoomStool"),v=t("./RoomTv"),E=t("../collider/CCollider"),_=t("../utils/NextStep"),T=t("../data/InventoryData"),D=t("./RoomWaterDispenser"),S=t("./RoomTrashCan"),O=t("./RoomKitchen"),A=cc._decorator,C=A.ccclass,R=(A.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isOpening=!1,e.unlockStep=new _.default,e.bookStep=new _.default,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.boxcover=this.node.getChildByName("boxcover").getComponent(cc.Sprite),this.boxback=this.node.getChildByName("boxback").getComponent(cc.Sprite),this.lock=this.node.getChildByName("lock").getComponent(cc.Sprite),this.tips=this.getComponentInChildren(h.default),this.tips.onInteract(function(e,i){t.furnitureData&&(t.furnitureData.purchased?t.furnitureData.isOpen?t.interact(i):t.openBox():t.unlockStep.next(function(){t.getComponent(cc.Animation).play("FurnitureUnlock"),d.default.play(d.default.SELECT_FAIL),f.default.toast("\u6682\u672a\u89e3\u9501\uff0c\u8bf7\u4e0b\u5355\u8d2d\u4e70:-D",!0,!0),r.EventHelper.emit(r.EventHelper.HUD_CELLPHONE_SHOW)},3,!0))}),this.tips.onEnter(function(){t.furnitureData&&t.furnitureData.purchased&&t.furnitureData.isOpen&&t.onEnter()}),this.tips.onExit(function(){t.furnitureData&&t.furnitureData.purchased&&t.furnitureData.isOpen&&t.onExit()}),r.EventHelper.on(r.EventHelper.HUD_FURNITURE_REFRESH,function(e){t.node&&e.id==t.furnitureData.id&&t.init(t.furnitureData)})},e.prototype.interact=function(t){switch(this.furnitureData.id){case i.TV:var e=this.getComponent(v.default);e&&e.interact(t);break;case i.STOOL:var o=this.getComponent(m.default);o&&o.open();break;case i.FISHTANK:var a=this.getComponent(y.default);a&&a.feed(t);break;case i.WATERDISPENER:var n=this.getComponent(D.default);n&&n.getWater(t);break;case i.CUPBOARD:if(this.furnitureData.storageList.length<1){for(var s=0;s<this.furnitureData.storage;s++)this.furnitureData.storageList.push(new T.default);p.default.saveFurnitureData(this.furnitureData)}r.EventHelper.emit(r.EventHelper.HUD_INVENTORY_SHOW,{id:this.furnitureData.id});break;case i.LITTLE_TABLE_2:f.default.toast("\u73b0\u5728\u662f"+f.default.getYear(u.default.realTime)+f.default.getDay(u.default.realTime)+f.default.getHour(u.default.realTime),!1,!0);break;case i.TRASHCAN:var l=this.getComponent(S.default);l&&l.getTrash();break;case i.BOOKSHELF:this.bookStep.next(function(){t.read()},5);break;case i.COOKING_BENCH:var c=this.getComponent(O.default);c&&c.getFood(t);break;case i.DOLL_MACHINE:r.EventHelper.emit(r.EventHelper.HUD_DOLL_MACHINE_DIALOG);break;default:d.default.play(d.default.SELECT_FAIL),f.default.toast("\u68a6\u5883\u5f00\u53d1\u4e2d,\u65e0\u6cd5\u4f7f\u7528\u3002")}},e.prototype.onEnter=function(){switch(this.furnitureData.id){case i.FISHTANK:var t=this.getComponent(y.default);t&&t.zoomCamera(!0);break;case i.LITTLE_TABLE_2:case i.WATERDISPENER:case i.TRASHCAN:this.zoomCamera(!0)}},e.prototype.onExit=function(){switch(this.furnitureData.id){case i.FISHTANK:var t=this.getComponent(y.default);t&&t.zoomCamera(!1);break;case i.TV:var e=this.getComponent(v.default);e&&e.close();break;case i.LITTLE_TABLE_2:case i.WATERDISPENER:case i.TRASHCAN:this.zoomCamera(!1)}},e.prototype.init=function(t){var e=p.default.getFurnitureData(t.id);if(e&&(t.isOpen=e.isOpen,t.purchased=e.purchased,t.storage=e.storage?e.storage:t.storage,e.storageList&&e.storageList.length>0&&(t.storageList=e.storageList)),t.price<=0&&(t.isOpen=!0,t.purchased=!0),this.furnitureData=new l.default,this.furnitureData.valueCopy(t),u.default.inventoryManager.furnitureMap.set(t.id,this.furnitureData),this.furnitureData.purchased?(this.sprite.node.color=cc.color(255,255,255,255),this.lock.node.active=!1,this.furnitureData.isOpen?(this.boxcover.node.active=!1,this.boxback.node.active=!1):(this.boxcover.node.active=!0,this.boxback.node.active=!0)):(this.sprite.node.color=cc.color(128,128,128,255),this.sprite.node.opacity=128,this.boxcover.node.active=!1,this.boxback.node.active=!1,this.lock.node.active=!0),this.changeRes(this.furnitureData.resName),this.isNormal()&&this.furnitureData.collider.length>0){var i=this.furnitureData.collider.split(","),o=this.getComponent(E.default);o.offset=cc.v2(parseInt(i[0]),parseInt(i[1])),o.setSize(cc.size(parseInt(i[2]),parseInt(i[3])))}p.default.saveFurnitureData(this.furnitureData),s.default.addFurnituresAchievement(this.furnitureData.id)},e.prototype.isNormal=function(){return this.furnitureData.id!=i.STOOL&&this.furnitureData.id!=i.TV&&this.furnitureData.id!=i.SOFA&&this.furnitureData.id!=i.COOKING_BENCH&&this.furnitureData.id!=i.FISHTANK},e.prototype.changeRes=function(t){var e=u.default.spriteFrameRes(t);if(e&&this.isNormal()){this.sprite.spriteFrame=e,this.sprite.node.width=e.getOriginalSize().width,this.sprite.node.height=e.getOriginalSize().height,this.boxback.node.width=e.getOriginalSize().width,this.boxback.node.height=e.getOriginalSize().height,this.boxcover.node.width=e.getOriginalSize().width,this.boxcover.node.height=e.getOriginalSize().height,this.sprite.node.scale=this.furnitureData.scale,this.tips.node.scale=2,this.boxback.node.scale=this.furnitureData.scale,this.boxcover.node.scale=this.furnitureData.scale;var i=this.sprite.node.width*this.sprite.node.scale,o=this.sprite.node.height*this.sprite.node.scale;this.tips.node.position=cc.v3(i/2-c.default.TILE_SIZE/2,o-c.default.TILE_SIZE/2),this.lock.node.position=cc.v3(i/2-c.default.TILE_SIZE/2,o/2-c.default.TILE_SIZE/2);var a=this.tips.node.getComponent(E.default);a.radius=i>o?o/2:i/2,i>o?(a.radius=o/2,a.offset=cc.v2(0,-o/2)):(a.radius=i/2,a.offset=cc.v2(0,-o+i))}},e.prototype.zoomCamera=function(t){r.EventHelper.emit(t?r.EventHelper.HUD_CAMERA_ZOOM_IN:r.EventHelper.HUD_CAMERA_ZOOM_OUT)},e.prototype.openBox=function(){this.furnitureData.isOpen||(this.furnitureData.isOpen=!0,p.default.saveFurnitureData(this.furnitureData),this.anim.play("FurnitureOpen"))},e.prototype.start=function(){this.changeRes(this.furnitureData.resName)},e.SOFA="furniture001",e.BATH="furniture002",e.DINNER_TABLE="furniture003",e.WASHING_MACHINE="furniture004",e.COOKING_BENCH="furniture005",e.DOLL_MACHINE="furniture006",e.COOKING_BENCH_2="furniture007",e.COOKING_BENCH_3="furniture008",e.FRIDGE="furniture009",e.DESK="furniture010",e.CUPBOARD="furniture011",e.LITTLE_TABLE="furniture012",e.LITTLE_TABLE_1="furniture013",e.LITTLE_TABLE_2="furniture014",e.STOOL="furniture015",e.TV="furniture016",e.FISHTANK="furniture017",e.BOOKSHELF="furniture018",e.WATERDISPENER="furniture019",e.TRASHCAN="furniture020",i=n([C],e)}(g.default));i.default=R,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/FurnitureData":"FurnitureData","../data/InventoryData":"InventoryData","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../ui/Tips":"Tips","../utils/AudioPlayer":"AudioPlayer","../utils/LocalStorage":"LocalStorage","../utils/NextStep":"NextStep","../utils/Utils":"Utils","./../logic/EventHelper":"EventHelper","./Building":"Building","./RoomFishtank":"RoomFishtank","./RoomKitchen":"RoomKitchen","./RoomStool":"RoomStool","./RoomTrashCan":"RoomTrashCan","./RoomTv":"RoomTv","./RoomWaterDispenser":"RoomWaterDispenser"}],GameFinish:[function(t,e,i){"use strict";cc._RF.push(e,"98577N+o/RGi4cE+Wsz8Pp4","GameFinish");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Logic"),s=t("./WxHelper"),l=t("./EventHelper"),c=t("../utils/AudioPlayer"),u=t("../ui/StartBackground"),h=cc._decorator,d=h.ccclass,p=h.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wxhelper=null,e.level=null,e.clock=null,e}return a(e,t),e.prototype.start=function(){this.clock&&(this.clock.string=""+r.default.time),this.level&&(this.level.string="Level "+(r.default.chapterIndex+1)+"-"+r.default.level)},e.prototype.retry=function(){r.default.resetData(),cc.director.emit(l.EventHelper.PLAY_AUDIO,{detail:{name:c.default.SELECT}});var t=this.getComponentInChildren(u.default);t&&t.startPressed(),this.scheduleOnce(function(){cc.director.loadScene("loading")},1)},e.prototype.home=function(){this.wxhelper&&this.wxhelper.CloseDialog(),cc.director.emit(l.EventHelper.PLAY_AUDIO,{detail:{name:c.default.SELECT}});var t=this.getComponentInChildren(u.default);t&&t.startPressed(),this.scheduleOnce(function(){cc.director.loadScene("start")},1)},n([p(s.default)],e.prototype,"wxhelper",void 0),n([p(cc.Label)],e.prototype,"level",void 0),n([p(cc.Label)],e.prototype,"clock",void 0),n([d],e)}(cc.Component);i.default=f,cc._RF.pop()},{"../ui/StartBackground":"StartBackground","../utils/AudioPlayer":"AudioPlayer","./EventHelper":"EventHelper","./Logic":"Logic","./WxHelper":"WxHelper"}],GameHud:[function(t,e,i){"use strict";cc._RF.push(e,"34bc5nmZdpM3J3SaZigF3c3","GameHud");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./../logic/EventHelper"),s=t("./PlayerInfoDialog"),l=t("../logic/HealthBar"),c=t("../data/PlayerData"),u=t("../logic/Logic"),h=t("./dialog/SettingsDialog"),d=t("./dialog/MartShelvesDialog"),p=t("./dialog/InventoryDialog"),f=t("../utils/AudioPlayer"),g=t("./SatietyView"),y=t("./dialog/DollMachineDialog"),m=cc._decorator,v=m.ccclass,E=m.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.healthBar=null,e.dreamBar=null,e.bossHealthBar=null,e.playerInfoDialog=null,e.level=null,e.clock=null,e.damageCorner=null,e.pasueButton=null,e.zoomButton=null,e.settingsDialog=null,e.martShelvesDialog=null,e.completeLabel=null,e.oilGoldLabel=null,e.inventoryDialog=null,e.followArrows=null,e.satietyView=null,e.dollMachineDialog=null,e.AmmoLabel=null,e.arrowList=[],e.isCompleteShowed=!1,e.checkTimeDelay=0,e.startCountTime=!0,e.hour=0,e.minute=0,e.second=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this;r.EventHelper.on(r.EventHelper.HUD_UPDATE_PLAYER_INFODIALOG,function(e){var i=new c.default;i.valueCopy(e.data),t.statusUpdate(i)}),r.EventHelper.on(r.EventHelper.HUD_UPDATE_PLAYER_HEALTHBAR,function(e){t.healthBarUpdate(e.x,e.y)}),r.EventHelper.on(r.EventHelper.HUD_UPDATE_PLAYER_DREAMBAR,function(e){t.dreamBarUpdate(e.x,e.y)}),r.EventHelper.on(r.EventHelper.HUD_SHAKE_PLAYER_DREAMBAR,function(){t.dreamBar&&t.dreamBar.shake()}),r.EventHelper.on(r.EventHelper.HUD_UPDATE_PLAYER_LIFE_BAR,function(e){t.lifeBarUpdate(e.sanity,e.solid,e.poo,e.liquid,e.pee)}),r.EventHelper.on(r.EventHelper.HUD_DAMAGE_CORNER_SHOW,function(){t.showDamageCorner(),t.healthBar&&t.healthBar.shake()}),r.EventHelper.on(r.EventHelper.HUD_MART_SHELVES_DIALOG,function(e){t.showMartShelvesDialog(e.type,e.goodsNameList)}),r.EventHelper.on(r.EventHelper.HUD_COMPLETE_SHOW,function(e){t.showComplete(e.map)}),r.EventHelper.on(r.EventHelper.HUD_OILGOLD_LOSE_SHOW,function(){t.showOilGoldInfo(!0)}),r.EventHelper.on(r.EventHelper.HUD_OILGOLD_RECOVERY_SHOW,function(){t.showOilGoldInfo(!1)}),r.EventHelper.on(r.EventHelper.HUD_INVENTORY_SHOW,function(e){t.showInventoryDialog(e.id)}),r.EventHelper.on(r.EventHelper.HUD_CANCEL_OR_PAUSE,function(){t.cancelOrPause()}),r.EventHelper.on(r.EventHelper.HUD_STOP_COUNTTIME,function(){t.startCountTime=!1}),r.EventHelper.on(r.EventHelper.HUD_FADE_IN,function(){t.fadeIn()}),r.EventHelper.on(r.EventHelper.HUD_FADE_OUT,function(){t.fadeOut()}),r.EventHelper.on(r.EventHelper.HUD_DOLL_MACHINE_DIALOG,function(){t.showDollMachineDialog()}),r.EventHelper.on(r.EventHelper.HUD_UPDATE_PLAYER_AMMO,function(e){t.ammoUpdate(e.x,e.y)}),this.clock&&(this.clock.string=""+u.default.time),this.level&&(this.level.string=""+u.default.worldLoader.getCurrentLevelData().name),this.damageCorner&&(this.damageCorner.opacity=0),this.pasueButton.on(cc.Node.EventType.TOUCH_START,function(){t.pauseGame()}),this.zoomButton.on(cc.Node.EventType.TOUCH_START,function(){r.EventHelper.emit(r.EventHelper.HUD_CAMERA_ZOOM_IN,{})}),this.zoomButton.on(cc.Node.EventType.TOUCH_END,function(){r.EventHelper.emit(r.EventHelper.HUD_CAMERA_ZOOM_OUT,{})}),this.zoomButton.on(cc.Node.EventType.TOUCH_CANCEL,function(){r.EventHelper.emit(r.EventHelper.HUD_CAMERA_ZOOM_OUT,{}),r.EventHelper.emit(r.EventHelper.TEST_SHOW_NODE_COUNT)});var e=u.default.playerData.FinalCommon;this.healthBarUpdate(u.default.playerData.currentHealth,u.default.playerData.getHealth(e).y),this.dreamBarUpdate(u.default.playerData.currentDream,u.default.playerData.getDream(e).y),this.ammoUpdate(u.default.playerData.currentAmmo,e.maxAmmo),this.fadeIn(),this.initFollowArrows()},e.prototype.initFollowArrows=function(){this.arrowList.push(this.followArrows.getChildByName("arrow0")),this.arrowList.push(this.followArrows.getChildByName("arrow1")),this.arrowList.push(this.followArrows.getChildByName("arrow2")),this.arrowList.push(this.followArrows.getChildByName("arrow3"));for(var t=0,e=this.arrowList;t<e.length;t++)e[t].active=!1},e.prototype.showOilGoldInfo=function(t){var e=this;if(this.oilGoldLabel){t||f.default.play(f.default.COMPLETE);var i=t?["\u788e","\u788e\u7247","\u788e\u7247\u4e22","\u788e\u7247\u4e22\u5931","\u788e\u7247\u4e22\u5931","\u788e\u7247\u4e22\u5931","\u788e\u7247\u4e22\u5931","\u788e\u7247\u4e22\u5931","\u788e\u7247\u4e22\u5931","\u788e\u7247\u4e22\u5931","\u788e\u7247\u4e22","\u788e\u7247","\u788e",""]:["\u788e","\u788e\u7247","\u788e\u7247\u627e","\u788e\u7247\u627e\u56de","\u788e\u7247\u627e\u56de","\u788e\u7247\u627e\u56de","\u788e\u7247\u627e\u56de","\u788e\u7247\u627e\u56de","\u788e\u7247\u627e\u56de","\u788e\u7247\u627e\u56de","\u788e\u7247\u627e","\u788e\u7247","\u788e",""],o=0;this.oilGoldLabel.string="",this.oilGoldLabel.unscheduleAllCallbacks(),this.oilGoldLabel.schedule(function(){o<i.length&&(e.oilGoldLabel.string=i[o++])},.15,i.length)}},e.prototype.showComplete=function(t){var e=this;if(this.completeLabel&&!this.isCompleteShowed){f.default.play(f.default.COMPLETE);var i=["\u6e05","\u6e05\u7406","\u6e05\u7406\u5b8c","\u6e05\u7406\u5b8c\u6210","\u6e05\u7406\u5b8c\u6210","\u6e05\u7406\u5b8c\u6210","\u6e05\u7406\u5b8c\u6210","\u6e05\u7406\u5b8c\u6210","\u6e05\u7406\u5b8c\u6210","\u6e05\u7406\u5b8c\u6210","\u6e05\u7406\u5b8c","\u6e05\u7406","\u6e05",""],o=0;if(this.completeLabel.string="",this.completeLabel.unscheduleAllCallbacks(),this.isCompleteShowed=!0,this.completeLabel.schedule(function(){o<i.length&&(e.completeLabel.string=i[o++])},.1,i.length,.5),t&&t.size>0)for(var a=0;a<4;a++)t.has(a)?(this.arrowList[a].active=!0,this.arrowList[a].getChildByName("sprite").color=t.get(a)?cc.Color.WHITE:cc.color(55,55,55,255)):this.arrowList[a].active=!1}},e.prototype.fadeOut=function(){this.node&&(this.node.opacity=255,cc.tween(this.node).to(.5,{opacity:0}).start())},e.prototype.fadeIn=function(){this.node&&(this.node.opacity=0,cc.tween(this.node).to(3,{opacity:255}).start())},e.prototype.statusUpdate=function(t){this.playerInfoDialog&&this.playerInfoDialog.refreshDialog(t,t.EquipmentTotalData,t.StatusTotalData)},e.prototype.showDamageCorner=function(){this.damageCorner&&(this.damageCorner.stopAllActions(),this.damageCorner.opacity=255,this.damageCorner.scale=1,cc.tween(this.damageCorner).parallel(cc.tween(this.damageCorner).to(.5,{scale:1.05}),cc.tween(this.damageCorner).to(1,{opacity:0})).start())},e.prototype.ammoUpdate=function(t,e){this.AmmoLabel&&(this.AmmoLabel.string=(t<=0?"-":t)+"/"+(e<=0?"-":e),cc.tween(this.AmmoLabel.node).to(.05,{scale:1.05}).to(.05,{scale:.95}).to(.1,{scale:1.05}).to(.05,{scale:1}).start())},e.prototype.healthBarUpdate=function(t,e){this.healthBar&&this.healthBar.refreshHealth(t,e)},e.prototype.dreamBarUpdate=function(t,e){this.dreamBar&&this.dreamBar.refreshHealth(t,e)},e.prototype.lifeBarUpdate=function(t,e,i,o,a){this.satietyView&&this.satietyView.refreshPercent(t,e,i,o,a)},e.prototype.start=function(){var t=u.default.time.split(":");this.hour=parseInt(t[0]),this.minute=parseInt(t[1]),this.second=parseInt(t[2])},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.isCheckTimeDelay(t)&&this.clock&&this.startCountTime&&(this.changeTime(),this.clock.string=""+u.default.time),this.settingsDialog.node.active||this.martShelvesDialog.node.active||this.dollMachineDialog.node.active?u.default.isGamePause=!0:u.default.isGamePause=!1},e.prototype.useItem=function(){},e.prototype.changeTime=function(){if(!u.default.isGamePause){this.second=this.second+1,this.second>=60&&(this.second=0,this.minute=this.minute+1),this.minute>=60&&(this.minute=0,this.hour=this.hour+1);var t=""+this.hour;t=t.length>1?t:"0"+t;var e=""+this.minute;e=e.length>1?e:"0"+e;var i=""+this.second;i=i.length>1?i:"0"+i,u.default.time=t+":"+e+":"+i,u.default.realTime=u.default.realTime+1e4,r.EventHelper.emit(r.EventHelper.HUD_TIME_TICK)}},e.prototype.cancelOrPause=function(){this.node&&(this.inventoryDialog.isShow?this.inventoryDialog.dismiss():this.martShelvesDialog.isShow?this.martShelvesDialog.dismiss():this.dollMachineDialog.isShow?this.dollMachineDialog.dismiss():this.showSettingsDialog())},e.prototype.pauseGame=function(){f.default.play(f.default.SELECT),this.showSettingsDialog()},e.prototype.showInventoryDialog=function(t){this.node&&(this.inventoryDialog.isShow?this.inventoryDialog.dismiss():t&&t.length>0?this.inventoryDialog.showFurniture(t):this.inventoryDialog.show())},e.prototype.showSettingsDialog=function(){var t=this;this.node&&(this.settingsDialog.isShow?(this.settingsDialog.dismiss(),cc.director.getScheduler().setTimeScale(1)):(this.scheduleOnce(function(){t.settingsDialog.isShow&&!t.settingsDialog.isAniming?cc.director.getScheduler().setTimeScale(0):cc.director.getScheduler().setTimeScale(1)},1),this.settingsDialog.show()))},e.prototype.showMartShelvesDialog=function(t,e){this.martShelvesDialog&&(this.martShelvesDialog.isShow?this.martShelvesDialog.dismiss():(this.martShelvesDialog.updateUI(t,e),this.martShelvesDialog.show()))},e.prototype.showDollMachineDialog=function(){this.dollMachineDialog&&(this.dollMachineDialog.isShow?this.dollMachineDialog.dismiss():this.dollMachineDialog.show())},n([E(l.default)],e.prototype,"healthBar",void 0),n([E(l.default)],e.prototype,"dreamBar",void 0),n([E(l.default)],e.prototype,"bossHealthBar",void 0),n([E(s.default)],e.prototype,"playerInfoDialog",void 0),n([E(cc.Label)],e.prototype,"level",void 0),n([E(cc.Label)],e.prototype,"clock",void 0),n([E(cc.Node)],e.prototype,"damageCorner",void 0),n([E(cc.Node)],e.prototype,"pasueButton",void 0),n([E(cc.Node)],e.prototype,"zoomButton",void 0),n([E(h.default)],e.prototype,"settingsDialog",void 0),n([E(d.default)],e.prototype,"martShelvesDialog",void 0),n([E(cc.Label)],e.prototype,"completeLabel",void 0),n([E(cc.Label)],e.prototype,"oilGoldLabel",void 0),n([E(p.default)],e.prototype,"inventoryDialog",void 0),n([E(cc.Node)],e.prototype,"followArrows",void 0),n([E(g.default)],e.prototype,"satietyView",void 0),n([E(y.default)],e.prototype,"dollMachineDialog",void 0),n([E(cc.Label)],e.prototype,"AmmoLabel",void 0),n([v],e)}(cc.Component);i.default=_,cc._RF.pop()},{"../data/PlayerData":"PlayerData","../logic/HealthBar":"HealthBar","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer","./../logic/EventHelper":"EventHelper","./PlayerInfoDialog":"PlayerInfoDialog","./SatietyView":"SatietyView","./dialog/DollMachineDialog":"DollMachineDialog","./dialog/InventoryDialog":"InventoryDialog","./dialog/MartShelvesDialog":"MartShelvesDialog","./dialog/SettingsDialog":"SettingsDialog"}],GameOver:[function(t,e,i){"use strict";cc._RF.push(e,"0e28bkl25dNTqUQmquXpqGi","GameOver");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Logic"),s=t("../utils/AudioPlayer"),l=t("../utils/Random"),c=t("../data/ExitData"),u=t("../utils/LocalStorage"),h=cc._decorator,d=h.ccclass,p=h.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.info=null,e.infoIcon=null,e.level=null,e.clock=null,e.tips=null,e.tipsStr="",e}var i;return a(e,t),i=e,e.prototype.start=function(){var t=this,e=u.default.getAchievementData();this.clock&&(this.clock.string="\u5b58\u6d3b\u65f6\u95f4\uff1a"+r.default.time),this.level&&(this.level.string="");var o="\u6b7b\u4e8e\u975e\u547d";if(r.default.dieFrom.name.length>0&&(o="\u7b2c"+e.playerLifes+"\u6b21\u6b7b\u4ea1\uff0c\u5728 "+r.default.worldLoader.getCurrentLevelData().name+" \u88ab "+r.default.dieFrom.name+" \u51fb\u5012"),this.infoIcon&&r.default.dieFrom.res.length>0&&(this.infoIcon.spriteFrame=r.default.spriteFrameRes(r.default.dieFrom.res),this.infoIcon.node.width=64,this.infoIcon.node.height=64/this.infoIcon.spriteFrame.getOriginalSize().width*this.infoIcon.spriteFrame.getOriginalSize().height),this.info&&(this.info.string=o),this.tips){var a=0;this.tips.string="";var n=i.TIPS[l.default.getRandomNum(0,i.TIPS.length-1)];this.schedule(function(){++a>n.length&&(a=n.length),t.tips.string=n.substr(0,a)},.05,n.length,.2)}},e.prototype.retry=function(){r.default.resetData(),s.default.play(s.default.SELECT),r.default.loadingNextLevel(c.default.getRealWorldExitDataFromDream(r.default.chapterIndex,r.default.level))},e.prototype.home=function(){s.default.play(s.default.SELECT),cc.director.loadScene("start")},e.prototype.resetWorld=function(){s.default.play(s.default.SELECT),cc.director.loadScene("start"),r.default.profileManager.clearData()},e.TIPS=["\u5f53\u4f60\u51dd\u89c6\u6df1\u6e0a\u7684\u65f6\u5019,\u6df1\u6e0a\u4e5f\u5728\u51dd\u89c6\u7740\u4f60","\u4e0a\u9501\u7684\u95e8\u9700\u8981\u4ece\u53e6\u4e00\u9762\u624d\u80fd\u6253\u5f00","\u68a6\u9192\u53ef\u4ee5\u8eba\u5728\u5e8a\u4e0a\u56de\u5230\u4e0a\u4e00\u4e2a\u7fe0\u91d1\u70b9","\u76fe\u724c\u53ef\u4ee5\u683c\u6321\u5b50\u5f39\uff0c\u751a\u81f3\u5f39\u53cd\u5bf9\u9762","\u7fe0\u6e56\u7684\u6c34\u5f88\u51b0\u51b7","\u5408\u7406\u4f7f\u7528\u7269\u54c1\u6765\u589e\u5f3a\u81ea\u5df1","\u4f60\u6c89\u6c89\u5730\u7761\u7740\u4e86","\u7535\u773c\u4f1a\u9ebb\u75f9\u4f60\u7684\u601d\u7ef4","\u7fe0\u91d1\u70b9\u662f\u7528\u6765\u81ea\u52a8\u4fdd\u5b58\u8fdb\u5ea6\u7684","\u6fc0\u5149\u6709\u4e00\u4e2a\u77ed\u6682\u7684\u7784\u51c6\u671f\uff0c\u6293\u4f4f\u673a\u4f1a\u518d\u8865\u4e00\u5200","\u51b0\u9b54\u7684\u523a\u4f1a\u963b\u6321\u4f60\u7684\u884c\u52a8","\u6b66\u58eb\u5200\u53ef\u4ee5\u53cd\u51fb\u5b50\u5f39","\u4f60\u7684\u5934\u76d6\u9aa8\u88ab\u505a\u6210\u4e86\u7897","\u5e7d\u5149\u5728\u547c\u5524\u7740\u4f60"],n([p(cc.Label)],e.prototype,"info",void 0),n([p(cc.Sprite)],e.prototype,"infoIcon",void 0),n([p(cc.Label)],e.prototype,"level",void 0),n([p(cc.Label)],e.prototype,"clock",void 0),n([p(cc.Label)],e.prototype,"tips",void 0),i=n([d],e)}(cc.Component);i.default=f,cc._RF.pop()},{"../data/ExitData":"ExitData","../utils/AudioPlayer":"AudioPlayer","../utils/LocalStorage":"LocalStorage","../utils/Random":"Random","./Logic":"Logic"}],GameWorldSystem:[function(t,e,i){"use strict";cc._RF.push(e,"a00e4kRmPFPe6A8ApaCWdtB","GameWorldSystem");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("../ECS"),r=t("./ColliderSystem"),s=t("./MoveSystem"),l=function(t){function e(i,o,a){var n=t.call(this)||this;return e.colliderSystem=new r.default(i,o,a),n.add(e.colliderSystem),n.add(new s.default),n}return a(e,t),e}(n.ecs.RootSystem);i.default=l,cc._RF.pop()},{"../ECS":"ECS","./ColliderSystem":"ColliderSystem","./MoveSystem":"MoveSystem"}],GameWorld:[function(t,e,i){"use strict";cc._RF.push(e,"cf0d2aiaG9EvZLNdlduf8fH","GameWorld");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.start=function(){},n([s],e)}(cc.Component));i.default=l,cc._RF.pop()},{}],Game:[function(t,e,i){"use strict";cc._RF.push(e,"c30ffLX6hVIjoNslRhRCM7w","Game");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Dungeon"),s=t("./Logic"),l=t("../ui/GameHud"),c=t("../utils/LocalStorage"),u=cc._decorator,h=u.ccclass,d=(u.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.onLoad=function(){s.default.settings.showSoftShadow=c.default.isSwitchOpen(c.default.KEY_SWITCH_SHOW_SOFT_SHADOW),s.default.settings.showGamepad=c.default.isSwitchOpen(c.default.KEY_SWITCH_SHOW_GAMEPAD),s.default.settings.showEquipDialog=c.default.isSwitchOpen(c.default.KEY_SWITCH_SHOW_EQUIPDIALOG),cc.director.getScheduler().setTimeScale(1)},Object.defineProperty(e.prototype,"Dungeon",{get:function(){return this.dungeonBase||(this.dungeonBase=this.getComponentInChildren(r.default)),this.dungeonBase},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hud",{get:function(){return this.hudBase||(this.hudBase=this.getComponentInChildren(l.default)),this.hudBase},enumerable:!1,configurable:!0}),e.prototype.update=function(){this.node},n([h],e)}(cc.Component));i.default=d,cc._RF.pop()},{"../ui/GameHud":"GameHud","../utils/LocalStorage":"LocalStorage","./Dungeon":"Dungeon","./Logic":"Logic"}],GoodsData:[function(t,e,i){"use strict";cc._RF.push(e,"9eba4cjM5REaKZZ0yKseRh9","GoodsData");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("./BaseData"),r=t("./ItemData"),s=function(t){function e(){var e=t.call(this)||this;return e.uuid="",e.count=10,e.item=new r.default,e}return a(e,t),e.prototype.valueCopy=function(t){this.uuid=t.uuid?t.uuid:"",this.count=t.count?t.count:this.count,this.item.valueCopy(t.item)},e.prototype.clone=function(){var t=new e;return t.uuid=this.uuid,t.count=this.count,t.item=this.item.clone(),t},e}(n.default);i.default=s,cc._RF.pop()},{"./BaseData":"BaseData","./ItemData":"ItemData"}],Goods:[function(t,e,i){"use strict";cc._RF.push(e,"1cb63YYvfBC97O0f5MEeafg","Goods");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/GoodsData"),s=t("../logic/EventHelper"),l=t("../logic/Logic"),c=t("../utils/AudioPlayer"),u=cc._decorator,h=u.ccclass,d=u.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.data=new r.default,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.sprite1=this.node.getChildByName("sprite1").getComponent(cc.Sprite),this.sprite2=this.node.getChildByName("sprite2").getComponent(cc.Sprite),this.sprite3=this.node.getChildByName("sprite3").getComponent(cc.Sprite),this.node.on(cc.Node.EventType.TOUCH_END,function(){s.EventHelper.emit(s.EventHelper.HUD_MART_SHELVES_DIALOG_PAY,{data:t.data}),c.default.play(c.default.SELECT)})},e.prototype.init=function(t){this.data=t,this.updateSprite()},e.prototype.updateSprite=function(){this.sprite1||(this.sprite1=this.node.getChildByName("sprite1").getComponent(cc.Sprite),this.sprite2=this.node.getChildByName("sprite2").getComponent(cc.Sprite),this.sprite3=this.node.getChildByName("sprite3").getComponent(cc.Sprite)),this.sprite1.node.opacity=255,this.sprite2.node.opacity=255,this.sprite3.node.opacity=255,this.sprite1.spriteFrame=l.default.spriteFrameRes(this.data.item.resName),this.sprite2.spriteFrame=l.default.spriteFrameRes(this.data.item.resName),this.sprite3.spriteFrame=l.default.spriteFrameRes(this.data.item.resName),this.sprite1.node.width=this.sprite1.spriteFrame.getRect().width,this.sprite2.node.width=this.sprite2.spriteFrame.getRect().width,this.sprite2.node.width=this.sprite2.spriteFrame.getRect().width,this.sprite1.node.height=this.sprite1.spriteFrame.getRect().height,this.sprite2.node.height=this.sprite2.spriteFrame.getRect().height,this.sprite2.node.height=this.sprite2.spriteFrame.getRect().height,this.label.string=this.data.item.nameCn+"\n$:"+this.data.item.price,2==this.data.count?this.sprite1.node.opacity=0:1==this.data.count?(this.sprite2.node.opacity=0,this.sprite1.node.opacity=0):this.data.count<=0&&(this.sprite1.node.opacity=0,this.sprite2.node.opacity=0,this.sprite3.node.opacity=0)},e.prototype.click=function(){},n([d(cc.Label)],e.prototype,"label",void 0),n([h],e)}(cc.Component);i.default=p,cc._RF.pop()},{"../data/GoodsData":"GoodsData","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer"}],GroundOilGoldData:[function(t,e,i){"use strict";cc._RF.push(e,"06da22NYo5DOLe6uR2c2v0D","GroundOilGoldData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.x=0,this.y=0,this.chapter=0,this.level=0,this.value=0}return t.prototype.valueCopy=function(t){t&&(this.x=t.x?t.x:0,this.y=t.y?t.y:0,this.chapter=t.chapter?t.chapter:0,this.level=t.level?t.level:0,this.value=t.value?t.value:0)},t.prototype.clone=function(){var e=new t;return e.x=this.x,e.y=this.y,e.chapter=this.chapter,e.level=this.level,e.value=this.value,e},t}();i.default=o,cc._RF.pop()},{}],HealthBar:[function(t,e,i){"use strict";cc._RF.push(e,"4298eVZsIJFhKykTJYXRBP0","HealthBar");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.backbar=null,e.label=null,e.isPlayer=!1,e.timeDelay=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.progressBar=this.getComponent(cc.ProgressBar),this.progressBar.progress=1},e.prototype.start=function(){},e.prototype.refreshHealth=function(t,e){this.progressBar&&(this.isPlayer&&(this.progressBar.totalLength=e*i.ICON_SIZE,this.node.width=this.progressBar.totalLength),this.progressBar.progress=t/e,this.label&&(this.label.string=parseFloat(t.toFixed(1))+"/"+e))},e.prototype.shake=function(){cc.tween(this.node).to(.05,{scale:1.05}).to(.05,{scale:.95}).to(.1,{scale:1.05}).to(.05,{scale:1}).start()},e.prototype.update=function(t){this.backbar.width=this.lerp(this.backbar.width,this.progressBar.barSprite.node.width,5*t)},e.prototype.lerp=function(t,e,i){return t+(e-t)*i},e.ICON_SIZE=17,n([l(cc.Node)],e.prototype,"backbar",void 0),n([l(cc.Label)],e.prototype,"label",void 0),n([l],e.prototype,"isPlayer",void 0),i=n([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{}],HitBuilding:[function(t,e,i){"use strict";cc._RF.push(e,"94f4daN5WxHhp3nfQbY7apH","HitBuilding");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Building"),s=t("../logic/Logic"),l=t("../logic/Dungeon"),c=t("../utils/IndexZ"),u=t("../utils/AudioPlayer"),h=t("../collider/CCollider"),d=cc._decorator,p=d.ccclass,f=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.resName="",e.itemNames=[],e.equipmentNames=[],e.isCustom=!1,e.colliderExtrude=0,e}return a(e,t),e.prototype.init=function(t,e,i,o,a,n,r,s,l){this.dungeon=t,this.resName=e,this.itemNames=i,this.equipmentNames=o,this.data.maxHealth=a,this.data.currentHealth=n,this.colliderExtrude=l,this.isCustom=s,this.sprite||(this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite)),this.sprite.node.scale=r,this.changeRes(e,""+this.data.currentHealth),this.data.currentHealth<=0&&(this.getComponent(h.default).sensor=!0)},e.prototype.hitLight=function(t){this.mat||(this.mat=this.node.getChildByName("sprite").getComponent(cc.Sprite).getMaterial(0)),this.mat.setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT)},e.prototype.setDefaultPos=function(t){this.data.defaultPos=t,this.entity.Transform.position=l.default.getPosInMap(t),this.node.position=this.entity.Transform.position.clone(),this.node.zIndex=c.default.getActorZIndex(this.entity.Transform.position)},e.prototype.takeDamage=function(){var t=this;if(this.data.currentHealth<=0||this.data.currentHealth>=9999)return!1;var e=[u.default.MONSTER_HIT,u.default.MONSTER_HIT1,u.default.MONSTER_HIT2];if(u.default.play(e[s.default.getRandomNum(0,2)]),this.data.currentHealth-=1,this.changeRes(this.resName,""+this.data.currentHealth),this.hitLight(!0),this.scheduleOnce(function(){t.hitLight(!1)},.15),this.data.currentHealth<=0){for(var i=0,o=this.itemNames;i<o.length;i++)(r=o[i])&&r.length>0&&this.dungeon.addItem(this.entity.Transform.position.clone(),r);for(var a=0,n=this.equipmentNames;a<n.length;a++){var r;(r=n[a])&&r.length>0&&this.dungeon.addEquipment(r,l.default.getPosInMap(this.data.defaultPos),null,1)}this.getComponent(h.default).sensor=!0}var c=s.default.mapManager.getCurrentMapBuilding(this.data.defaultPos);return c&&(c.currentHealth=this.data.currentHealth),!0},e.prototype.changeRes=function(t,e){this.sprite||(this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite));var i=s.default.spriteFrameRes(t),o=(i.getOriginalSize().width-this.colliderExtrude)*this.sprite.node.scale,a=(i.getOriginalSize().height-this.colliderExtrude)*this.sprite.node.scale;if(e&&s.default.spriteFrameRes(t+e)&&(i=s.default.spriteFrameRes(t+e)),i&&(this.sprite.node.opacity=255,this.sprite.node.width=i.getOriginalSize().width,this.sprite.node.height=i.getOriginalSize().height,!this.isCustom)){var n=cc.size(o,a);this.getComponent(h.default).setSize(n.clone()),this.sprite.spriteFrame=i}},n([p],e)}(r.default));i.default=f,cc._RF.pop()},{"../collider/CCollider":"CCollider","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","./Building":"Building"}],IceDemonThron:[function(t,e,i){"use strict";cc._RF.push(e,"24e5dr3bslGlZZLL6MjYCjj","IceDemonThron");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../manager/StatusManager"),l=t("../data/FromData"),c=t("../utils/ActorUtils"),u=t("../base/BaseColliderComponent"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isUp=!1,e.isAuto=!0,e.isUping=!1,e}return a(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.isUp=!1,this.node.getChildByName("thron").getComponent(cc.Sprite).getMaterial(0).setProperty("addColor",cc.color(194,255,255))},e.prototype.fall=function(){this.anim=this.getComponent(cc.Animation),this.anim.play(),this.isUping=!0},e.prototype.ThronUp=function(){var t=this;this.isUp=!0,this.scheduleOnce(function(){t.isUp=!1},.1),this.scheduleOnce(function(){t.node&&t.destroyEntityNode()},2)},e.prototype.start=function(){},e.prototype.onColliderEnter=function(t){!c.default.getEnemyCollisionTarget(t)||this.isAuto||this.isUping||this.fall()},e.prototype.onColliderStay=function(t){var e=c.default.getEnemyCollisionTarget(t);if(e&&this.isUp&&this.isValid){this.isUp=!1;var i=l.default.getClone("\u51b0\u523a","bossicethron02");e.takeDamage(new r.default(3),i)&&e.addStatus(s.default.FROZEN,i)}},n([d],e)}(u.default));i.default=p,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../data/DamageData":"DamageData","../data/FromData":"FromData","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils"}],IceDemon:[function(t,e,i){"use strict";cc._RF.push(e,"4043fv41gFB1o18Orugu9B9","IceDemon");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/EventHelper"),l=t("../logic/Shooter"),c=t("../data/DamageData"),u=t("../manager/StatusManager"),h=t("./Boss"),d=t("../utils/NextStep"),p=t("../utils/AudioPlayer"),f=t("../data/FromData"),g=t("../logic/Achievement"),y=t("../data/AreaOfEffectData"),m=t("../utils/IndexZ"),v=t("../utils/ActorUtils"),E=t("../talent/MagicIce"),_=t("../logic/Logic"),T=t("../collider/CCollider"),D=cc._decorator,S=D.ccclass,O=D.property,A=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeDelay=0,e.isFaceRight=!0,e.isMoving=!1,e.dashSkill=new d.default,e.thronSkill=new d.default,e.defenceSkill=new d.default,e.meleeSkill=new d.default,e.groundThron=null,e.selfThron=null,e.magicice=null,e.actionTimeDelay=0,e}return a(e,t),e.prototype.init=function(){},e.prototype.onLoad=function(){this.sc.isDied=!1,this.sc.isShow=!1,this.anim=this.getComponent(cc.Animation),this.shooter=this.node.getChildByName("Shooter").getComponent(l.default),this.shooter.from.valueCopy(f.default.getClone(this.actorName(),"bossicepart01")),this.statusManager=this.node.getChildByName("StatusManager").getComponent(u.default)},e.prototype.start=function(){t.prototype.start.call(this)},e.prototype.takeDamage=function(t){if(this.sc.isDied||!this.sc.isShow)return!1;this.data.currentHealth-=this.data.getDamage(t).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth);var e=this.data.currentHealth<this.data.Common.maxHealth/2;if(this.defence(e),this.defenceSkill.IsExcuting)p.default.play(p.default.BOSS_ICEDEMON_HIT);else{var i=[p.default.MONSTER_HIT,p.default.MONSTER_HIT1,p.default.MONSTER_HIT2];p.default.play(i[_.default.getRandomNum(0,2)])}return!0},e.prototype.killed=function(){var t=this;this.sc.isDied||(g.default.addMonsterKillAchievement(this.data.resName),cc.tween(this.node).to(3,{opacity:0}).start(),this.sc.isDied=!0,this.anim.play("IceDemonDefence"),this.scheduleOnce(function(){t.node&&(t.node.active=!1)},5),this.getLoot())},e.prototype.bossAction=function(){if(!this.sc.isDied&&this.sc.isShow&&this.dungeon){this.entity.Transform.position=r.default.fixOuterMap(this.entity.Transform.position),this.pos=r.default.getIndexInMap(this.entity.Transform.position),this.changeZIndex();var t=this.getMovePos(),e=this.getNearPlayerDistance(this.dungeon.player.node),i=this.data.currentHealth<this.data.Common.maxHealth/2;e<100&&(this.entity.Move.linearVelocity=cc.Vec2.ZERO),!i||this.magicice.isShow||this.defenceSkill.IsInCooling||this.magicice.showIce(),!(e<200)||this.defenceSkill.IsExcuting||this.meleeSkill.IsExcuting||this.thronSkill.IsExcuting||this.dashSkill.IsExcuting||this.attack(),this.meleeSkill.IsExcuting||this.defenceSkill.IsExcuting||this.thronSkill.IsExcuting||this.dash(),this.meleeSkill.IsExcuting||this.defenceSkill.IsExcuting||this.dashSkill.IsExcuting||this.thronGround(i),t.equals(cc.Vec3.ZERO)||this.meleeSkill.IsExcuting||this.defenceSkill.IsExcuting||this.thronSkill.IsExcuting||this.dashSkill.IsExcuting||!(e>60)||(t=t.normalizeSelf(),this.move(t,500))}},e.prototype.getMovePos=function(){var t=this.dungeon.player.pos.clone(),e=r.default.getPosInMap(t);e.y+=32;var i=(e=e.sub(this.node.position)).x;return this.isFaceRight=i>0,e},e.prototype.thronGround=function(t){var e=this;this.thronSkill.next(function(){e.thronSkill.IsExcuting=!0,e.anim||(e.anim=e.getComponent(cc.Animation)),e.anim.play("IceDemonThron");var i=1;e.scheduleOnce(function(){p.default.play(p.default.BOSS_ICEDEMON_THRON)},1),e.scheduleOnce(function(){p.default.play(p.default.BOSS_ICEDEMON_THRON)},2),e.schedule(function(){for(var t=e.pos.clone(),o=[cc.v3(t.x,t.y+i),cc.v3(t.x,t.y-i),cc.v3(t.x+i,t.y+i),cc.v3(t.x+i,t.y-i),cc.v3(t.x+i,t.y),cc.v3(t.x-i,t.y),cc.v3(t.x-i,t.y+i),cc.v3(t.x-i,t.y-i)],a=0;a<o.length;a++){var n=new c.default;n.physicalDamage=3,e.shooter.dungeon=e.dungeon,e.shooter.fireAoe(e.selfThron,(new y.default).init(0,2,.4,4,m.default.getActorZIndex(r.default.getPosInMap(o[a])),!0,!0,!0,!1,!0,n,f.default.getClone("\u51b0\u523a","bossicethron02"),[u.default.FROZEN]),r.default.getPosInMap(o[a]).subSelf(e.getCenterPosition()),0,null,!0)}i++},.2,t?7:5,1),t&&e.scheduleOnce(function(){for(var t=e.pos.clone(),i=[cc.v3(t.x+2,t.y+1),cc.v3(t.x+2,t.y-1),cc.v3(t.x-2,t.y+1),cc.v3(t.x-2,t.y-1),cc.v3(t.x+4,t.y+2),cc.v3(t.x+4,t.y-2),cc.v3(t.x-4,t.y+2),cc.v3(t.x-4,t.y-2),cc.v3(t.x+5,t.y+3),cc.v3(t.x+5,t.y-3),cc.v3(t.x-5,t.y+3),cc.v3(t.x-5,t.y-3),cc.v3(t.x+6,t.y+2),cc.v3(t.x+6,t.y-2),cc.v3(t.x-6,t.y+2),cc.v3(t.x-6,t.y-2),cc.v3(t.x+6,t.y+4),cc.v3(t.x+6,t.y-4),cc.v3(t.x-6,t.y+4),cc.v3(t.x-6,t.y-4),cc.v3(t.x+1,t.y+2),cc.v3(t.x+1,t.y-2),cc.v3(t.x-1,t.y+2),cc.v3(t.x-1,t.y-2),cc.v3(t.x+2,t.y+4),cc.v3(t.x+2,t.y-4),cc.v3(t.x-2,t.y+4),cc.v3(t.x-2,t.y-4),cc.v3(t.x+3,t.y+5),cc.v3(t.x+3,t.y-5),cc.v3(t.x-3,t.y+5),cc.v3(t.x-3,t.y-5),cc.v3(t.x+2,t.y+6),cc.v3(t.x+2,t.y-6),cc.v3(t.x-2,t.y+6),cc.v3(t.x-2,t.y-6),cc.v3(t.x+4,t.y+6),cc.v3(t.x+4,t.y-6),cc.v3(t.x-4,t.y+6),cc.v3(t.x-4,t.y-6)],o=0;o<i.length;o++){var a=new c.default;a.physicalDamage=3,e.shooter.dungeon=e.dungeon,e.shooter.fireAoe(e.selfThron,(new y.default).init(0,2,.4,4,m.default.getActorZIndex(r.default.getPosInMap(i[o])),!0,!0,!0,!1,!0,a,f.default.getClone("\u51b0\u523a","bossicethron02"),[u.default.FROZEN]),r.default.getPosInMap(i[o]).subSelf(e.getCenterPosition()),0,null,!0)}},1.5),e.scheduleOnce(function(){e.thronSkill.IsExcuting=!1},4)},15,!0)},e.prototype.thronSelf=function(){this.scheduleOnce(function(){p.default.play(p.default.SKILL_ICETHRON)},1);var t=[0,45,90,135,180,225,270,315],e=[cc.v3(0,40),cc.v3(-20,20),cc.v3(-40,0),cc.v3(-20,-20),cc.v3(0,-40),cc.v3(20,-20),cc.v3(40,0),cc.v3(20,20)],i=(cc.v3(0,-40),cc.v3(-20,-20),cc.v3(-40,0),cc.v3(-20,20),cc.v3(0,40),cc.v3(20,20),cc.v3(40,0),cc.v3(20,-20),new c.default);i.magicDamage=1;for(var o=0;o<t.length;o++)this.shooter.dungeon=this.dungeon,this.shooter.fireAoe(this.selfThron,(new y.default).init(0,2,.4,3,m.default.OVERHEAD,!0,!0,!0,!1,!0,i,f.default.getClone(this.actorName(),"bossicepart01"),[u.default.FROZEN]),cc.v3(e[o]),t[o],null,!0)},e.prototype.attack=function(){var t=this;this.meleeSkill.next(function(){t.meleeSkill.IsExcuting=!0,cc.director.emit(s.EventHelper.PLAY_AUDIO,{detail:{name:p.default.MELEE}}),t.anim||(t.anim=t.getComponent(cc.Animation)),t.anim.play("IceDemonAttack001"),t.scheduleOnce(function(){p.default.play(p.default.BOOS_ICEDEMON_ATTACK);var e=t.getMovePos(),i=e.x,o=e.y,a=cc.v2(i,o);a=a.normalize().mul(1500),t.entity.Move.linearVelocity=a},1),t.scheduleOnce(function(){t.meleeSkill.IsExcuting=!1},2)},3,!0)},e.prototype.dash=function(){var t=this;this.dashSkill.next(function(){t.dashSkill.IsExcuting=!0,t.anim||(t.anim=t.getComponent(cc.Animation)),t.scheduleOnce(function(){p.default.play(p.default.BOSS_ICEDEMON_DASH)},2.5),t.anim.play("IceDemonDash"),t.scheduleOnce(function(){var e=t.getMovePos(),i=e.x,o=e.y,a=cc.v2(i,o);a=a.normalize().mul(2500),t.entity.Move.linearVelocity=a},2.4),t.scheduleOnce(function(){t.dashSkill.IsExcuting=!1},3)},8,!0)},e.prototype.defence=function(t){var e=this;this.defenceSkill.next(function(){e.defenceSkill.IsExcuting=!0,e.anim||(e.anim=e.getComponent(cc.Animation)),e.anim.play("IceDemonDefence"),e.data.Common.defence=9999,e.data.Common.magicDefence=9999,p.default.play(p.default.BOSS_ICEDEMON_DEFEND),e.scheduleOnce(function(){e.defenceSkill.IsExcuting=!1,e.data.Common.defence=0,e.data.Common.magicDefence=0},3),t&&(e.magicice.isShow&&e.magicice.breakIce(),e.thronSelf())},6,!0)},e.prototype.fireShooter=function(t,e,i,o,a){t.dungeon=this.dungeon,t.data.bulletType=e,t.data.bulletArcExNum=i,t.data.bulletLineExNum=o,t.fireBullet(a)},e.prototype.showBoss=function(){this.sc.isShow=!0,this.entity.NodeRender.node=this.node,this.entity.Move.linearDamping=10,this.healthBar&&(this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.healthBar.node.active=!this.sc.isDied)},e.prototype.isActionTimeDelay=function(t){return this.actionTimeDelay+=t,this.actionTimeDelay>.2&&(this.actionTimeDelay=0,!0)},e.prototype.updateLogic=function(t){this.timeDelay+=t,this.timeDelay>1&&(this.timeDelay=0),this.isActionTimeDelay(t)&&this.bossAction(),this.data.currentHealth<1&&this.killed(),this.healthBar.node.active=!this.sc.isDied,this.sc.isDied&&(this.entity.Move.linearVelocity=cc.Vec2.ZERO),this.node.scaleX=this.isFaceRight?1:-1},e.prototype.move=function(t,e){if(!this.sc.isDied){t.equals(cc.Vec3.ZERO)||(this.pos=r.default.getIndexInMap(this.node.position));var i=t.x,o=t.y,a=(Math.abs(i),Math.abs(o),cc.v2(i,o));a=a.normalize().mul(e),this.entity.Move.linearVelocity=a,this.isMoving=0!=i||0!=o,this.isMoving?this.anim.getAnimationState("IceDemonWalk").isPlaying||this.anim.playAdditive("IceDemonWalk"):this.anim.getAnimationState("IceDemonWalk").isPlaying&&this.anim.play("IceDemonIdle"),this.changeZIndex()}},e.prototype.onColliderEnter=function(t,e){if(e.tag==T.default.TAG.BOSS_HIT){var i=v.default.getEnemyCollisionTarget(t);if(i&&(this.meleeSkill.IsExcuting||this.dashSkill.IsExcuting)&&!this.sc.isDied){var o=new c.default;o.physicalDamage=3;var a=f.default.getClone(this.actorName(),"bossicepart01");i.takeDamage(o,a,this)&&i.addStatus(u.default.FROZEN,a)}}},e.prototype.actorName=function(){return"\u51b0\u9b54"},n([O(cc.Prefab)],e.prototype,"groundThron",void 0),n([O(cc.Prefab)],e.prototype,"selfThron",void 0),n([O(E.default)],e.prototype,"magicice",void 0),n([S],e)}(h.default);i.default=A,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/AreaOfEffectData":"AreaOfEffectData","../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../manager/StatusManager":"StatusManager","../talent/MagicIce":"MagicIce","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/NextStep":"NextStep","./Boss":"Boss"}],IceThron:[function(t,e,i){"use strict";cc._RF.push(e,"732e0QfOMxFu5eXTn+nHJEI","IceThron");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../data/FromData"),l=t("../manager/StatusManager"),c=t("../utils/IndexZ"),u=t("../utils/ActorUtils"),h=t("../base/BaseColliderComponent"),d=cc._decorator,p=d.ccclass,f=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasTargetMap=new Map,e.isAttacking=!1,e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this)},e.prototype.start=function(){},e.prototype.AnimFinish=function(){var t=this;this.isAttacking=!1,this.scheduleOnce(function(){t.node&&t.destroyEntityNode()},1)},e.prototype.show=function(t,e,i,o){this.player=t,this.node.active=!0,this.node.parent=t.node.parent,this.node.setPosition(this.getPlayerPosition(t,e,i)),this.node.scale=o,e>90&&e<270&&(this.node.scaleX=-this.node.scaleX),this.isAttacking=!0,this.node.zIndex=c.default.getActorZIndex(this.node.position)},e.prototype.getPlayerPosition=function(t,e,i){var o=t.Hv.clone(),a=cc.v3(cc.v2(o).rotateSelf(e*Math.PI/180)).normalizeSelf();return t.node.position.clone().addSelf(a.mulSelf(i))},e.prototype.onColliderStay=function(t,e){e.radius>0&&this.isAttacking&&(this.hasTargetMap.has(t.id)&&this.hasTargetMap.get(t.id)>0?this.hasTargetMap.set(t.id,this.hasTargetMap.get(t.id)+1):(this.hasTargetMap.set(t.id,1),u.default.getEnemyCollisionTarget(t,!0)&&this.attacking(t.node)))},e.prototype.attacking=function(t){if(t){var e=new r.default,i=l.default.FROZEN;e.magicDamage=4;var o=u.default.getEnemyActorByNode(t,!0);o&&!o.sc.isDied&&(o.takeDamage(e),o.addStatus(i,new s.default))}},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.5&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.isCheckTimeDelay(t)&&this.hasTargetMap.clear()},n([p],e)}(h.default));i.default=f,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../data/DamageData":"DamageData","../data/FromData":"FromData","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/IndexZ":"IndexZ"}],IndexZ:[function(t,e,i){"use strict";cc._RF.push(e,"ee2b0v0Hy5Er7bVWcKf3jFS","IndexZ"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.getActorZIndex=function(e){return t.ACTOR+3e3-e.y},t.BACKGROUND=100,t.BACKGROUNDFLOOR=300,t.DOORWALLBEHIND=400,t.BASE=500,t.FLOOR=600,t.WATER=610,t.KRAKENBODY=620,t.DARKNESS=650,t.WALL=700,t.WALLCORNER=800,t.WALLINTERNAL=900,t.ACTOR=2e3,t.OVERHEAD=6e3,t.ROOF=6100,t.SHADOW=6200,t.FOG=6500,t.UI=7e3,t}();i.default=o,cc._RF.pop()},{}],InputComponent:[function(t,e,i){"use strict";cc._RF.push(e,"9625ac+//dMqqAiex6GDUXi","InputComponent");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0}),i.InputComponent=void 0;var r=t("../ECS"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.reset=function(){},n([r.ecs.register("Input")],e)}(r.ecs.IComponent);i.InputComponent=s,cc._RF.pop()},{"../ECS":"ECS"}],InputSystem:[function(t,e,i){"use strict";cc._RF.push(e,"457d5Kq4DZGLqTyaRpFcFFM","InputSystem");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../logic/EventHelper"),r=t("../component/InputComponent"),s=t("../ECS"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.init=function(){var t=this;n.EventHelper.on(n.EventHelper.PLAYER_MOVE,function(e){t.playerAction(e.dir,e.pos,e.dt)})},e.prototype.filter=function(){return s.ecs.allOf(r.InputComponent)},e.prototype.update=function(){},e.prototype.playerAction=function(){},e}(s.ecs.ComblockSystem);i.default=l,cc._RF.pop()},{"../../logic/EventHelper":"EventHelper","../ECS":"ECS","../component/InputComponent":"InputComponent"}],InteractBuilding:[function(t,e,i){"use strict";cc._RF.push(e,"7b8abAQqgxLbKCSpiTgLOQk","InteractBuilding");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Logic"),l=t("./Building"),c=t("../logic/EventHelper"),u=t("../utils/AudioPlayer"),h=t("../item/Item"),d=t("../utils/IndexZ"),p=t("../data/DamageData"),f=t("../boss/Boss"),g=t("../data/AvatarData"),y=t("../data/CommonData"),m=t("../data/FromData"),v=t("../manager/StatusManager"),E=t("../logic/NonPlayer"),_=t("./Box"),T=t("./HitBuilding"),D=t("../collider/CCollider"),S=cc._decorator,O=S.ccclass,A=(S.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeDelay=0,e.decorateType=0,e.resName="decorate000",e.isTaken=!1,e.isAttacking=!1,e.isThrowing=!1,e.isLift=!1,e.isAniming=!1,e.hasTargetMap=new Map,e.saveTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.shadow=this.node.getChildByName("shadow")},e.prototype.start=function(){},e.prototype.init=function(t,e){switch(this.decorateType=e,this.data.interact=t?1:0,s.default.chapterIndex){case s.default.CHAPTER00:this.resName="decorate000"+this.decorateType;break;case s.default.CHAPTER01:this.resName="decorate010"+this.decorateType;break;case s.default.CHAPTER02:this.resName="decorate020"+this.decorateType;break;case s.default.CHAPTER03:this.resName="decorate030"+this.decorateType;break;case s.default.CHAPTER04:case s.default.CHAPTER05:this.resName="decorate040"+this.decorateType;break;case s.default.CHAPTER099:this.resName="decorate000"+this.decorateType}this.updateCollider(),this.changeRes(this.resName)},e.prototype.updateCollider=function(){var t=s.default.spriteFrameRes(this.resName),e=t.getOriginalSize().width*this.sprite.node.scale,i=t.getOriginalSize().height*this.sprite.node.scale/3,o=this.getComponent(D.default);0==this.sprite.node.angle?o.setSize(cc.size(e,i)):o.setSize(cc.size(i,e)),this.entity.Move.linearDamping=this.isThrowing?5:10,o.sensor=this.data.currentHealth<=0,o.bounce=100},e.prototype.changeRes=function(t,e){this.sprite||(this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite));var i=s.default.spriteFrameRes(t);e&&s.default.spriteFrameRes(t+e)&&(i=s.default.spriteFrameRes(t+e)),this.sprite.node.opacity=255,this.sprite.spriteFrame=i,this.mat||(this.mat=this.node.getChildByName("sprite").getComponent(cc.Sprite).getMaterial(0)),this.mat.setProperty("textureSizeWidth",i.getTexture().width*this.sprite.node.scaleX),this.mat.setProperty("textureSizeHeight",i.getTexture().height*this.sprite.node.scaleY),this.mat.setProperty("outlineColor",cc.color(200,200,200)),this.sprite.node.angle=this.data.rollover>0?90:0},e.prototype.BreakingFinish=function(){this.reset()},e.prototype.hitLight=function(t){this.mat||(this.mat=this.node.getChildByName("sprite").getComponent(cc.Sprite).getMaterial(0)),this.mat.setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT)},e.prototype.highLight=function(t){this.mat||(this.mat=this.node.getChildByName("sprite").getComponent(cc.Sprite).getMaterial(0)),this.mat.setProperty("openOutline",t?1:0)},e.prototype.takeDamage=function(t){var e=this;if(!(this.data.currentHealth<=0)){this.data.currentHealth-=t.getTotalDamage();var i=[u.default.MONSTER_HIT,u.default.MONSTER_HIT1,u.default.MONSTER_HIT2];return u.default.play(i[s.default.getRandomNum(0,2)]),this.data.currentHealth>0?(this.hitLight(!0),this.scheduleOnce(function(){e.hitLight(!1)},.1),!0):(this.isTaken=!1,this.isAttacking=!1,cc.tween(this.sprite.node).call(function(){e.changeRes(e.resName,"anim001"),e.hitLight(!0)}).delay(.1).call(function(){e.hitLight(!1),e.changeRes(e.resName,"anim002")}).delay(.1).call(function(){e.changeRes(e.resName,"anim003")}).delay(.1).call(function(){e.changeRes(e.resName,"anim004"),e.sprite.node.angle=0,e.updateCollider();var t=s.default.mapManager.getRandom4Save(s.default.mapManager.getRebornSeed(e.seed)),i=t.rand();i>.6&&i<.8?cc.director.emit(c.EventHelper.DUNGEON_ADD_COIN,{detail:{pos:e.entity.Transform.position,count:t.getRandomNum(1,3)}}):i>=.8&&i<.85?cc.director.emit(c.EventHelper.DUNGEON_ADD_ITEM,{detail:{pos:e.entity.Transform.position,res:h.default.HEART}}):i>=.85&&i<.9&&cc.director.emit(c.EventHelper.DUNGEON_ADD_ITEM,{detail:{pos:e.entity.Transform.position,res:h.default.DREAM}})}).delay(10).call(function(){e.reset()}).start(),!0)}},e.prototype.reset=function(){this.entity.Transform.position=r.default.getPosInMap(cc.v3(-10,-10)),this.node.position=this.entity.Transform.position.clone(),this.data.currentHealth=this.data.maxHealth},e.prototype.rollover=function(){this.data.rollover=this.data.rollover>0?0:1,cc.tween(this.sprite.node).to(.5,{angle:this.data.rollover>0?90:0},{easing:"bounceOut"}).start(),this.updateCollider()},e.prototype.interact=function(t,e,i,o){return!(this.data.interact<1||this.isAniming)&&(this.player=t,i?this.attack():o?this.throwOrKick():e?this.putDown():this.switchMode())},e.prototype.taken=function(t,e){if(!(this.data.interact<1||this.isAniming))return this.player=t,!this.isTaken&&(e?(this.rollover(),!1):(this._taken(),!0))},e.prototype._taken=function(){if(!this.isAniming)return this.isTaken=!0,this.isLift=!0,!0},e.prototype.putDown=function(){if(!this.isAniming)return this.isTaken=!1,!0},e.prototype.switchMode=function(){if(!this.isAniming)return this.isLift=!this.isLift,!0},e.prototype.throwOrKick=function(){var t=this;if(!this.isAniming&&!this.isThrowing)return this.isAttacking=!0,this.isThrowing=!0,this.isAniming=!0,u.default.play(u.default.MELEE),this.updateCollider(),this.beatBack(this,this.player.Hv.clone(),this.isLift?500:1e3),this.scheduleOnce(function(){cc.director.emit(c.EventHelper.CAMERA_SHAKE,{detail:{isHeavyShaking:!1}})},this.isLift?.5:0),this.isLift&&(cc.tween(this.sprite.node).to(.2,{position:cc.v3(0,128)}).to(.2,{position:cc.v3(0,0)},{easing:"bounceOut"}).start(),cc.tween(this.shadow).to(.5,{scale:3}).to(.5,{scale:4}).start()),this.scheduleOnce(function(){t.isAniming=!1,t.isAttacking=!1,t.isTaken=!1,t.isThrowing=!1,t.updateCollider()},1),!0},e.prototype.attack=function(){var t=this;if(!this.isTaken||this.isAniming||!this.player)return!1;this.isAniming=!0,this.hasTargetMap.clear(),u.default.play(u.default.MELEE);if(this.isLift){var e=this.node.parent.convertToNodeSpaceAR(this.player.weaponLeft.meleeWeapon.node.convertToWorldSpaceAR(cc.v3(-32,0))),i=this.node.parent.convertToNodeSpaceAR(this.player.weaponLeft.meleeWeapon.node.convertToWorldSpaceAR(cc.v3(64,0)));cc.tween(this.sprite.node).to(.2,{position:cc.v3(0,64)}).call(function(){t.isAttacking=!0}).to(.1,{position:cc.v3(0,96)}).to(.1,{position:cc.v3(0,0)}).call(function(){t.isAttacking=!1}).to(.2,{position:cc.v3(0,96)}).call(function(){t.isAniming=!1}).start(),cc.tween(this.node).to(.2,{position:e}).to(.2,{position:i}).start()}else{e=this.node.parent.convertToNodeSpaceAR(this.player.weaponLeft.meleeWeapon.node.convertToWorldSpaceAR(cc.v3(0,64))),i=this.node.parent.convertToNodeSpaceAR(this.player.weaponLeft.meleeWeapon.node.convertToWorldSpaceAR(cc.v3(44.8,44.8)));var o=this.node.parent.convertToNodeSpaceAR(this.player.weaponLeft.meleeWeapon.node.convertToWorldSpaceAR(cc.v3(64,0))),a=this.node.parent.convertToNodeSpaceAR(this.player.weaponLeft.meleeWeapon.node.convertToWorldSpaceAR(cc.v3(44.8,-44.8))),n=this.node.parent.convertToNodeSpaceAR(this.player.weaponLeft.meleeWeapon.node.convertToWorldSpaceAR(cc.v3(0,-64)));cc.tween(this.node).to(.15,{position:e}).call(function(){t.isAttacking=!0}).to(.1,{position:i}).to(.1,{position:o}).to(.1,{position:a}).to(.1,{position:n}).to(.1,{position:a}).to(.1,{position:o}).call(function(){t.isAttacking=!1,t.isAniming=!1}).start()}return!0},e.prototype.onColliderPreSolve=function(t,e){t.tag==D.default.TAG.PLAYER&&(this.isTaken||this.isAttacking)&&(e.disabledOnce=!0)},e.prototype.onColliderStay=function(t){if(t.tag!=D.default.TAG.PLAYER&&this.player&&this.isTaken&&this.isAttacking)return t.tag!=D.default.TAG.BUILDING&&t.tag!=D.default.TAG.WALL&&t.tag!=D.default.TAG.WALL_TOP||this.isThrowing&&(this.entity.Move.linearVelocity=cc.Vec2.ZERO),this.hasTargetMap.has(t.id)&&this.hasTargetMap.get(t.id)>0?(this.hasTargetMap.set(t.id,this.hasTargetMap.get(t.id)+1),!1):(this.hasTargetMap.set(t.id,1),this.attacking(t))},e.prototype.updatePosition=function(){if(this.shadow.opacity=255,this.player&&this.isTaken&&(this.shadow.opacity=this.isThrowing?255:0,!this.isAniming))if(this.isLift)this.sprite.node.position=s.default.lerpPos(this.sprite.node.position,cc.v3(0,96),.1),this.entity.Transform.position=this.player.node.position.clone();else{var t=this.player.Hv.clone().mul(64),e=this.player.node.position.add(cc.v3(t));this.sprite.node.position=s.default.lerpPos(this.sprite.node.position,cc.v3(0,0),.1),this.entity.Transform.position=s.default.lerpPos(this.entity.Transform.position,e,.1)}this.node.zIndex=d.default.getActorZIndex(this.entity.Transform.position)},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.isSaveTimeDelay=function(t){return this.saveTimeDelay+=t,this.saveTimeDelay>.2&&(this.saveTimeDelay=0,!0)},e.prototype.update=function(t){if(this.isTimeDelay(t)&&this.updatePosition(),this.isSaveTimeDelay(t)){this.data.position=this.entity.Transform.position;var e=s.default.mapManager.getCurrentMapBuilding(this.data.defaultPos);e&&e.valueCopy(this.data)}},e.prototype.beatBack=function(t,e,i){var o=e;o.equals(cc.Vec2.ZERO)&&(o=cc.v2(1,0)),o=o.normalize().mul(i),this.scheduleOnce(function(){t.entity.Move.linearVelocity=cc.v2(o.x,o.y)},.1)},e.prototype.attacking=function(t){if(!t||!this.isAttacking)return!1;var e=new p.default,i=new y.default;this.player&&(e=this.player.data.getFinalAttackPoint(),this.player.data.LifeData.sanity<=0&&(e.physicalDamage=e.physicalDamage>1?1:e.physicalDamage,e.magicDamage=e.magicDamage>1?1:e.magicDamage,e.realDamage=e.realDamage>1?1:e.realDamage),i=this.player.data.FinalCommon),e.isMelee=!0,e.physicalDamage+=this.isThrowing?5:3;var o=!1,a=!1;if(t.tag==D.default.TAG.NONPLAYER){var n=t.node.getComponent(E.default);n&&!n.sc.isDied&&n.data.isEnemy>0&&(e.isBackAttack=n.isPlayerBehindAttack()&&i.damageBack>0,e.isBackAttack&&(e.realDamage+=i.damageBack),(o=n.takeDamage(e))&&(this.beatBack(n,this.player.Hv.clone(),200),this.addTargetAllStatus(i,n)))}else if(t.tag==D.default.TAG.BOSS){var r=t.node.getComponent(f.default);r&&!r.sc.isDied&&(o=r.takeDamage(e))&&this.addTargetAllStatus(i,r)}else if(t.tag==D.default.TAG.BUILDING||t.tag==D.default.TAG.WALL){var s=t.node.getComponent(_.default);if(s&&(a=!0,s.breakBox()),!a){var l=t.node.getComponent(T.default);l&&(a=!0,l.takeDamage(e))}}return(o||a)&&cc.director.emit(c.EventHelper.CAMERA_SHAKE,{detail:{isHeavyShaking:!1}}),o&&this.player.data.AvatarData.organizationIndex==g.default.TECH&&this.player.updateDream(-1),o||a},e.prototype.addTargetAllStatus=function(t,e){this.addTargetStatus(t.iceRate,e,v.default.FROZEN),this.addTargetStatus(t.fireRate,e,v.default.BURNING),this.addTargetStatus(t.lighteningRate,e,v.default.DIZZ),this.addTargetStatus(t.toxicRate,e,v.default.TOXICOSIS),this.addTargetStatus(t.curseRate,e,v.default.CURSING),this.addTargetStatus(t.realRate,e,v.default.BLEEDING)},e.prototype.addTargetStatus=function(t,e,i){s.default.getRandomNum(0,100)<t&&e.addStatus(i,new m.default)},e.BOX=0,e.PLANT=1,e.BOXBREAKABLE=2,n([O],e)}(l.default));i.default=A,cc._RF.pop()},{"../boss/Boss":"Boss","../collider/CCollider":"CCollider","../data/AvatarData":"AvatarData","../data/CommonData":"CommonData","../data/DamageData":"DamageData","../data/FromData":"FromData","../item/Item":"Item","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/NonPlayer":"NonPlayer","../manager/StatusManager":"StatusManager","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","./Box":"Box","./Building":"Building","./HitBuilding":"HitBuilding"}],InventoryData:[function(t,e,i){"use strict";cc._RF.push(e,"8d617FHrhNC9JdBH0sgyrgd","InventoryData");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("./BaseData"),r=t("./EquipmentData"),s=t("./ItemData"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.createTime=0,e.level=0,e.type=0,e}return a(e,t),e.prototype.valueCopy=function(t){t&&(this.type=t.type?t.type:0,this.price=t.price?t.price:0,t.equipmentData&&(this.equipmentData=new r.default,this.equipmentData.valueCopy(t.equipmentData),this.price=this.equipmentData.price,this.id=this.equipmentData.id,this.level=this.equipmentData.level),t.itemData&&(this.itemData=new s.default,this.itemData.valueCopy(t.itemData),this.price=this.itemData.price,this.id=this.itemData.id,this.level=0),this.itemData=t.itemData,this.createTime=t.createTime?t.createTime:0)},e.prototype.clone=function(){var t=new e;return t.equipmentData=this.equipmentData,t.itemData=this.itemData,t.createTime=this.createTime,t.id=this.id,t.type=this.type,t.price=this.price,t.level=this.level,t},e.prototype.setEmpty=function(){this.type=0,this.equipmentData=null,this.itemData=null,this.createTime=0,this.id=0,this.price=0,this.level=0},e}(n.default);i.default=l,cc._RF.pop()},{"./BaseData":"BaseData","./EquipmentData":"EquipmentData","./ItemData":"ItemData"}],InventoryDialog:[function(t,e,i){"use strict";cc._RF.push(e,"66439SRIlRDCK2s/WLS+qDi","InventoryDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../../data/AvatarData"),s=t("../../data/InventoryData"),l=t("../../logic/EventHelper"),c=t("../../item/Item"),u=t("../../logic/Logic"),h=t("../../manager/InventoryManager"),d=t("../../utils/AudioPlayer"),p=t("../InventoryItem"),f=t("./BaseDialog"),g=t("./EquipmentAndItemDialog"),y=t("../../utils/Utils"),m=t("../../talent/Talent"),v=t("../../data/EquipmentData"),E=t("../../data/ItemData"),_=cc._decorator,T=_.ccclass,D=_.property,S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.item=null,e.layer=null,e.layout=null,e.layoutEquip=null,e.layoutItem=null,e.layoutOther=null,e.otherDialog=null,e.toggleContainer=null,e.equipmentAndItemDialogPrefab=null,e.useButton=null,e.dropButton=null,e.saleButton=null,e.list=[],e.equipList=[],e.itemList=[],e.otherList=[],e.furnitureId="",e.select=null,e.discountLabel=null,e.discount=.5,e.equipmentAndItemDialog=null,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.select.opacity=0,this.equipmentAndItemDialog=this.initDialog(),this.initLayout(this.layout,this.list,h.default.MAX_BAG,0),this.initLayout(this.layoutEquip,this.equipList,h.default.MAX_EQUIP,h.default.MAX_BAG),this.initLayout(this.layoutItem,this.itemList,h.default.MAX_ITEM,h.default.MAX_BAG+h.default.MAX_EQUIP),this.initLayout(this.layoutOther,this.otherList,0,0),l.EventHelper.on(l.EventHelper.HUD_INVENTORY_ALL_UPDATE,function(){t.node&&(t.updateList(u.default.bagSortIndex),t.updateEquipList(),t.updateItemList(),t.furnitureId.length>0&&t.updateOtherList(u.default.sortIndexs[t.furnitureId]))}),l.EventHelper.on(l.EventHelper.HUD_INVENTORY_EQUIP_UPDATE,function(){t.node&&t.updateEquipList()}),l.EventHelper.on(l.EventHelper.HUD_INVENTORY_ITEM_UPDATE,function(){t.node&&t.updateItemList()}),l.EventHelper.on(l.EventHelper.HUD_INVENTORY_SELECT_UPDATE,function(e){if(t.node){var i=u.default.inventoryManager.inventoryList[e.index],o=e.furnitureId;o&&o.length>0?(i=u.default.inventoryManager.furnitureMap.get(o).storageList[e.index],t.otherList[e.index].updateData(i)):t.list[e.index].updateData(i)}}),this.toggleContainer.toggleItems[u.default.bagSortIndex].isChecked=!0,u.default.playerData.AvatarData.organizationIndex==r.default.HUNTER&&(this.discount+=.1),m.default.TALENT_010==u.default.playerData.AvatarData.professionData.talent&&(this.discount+=.1)},e.prototype.initDialog=function(){var t=cc.instantiate(this.equipmentAndItemDialogPrefab);t.parent=this.node.getChildByName("layer");var e=t.getComponent(g.default);return e.changeBgAndAnchor(g.default.BG_TYPE_ARROW_NONE),e.hideDialog(),e},e.prototype.initLayout=function(t,e,i,o){t.removeAllChildren();for(var a=0;a<i;a++){var n=new s.default;n.createTime=(new Date).getTime(),e.push(this.getItem(o+a,n,t))}},e.prototype.getItem=function(t,e,i){var o=cc.instantiate(this.item);o.parent=i;var a=o.getComponent(p.default);return a.init(this,t,e),a},e.prototype.show=function(){this._show("")},e.prototype.showFurniture=function(t){this._show(t)},e.prototype._show=function(e){this.layer.x=0;var i=e&&e.length>0;this.otherDialog.active=i,this.furnitureId=i?e:"",t.prototype.show.call(this),this.updateList(u.default.bagSortIndex),this.updateEquipList(),this.updateItemList(),this.updateOtherList(i?u.default.sortIndexs[e]:0),i&&cc.tween(this.layer).delay(.3).to(.5,{x:145}).start()},e.prototype.changeSort=function(t,e){u.default.bagSortIndex=e,this.updateList(e)},e.prototype.changeFurnitureSort=function(t,e){u.default.sortIndexs[this.furnitureId]=e,this.updateOtherList(e)},e.prototype.clearSelect=function(){this.currentSelectIndex=-1,this.equipmentAndItemDialog.hideDialog(),this.useButton.active=!1,this.dropButton.active=!1,this.saleButton.active=!1,this.select.opacity=0},e.prototype.showSelect=function(t){this.currentSelectIndex=t.index,this.select.position=this.node.convertToNodeSpaceAR(t.node.convertToWorldSpaceAR(cc.Vec3.ZERO)),this.select.opacity=200,this.useButton.getComponentInChildren(cc.Label).string=this.currentSelectIndex>=h.default.MAX_BAG?"\u5378\u4e0b":"\u88c5\u5907",this.furnitureId.length>0?this.currentSelectIndex>=h.default.MAX_BAG+h.default.MAX_EQUIP+h.default.MAX_ITEM?(this.dropButton.getComponentInChildren(cc.Label).string="\u53d6\u51fa",this.useButton.getComponentInChildren(cc.Label).string="\u88c5\u5907"):this.dropButton.getComponentInChildren(cc.Label).string="\u5b58\u5165":this.dropButton.getComponentInChildren(cc.Label).string="\u653e\u4e0b",d.default.play(d.default.SELECT),t.data.type==p.default.TYPE_EQUIP?(this.discountLabel.string="-"+100*this.discount+"%("+Math.floor(t.data.equipmentData.price*this.discount)+")",this.useButton.active=!0,this.dropButton.active=!0,this.saleButton.active=!0,this.equipmentAndItemDialog.showDialog(cc.v3(420,260),null,null,t.data.equipmentData,null)):(this.discountLabel.string="-"+100*this.discount+"%("+Math.floor(t.data.itemData.count>1?t.data.itemData.price*t.data.itemData.count*this.discount:t.data.itemData.price*this.discount)+")",this.useButton.active=!0,this.dropButton.active=!0,this.saleButton.active=!0,this.equipmentAndItemDialog.showDialog(cc.v3(420,160),null,t.data.itemData,null,null))},e.prototype.updateItemList=function(){for(var t=[],e=0,i=u.default.inventoryManager.itemList;e<i.length;e++){var o=i[e],a=h.default.buildItemInventoryData(o);t.push(a)}for(var n=0;n<h.default.MAX_ITEM;n++)n<t.length&&t[n].type!=p.default.TYPE_EMPTY?(a=t[n],this.itemList[n].updateData(a)):this.itemList[n].setEmpty()},e.prototype.updateEquipList=function(){var t=[];for(var e in u.default.inventoryManager.equips){var i=u.default.inventoryManager.equips[e],o=!1;if(e!=h.default.REMOTE&&e!=h.default.SHIELD?o=!0:e==h.default.REMOTE?i.equipmetType!=h.default.REMOTE&&u.default.inventoryManager.equips[h.default.SHIELD].equipmetType!=h.default.EMPTY||(o=!0):e==h.default.SHIELD&&i.equipmetType==h.default.SHIELD&&(o=!0),o){var a=h.default.buildEquipInventoryData(i);t.push(a)}}for(var n=0;n<h.default.MAX_EQUIP;n++)n<t.length&&t[n].type!=p.default.TYPE_EMPTY?(a=t[n],this.equipList[n].updateData(a)):this.equipList[n].setEmpty()},e.prototype.updateOtherList=function(t){if(this.clearSelect(),this.otherList=[],this.layoutOther.removeAllChildren(),!(this.furnitureId.length<1)){var e=u.default.inventoryManager.furnitureMap.get(this.furnitureId);if(e){for(var i=0;i<e.storage;i++){var o=new s.default;i<e.storageList.length&&o.valueCopy(e.storageList[i]),this.otherList.push(this.getItem(h.default.MAX_BAG+h.default.MAX_EQUIP+h.default.MAX_ITEM+i,o,this.layoutOther))}var a=this.getSortList(t,e.storageList);for(i=0;i<e.storage;i++)i<a.length&&a[i].type!=p.default.TYPE_EMPTY?(o=a[i],this.otherList[i].updateData(o)):this.otherList[i].setEmpty();e.storageList=a}}},e.prototype.updateList=function(t){this.clearSelect();for(var e=this.getSortList(t,u.default.inventoryManager.inventoryList),i=0;i<h.default.MAX_BAG;i++)if(i<e.length&&e[i].type!=p.default.TYPE_EMPTY){var o=e[i];this.list[i].updateData(o)}else this.list[i].setEmpty();u.default.inventoryManager.inventoryList=e},e.prototype.getSortList=function(t,e){for(var i=[],o=[],a=[],n=0;n<e.length;n++){var r=e[n];r.type!=p.default.TYPE_EMPTY&&(a.push(r),r.type==p.default.TYPE_EQUIP?o.push(r):r.type==p.default.TYPE_ITEM&&i.push(r))}return 0==t?a.sort(function(t,e){return t.createTime-e.createTime}):1==t?a.sort(function(t,e){return t.id-e.id}):2==t?(i.sort(function(t,e){return t.id-e.id}),o.sort(function(t,e){return e.equipmentData.level-t.equipmentData.level}),a=o.concat(i)):3==t&&a.sort(function(t,e){return e.price-t.price}),a},e.getItemInsertIndex=function(t,e,o){for(var a=e.length<o?e.length:-1,n=0;n<e.length;n++){var r=e[n];if(h.default.isItemEqualCanAdd(r.itemData,t)){a=n;break}}return-1==a?i.getEmptyInsertIndex(e,o):a},e.getEmptyInsertIndex=function(t,e){for(var i=t.length<e?t.length:-1,o=0;o<t.length;o++)if(t[o].type==p.default.TYPE_EMPTY){i=o;break}return i},e.addEquipOrItemToBag=function(t,e,i,o,a){var n=o?this.getItemInsertIndex(t.itemData,e,i):this.getEmptyInsertIndex(e,i);if(-1==n)return!1;var r=new s.default;if(r.valueCopy(t),n<e.length){if(o){var l=r.itemData,c=e[n].itemData;if(h.default.isItemEqualCanAdd(l,c)){var u=l.count+c.count;r.itemData.valueCopy(c),r.itemData.count=u}}e[n]=r,a&&a[n].updateData(r)}else e.push(r),a&&a[e.length-1].updateData(r);return!0},e.prototype.takeOffEquip=function(t,e){if(!(this.currentSelectIndex>=h.default.MAX_BAG&&this.currentSelectIndex<h.default.MAX_BAG+h.default.MAX_EQUIP))return!1;d.default.play(d.default.SELECT);var o=this.equipList[this.currentSelectIndex-h.default.MAX_BAG];if(o.data.type==p.default.TYPE_EMPTY)return!1;var a=o.data.equipmentData.clone(),n=u.default.inventoryManager.inventoryList;if(e)l.EventHelper.emit(l.EventHelper.HUD_ADD_COIN,{count:Math.floor(a.price*this.discount)}),d.default.play(d.default.COIN);else{var r=!1;t||(r=i.addEquipOrItemToBag(o.data,n,this.list.length,!1,this.list)),!r&&this.furnitureId&&this.furnitureId.length>0&&(n=u.default.inventoryManager.furnitureMap.get(this.furnitureId).storageList,r=i.addEquipOrItemToBag(o.data,n,this.otherList.length,!1,this.otherList)),r||(t||y.default.toast("\u7269\u54c1\u680f\u5df2\u6ee1"),l.EventHelper.emit(l.EventHelper.DUNGEON_SETEQUIPMENT,{res:a.img,equipmentData:a}))}return u.default.inventoryManager.equips[a.equipmetType]=new v.default,l.EventHelper.emit(l.EventHelper.PLAYER_EQUIPMENT_REFRESH,{equipmetType:a.equipmetType}),o.setEmpty(),this.clearSelect(),!0},e.prototype.takeOffItem=function(t,e){if(!(this.currentSelectIndex>=h.default.MAX_BAG+h.default.MAX_EQUIP&&this.currentSelectIndex<h.default.MAX_BAG+h.default.MAX_EQUIP+h.default.MAX_ITEM))return!1;d.default.play(d.default.SELECT);var o=this.itemList[this.currentSelectIndex-h.default.MAX_BAG-h.default.MAX_EQUIP];if(o.data.type==p.default.TYPE_EMPTY)return!1;var a=new E.default;a.valueCopy(o.data.itemData);var n=u.default.inventoryManager.inventoryList;if(e)l.EventHelper.emit(l.EventHelper.HUD_ADD_COIN,{count:Math.floor(a.count>1?a.price*a.count*this.discount:a.price*this.discount)}),d.default.play(d.default.COIN);else{var r=!1;t||(r=i.addEquipOrItemToBag(o.data,n,this.list.length,!0,this.list)),!r&&this.furnitureId&&this.furnitureId.length>0&&(n=u.default.inventoryManager.furnitureMap.get(this.furnitureId).storageList,r=i.addEquipOrItemToBag(o.data,n,this.otherList.length,!0,this.otherList)),r||(t||y.default.toast("\u7269\u54c1\u680f\u5df2\u6ee1"),l.EventHelper.emit(l.EventHelper.DUNGEON_ADD_ITEM,{res:a.resName,count:a.count}))}return u.default.inventoryManager.itemList[this.currentSelectIndex-h.default.MAX_BAG-h.default.MAX_EQUIP]=new E.default,l.EventHelper.emit(l.EventHelper.PLAYER_ITEM_REFRESH),o.setEmpty(),this.clearSelect(),!0},e.prototype.takeOnEquipOrItem=function(t,e,o){if(o[t].data.type!=p.default.TYPE_EMPTY){d.default.play(d.default.SELECT);var a=o[t];if(a.data.type==p.default.TYPE_EQUIP){var n=a.data.equipmentData.clone();if(n.equipmetType!=h.default.EMPTY){if(n.requireLevel>u.default.playerData.OilGoldData.level)return void y.default.toast("\u5f53\u524d\u4eba\u7269\u7b49\u7ea7\u592a\u4f4e\uff0c\u65e0\u6cd5\u88c5\u5907");a.setEmpty(),e[t].setEmpty(),n.equipmetType==h.default.REMOTE?(i.addEquipOrItemToBag(h.default.buildEquipInventoryData(u.default.inventoryManager.equips[h.default.REMOTE]),e,o.length,!1,o),i.addEquipOrItemToBag(h.default.buildEquipInventoryData(u.default.inventoryManager.equips[h.default.SHIELD]),e,o.length,!1,o),u.default.inventoryManager.equips[h.default.SHIELD].valueCopy(new v.default),l.EventHelper.emit(l.EventHelper.PLAYER_EQUIPMENT_REFRESH,{equipmetType:h.default.SHIELD})):n.equipmetType==h.default.SHIELD?(i.addEquipOrItemToBag(h.default.buildEquipInventoryData(u.default.inventoryManager.equips[h.default.REMOTE]),e,o.length,!1,o),i.addEquipOrItemToBag(h.default.buildEquipInventoryData(u.default.inventoryManager.equips[h.default.SHIELD]),e,o.length,!1,o),u.default.inventoryManager.equips[h.default.REMOTE].valueCopy(new v.default),l.EventHelper.emit(l.EventHelper.PLAYER_EQUIPMENT_REFRESH,{equipmetType:h.default.REMOTE})):i.addEquipOrItemToBag(h.default.buildEquipInventoryData(u.default.inventoryManager.equips[n.equipmetType]),e,o.length,!1,o),u.default.inventoryManager.equips[n.equipmetType]=n,this.updateEquipList(),l.EventHelper.emit(l.EventHelper.PLAYER_EQUIPMENT_REFRESH,{equipmetType:n.equipmetType})}}else{var r=new E.default;if(r.valueCopy(a.data.itemData),r.resName!=c.default.EMPTY){a.setEmpty(),e[t].setEmpty();for(var s=!1,f=0;f<u.default.inventoryManager.itemList.length;f++){var g=u.default.inventoryManager.itemList[f];if(h.default.isItemEqualCanAdd(g,r)){var m=g.count+r.count;g.valueCopy(r),g.count=m,s=!0;break}}if(!s)for(f=0;f<u.default.inventoryManager.itemList.length;f++)if((g=u.default.inventoryManager.itemList[f]).resName==c.default.EMPTY){g.valueCopy(r),s=!0;break}if(!s){var _=u.default.inventoryManager.itemList[0].clone(),T=new Array;for(f=1;f<u.default.inventoryManager.itemList.length;f++)T.push(u.default.inventoryManager.itemList[f]);for(T.push(r),f=0;f<u.default.inventoryManager.itemList.length;f++)u.default.inventoryManager.itemList[f].valueCopy(T[f]);i.addEquipOrItemToBag(h.default.buildItemInventoryData(_),e,o.length,!0,o)}this.updateItemList(),l.EventHelper.emit(l.EventHelper.PLAYER_ITEM_REFRESH)}}this.clearSelect()}},e.prototype.dropEquipOrItem=function(t,e,o,a,n){if(o[t].data.type!=p.default.TYPE_EMPTY){var r=!1;d.default.play(d.default.SELECT);var s=o[t];if(s.data.type==p.default.TYPE_EQUIP){var f=s.data.equipmentData.clone();f.equipmetType!=h.default.EMPTY&&(n?(l.EventHelper.emit(l.EventHelper.HUD_ADD_COIN,{count:Math.floor(f.price*this.discount)}),d.default.play(d.default.COIN)):(a?r=i.addEquipOrItemToBag(s.data,u.default.inventoryManager.inventoryList,this.list.length,!1,this.list):this.furnitureId&&this.furnitureId.length>0&&(r=i.addEquipOrItemToBag(s.data,u.default.inventoryManager.furnitureMap.get(this.furnitureId).storageList,this.otherList.length,!1,this.otherList)),r||l.EventHelper.emit(l.EventHelper.DUNGEON_SETEQUIPMENT,{res:f.img,equipmentData:f})))}else{var g=new E.default;g.valueCopy(s.data.itemData),g.resName!=c.default.EMPTY&&(n?(l.EventHelper.emit(l.EventHelper.HUD_ADD_COIN,{count:Math.floor(g.count>1?g.price*g.count*this.discount:g.price*this.discount)}),d.default.play(d.default.COIN)):(a?r=i.addEquipOrItemToBag(s.data,u.default.inventoryManager.inventoryList,this.list.length,!0,this.list):this.furnitureId&&this.furnitureId.length>0&&(r=i.addEquipOrItemToBag(s.data,u.default.inventoryManager.furnitureMap.get(this.furnitureId).storageList,this.otherList.length,!0,this.otherList)),r||l.EventHelper.emit(l.EventHelper.DUNGEON_ADD_ITEM,{res:g.resName,count:g.count})))}o[t].setEmpty(),e[t].setEmpty(),this.clearSelect()}},e.prototype.use=function(){if(-1!=this.currentSelectIndex&&!this.takeOffEquip(!1,!1)&&!this.takeOffItem(!1,!1)){var t=this.list,e=u.default.inventoryManager.inventoryList,i=this.currentSelectIndex;this.currentSelectIndex>=h.default.MAX_BAG+h.default.MAX_EQUIP+h.default.MAX_ITEM&&(t=this.otherList,e=u.default.inventoryManager.furnitureMap.get(this.furnitureId).storageList,i=this.currentSelectIndex-h.default.MAX_BAG-h.default.MAX_EQUIP-h.default.MAX_ITEM),this.takeOnEquipOrItem(i,e,t)}},e.prototype.drop=function(){if(-1!=this.currentSelectIndex&&!this.takeOffEquip(!0,!1)&&!this.takeOffItem(!0,!1)){var t=this.list,e=u.default.inventoryManager.inventoryList,i=this.currentSelectIndex,o=this.currentSelectIndex>=h.default.MAX_BAG+h.default.MAX_EQUIP+h.default.MAX_ITEM;o&&(t=this.otherList,e=u.default.inventoryManager.furnitureMap.get(this.furnitureId).storageList,i=this.currentSelectIndex-h.default.MAX_BAG-h.default.MAX_EQUIP-h.default.MAX_ITEM),this.dropEquipOrItem(i,e,t,o,!1)}},e.prototype.sale=function(){if(-1!=this.currentSelectIndex&&!this.takeOffEquip(!1,!0)&&!this.takeOffItem(!1,!0)){var t=this.list,e=u.default.inventoryManager.inventoryList,i=this.currentSelectIndex,o=this.currentSelectIndex>=h.default.MAX_BAG+h.default.MAX_EQUIP+h.default.MAX_ITEM;o&&(t=this.otherList,e=u.default.inventoryManager.furnitureMap.get(this.furnitureId).storageList,i=this.currentSelectIndex-h.default.MAX_BAG-h.default.MAX_EQUIP-h.default.MAX_ITEM),this.dropEquipOrItem(i,e,t,o,!0)}},e.prototype.close=function(){d.default.play(d.default.SELECT),this.dismiss()},n([D(cc.Prefab)],e.prototype,"item",void 0),n([D(cc.Node)],e.prototype,"layer",void 0),n([D(cc.Node)],e.prototype,"layout",void 0),n([D(cc.Node)],e.prototype,"layoutEquip",void 0),n([D(cc.Node)],e.prototype,"layoutItem",void 0),n([D(cc.Node)],e.prototype,"layoutOther",void 0),n([D(cc.Node)],e.prototype,"otherDialog",void 0),n([D(cc.ToggleContainer)],e.prototype,"toggleContainer",void 0),n([D(cc.Prefab)],e.prototype,"equipmentAndItemDialogPrefab",void 0),n([D(cc.Node)],e.prototype,"useButton",void 0),n([D(cc.Node)],e.prototype,"dropButton",void 0),n([D(cc.Node)],e.prototype,"saleButton",void 0),n([D(cc.Node)],e.prototype,"select",void 0),n([D(cc.Label)],e.prototype,"discountLabel",void 0),i=n([T],e)}(f.default);i.default=S,cc._RF.pop()},{"../../data/AvatarData":"AvatarData","../../data/EquipmentData":"EquipmentData","../../data/InventoryData":"InventoryData","../../data/ItemData":"ItemData","../../item/Item":"Item","../../logic/EventHelper":"EventHelper","../../logic/Logic":"Logic","../../manager/InventoryManager":"InventoryManager","../../talent/Talent":"Talent","../../utils/AudioPlayer":"AudioPlayer","../../utils/Utils":"Utils","../InventoryItem":"InventoryItem","./BaseDialog":"BaseDialog","./EquipmentAndItemDialog":"EquipmentAndItemDialog"}],InventoryItem:[function(t,e,i){"use strict";cc._RF.push(e,"51ad8KPmpFIULMuWCViUiMp","InventoryItem");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/InventoryData"),s=t("../logic/Logic"),l=t("../manager/InventoryManager"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isSelect=!1,e.sprite=null,e.label=null,e.index=0,e.data=new r.default,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_END,function(){t.isSelect&&t.index==t.dialog.currentSelectIndex?t.isSelect=!1:t.isSelect=t.data.type!=i.TYPE_EMPTY,t.dialog.clearSelect(),t.isSelect&&t.dialog.showSelect(t)},this)},e.prototype.init=function(t,e,i){this.dialog=t,this.index=e,this.isSelect=!1,this.updateData(i)},e.prototype.updateData=function(t){if(this.isSelect=!1,this.data.valueCopy(t),this.label.string="",this.sprite.spriteFrame=null,this.node.color=cc.Color.WHITE,this.data.type==i.TYPE_ITEM&&this.data.itemData)this.label.string=t.itemData.count>0?"x"+t.itemData.count:"",this.sprite.spriteFrame=s.default.spriteFrameRes(this.data.itemData.resName);else if(this.data.equipmentData){var e=s.default.spriteFrameRes(this.data.equipmentData.img);this.data.equipmentData.equipmetType==l.default.CLOTHES?e=s.default.spriteFrameRes(this.data.equipmentData.img+"anim0"):this.data.equipmentData.equipmetType==l.default.HELMET?e=s.default.spriteFrameRes(this.data.equipmentData.img+"anim0"):this.data.equipmentData.equipmetType==l.default.REMOTE&&(e=s.default.spriteFrameRes(this.data.equipmentData.img+"anim0")),this.sprite.spriteFrame=e;var o=cc.color(255,255,255).fromHEX(this.data.equipmentData.color),a=cc.color(255,255,255).fromHEX(this.data.equipmentData.titlecolor);this.sprite.node.color=o,this.node.color=a}},e.prototype.setEmpty=function(){this.data.setEmpty(),this.label.string="",this.sprite.spriteFrame=null,this.node.color=cc.Color.WHITE},e.prototype.start=function(){},e.TYPE_EMPTY=0,e.TYPE_EQUIP=1,e.TYPE_ITEM=2,n([h(cc.Sprite)],e.prototype,"sprite",void 0),n([h(cc.Label)],e.prototype,"label",void 0),i=n([u],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../data/InventoryData":"InventoryData","../logic/Logic":"Logic","../manager/InventoryManager":"InventoryManager"}],InventoryManager:[function(t,e,i){"use strict";cc._RF.push(e,"1dc08IgWM1D6q2nqBDxwhzD","InventoryManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../data/EquipmentData"),a=t("../data/InventoryData"),n=t("../data/ItemData"),r=t("../ui/InventoryItem"),s=t("../utils/NextStep"),l=t("../item/Item"),c=function(){function t(){this.buffer=new o.default,this.itemList=[],this.inventoryList=[],this.itemCoolDownList=[],this.equips={},this.suitMap={},this.suitEquipMap={},this.furnitureMap=new Map,this.emptyEquipData=new o.default,this.totalEquipData=new o.default;for(var e=0,i=t.EQUIP_TAGS;e<i.length;e++){var a=i[e];this.equips[a]=new o.default}for(var r=0;r<5;r++){var l=new n.default;l.count=-1,this.itemList.push(l),this.itemCoolDownList.push(new s.default)}this.suitMap={},this.suitEquipMap={},this.furnitureMap=new Map}return t.prototype.clear=function(){},t.prototype.getEquipBySuit=function(t){return t&&this.suitEquipMap[t.suitType]?this.suitEquipMap[t.suitType]:this.emptyEquipData},Object.defineProperty(t.prototype,"TotalEquipData",{get:function(){return this.totalEquipData},enumerable:!1,configurable:!0}),t.prototype.updateTotalEquipData=function(){var t=new o.default,e=[];for(var i in this.equips){var a=this.equips[i];t.Common.add(a.Common);for(var n=0,r=a.exTriggers;n<r.length;n++){var s=r[n];e.push(s)}}for(var i in t.Common.add(this.buffer.Common),this.suitEquipMap)if(a=this.suitEquipMap[i]){t.Common.add(a.Common);for(var l=0,c=a.exTriggers;l<c.length;l++)s=c[l],e.push(s)}t.exTriggers=e,this.totalEquipData=t},t.buildItemInventoryData=function(t){var e=new a.default;return e.itemData=new n.default,e.itemData.valueCopy(t),e.type=t.resName==l.default.EMPTY?r.default.TYPE_EMPTY:r.default.TYPE_ITEM,e.createTime=(new Date).getTime(),e.id=e.itemData.id,e},t.buildEquipInventoryData=function(e){var i=new a.default;return i.equipmentData=new o.default,i.equipmentData.valueCopy(e),i.type=e.equipmetType==t.EMPTY?r.default.TYPE_EMPTY:r.default.TYPE_EQUIP,i.price=i.equipmentData.price,i.createTime=(new Date).getTime(),i.id=i.equipmentData.id,i},t.isItemEqualCanAdd=function(t,e){return t&&e&&t.resName!=l.default.EMPTY&&t.resName==e.resName&&t.count>0&&e.count>0},t.MAX_BAG=32,t.MAX_EQUIP=8,t.MAX_ITEM=5,t.EMPTY="empty",t.WEAPON="weapon",t.REMOTE="remote",t.SHIELD="shield",t.HELMET="helmet",t.CLOTHES="clothes",t.TROUSERS="trousers",t.GLOVES="gloves",t.SHOES="shoes",t.CLOAK="cloak",t.EQUIP_TAGS=[t.WEAPON,t.REMOTE,t.SHIELD,t.HELMET,t.CLOTHES,t.TROUSERS,t.GLOVES,t.SHOES,t.CLOAK],t.TAG=cc.Enum({DEFAULT:0,EQUIP:1,ITEM:2,CUPBOARD:3}),t}();i.default=c,cc._RF.pop()},{"../data/EquipmentData":"EquipmentData","../data/InventoryData":"InventoryData","../data/ItemData":"ItemData","../item/Item":"Item","../ui/InventoryItem":"InventoryItem","../utils/NextStep":"NextStep"}],Inventory:[function(t,e,i){"use strict";cc._RF.push(e,"3b411lPIzZAv7ApO4pixeng","Inventory");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=r.property,c=t("./EventHelper"),u=t("./Logic"),h=t("../data/EquipmentData"),d=t("../manager/InventoryManager"),p=t("./Dungeon"),f=t("../data/FromData"),g=t("../item/Item"),y=t("../data/SuitData"),m=t("../ui/dialog/EquipmentAndItemDialog"),v=t("../utils/LocalStorage"),E=t("../utils/Utils"),_=t("../ui/dialog/InventoryDialog"),T=t("../data/TriggerData"),D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dungeon=null,e.weapon=null,e.remote=null,e.shield=null,e.helmet=null,e.clothes=null,e.trousers=null,e.gloves=null,e.shoes=null,e.cloak=null,e.itemsprite1=null,e.itemsprite2=null,e.itemsprite3=null,e.itemsprite4=null,e.itemsprite5=null,e.itemlabel1=null,e.itemlabel2=null,e.itemlabel3=null,e.itemlabel4=null,e.itemlabel5=null,e.equipmentAndItemDialogPrefab=null,e.mainCamera=null,e.equipmentNode=null,e.dialogNode=null,e.equipmentAndItemDialog=null,e.equipmentGroundDialog=null,e.itemGroundDialog=null,e.graphics=null,e.equipAndItemTimeDelays=new Map,e.equipSprites=new Map,e.equipCovers=new Map,e.itemPositions=[],e.itemCovers=[],e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.equipmentNode.active=u.default.settings.showEquipDialog,this.equipmentGroundDialog=this.initDialog(!0),this.itemGroundDialog=this.initDialog(!0),this.equipmentAndItemDialog=this.initDialog(!1),this.graphics=this.getComponent(cc.Graphics),this.inventoryManager=u.default.inventoryManager,c.EventHelper.on(c.EventHelper.PLAYER_CHANGEEQUIPMENT,function(e){t.node&&(t.refreshEquipment(e.equipmetType,e.equipData,!1,e.isReplace),t.refreshSuits(),u.default.inventoryManager.updateTotalEquipData())}),c.EventHelper.on(c.EventHelper.PLAYER_EQUIPMENT_REFRESH,function(e){t.node&&(t.refreshEquipmentRes(e.equipmetType),t.refreshSuits(),u.default.inventoryManager.updateTotalEquipData())}),c.EventHelper.on(c.EventHelper.PLAYER_ITEM_REFRESH,function(){t.node&&t.refreshItemRes()}),this.equipmentGroundDialog&&this.equipmentGroundDialog.hideDialog(),this.itemGroundDialog&&this.itemGroundDialog.hideDialog(),c.EventHelper.on(c.EventHelper.PLAYER_CHANGEITEM,function(e){t.node&&t.refreshItem(e.itemData,e.isReplace)}),c.EventHelper.on(c.EventHelper.HUD_GROUND_EQUIPMENT_INFO_SHOW,function(e){if(t.equipmentGroundDialog){var i=e.worldPos,o=t.node.convertToNodeSpaceAR(i);t.equipmentGroundDialog.showDialog(o.sub(t.mainCamera.node.position),null,e.itemData,e.equipData,null)}}),c.EventHelper.on(c.EventHelper.HUD_GROUND_EQUIPMENT_INFO_HIDE,function(){t.equipmentGroundDialog&&t.equipmentGroundDialog.hideDialog()}),c.EventHelper.on(c.EventHelper.HUD_GROUND_ITEM_INFO_SHOW,function(e){if(t.itemGroundDialog){var i=e.worldPos,o=t.node.convertToNodeSpaceAR(i);t.itemGroundDialog.showDialog(o.sub(t.mainCamera.node.position),null,e.itemData,null,null)}}),c.EventHelper.on(c.EventHelper.HUD_GROUND_ITEM_INFO_HIDE,function(){t.itemGroundDialog&&t.itemGroundDialog.hideDialog()}),c.EventHelper.on(c.EventHelper.USEITEM_KEYBOARD,function(e){t.userItem(e.index)}),c.EventHelper.on(c.EventHelper.HUD_FADE_IN,function(){t.fadeIn()}),c.EventHelper.on(c.EventHelper.HUD_FADE_OUT,function(){t.fadeOut()}),this.remote.node.parent.active=!0,this.shield.node.parent.active=!1;for(var e=0,i=d.default.EQUIP_TAGS;e<i.length;e++){var o=i[e];this.equipAndItemTimeDelays.set(o,0)}this.equipSprites.set(d.default.WEAPON,this.weapon),this.equipSprites.set(d.default.REMOTE,this.remote),this.equipSprites.set(d.default.SHIELD,this.shield),this.equipSprites.set(d.default.HELMET,this.helmet),this.equipSprites.set(d.default.CLOTHES,this.clothes),this.equipSprites.set(d.default.TROUSERS,this.trousers),this.equipSprites.set(d.default.GLOVES,this.gloves),this.equipSprites.set(d.default.SHOES,this.shoes),this.equipSprites.set(d.default.CLOAK,this.cloak)},e.prototype.initDialog=function(t){var e=cc.instantiate(this.equipmentAndItemDialogPrefab);e.parent=this.node;var i=e.getComponent(m.default);return i.changeBgAndAnchor(t?m.default.BG_TYPE_ARROW_DOWN:m.default.BG_TYPE_ARROW_RIGHT),i.hideDialog(),t||(e.parent=this.dialogNode),i},e.prototype.showEquipment=function(){this.equipmentNode.active=!this.equipmentNode.active,u.default.settings.showEquipDialog=this.equipmentNode.active,v.default.saveSwitch(v.default.KEY_SWITCH_SHOW_EQUIPDIALOG,u.default.settings.showEquipDialog)},e.prototype.fadeOut=function(){this.equipmentNode&&(this.node.opacity=255,cc.tween(this.equipmentNode).to(.5,{opacity:0}).start())},e.prototype.fadeIn=function(){this.equipmentNode&&(this.node.opacity=0,cc.tween(this.equipmentNode).to(3,{opacity:255}).start())},e.prototype.start=function(){var t=this;for(var e in this.equipSprites.forEach(function(e,i){e.spriteFrame=null,t.addEquipSpriteTouchEvent(e,i),t.equipCovers.set(i,e.node.parent.getChildByName("cover"))}),this.inventoryManager.equips)this.refreshEquipment(e,this.inventoryManager.equips[e].clone(),!0,!1);this.refreshItemRes();for(var i=[this.itemsprite1,this.itemsprite2,this.itemsprite3,this.itemsprite4,this.itemsprite5],o=[this.itemlabel1,this.itemlabel2,this.itemlabel3,this.itemlabel4,this.itemlabel5],a=0;a<o.length;a++)this.itemPositions[a]=i[a].node.convertToWorldSpaceAR(cc.Vec3.ZERO),this.addItemSpriteTouchEvent(i[a],o[a].node.parent,a),this.itemCovers.push(o[a].node.parent.getChildByName("cover"));this.refreshSuits(),u.default.inventoryManager.updateTotalEquipData()},e.prototype.addEquipSpriteTouchEvent=function(t,e){var i=this;t.node.parent.on(cc.Node.EventType.TOUCH_START,function(){if(null!=t.spriteFrame){var o=new h.default;if(i.inventoryManager.equips[e]&&(o=i.inventoryManager.equips[e].clone()),o.equipmetType!=d.default.EMPTY){var a=i.node.convertToNodeSpaceAR(t.node.parent.convertToWorldSpaceAR(cc.Vec3.ZERO));i.equipmentAndItemDialog.showDialog(a.add(cc.v3(-32,0)),null,null,o,null,i.inventoryManager,m.default.BG_TYPE_ARROW_RIGHT)}}}),t.node.parent.on(cc.Node.EventType.TOUCH_END,function(){i.equipmentAndItemDialog.hideDialog()}),t.node.parent.on(cc.Node.EventType.TOUCH_CANCEL,function(){i.equipmentAndItemDialog.hideDialog()})},e.prototype.addItemSpriteTouchEvent=function(t,e,i){var o=this,a=!1,n=!1;e.on(cc.Node.EventType.TOUCH_START,function(){null!=t.spriteFrame&&(n=!0,o.scheduleOnce(function(){if(n&&o.inventoryManager&&o.inventoryManager.itemList&&!(i>o.inventoryManager.itemList.length-1)){a=!0;var t=o.inventoryManager.itemList[i].clone();if(t.resName!=g.default.EMPTY){var r=o.node.convertToNodeSpaceAR(e.convertToWorldSpaceAR(cc.Vec3.ZERO));o.equipmentAndItemDialog.showDialog(r.add(cc.v3(32,0)),null,t,null,null,null,m.default.BG_TYPE_ARROW_LEFT)}}},.3))}),e.on(cc.Node.EventType.TOUCH_END,function(){o.equipmentAndItemDialog.hideDialog(),a||o.userItem(i),n=!1,a=!1}),e.on(cc.Node.EventType.TOUCH_CANCEL,function(){o.equipmentAndItemDialog.hideDialog(),n=!1,a=!1})},e.prototype.refreshSuits=function(){for(var t in this.inventoryManager.suitMap={},this.inventoryManager.suitEquipMap={},this.inventoryManager.equips){var e=this.inventoryManager.equips[t];if(!(e.suitType.length<1))if(this.inventoryManager.suitMap[e.suitType])this.inventoryManager.suitMap[e.suitType].count++;else{var i=new y.default;i.valueCopy(u.default.suits[e.suitType]),i.count=1,this.inventoryManager.suitMap[e.suitType]=i}}for(var t in this.inventoryManager.suitMap){var o=this.inventoryManager.suitMap[t],a=new h.default;if(o){for(var n=0;n<o.count-1;n++)n<o.EquipList.length&&a.add(o.EquipList[n]);this.inventoryManager.suitEquipMap[t]=a}}},e.prototype.refreshEquipmentRes=function(t){if(t){var e=this.inventoryManager.equips[t],i=cc.color(255,255,255).fromHEX(e.color),o=u.default.spriteFrameRes(e.img);e.equipmetType==d.default.CLOTHES?o=u.default.spriteFrameRes(e.img+"anim0"):e.equipmetType==d.default.HELMET?o=u.default.spriteFrameRes(e.img+"anim0"):e.equipmetType==d.default.REMOTE&&(o=u.default.spriteFrameRes(e.img+"anim0"));var a=this.equipSprites.get(t);switch(a&&(a.node.color=i,a.spriteFrame=1==e.trouserslong?u.default.spriteFrameRes("trousers000"):o,t==d.default.TROUSERS&&1==e.trouserslong&&(a.spriteFrame=u.default.spriteFrameRes("trousers000"))),t){case d.default.REMOTE:this.remote.node.parent.active=!0,this.shield.node.parent.active=!0,this.inventoryManager.equips[t].equipmetType!=d.default.EMPTY&&(this.shield.node.parent.active=!1);break;case d.default.SHIELD:this.remote.node.parent.active=!0,this.shield.node.parent.active=!0,this.inventoryManager.equips[t].equipmetType!=d.default.EMPTY?(this.remote.node.parent.active=!1,this.shield.node.parent.active=!0):(this.remote.node.parent.active=!0,this.shield.node.parent.active=!1)}this.dungeon&&this.dungeon.player&&this.dungeon.player.changeEquipment(t,e,o)}},e.prototype.refreshEquipment=function(t,e,i,o){if(e&&this.weapon&&t){var a=this.inventoryManager.equips[t],n=a&&a.equipmetType!=d.default.EMPTY;if(n||(t==d.default.REMOTE&&this.inventoryManager.equips[d.default.SHIELD].equipmetType!=d.default.EMPTY&&(n=!0),t==d.default.SHIELD&&this.inventoryManager.equips[d.default.REMOTE].equipmetType!=d.default.EMPTY&&(n=!0)),!o&&!i&&a&&n||e.requireLevel>u.default.playerData.OilGoldData.level)this.setEquipmentToBag(e,i);else{switch(a&&(this.setEquipmentToBag(a,i),a.valueCopy(e),i||c.EventHelper.emit(c.EventHelper.HUD_INVENTORY_EQUIP_UPDATE)),t){case d.default.REMOTE:this.inventoryManager.equips[t].equipmetType!=d.default.EMPTY&&(this.setEquipmentToBag(this.inventoryManager.equips[d.default.SHIELD],i),this.inventoryManager.equips[d.default.SHIELD].valueCopy(new h.default),this.refreshEquipmentRes(d.default.SHIELD));break;case d.default.SHIELD:this.inventoryManager.equips[t].equipmetType!=d.default.EMPTY&&(this.setEquipmentToBag(this.inventoryManager.equips[d.default.REMOTE],i),this.inventoryManager.equips[d.default.REMOTE].valueCopy(new h.default),this.refreshEquipmentRes(d.default.REMOTE))}this.refreshEquipmentRes(t)}}},e.prototype.getTimeDelay=function(t,e,i){return t||(t=0),(t+=i)>e?t=0:t},e.prototype.isTimeDelay=function(t,e,i){return!(i<=0)&&(this.equipAndItemTimeDelays.set(e,this.getTimeDelay(this.equipAndItemTimeDelays.get(e),i,t)),0==this.equipAndItemTimeDelays.get(e))},e.prototype.update=function(t){var e=this;if(!u.default.isGamePause){for(var i=this.inventoryManager.TotalEquipData,o=0,a=i.exTriggers;o<a.length;o++){var n=a[o];this.isTimeDelay(t,n.uuid,n.autoInterval)&&this.dungeon&&this.dungeon.player&&this.dungeon.player.exTriggerDo(n,T.default.GROUP_AUTO,T.default.TYPE_AUTO,f.default.getClone(i.nameCn,i.img),null)}var r=Date.now();for(var s in this.equipCovers.forEach(function(t,i){var o=e.inventoryManager.equips[i];if(o){var a=(r-o.lastTime)/(1e3*o.cooldown);a>1&&(a=1),t.height=t.width*(1-a)}}),this.equipCovers)(c=this.inventoryManager.equips[s])&&((p=(r-c.lastTime)/(1e3*c.cooldown))>1&&(p=1),this.equipCovers.get(s).height=this.equipCovers.get(s).width*(1-p));for(var l=0;l<this.inventoryManager.itemList.length;l++){for(var c,h=0,d=(c=this.inventoryManager.itemList[l]).exTriggers;h<d.length;h++)n=d[h],this.isTimeDelay(t,"itemIndex"+l,n.autoInterval)&&this.dungeon&&this.dungeon.player&&this.dungeon.player.exTriggerDo(n,T.default.GROUP_AUTO,T.default.TYPE_AUTO,f.default.getClone(c.nameCn,c.resName),null);var p;(p=(r-c.lastTime)/(1e3*c.cooldown))>1&&(p=1),this.itemCovers[l].height=this.itemCovers[l].width*(1-p)}}},e.prototype.userItem=function(t){if(this.inventoryManager&&this.inventoryManager.itemList&&!(t>this.inventoryManager.itemList.length-1)){var e=this.inventoryManager.itemList[t].clone();if(e.resName!=g.default.EMPTY&&this.dungeon.player.canEatOrDrink(e)){var i=Date.now();i-e.lastTime>1e3*e.cooldown&&(e.lastTime=i,-1!=e.count&&e.count--,e.count<=0&&-1!=e.count?this.inventoryManager.itemList[t].valueCopy(u.default.items[g.default.EMPTY]):this.inventoryManager.itemList[t].valueCopy(e),this.refreshItemRes(),e.resName!=g.default.EMPTY&&cc.director.emit(c.EventHelper.PLAYER_USEITEM,{detail:{itemData:e}}))}}},e.prototype.refreshItem=function(t,e){if(this.node){for(var i=!1,o=0;o<this.inventoryManager.itemList.length;o++){var a=this.inventoryManager.itemList[o];if(d.default.isItemEqualCanAdd(a,t)){var n=a.count+t.count;a.valueCopy(t),a.count=n,i=!0;break}}if(!i)for(o=0;o<this.inventoryManager.itemList.length;o++)if((a=this.inventoryManager.itemList[o]).resName==g.default.EMPTY){a.valueCopy(t),i=!0;break}if(!i)if(e){var r=this.inventoryManager.itemList[0].clone(),s=new Array;for(o=1;o<this.inventoryManager.itemList.length;o++)s.push(this.inventoryManager.itemList[o]);for(s.push(t),o=0;o<this.inventoryManager.itemList.length;o++)this.inventoryManager.itemList[o].valueCopy(s[o]);this.setItemToBag(r)}else this.setItemToBag(t);this.refreshItemRes()}},e.prototype.refreshItemRes=function(){for(var t=[this.itemsprite1,this.itemsprite2,this.itemsprite3,this.itemsprite4,this.itemsprite5],e=[this.itemlabel1,this.itemlabel2,this.itemlabel3,this.itemlabel4,this.itemlabel5],i=0;i<t.length;i++){var o=this.inventoryManager.itemList[i];t[i].spriteFrame=u.default.spriteFrameRes(o.resName),e[i].string=o.count>0?"x"+o.count:""}},e.prototype.setEquipmentToBag=function(t,e){if(!e&&t.equipmetType!=d.default.EMPTY){var i=u.default.inventoryManager.inventoryList,o=d.default.buildEquipInventoryData(t);_.default.addEquipOrItemToBag(o,i,d.default.MAX_BAG,!1,null)||(E.default.toast("\u7269\u54c1\u680f\u5df2\u6ee1\uff01"),c.EventHelper.emit(c.EventHelper.DUNGEON_SETEQUIPMENT,{res:t.img,equipmentData:t}))}},e.prototype.setItemToBag=function(t){var e=u.default.inventoryManager.inventoryList,i=d.default.buildItemInventoryData(t);_.default.addEquipOrItemToBag(i,e,d.default.MAX_BAG,!0,null)||(E.default.toast("\u7269\u54c1\u680f\u5df2\u6ee1\uff01"),c.EventHelper.emit(c.EventHelper.DUNGEON_ADD_ITEM,{res:t.resName,count:t.count}))},n([l(p.default)],e.prototype,"dungeon",void 0),n([l(cc.Sprite)],e.prototype,"weapon",void 0),n([l(cc.Sprite)],e.prototype,"remote",void 0),n([l(cc.Sprite)],e.prototype,"shield",void 0),n([l(cc.Sprite)],e.prototype,"helmet",void 0),n([l(cc.Sprite)],e.prototype,"clothes",void 0),n([l(cc.Sprite)],e.prototype,"trousers",void 0),n([l(cc.Sprite)],e.prototype,"gloves",void 0),n([l(cc.Sprite)],e.prototype,"shoes",void 0),n([l(cc.Sprite)],e.prototype,"cloak",void 0),n([l(cc.Sprite)],e.prototype,"itemsprite1",void 0),n([l(cc.Sprite)],e.prototype,"itemsprite2",void 0),n([l(cc.Sprite)],e.prototype,"itemsprite3",void 0),n([l(cc.Sprite)],e.prototype,"itemsprite4",void 0),n([l(cc.Sprite)],e.prototype,"itemsprite5",void 0),n([l(cc.Label)],e.prototype,"itemlabel1",void 0),n([l(cc.Label)],e.prototype,"itemlabel2",void 0),n([l(cc.Label)],e.prototype,"itemlabel3",void 0),n([l(cc.Label)],e.prototype,"itemlabel4",void 0),n([l(cc.Label)],e.prototype,"itemlabel5",void 0),n([l(cc.Prefab)],e.prototype,"equipmentAndItemDialogPrefab",void 0),n([l(cc.Camera)],e.prototype,"mainCamera",void 0),n([l(cc.Node)],e.prototype,"equipmentNode",void 0),n([l(cc.Node)],e.prototype,"dialogNode",void 0),n([s],e)}(cc.Component);i.default=D,cc._RF.pop()},{"../data/EquipmentData":"EquipmentData","../data/FromData":"FromData","../data/SuitData":"SuitData","../data/TriggerData":"TriggerData","../item/Item":"Item","../manager/InventoryManager":"InventoryManager","../ui/dialog/EquipmentAndItemDialog":"EquipmentAndItemDialog","../ui/dialog/InventoryDialog":"InventoryDialog","../utils/LocalStorage":"LocalStorage","../utils/Utils":"Utils","./Dungeon":"Dungeon","./EventHelper":"EventHelper","./Logic":"Logic"}],ItemData:[function(t,e,i){"use strict";cc._RF.push(e,"371e21tzPlAtY0KmtggGqZV","ItemData");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("./BaseData"),r=t("./CommonData"),s=function(t){function e(){var e=t.call(this)||this;return e.uuid="",e.id=2e7,e.pos=cc.v3(0,0),e.nameCn="",e.nameEn="",e.duration=0,e.desc="",e.info="",e.resName="emptyitem",e.price=0,e.isTaken=!1,e.count=1,e.cooldown=1,e.statusList="",e.canSave=0,e.sanity=0,e.solidSatiety=0,e.liquidSatiety=0,e.lastTime=0,e.exTriggers=[],e.common=new r.default,e}return a(e,t),Object.defineProperty(e.prototype,"Common",{get:function(){return this.common},enumerable:!1,configurable:!0}),e.prototype.valueCopy=function(t){t&&(this.uuid=t.uuid?t.uuid:"",this.id=t.id?t.id:2e7,this.common.valueCopy(t.common),this.pos=t.pos?cc.v3(t.pos.x,t.pos.y):cc.v3(0,0),this.nameCn=t.nameCn?t.nameCn:this.nameCn,this.nameEn=t.nameEn,this.duration=t.duration,this.resName=t.resName?t.resName:"emptyitem",this.info=t.info?t.info:"",this.desc=t.desc?t.desc:"",this.isTaken=!!t.isTaken&&t.isTaken,this.canSave=t.canSave?t.canSave:0,this.count=t.count?t.count:1,this.cooldown=t.cooldown?t.cooldown:1,this.price=t.price?t.price:0,this.statusList=t.statusList?t.statusList:"",this.sanity=t.sanity?t.sanity:0,this.solidSatiety=t.solidSatiety?t.solidSatiety:0,this.liquidSatiety=t.liquidSatiety?t.liquidSatiety:0,this.exTriggers=t.exTriggers?t.exTriggers:[],this.lastTime=t.lastTime?t.lastTime:0)},e.prototype.clone=function(){var t=new e;return t.uuid=this.uuid,t.id=this.id,t.common=this.common.clone(),t.pos=this.pos,t.nameCn=this.nameCn,t.nameEn=this.nameEn,t.duration=this.duration,t.info=this.info,t.desc=this.desc,t.resName=this.resName,t.isTaken=this.isTaken,t.canSave=this.canSave,t.count=this.count,t.cooldown=this.cooldown,t.price=this.price,t.statusList=this.statusList,t.sanity=this.sanity,t.solidSatiety=this.solidSatiety,t.liquidSatiety=this.liquidSatiety,t.exTriggers=this.exTriggers,t.lastTime=this.lastTime,t},e}(n.default);i.default=s,cc._RF.pop()},{"./BaseData":"BaseData","./CommonData":"CommonData"}],ItemManager:[function(t,e,i){"use strict";cc._RF.push(e,"9211357HjhKqavyVFqZ4zof","ItemManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../item/Coin"),s=t("../logic/Dungeon"),l=t("../item/OilGold"),c=t("../utils/IndexZ"),u=t("./BaseManager"),h=t("../logic/Logic"),d=t("../item/Item"),p=t("../logic/EventHelper"),f=cc._decorator,g=f.ccclass,y=f.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.coin=null,e.oilGold=null,e.item=null,e.groundList=[],e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.coinPool=new cc.NodePool,this.oilPool=new cc.NodePool,cc.director.on("destorycoin",function(e){t.destroyCoin(e.detail.coinNode)}),cc.director.on("destoryoilgold",function(e){t.destroyOilGold(e.detail.oilGoldNode)})},e.prototype.clear=function(){this.coinPool&&(this.coinPool.clear(),this.oilPool.clear()),this.groundList=[]},e.prototype.getValueCoin=function(t,e,i){for(var o=r.default.FACE_VALUE,a=t%o,n=0;n<a;n++)this.getCoinItem(1,e,i,!0);var s=(t-a)/o;for(n=0;n<s;n++)this.getCoinItem(o,e,i,!0)},e.prototype.getValueOilGold=function(t,e,i){for(var o=l.default.FACE_VALUE,a=t%o,n=0;n<a;n++)this.getCoinItem(1,e,i,!1);var r=(t-a)/o;for(n=0;n<r;n++)this.getCoinItem(o,e,i,!1)},e.prototype.getCoinItem=function(t,e,i,o){var a,n=o?this.coinPool:this.oilPool,u=o?this.coin:this.oilGold,h=i.getComponent(s.default);h&&(a=h.player);var d=null;n.size()>0&&(d=n.get()),d&&!d.active||(d=cc.instantiate(u)),d.parent=i,d.position=e;var p=o?d.getComponent(r.default):d.getComponent(l.default);p.entity.Transform.position=e,p.player=a,p.changeValue(t),p.node.zIndex=c.default.OVERHEAD,d.active=!0},e.prototype.destroyCoin=function(t){t.active=!1,this.coinPool&&this.coinPool.put(t)},e.prototype.destroyOilGold=function(t){t.active=!1,this.oilPool&&this.oilPool.put(t)},e.prototype.addItem=function(t,e,i,o){if(this.item&&h.default.items[e]){var a=cc.instantiate(this.item);a.parent=this.node,a.position=t;var n=s.default.getIndexInMap(t);a.zIndex=c.default.OVERHEAD;var r=a.getComponent(d.default);r.init(e,n.clone(),i,o);var l=a.getComponent(d.default).data;if(this.groundList.push(r),!o){var u=h.default.mapManager.getCurrentMapItems();u?u.push(l):((u=new Array).push(l),h.default.mapManager.setCurrentItemsArr(u))}}},e.prototype.addItemFromMap=function(t,e){"A0"==t&&this.addItem(s.default.getPosInMap(e),d.default.HEART),"A1"==t&&this.addItem(s.default.getPosInMap(e),d.default.DREAM),"A3"==t&&this.addItem(s.default.getPosInMap(e),d.default.REDCAPSULE),"A1"==t&&this.addItem(s.default.getPosInMap(e),d.default.BLUECAPSULE),"A4"==t&&this.addItem(s.default.getPosInMap(e),d.default.SHIELD),"A5"==t&&this.addItem(s.default.getPosInMap(e),d.default.GOLDAPPLE),"Aa"==t&&this.addItem(s.default.getPosInMap(e),d.default.BOTTLE_HEALING),"Ab"==t&&this.addItem(s.default.getPosInMap(e),d.default.BOTTLE_MOVESPEED),"Ac"==t&&this.addItem(s.default.getPosInMap(e),d.default.BOTTLE_ATTACK),"Ad"==t&&this.addItem(s.default.getPosInMap(e),d.default.BOTTLE_DREAM),"Ae"==t&&this.addItem(s.default.getPosInMap(e),d.default.BOTTLE_REMOTE)},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.2&&(this.checkTimeDelay=0,!0)},e.prototype.updateLogic=function(t,e){if(this.isCheckTimeDelay(t)){for(var i=200,o=null,a=this.groundList.length-1;a>=0;a--){var n=this.groundList[a];if(n.highLight(!1),n.isValid&&!n.data.isTaken){var r=h.default.getDistanceNoSqrt(n.node.position,e.node.position);r<i&&(i=r,o=n)}else this.groundList.splice(a,1)}i<(o&&o.data.canSave?64:48)&&o?(o.highLight(!0),o.taketips||(o.taketips=this.node.getChildByName("sprite").getChildByName("taketips")),o.data.canSave?(this.lastGroundItem&&this.lastGroundItem.uuid==o.uuid||(cc.tween(o.taketips).to(.2,{opacity:255}).delay(1).to(.2,{opacity:0}).start(),cc.director.emit(p.EventHelper.HUD_GROUND_ITEM_INFO_SHOW,{detail:{worldPos:o.node.convertToWorldSpaceAR(cc.v3(0,32)),itemData:o.data}})),this.lastGroundItem=o):e&&e.canEatOrDrink(o.data)&&(o.taken(e,!1),this.lastGroundItem=null)):(this.lastGroundItem=null,cc.director.emit(p.EventHelper.HUD_GROUND_ITEM_INFO_HIDE))}},n([y(cc.Prefab)],e.prototype,"coin",void 0),n([y(cc.Prefab)],e.prototype,"oilGold",void 0),n([y(cc.Prefab)],e.prototype,"item",void 0),n([g],e)}(u.default);i.default=m,cc._RF.pop()},{"../item/Coin":"Coin","../item/Item":"Item","../item/OilGold":"OilGold","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../utils/IndexZ":"IndexZ","./BaseManager":"BaseManager"}],Item:[function(t,e,i){"use strict";cc._RF.push(e,"ce4de5SY9BKg5Ay5wKpP9r7","Item");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=t("../logic/Logic"),l=t("../data/ItemData"),c=t("../utils/AudioPlayer"),u=t("../data/FromData"),h=t("../logic/Achievement"),d=t("../data/StatusData"),p=t("../manager/StatusManager"),f=cc._decorator,g=f.ccclass,y=(f.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=new l.default,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.taketips=this.node.getChildByName("sprite").getChildByName("taketips")},e.prototype.start=function(){this.anim=this.getComponent(cc.Animation)},e.prototype.init=function(t,e,i,o){this.data.valueCopy(s.default.items[t]),this.data.uuid=this.data.genNonDuplicateID();for(var a=0,n=this.data.exTriggers;a<n.length;a++)n[a].uuid=this.data.genNonDuplicateID();this.data.pos=e,this.data.count=i||this.data.count,o&&(this.shopTable=o,o.data.itemdata=new l.default,o.data.itemdata.valueCopy(s.default.items[t]),o.data.price=this.data.price);var r=s.default.spriteFrameRes(this.data.resName);r&&(this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.node.getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=r,this.sprite.node.width=r.getOriginalSize().width,this.sprite.node.height=r.getOriginalSize().height,this.mat=this.sprite.getComponent(cc.Sprite).getMaterial(0),this.mat.setProperty("textureSizeWidth",r.getTexture().width*this.sprite.node.scaleX),this.mat.setProperty("textureSizeHeight",r.getTexture().height*this.sprite.node.scaleY),this.mat.setProperty("outlineColor",cc.color(200,200,200)),this.highLight(!1))},e.prototype.highLight=function(t){this.mat||(this.mat=this.sprite.getComponent(cc.Sprite).getMaterial(0)),this.mat.setProperty("openOutline",t?1:0)},e.prototype.taken=function(t,e){return!this.data.isTaken&&(this.data.canSave&&this.shopTable?s.default.coins>=this.data.price&&(cc.director.emit(r.EventHelper.HUD_ADD_COIN,{detail:{count:-this.data.price}}),cc.director.emit(r.EventHelper.PLAY_AUDIO,{detail:{name:c.default.COIN}}),this._taken(t,e),this.shopTable.sale(!0),!0):(this._taken(t,e),!0))},e.prototype._taken=function(t,e){var o=this;!this.data.isTaken&&this.anim&&(this.anim.play("ItemTaken"),h.default.addItemAchievement(this.data.resName),this.data.isTaken=!0,c.default.play(c.default.PICK_ITEM),this.data.canSave<1?i.userIt(this.data,t):cc.director.emit(r.EventHelper.PLAYER_CHANGEITEM,{detail:{itemData:this.data,isReplace:e}}),this.scheduleOnce(function(){o.node&&(o.node.active=!1)},3));var a=s.default.mapManager.getCurrentMapItems(),n=new Array;if(a)for(var l=0,u=a;l<u.length;l++){var d=u[l];d.uuid&&d.uuid!=this.data.uuid&&n.push(d)}s.default.mapManager.setCurrentItemsArr(n),cc.director.emit(r.EventHelper.HUD_GROUND_ITEM_INFO_HIDE)},e.userIt=function(t,e){var o,a=u.default.getClone(t.nameCn,t.resName);switch(t.resName!=i.EMPTY&&t.canSave&&c.default.play(c.default.PICK_ITEM),t.resName){case i.GOLDFINGER:e.stopAllDebuffs()}if(t.statusList.length>0)for(var n=0,r=t.statusList.split(",");n<r.length;n++){var l=r[n];e.addStatus(l,a),e.dungeon.nonPlayerManager.isPetAlive()&&e.dungeon.nonPlayerManager.pet.addStatus(l,a)}(e.sanityChange(t.sanity),t.solidSatiety>0||t.liquidSatiety>0)&&(c.default.play(c.default.DRINK),t.solidSatiety&&((o=new d.default).valueCopy(s.default.status[p.default.EAT]),o.solidDirect=t.solidSatiety,e.addCustomStatus(o,a)),t.liquidSatiety&&((o=new d.default).valueCopy(s.default.status[p.default.DRINK]),o.liquidDirect=t.liquidSatiety,e.addCustomStatus(o,a)))},e.EMPTY="emptyitem",e.HEART="heart",e.DREAM="dream",e.BOTTLE_HEALING="bottle001",e.BOTTLE_MOVESPEED="bottle002",e.BOTTLE_ATTACK="bottle003",e.BOTTLE_DREAM="bottle004",e.BOTTLE_REMOTE="bottle005",e.REDCAPSULE="redcapsule",e.BLUECAPSULE="bluecapsule",e.SHIELD="shield",e.GOLDAPPLE="goldapple",e.GOLDFINGER="goldfinger",e.FRIEDRICE="food000",i=n([g],e)}(cc.Component));i.default=y,cc._RF.pop()},{"../data/FromData":"FromData","../data/ItemData":"ItemData","../data/StatusData":"StatusData","../logic/Achievement":"Achievement","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../manager/StatusManager":"StatusManager","../utils/AudioPlayer":"AudioPlayer"}],JoyController:[function(t,e,i){"use strict";cc._RF.push(e,"246e3R5w7RM/68kAxSEZZAX","JoyController");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./EventHelper"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anglePreDirQuadrant=23,e.fixedPoint=null,e.movePoint=null,e.movePointMoveRadius=100,e.timeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this.node.getContentSize();this.touchArea=new cc.Vec3(t.width,t.height),this.fixedPointMoveCenterPos=cc.v3(0,0),this.fixedPointMoveRadius=this.touchArea.x/2-this.movePointMoveRadius,this.node.on(cc.Node.EventType.TOUCH_START,function(t){if(-1==this.touchID){var e=t.getLocation(),i=new cc.Vec3(e.x,e.y);i.subSelf(this.node.position);var o=this.clampPos(i,this.fixedPointMoveCenterPos,this.fixedPointMoveRadius);this.movePointMoveCenterPos=o,this.setFixedPointPos(o),this.touchID=t.getID()}},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(this.touchID==t.getID()){var e=t.getLocation(),i=new cc.Vec3(e.x,e.y);i.subSelf(this.node.position);var o=this.clampPos(i,this.movePointMoveCenterPos,this.movePointMoveRadius);console.log(o),this.setMovePointPos(o)}},this),this.node.on(cc.Node.EventType.TOUCH_END,function(){this.init(),cc.director.emit(r.EventHelper.PLAYER_ATTACK)},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){this.init(),cc.director.emit(r.EventHelper.PLAYER_ATTACK)},this),this.init()},e.prototype.init=function(){this.touchID=-1,this.joystickInputDir=new cc.Vec3,this.setFixedPointPos(this.fixedPointMoveCenterPos),this.setMovePointPos(this.fixedPointMoveCenterPos)},e.prototype.setFixedPointPos=function(){this.fixedPoint.setPosition(cc.v3(0,0))},e.prototype.getFixedPointPos=function(){return this.fixedPoint.getPosition()},e.prototype.setMovePointPos=function(t){this.movePoint.setPosition(t)},e.prototype.getMovePointPos=function(){return this.movePoint.getPosition()},e.prototype.clampPos=function(t,e,i){var o=t.sub(e);return o.mag()>i?o.normalize().mul(i).add(e):t},e.prototype.getInputDir=function(){var t=this.movePoint.getPosition().sub(this.fixedPoint.getPosition());return t.mag()>0&&t.normalizeSelf(),t},e.prototype.getInputQuadrantDir=function(){return this.getVec2ByQuadrant(this.getDirQuadrant(this.getInputDir()))},e.prototype.getDirQuadrant=function(t){var e=null;return t.mag()>0&&(e=Math.floor(this.getAngleByVec2(t)/this.anglePreDirQuadrant)),e},e.prototype.getAngleByVec2=function(t){return 180*-Math.atan2(t.y,t.x)/Math.PI+this.anglePreDirQuadrant/2},e.prototype.getVec2ByAngle=function(t){var e=new cc.Vec2,i=(this.anglePreDirQuadrant/2-t)*(Math.PI/180);return e.x=Math.cos(i),e.y=Math.sin(i),e.normalizeSelf()},e.prototype.getVec2ByQuadrant=function(t){if(null!=t){var e=t*this.anglePreDirQuadrant;return e+=this.anglePreDirQuadrant/2,this.getVec2ByAngle(e)}return cc.Vec2.ZERO},e.prototype.sendMoveMessageToPlayer=function(t){var e=this.getInputQuadrantDir(),i=4;Math.abs(e.x)<Math.abs(e.y)&&(e.y>.3&&(i=0),e.y<-.3&&(i=1)),Math.abs(e.x)>Math.abs(e.y)&&(e.x<-.3&&(i=2),e.x>.3&&(i=3));var o=this.getInputDir();cc.director.emit(r.EventHelper.PLAYER_ROTATE,{detail:{dir:i,pos:o,dt:t}})},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.update=function(t){this.isTimeDelay(t)&&this.sendMoveMessageToPlayer(t)},n([c(cc.Integer)],e.prototype,"anglePreDirQuadrant",void 0),n([c(cc.Node)],e.prototype,"fixedPoint",void 0),n([c(cc.Node)],e.prototype,"movePoint",void 0),n([c],e.prototype,"movePointMoveRadius",void 0),n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"./EventHelper":"EventHelper"}],Joystick:[function(t,e,i){"use strict";cc._RF.push(e,"a3868eVgi9Ewpbgxpufia3p","Joystick");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Controller"),s=t("./EventHelper"),l=t("./Logic"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anglePreDirQuadrant=23,e.fixedPoint=null,e.movePoint=null,e.movePointMoveRadius=100,e.stopCount=0,e.timeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this,e=this.node.getContentSize();this.touchArea=new cc.Vec3(e.width,e.height),this.fixedPointMoveCenterPos=this.touchArea.div(0,this.touchArea),this.fixedPointMoveRadius=this.touchArea.x/2-this.movePointMoveRadius,this.node.on(cc.Node.EventType.TOUCH_START,function(e){if(!r.default.isMouseMode()&&-1==t.touchID){var i=e.getLocation(),o=new cc.Vec3(i.x,i.y),a=t.clampPos(o,t.fixedPointMoveCenterPos,t.fixedPointMoveRadius);t.movePointMoveCenterPos=a,t.setFixedPointPos(a),t.setMovePointPos(a),t.touchID=e.getID()}},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){if(!r.default.isMouseMode()&&t.touchID==e.getID()){var i=e.getLocation(),o=new cc.Vec3(i.x,i.y),a=t.clampPos(o,t.movePointMoveCenterPos,t.movePointMoveRadius);t.setMovePointPos(a)}},this),this.node.on(cc.Node.EventType.TOUCH_END,function(){r.default.isMouseMode()||t.init()},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){r.default.isMouseMode()||t.init()},this),this.init()},e.prototype.init=function(){this.touchID=-1,this.joystickInputDir=new cc.Vec3,this.setFixedPointPos(this.fixedPointMoveCenterPos),this.setMovePointPos(this.fixedPointMoveCenterPos)},e.prototype.setFixedPointPos=function(t){this.fixedPoint.setPosition(this.node.convertToNodeSpaceAR(t))},e.prototype.getFixedPointPos=function(){return this.fixedPoint.getPosition()},e.prototype.setMovePointPos=function(t){this.movePoint.setPosition(this.node.convertToNodeSpaceAR(t))},e.prototype.getMovePointPos=function(){return this.movePoint.getPosition()},e.prototype.clampPos=function(t,e,i){var o=t.sub(e);return o.mag()>i?o.normalize().mul(i).add(e):t},e.prototype.getInputDir=function(){var t=this.movePoint.getPosition().sub(this.fixedPoint.getPosition());return(isNaN(t.x)||isNaN(t.y))&&(t=cc.v2(0,0)),t.mag()>0&&t.normalizeSelf(),t},e.prototype.getInputQuadrantDir=function(){return this.getVec2ByQuadrant(this.getDirQuadrant(this.getInputDir()))},e.prototype.getDirQuadrant=function(t){var e=null;return t.mag()>0&&(e=Math.floor(this.getAngleByVec2(t)/this.anglePreDirQuadrant)),e},e.prototype.getAngleByVec2=function(t){return 180*-Math.atan2(t.y,t.x)/Math.PI+this.anglePreDirQuadrant/2},e.prototype.getVec2ByAngle=function(t){var e=new cc.Vec2,i=(this.anglePreDirQuadrant/2-t)*(Math.PI/180);return e.x=Math.cos(i),e.y=Math.sin(i),e.normalizeSelf()},e.prototype.getVec2ByQuadrant=function(t){if(null!=t){var e=t*this.anglePreDirQuadrant;return e+=this.anglePreDirQuadrant/2,this.getVec2ByAngle(e)}return cc.Vec2.ZERO},e.prototype.sendMoveMessageToPlayer=function(t){if(!l.default.isGamePause){var e=this.getInputQuadrantDir(),i=4;Math.abs(e.x)<Math.abs(e.y)&&(e.y>.3&&(i=0),e.y<-.3&&(i=1)),Math.abs(e.x)>Math.abs(e.y)&&(e.x<-.3&&(i=2),e.x>.3&&(i=3));var o=this.getInputDir();o.equals(cc.Vec2.ZERO)?this.stopCount++:this.stopCount=0,this.stopCount<2&&cc.director.emit(s.EventHelper.PLAYER_MOVE,{detail:{dir:i,pos:o,dt:t}})}},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.update=function(t){this.isTimeDelay(t)&&this.sendMoveMessageToPlayer(t)},n([h(cc.Integer)],e.prototype,"anglePreDirQuadrant",void 0),n([h(cc.Node)],e.prototype,"fixedPoint",void 0),n([h(cc.Node)],e.prototype,"movePoint",void 0),n([h],e.prototype,"movePointMoveRadius",void 0),n([u],e)}(cc.Component);i.default=d,cc._RF.pop()},{"./Controller":"Controller","./EventHelper":"EventHelper","./Logic":"Logic"}],KeyboardController:[function(t,e,i){"use strict";cc._RF.push(e,"b57f7ePcl9JD6/oAh/+vpUg","KeyboardController");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./EventHelper"),s=t("./Logic"),l=cc._decorator,c=l.ccclass,u=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stopCount=0,e.isUp=!1,e.isDown=!1,e.isLeft=!1,e.isRight=!1,e.isA=!1,e.isB=!1,e.isC=!1,e.isD=!1,e.isE=!1,e.isLongPress=!1,e.touchStart=!1,e.timeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.start=function(){},e.prototype.onKeyDown=function(t){var e=this;switch(t.keyCode){case cc.macro.KEY.w:this.isUp=!0;break;case cc.macro.KEY.s:this.isDown=!0;break;case cc.macro.KEY.a:this.isLeft=!0;break;case cc.macro.KEY.d:this.isRight=!0;break;case cc.macro.KEY.i:this.openInventory();break;case cc.macro.KEY.u:this.openCellphone();break;case cc.macro.KEY.j:this.isA=!0;break;case cc.macro.KEY.space:this.isB=!0;break;case cc.macro.KEY.e:this.isC=!0,this.touchStart=!0,this.scheduleOnce(function(){e.touchStart&&(e.isLongPress=!0,e.trigger(!0))},.3);break;case cc.macro.KEY.r:this.isD=!0;break;case cc.macro.KEY.f:this.isE=!0;break;case cc.macro.KEY.num1:this.useItem(0);break;case cc.macro.KEY.num2:this.useItem(1);break;case cc.macro.KEY.num3:this.useItem(2);break;case 49:this.useItem(0);break;case 50:this.useItem(1);break;case 51:this.useItem(2);break;case cc.macro.KEY.escape:r.EventHelper.emit(r.EventHelper.HUD_CANCEL_OR_PAUSE);break;case cc.macro.KEY.m:r.EventHelper.emit(r.EventHelper.OPEN_MINIMAP)}},e.prototype.trigger=function(t){s.default.isGamePause||r.EventHelper.emit(r.EventHelper.PLAYER_TRIGGER,{isLongPress:t})},e.prototype.openInventory=function(){s.default.isGamePause||r.EventHelper.emit(r.EventHelper.HUD_INVENTORY_SHOW)},e.prototype.openCellphone=function(){s.default.isGamePause||r.EventHelper.emit(r.EventHelper.HUD_CELLPHONE_SHOW)},e.prototype.useItem=function(t){s.default.isGamePause||r.EventHelper.emit(r.EventHelper.USEITEM_KEYBOARD,{index:t})},e.prototype.onKeyUp=function(t){switch(t.keyCode){case cc.macro.KEY.w:this.isUp=!1;break;case cc.macro.KEY.s:this.isDown=!1;break;case cc.macro.KEY.a:this.isLeft=!1;break;case cc.macro.KEY.d:this.isRight=!1;break;case cc.macro.KEY.j:this.isA=!1;break;case cc.macro.KEY.space:this.isB=!1,r.EventHelper.emit(r.EventHelper.PLAYER_REMOTEATTACK_CANCEL);break;case cc.macro.KEY.e:this.isC=!1,this.isLongPress||this.trigger(),this.touchStart=!1,this.isLongPress=!1;break;case cc.macro.KEY.r:this.isD=!1;break;case cc.macro.KEY.f:this.isE=!1}},e.prototype.update=function(t){this.isTimeDelay(t)&&this.sendMoveMessageToPlayer(t)},e.prototype.sendMoveMessageToPlayer=function(t){var e=cc.v3(0,0);this.isUp&&e.addSelf(cc.v3(0,.9)),this.isDown&&e.addSelf(cc.v3(0,-.9)),this.isLeft&&e.addSelf(cc.v3(-.9,0)),this.isRight&&e.addSelf(cc.v3(.9,0)),e.mag()>0&&e.normalizeSelf();var i=4;if(Math.abs(e.x)<Math.abs(e.y)&&(e.y>.3&&(i=0),e.y<-.3&&(i=1)),Math.abs(e.x)>Math.abs(e.y)&&(e.x<-.3&&(i=2),e.x>.3&&(i=3)),e.equals(cc.Vec3.ZERO)?this.stopCount++:this.stopCount=0,s.default.isGamePause)return this.isA&&cc.director.emit(r.EventHelper.KEYBOARD_INTERACT),void(this.stopCount<2&&cc.director.emit(r.EventHelper.KEYBOARD_MOVE,{detail:{dir:i,pos:e,dt:t}}));this.stopCount<2&&cc.director.emit(r.EventHelper.PLAYER_MOVE,{detail:{dir:i,pos:e,dt:t}}),this.isA&&cc.director.emit(r.EventHelper.PLAYER_ATTACK),this.isB&&cc.director.emit(r.EventHelper.PLAYER_REMOTEATTACK),this.isD&&cc.director.emit(r.EventHelper.PLAYER_SKILL),this.isE&&cc.director.emit(r.EventHelper.PLAYER_SKILL1)},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.03&&(this.timeDelay=0,!0)},n([c],e)}(cc.Component));i.default=u,cc._RF.pop()},{"./EventHelper":"EventHelper","./Logic":"Logic"}],KrakenSwingHand:[function(t,e,i){"use strict";cc._RF.push(e,"15ea4rtPQxD8pcJLX7yPozV","KrakenSwingHand");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../data/FromData"),l=t("./Kraken"),c=t("../utils/ActorUtils"),u=t("../base/BaseColliderComponent"),h=cc._decorator,d=h.ccclass,p=h.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.damage=2,e.isShow=!1,e}return a(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.anim=this.node.parent.getComponent(cc.Animation)},e.prototype.swing=function(){this.anim.play()},e.prototype.start=function(){this.isShow=!1},e.prototype.onColliderEnter=function(t){var e=c.default.getEnemyCollisionTarget(t);if(e&&this.isShow&&this.node.active){this.node.stopAllActions();var i=new r.default;i.physicalDamage=this.damage,e.takeDamage(i,s.default.getClone(this.actorName(),"boss001"),this.node.parent.getComponent(l.default))}},e.prototype.actorName=function(){return"\u6d77\u5996"},n([p],e.prototype,"damage",void 0),n([d],e)}(u.default);i.default=f,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../data/DamageData":"DamageData","../data/FromData":"FromData","../utils/ActorUtils":"ActorUtils","./Kraken":"Kraken"}],Kraken:[function(t,e,i){"use strict";cc._RF.push(e,"cbbb1U+Yy5Jtb8PV4hyvH/c","Kraken");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Shooter"),s=t("../logic/EventHelper"),l=t("./KrakenSwingHand"),c=t("../logic/Dungeon"),u=t("../logic/Logic"),h=t("./Boss"),d=t("../utils/NextStep"),p=t("../utils/AudioPlayer"),f=t("../data/FromData"),g=t("../logic/Achievement"),y=t("../utils/IndexZ"),m=t("../item/Item"),v=cc._decorator,E=v.ccclass,_=v.property,T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.swingHand=null,e.timeDelay=0,e.remoteSkill=new d.default,e.handSkill=new d.default,e.nearHandSkill=new d.default,e.hands=[],e.actionTimeDelay=0,e}return a(e,t),e.prototype.init=function(){throw new Error("Method not implemented.")},e.prototype.onLoad=function(){this.sc.isDied=!1,this.sc.isShow=!1,this.shooter=this.getComponentInChildren(r.default),this.shooter.from.valueCopy(f.default.getClone(this.actorName(),"boss001")),this.anim=this.getComponent(cc.Animation)},e.prototype.ShowFinish=function(){this.anim.play("KrakenHeadIdle"),this.sc.isShow=!0;var t=c.default.getPosInMap(cc.v3(c.default.WIDTH_SIZE,-4)),e=c.default.getPosInMap(cc.v3(-2,-4)),i=c.default.getPosInMap(cc.v3(c.default.WIDTH_SIZE,c.default.HEIGHT_SIZE)),o=c.default.getPosInMap(cc.v3(-2,c.default.HEIGHT_SIZE));this.hand01=this.addHand(t,!0,!0),this.hand02=this.addHand(e,!1,!0),this.hand03=this.addHand(i,!0,!1),this.hand04=this.addHand(o,!1,!1)},e.prototype.addHand=function(t,e,i){var o=cc.instantiate(this.swingHand);this.dungeon.node.addChild(o),o.setPosition(t),o.scaleX=e?-80:80,o.scaleY=i?-80:80,o.zIndex=y.default.OVERHEAD;var a=o.getComponentInChildren(l.default);return this.scheduleOnce(function(){a.isShow=!0},2),this.hands.push(a),a},e.prototype.updatePlayerPos=function(){var t=c.default.getPosInMap(cc.v3(c.default.WIDTH_SIZE/2,c.default.HEIGHT_SIZE+2));this.entity.Transform.position=t,this.node.setPosition(t)},e.prototype.changeZIndex=function(){this.node.zIndex=y.default.KRAKENBODY},e.prototype.start=function(){t.prototype.start.call(this)},e.prototype.takeDamage=function(t){var e=this;if(this.sc.isDied||!this.sc.isShow)return!1;this.data.currentHealth-=this.data.getDamage(t).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth);var i=[p.default.MONSTER_HIT,p.default.MONSTER_HIT1,p.default.MONSTER_HIT2];return p.default.play(i[u.default.getRandomNum(0,2)]),this.nearHandSkill.next(function(){e.dungeon.player.pos.x>c.default.WIDTH_SIZE/2?e.hand03&&e.hand03.swing():e.hand04&&e.hand04.swing()},5),!0},e.prototype.killed=function(){var t=this;if(!this.sc.isDied){g.default.addMonsterKillAchievement(this.data.resName),this.sc.isDied=!0,this.changeZIndex();for(var e=0,i=this.hands;e<i.length;e++){var o=i[e];o.isShow=!1,o.node.active=!1}this.scheduleOnce(function(){t.node&&(t.node.active=!1)},5),this.getLoot()}},e.prototype.getLoot=function(t){if(this.dungeon){var e=u.default.mapManager.getRandom4Save(this.seed),i=cc.v3(Math.floor(c.default.WIDTH_SIZE/2),Math.floor(c.default.HEIGHT_SIZE/2)),o=c.default.getPosInMap(i);cc.director.emit(s.EventHelper.DUNGEON_ADD_COIN,{detail:{pos:o,count:19}}),t||s.EventHelper.emit(s.EventHelper.DUNGEON_ADD_OILGOLD,{pos:this.entity.Transform.position,count:100}),(u.default.getHalfChance()&&t||!t)&&(cc.director.emit(s.EventHelper.DUNGEON_ADD_ITEM,{detail:{pos:this.entity.Transform.position,res:m.default.HEART}}),cc.director.emit(s.EventHelper.DUNGEON_ADD_ITEM,{detail:{pos:this.entity.Transform.position,res:m.default.DREAM}})),this.dungeon.addEquipment(u.default.getRandomEquipType(e),c.default.getPosInMap(i),null,3)}},e.prototype.showBoss=function(){this.entity.NodeRender.node=this.node,this.entity.Move.linearDamping=10,this.healthBar&&(this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.healthBar.node.active=!this.sc.isDied),this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play("KrakenHeadShow")},e.prototype.isActionTimeDelay=function(t){return this.actionTimeDelay+=t,this.actionTimeDelay>.2&&(this.actionTimeDelay=0,!0)},e.prototype.updateLogic=function(t){this.isActionTimeDelay(t)&&this.bossAction(),this.data.currentHealth<1&&this.killed(),this.label&&(this.label.string=""+this.node.zIndex),this.healthBar.node.active=!this.sc.isDied},e.prototype.bossAction=function(){var t=this;!this.sc.isDied&&this.sc.isShow&&this.dungeon&&(this.hand01&&(this.hand01.node.parent.y=u.default.lerp(this.hand01.node.y,this.dungeon.player.node.y,.1)),this.hand02&&(this.hand02.node.parent.y=u.default.lerp(this.hand02.node.y,this.dungeon.player.node.y,.1)),this.shooter&&this.remoteSkill.next(function(){var e=t.entity.Transform.position.clone().add(t.shooter.node.position),i=t.dungeon.player.getCenterPosition().sub(e);i.equals(cc.Vec3.ZERO)||(t.shooter.setHv(cc.v2(i).normalize()),t.shooter.dungeon=t.dungeon,t.shooter.data.bulletType="bullet004",t.shooter.fireBullet(),t.shooter.fireBullet(30),t.shooter.fireBullet(-30)),t.data.currentHealth<t.data.Common.maxHealth/2&&(t.dungeon.addFallStone(t.dungeon.player.node.position,!0),t.shooter.fireBullet(30),t.shooter.fireBullet(-30),t.shooter.fireBullet(15),t.shooter.fireBullet(-15))},3),this.handSkill.next(function(){t.dungeon.player.pos.x>c.default.WIDTH_SIZE/2?t.hand01&&t.hand01.swing():t.hand02&&t.hand02.swing()},10))},e.prototype.actorName=function(){return"\u6d77\u5996"},n([_(cc.Label)],e.prototype,"label",void 0),n([_(cc.Prefab)],e.prototype,"swingHand",void 0),n([E],e)}(h.default);i.default=T,cc._RF.pop()},{"../data/FromData":"FromData","../item/Item":"Item","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/NextStep":"NextStep","./Boss":"Boss","./KrakenSwingHand":"KrakenSwingHand"}],Laser:[function(t,e,i){"use strict";cc._RF.push(e,"5c9a5lk5itEM7gD+Oy8SkoT","Laser");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/NonPlayer"),s=t("../logic/Player"),l=t("../data/DamageData"),c=t("../logic/Logic"),u=t("../boss/Boss"),h=t("../data/BulletData"),d=t("../manager/StatusManager"),p=t("../utils/AudioPlayer"),f=t("../data/FromData"),g=t("../building/HitBuilding"),y=t("../base/Actor"),m=t("../building/InteractBuilding"),v=t("../building/EnergyShield"),E=t("../utils/Utils"),_=t("../logic/MeleeShadowWeapon"),T=t("../logic/MeleeWeapon"),D=t("../logic/Shield"),S=t("../collider/CCollider"),O=t("../base/BaseColliderComponent"),A=t("../ecs/system/GameWorldSystem"),C=cc._decorator,R=C.ccclass,L=(C.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=new h.default,e.dir=0,e.tagetPos=cc.v3(0,0),e.hv=cc.v2(0,0),e.isFromPlayer=!1,e.isReserved=!1,e.isStop=!1,e.targetMap=new Map,e.sensorTargetMap=new Map,e.ignoreMap=new Map,e.startPos=cc.v2(0,0),e.angleOffset=0,e.timeDelay=0,e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.collider=this.getComponent(S.default),this.initSpriteNode();for(var e=0,i=[S.default.TAG.BOSS,S.default.TAG.BUILDING,S.default.TAG.ENERGY_SHIELD,S.default.TAG.WALL,S.default.TAG.WALL_TOP];e<i.length;e++){var o=i[e];this.targetMap.set(o,!0)}for(var a=0,n=[S.default.TAG.ENERGY_SHIELD];a<n.length;a++)o=n[a],this.sensorTargetMap.set(o,!0)},e.prototype.initIgnoreMap=function(t){if(!t)return!1;this.ignoreMap.clear();var e=t.node.getComponentsInChildren(S.default);if(e&&e.length>0)for(var i=0,o=e;i<o.length;i++){var a=o[i];this.ignoreMap.set(a.id,!0)}return!0},e.prototype.initSpriteNode=function(){this.sprite||(this.sprite=this.node.getChildByName("sprite"),this.lineNode=this.sprite.getChildByName("line"),this.lightSprite=this.sprite.getChildByName("light").getComponent(cc.Sprite),this.lightCenterSprite=this.sprite.getChildByName("light").getChildByName("center").getComponent(cc.Sprite),this.headSprite=this.sprite.getChildByName("head").getComponent(cc.Sprite),this.graphics=this.node.getComponent(cc.Graphics))},e.prototype.onEnable=function(){this.tagetPos=cc.v3(0,0),this.entity.NodeRender.node=this.node,this.entity.Move.linearVelocity=cc.v2(0,0),this.initSpriteNode(),this.isReserved=!1},e.prototype.update=function(t){c.default.isGamePause?this.entity.Move.linearVelocity=cc.v2(0,0):(this.updatePos(),this.checkTimeDelay+=t,this.checkTimeDelay>.15&&(this.updateLaser(),this.checkTimeDelay=0))},e.prototype.changeBullet=function(t){this.data=t,this.node.scale=t.size>0?t.size:1,this.collider.h=16,this.collider.w=0,this.collider.offset=cc.v2(0,0),this.collider.sensor=0==t.isPhysical,this.node.stopAllActions(),this.initSpriteNode(),this.initIgnoreMap(this.shooter.getParentNode().getComponent(y.default))},e.prototype.fire=function(t,e){var i=this;this.hv=t,this.angleOffset=e,this.node.stopAllActions(),this.unscheduleAllCallbacks(),this.rotateCollider(cc.v2(this.hv.x,this.hv.y)),this.isStop=!1,this.data.lifeTime>0?this.scheduleOnce(function(){i.stopLaser()},this.data.lifeTime):this.scheduleOnce(function(){i.stopLaser()},5),this.lightSprite.node.color=cc.color(255,255,255).fromHEX(this.data.lightColor),cc.tween(this.lightSprite.node).repeatForever(cc.tween().delay(.05).call(function(){i.lightSprite.spriteFrame=i.getSpriteFrameByName("laser000light001"),i.lightCenterSprite.spriteFrame=i.getSpriteFrameByName("laser000light001")}).delay(.05).call(function(){i.lightSprite.spriteFrame=i.getSpriteFrameByName("laser000light002"),i.lightCenterSprite.spriteFrame=i.getSpriteFrameByName("laser000light002")}).delay(.05).call(function(){i.lightSprite.spriteFrame=i.getSpriteFrameByName("laser000light003"),i.lightCenterSprite.spriteFrame=i.getSpriteFrameByName("laser000light003")})).start(),cc.tween(this.sprite).repeatForever(cc.tween(this.sprite).to(.1,{scaleY:.9}).to(.1,{scaleY:1.1})).start(),this.isFromPlayer?(this.targetMap.has(S.default.TAG.PLAYER)&&this.targetMap.delete(S.default.TAG.PLAYER),this.targetMap.has(S.default.TAG.GOODNONPLAYER)&&this.targetMap.delete(S.default.TAG.GOODNONPLAYER),this.sensorTargetMap.has(S.default.TAG.ENERGY_SHIELD)&&this.sensorTargetMap.delete(S.default.TAG.ENERGY_SHIELD),this.sensorTargetMap.has(S.default.TAG.PLAYER_HIT)&&this.sensorTargetMap.delete(S.default.TAG.PLAYER_HIT),this.targetMap.set(S.default.TAG.NONPLAYER,!0),this.targetMap.set(S.default.TAG.BOSS,!0)):(this.targetMap.has(S.default.TAG.NONPLAYER)&&this.targetMap.delete(S.default.TAG.PLAYER),this.targetMap.has(S.default.TAG.BOSS)&&this.targetMap.delete(S.default.TAG.BOSS),this.targetMap.set(S.default.TAG.PLAYER,!0),this.targetMap.set(S.default.TAG.GOODNONPLAYER,!0),this.sensorTargetMap.set(S.default.TAG.ENERGY_SHIELD,!0),this.sensorTargetMap.set(S.default.TAG.PLAYER_HIT,!0)),this.updatePos(),this.updateLaser(),p.default.play(p.default.REMOTE_LASER)},e.prototype.updatePos=function(){var t=this.shooter.defaultPos.clone(),e=this.shooter.node.convertToWorldSpaceAR(t);this.startPos=cc.v2(e.clone()),e=this.dungeon.node.convertToNodeSpaceAR(e),this.entity.Transform.position=e,this.node.position=e,this.hv=cc.v2(this.shooter.Hv).rotateSelf(this.angleOffset*Math.PI/180),this.rotateCollider(cc.v2(this.hv.x,this.hv.y))},e.prototype.updateLaser=function(){if(this.shooter&&!this.isStop){var t=this.node.convertToWorldSpaceAR(cc.v2(this.data.laserRange>0?this.data.laserRange:3e3,0)),e=A.default.colliderSystem.nearestRayCast(this.startPos,t,this.targetMap,this.sensorTargetMap,this.ignoreMap);e&&(t=e.point);var i=c.default.getDistance(this.startPos,t);i<=0&&(i=0);var o=i;this.lineNode.width=o/this.node.scaleY,this.lightSprite.node.setPosition(this.lineNode.width,0),this.graphics.clear();var a=cc.color(255,255,255).fromHEX(this.data.lightColor);this.graphics.strokeColor=a,this.graphics.lineWidth=32,this.graphics.moveTo(0,0),this.graphics.lineTo(this.lightSprite.node.position.x+32,0),this.graphics.stroke(),this.graphics.lineWidth=64,this.graphics.moveTo(0,0),this.graphics.lineTo(1,0),this.graphics.stroke(),this.graphics.moveTo(this.lightSprite.node.position.x+32,0),this.graphics.lineTo(this.lightSprite.node.position.x+32+1,0),this.graphics.stroke(),e&&this.attacking(e.collider.node,e.collider.tag)}},e.prototype.stopLaser=function(){var t=this;this.isStop=!0,cc.tween(this.node).to(.2,{scaleY:0}).to(.1,{scaleX:0}).call(function(){t.shooter.addDestroyBullet(t.node,!0)}).start()},e.prototype.getSpriteFrameByName=function(t,e,i){var o=c.default.spriteFrameRes(t+e);return o||(o=c.default.spriteFrameRes(i?t+"anim000":t)),o},e.prototype.attacking=function(t,e){if(t){var i=new l.default,o=!1;if(i.valueCopy(this.data.damage),i.isRemote=!0,e==S.default.TAG.NONPLAYER||e==S.default.TAG.GOODNONPLAYER){var a=t.getComponent(r.default);a&&!a.sc.isDied&&(o=a.takeDamage(i))&&this.addTargetAllStatus(a,new f.default)}else if(e==S.default.TAG.PLAYER){var n=t.getComponent(s.default);if(n&&!n.sc.isDied){var c=!1;n.shield.Status==D.default.STATUS_PARRY&&1==n.shield.data.isReflect&&(c=this.revserseBullet(n.node.convertToWorldSpaceAR(cc.Vec2.ZERO))),c||(o=n.takeDamage(i,this.data.from))&&this.addTargetAllStatus(n,this.data.from)}}else if(e==S.default.TAG.BOSS){var h=t.getComponent(u.default);h&&!h.sc.isDied&&(o=h.takeDamage(i))&&this.addTargetAllStatus(h,new f.default)}else if(e==S.default.TAG.PLAYER_HIT){var d=t.getComponent(T.default),p=void 0;if(d||(p=t.getComponent(_.default))&&(d=p.meleeWeapon),d&&d.IsAttacking&&!this.isFromPlayer&&(c=!1,d.IsReflect)){var y=p?p.meleeWeapon.node:d.node;c=this.revserseBullet(y.convertToWorldSpaceAR(cc.Vec2.ZERO))}}else if(e==S.default.TAG.BUILDING||e==S.default.TAG.WALL||e==S.default.TAG.WALL_TOP){var E=t.getComponent(m.default);if(1==this.data.canBreakBuilding&&E&&(o=!0,E.takeDamage(i)),!o){var O=t.getComponent(g.default);1==this.data.canBreakBuilding&&O&&(o=!0,O.takeDamage(i))}}else if(!this.isFromPlayer&&e==S.default.TAG.ENERGY_SHIELD){var A=t.getComponent(v.default);A&&A.isValid&&(o=A.takeDamage(i))}}},e.prototype.revserseBullet=function(){if(this.isReserved)return this.isReserved=!0,!1;if(1!=this.data.isLaser){var t=-180+c.default.getRandomNum(0,10)-20;return this.node.angle+=t,this.isFromPlayer=!0,this.data.isTracking=0,!0}return!1},e.prototype.rotateCollider=function(t){t.equals(cc.Vec2.ZERO)||1!=this.data.fixedRotation&&(this.node.angle=E.default.getRotateAngle(t,this.node.scaleX<0))},e.prototype.addTargetAllStatus=function(t,e){this.addTargetStatus(this.data.damage.iceRate,t,d.default.FROZEN,e),this.addTargetStatus(this.data.damage.fireRate,t,d.default.BURNING,e),this.addTargetStatus(this.data.damage.lighteningRate,t,d.default.DIZZ,e),this.addTargetStatus(this.data.damage.toxicRate,t,d.default.TOXICOSIS,e),this.addTargetStatus(this.data.damage.curseRate,t,d.default.CURSING,e),this.addTargetStatus(this.data.damage.realRate,t,d.default.BLEEDING,e),this.addTargetStatus(this.data.statusRate,t,this.data.statusType,e)},e.prototype.addTargetStatus=function(t,e,i,o){c.default.getRandomNum(0,100)<t&&e.addStatus(i,o)},n([R],e)}(O.default));i.default=L,cc._RF.pop()},{"../base/Actor":"Actor","../base/BaseColliderComponent":"BaseColliderComponent","../boss/Boss":"Boss","../building/EnergyShield":"EnergyShield","../building/HitBuilding":"HitBuilding","../building/InteractBuilding":"InteractBuilding","../collider/CCollider":"CCollider","../data/BulletData":"BulletData","../data/DamageData":"DamageData","../data/FromData":"FromData","../ecs/system/GameWorldSystem":"GameWorldSystem","../logic/Logic":"Logic","../logic/MeleeShadowWeapon":"MeleeShadowWeapon","../logic/MeleeWeapon":"MeleeWeapon","../logic/NonPlayer":"NonPlayer","../logic/Player":"Player","../logic/Shield":"Shield","../manager/StatusManager":"StatusManager","../utils/AudioPlayer":"AudioPlayer","../utils/Utils":"Utils"}],LevelData:[function(t,e,i){"use strict";cc._RF.push(e,"58686Q/aZlPRJziOF8GmsMo","LevelData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./ExitData"),a=function(){function t(){this.name="",this.index=0,this.chapter=0,this.width=0,this.height=0,this.seed=0,this.roomWidth=0,this.roomHeight=0,this.floorRes="",this.floorCoverRes="",this.floorCoverRes1="",this.floorCoverRes2="",this.floorCoverRes3="",this.floorCoverRes4="",this.floorCoverRes5="",this.wallRes1="",this.wallRes2="",this.wallRes3="",this.wallRes4="",this.wallRes5="",this.wallRes6="",this.doorRes="",this.exitRes="",this.needRadomDecorate=!1,this.isWater=!1,this.map=[],this.roomTypes=[],this.minimap=[],this.minimaplock=[],this.exits=""}return t.prototype.valueCopy=function(t){this.name=t.name,this.index=t.index,this.chapter=t.chapter,this.width=t.width,this.height=t.height,this.seed=t.seed,this.roomWidth=t.roomWidth,this.roomHeight=t.roomHeight,this.map=t.map,this.roomTypes=t.roomTypes,this.minimap=t.minimap,this.minimaplock=t.minimaplock,this.floorRes=t.floorRes,this.floorCoverRes=t.floorCoverRes,this.floorCoverRes1=t.floorCoverRes1,this.floorCoverRes2=t.floorCoverRes2,this.floorCoverRes3=t.floorCoverRes3,this.floorCoverRes4=t.floorCoverRes4,this.floorCoverRes5=t.floorCoverRes5,this.wallRes1=t.wallRes1,this.wallRes2=t.wallRes2,this.wallRes3=t.wallRes3,this.wallRes4=t.wallRes4,this.wallRes5=t.wallRes5,this.wallRes6=t.wallRes6,this.doorRes=t.doorRes,this.exitRes=t.exitRes,this.exits=t.exits,this.needRadomDecorate=t.needRadomDecorate,this.isWater=t.isWater,this.lights=t.lights},t.prototype.getRoomMap=function(t,e){var i=new Array;if(t<0||e<0||t>this.width-1||e>this.height-1)return i;for(var o=0;o<this.roomWidth;o++){i[o]=new Array;for(var a=0;a<this.roomHeight;a++)i[o][a]=this.map[o+t*this.roomWidth][a+e*this.roomHeight]}return i},t.prototype.getExitList=function(){var t=new Array;if(this.exits&&this.exits.length>0)for(var e=0,i=this.exits.split("#");e<i.length;e++){var a=i[e],n=new o.default,r=a.split(","),s=parseInt(r[0]),l=this.roomHeight*this.height-parseInt(r[1])-1,c=parseInt(r[4]),u=parseInt(r[5]),h=Math.floor(s/this.roomWidth),d=Math.floor(l/this.roomHeight);n.fromRoomPos=cc.v3(h,d),n.fromPos=cc.v3(s%this.roomWidth,l%this.roomHeight),n.fromChapter=this.chapter,n.fromLevel=this.index,n.toChapter=parseInt(r[2]),n.toLevel=parseInt(r[3]),n.toPos=cc.v3(c,u),t.push(n)}return t},t}();i.default=a,cc._RF.pop()},{"./ExitData":"ExitData"}],LifeData:[function(t,e,i){"use strict";cc._RF.push(e,"f7167eNvVlCr6WZO6jChPq+","LifeData");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sanity=50,e.solidSatiety=50,e.liquidSatiety=50,e.poo=0,e.pee=0,e.timeScale=1,e}return a(e,t),e.prototype.valueCopy=function(t){t&&(this.sanity=t.sanity?t.sanity:0,this.solidSatiety=t.solidSatiety?t.solidSatiety:0,this.liquidSatiety=t.liquidSatiety?t.liquidSatiety:0,this.poo=t.poo?t.poo:0,this.pee=t.pee?t.pee:0,this.timeScale=t.timeScale?t.timeScale:1)},e.prototype.clone=function(){var t=new e;return t.sanity=this.sanity,t.solidSatiety=this.solidSatiety,t.liquidSatiety=this.liquidSatiety,t.poo=this.poo,t.pee=this.pee,t.timeScale=this.timeScale,t},e.SOLID_LOSS=.0035,e.LIQUID_LOSS=.005,e.POO_RATE=.2,e.PEERATE=.2,e}(t("./BaseData").default);i.default=n,cc._RF.pop()},{"./BaseData":"BaseData"}],LightBuilding:[function(t,e,i){"use strict";cc._RF.push(e,"b2591n42odFIbhfimSigtUE","LightBuilding");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Building"),s=cc._decorator,l=s.ccclass,c=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.onLoad=function(){},n([l],e)}(r.default));i.default=c,cc._RF.pop()},{"./Building":"Building"}],LightManager:[function(t,e,i){"use strict";cc._RF.push(e,"28a3dFSvA1P3KOJyNBCO1Gn","LightManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./BaseManager"),s=t("../logic/Logic"),l=t("../utils/IndexZ"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.camera=null,e.shadowCamera=null,e.shadow=null,e.shadowRay=null,e.shadowAlpha=i.ALPHA_START,e.checkTimeDelay=0,e.checkTimeChangeDelay=0,e}var i;return a(e,t),i=e,e.prototype.clear=function(){i.lightList=[]},e.prototype.onLoad=function(){this.mat=this.shadow.getMaterial(0),this.timeChange()},e.prototype.render=function(){for(var t=0;t<i.lightList.length;t++){var e=i.lightList[t];e&&(e.renderSightArea(this.camera),this.renderRay(e,0==t,this.shadowRay))}this.shadowTexture||(this.shadowTexture=new cc.RenderTexture,this.shadowTexture.initWithSize(cc.visibleRect.width/4,cc.visibleRect.height/4),this.shadowTexture.setFilters(cc.Texture2D.Filter.LINEAR,cc.Texture2D.Filter.LINEAR),this.shadowCamera.targetTexture=this.shadowTexture,this.shadow.spriteFrame=new cc.SpriteFrame(this.shadowTexture))},e.registerLight=function(t,e){for(var o=0,a=t;o<a.length;o++){var n=a[o];if(n.showShadow=n.node.active,n.fromSky){var r=n.node.convertToWorldSpaceAR(cc.Vec3.ZERO);n.node.parent=e.parent,n.node.position=n.node.parent.convertToNodeSpaceAR(r),n.node.zIndex=l.default.OVERHEAD}i.lightList.push(n)}},e.unRegisterLight=function(t){var e=i.lightList.indexOf(t);-1!=e&&i.lightList.splice(e,1)},e.prototype.renderRay=function(t,e,i){var o=t.lightVertsArray,a=t.lightRects,n=t.circle;if(e&&i.clear(!1),t.showShadow){if(i.lineWidth=10,i.fillColor=t.renderColor,o&&o.length>0){var r=i.node.convertToNodeSpaceAR(o[0]);i.moveTo(r.x,r.y);for(var s=1;s<o.length;s++){var l=i.node.convertToNodeSpaceAR(o[s]);i.lineTo(l.x,l.y)}i.close(),i.fill()}for(var c in a){var u=a[c],h=i.node.convertToNodeSpaceAR(cc.v2(u.x,u.y));i.rect(h.x,h.y,u.width,u.height),i.fill()}n&&n.z>0&&this.drawCircle(i,n.x,n.y,n.z)}},e.prototype.drawCircle=function(t,e,i,o){var a=t.node.convertToNodeSpaceAR(cc.v3(e,i));t.circle(a.x,a.y,o),t.fill()},e.prototype.fixShadowPos=function(){if(this.camera){var t=this.camera.node.convertToWorldSpaceAR(cc.v2(0,0));if(this.shadow){var e=this.shadowRay.node.convertToNodeSpaceAR(t);this.shadow.node.position=cc.v3(e)}}},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.03&&(this.checkTimeDelay=0,!0)},e.prototype.isCheckTimeChangeDelay=function(t){return this.checkTimeChangeDelay+=t,this.checkTimeChangeDelay>1&&(this.checkTimeChangeDelay=0,!0)},e.prototype.timeChange=function(){var t=this.getShadowAlphaByTime();this.shadowAlpha=i.ALPHA_START+t,this.shadowAlpha>i.ALPHA_END&&(this.shadowAlpha=i.ALPHA_END),this.shadowAlpha<i.ALPHA_START&&(this.shadowAlpha=i.ALPHA_START),this.mat.setProperty("lightColor",cc.color(0,0,50,this.shadowAlpha))},e.prototype.getShadowAlphaByTime=function(){var t=new Date(s.default.realTime),e=t.getHours(),i=t.getMinutes(),o=Math.floor(20*i/60);return e>12?20*(e-12)+o:20*(12-e)-o},e.prototype.update=function(t){this.isCheckTimeDelay(t)&&this.render(),this.isCheckTimeChangeDelay(t)&&this.timeChange(),this.fixShadowPos()},e.lightList=[],e.ALPHA_START=10,e.ALPHA_END=200,e.ROOM_LIGHT=50,n([h(cc.Camera)],e.prototype,"camera",void 0),n([h(cc.Camera)],e.prototype,"shadowCamera",void 0),n([h(cc.Sprite)],e.prototype,"shadow",void 0),n([h(cc.Graphics)],e.prototype,"shadowRay",void 0),i=n([u],e)}(r.default);i.default=d,cc._RF.pop()},{"../logic/Logic":"Logic","../utils/IndexZ":"IndexZ","./BaseManager":"BaseManager"}],Light:[function(t,e,i){"use strict";cc._RF.push(e,"03c71kep4JPC4OkHwKVSXdP","Light");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layer=null,e.lightPrefab=null,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},n([l(cc.Node)],e.prototype,"layer",void 0),n([l(cc.Prefab)],e.prototype,"lightPrefab",void 0),n([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{}],LoadingIcon:[function(t,e,i){"use strict";cc._RF.push(e,"69f56NploZJ85VmIt+4fEdC","LoadingIcon");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../utils/Random"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label1=null,e.icon=null,e.label2=null,e.isFirst=!1,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.isFirst=r.default.isFirstLoading,this.getComponent(cc.Animation).play(r.default.isFirstLoading?"LoadingIconWithLabel":"LoadingIcon"),this.label2.string=""+i.WORDS[s.default.getRandomNum(0,i.WORDS.length-1)]},e.prototype.start=function(){r.default.isFirstLoading=!1},e.WORDS=["\u68a6\u662f\u5927\u81ea\u7136\u6240\u4f5c\u7684\u806a\u660e\u7684\u5b89\u6392,\u4e3a\u4e86\u5728\u57fa\u4e8e\u610f\u5fd7\u7684\u8eab\u4f53\u8fd0\u52a8\u5373\u808c\u8089\u8fd0\u52a8\u6682\u65f6\u4f11\u606f\u65f6,\u7528\u4e0d\u968f\u610f\u865a\u6784\u51fa\u6765\u7684\u4e8b\u7269\u6240\u4ea7\u751f\u7684\u6fc0\u60c5\u53bb\u523a\u6fc0\u751f\u547d\u529b\u3002","\u4e00\u65b9\u9762,\u68a6\u662f\u53cd\u6620\u751f\u6d3b\u7684;\u53e6\u4e00\u65b9\u9762,\u68a6\u53c8\u662f\u8fdc\u79bb\u751f\u6d3b\u7684\u3002\u5b83\u4ee5\u5938\u5f20\u3001\u6b6a\u66f2\u3001\u751a\u81f3\u53d8\u5f62\u7684\u65b9\u5f0f\u53cd\u6620\u751f\u6d3b\u3002","\u68a6\u628a\u4eba\u4eec\u4ece\u684e\u688f\u822c\u7684\u73b0\u5b9e\u4e2d,\u91ca\u653e\u4e86\u51fa\u6765,\u4f7f\u4ed6\u81ea\u7531,\u4f7f\u4ed6\u5728\u4e91\u4e2d\u7ff1\u7fd4,\u4f7f\u4ed6\u5728\u5c71\u5cf0\u4e0a\u5954\u8d70\u3002","\u5076\u7136\u505a\u4e2a\u767d\u663c\u68a6,\u60f3\u5165\u975e\u975e,\u4efb\u60f3\u8c61\u53bb\u9a70\u9a8b,\u83b7\u5f97\u4e00\u65f6\u7684\u6170\u5b89,\u5f53\u7136\u4ea6\u65e0\u4e0d\u53ef,\u4f46\u662f\u7a76\u7adf\u53ea\u662f\u4e00\u65f6\u6709\u6548\u7684\u9547\u5b9a\u5242,\u53ef\u4ee5\u6682\u65f6\u6b62\u75db,\u4f46\u4e0d\u6839\u672c\u6cbb\u7597\u3002","\u68a6\u4e0e\u89c9\u3001\u9189\u4e0e\u9192\u3001\u5e7b\u4e0e\u771f\u3001\u865a\u4e0e\u5b9e\u3001\u663e\u4e0e\u9690\u3001\u5f62\u4e0e\u8ff9\u3001\u5149\u4e0e\u5f71\u3001\u6697\u4e0e\u660e,\u90fd\u662f\u751f\u6d3b\u91cc\u4e00\u4e8b\u7684\u4e24\u9762,\u4e92\u76f8\u4f9d\u5b58,\u800c\u6cfe\u6e2d\u81ea\u5206\u3002","\u68a6\u662f\u4e0d\u53ef\u601d\u8bae\u7684,\u4e5f\u662f\u4e0d\u53ef\u6349\u6478\u7684,\u65e2\u65e0\u6cd5\u9884\u6599,\u4e5f\u65e0\u6cd5\u9009\u62e9\u548c\u63a7\u5236\u3002","\u505a\u5669\u68a6\u65f6,\u75db\u82e6\u6216\u6050\u6016\u8fbe\u5230\u6700\u9ad8\u5ea6,\u6050\u6016\u7684\u672c\u8eab\u4fbf\u4fc3\u4f7f\u6211\u4eec\u89c9\u9192,\u68a6\u4e2d\u7684\u5996\u9b54\u9b3c\u602a\u4e5f\u63a5\u7740\u6d88\u706d\u3002\u5728\u4eba\u751f\u7684\u68a6\u4e2d\u60c5\u5f62\u4ea6\u590d\u5982\u6b64\u3002","\u68a6\u662f\u4e0d\u8fde\u8d2f\u7684,\u5b83\u6beb\u4e0d\u8fdf\u7591\u5730\u8c03\u548c\u7740\u8352\u8c2c\u7684\u77db\u76fe,\u5b83\u63a5\u53d7\u4e0d\u53ef\u80fd\u6027,\u6f20\u89c6\u6e05\u9192\u72b6\u6001\u65f6\u7684\u6743\u5a01\u6027\u8ba4\u8bc6,\u800c\u4e14\u5b83\u5411\u6211\u4eec\u663e\u793a\u5bf9\u4f26\u7406\u9053\u5fb7\u7684\u8fdf\u949d","\u90a3\u6c38\u4e45\u6c89\u7761\u7684\u5e76\u975e\u6b7b\u8005\uff0c\u5728\u6f2b\u957f\u800c\u5947\u5f02\u7684\u65f6\u5149\u4e2d\uff0c\u6b7b\u4ea1\u4ea6\u6709\u5176\u7ec8\u7ed3\u3002","\u8fd9\u4e2a\u4e16\u754c\u6700\u4ec1\u6148\u7684\u5730\u65b9\uff0c\u83ab\u8fc7\u4e8e\u4eba\u7c7b\u601d\u7ef4\u65e0\u6cd5\u878d\u4f1a\u8d2f\u901a\u5b83\u7684\u5168\u90e8\u5185\u5bb9\u3002","\u6c38\u8fdc\u8eba\u4e0b\u7684\u5e76\u6ca1\u6709\u6b7b\u53bb\uff0c\u5728\u795e\u79d8\u7684\u4e07\u53e4\u4e2d\u5373\u4fbf\u662f\u6b7b\u4ea1\u4e5f\u53ef\u4ee5\u6b7b\u53bb\u3002","\u4eba\u7c7b\u5c45\u4f4f\u5728\u5e7d\u6697\u7684\u6d77\u6d0b\u4e2d\u4e00\u4e2a\u540d\u4e3a\u65e0\u77e5\u7684\u5c0f\u5c9b\u4e0a\uff0c\u8fd9\u6d77\u6d0b\u6d69\u6dfc\u65e0\u57a0\u3001\u8574\u85cf\u65e0\u7a77\u79d8\u5bc6\uff0c\u4f46\u6211\u4eec\u5e76\u4e0d\u5e94\u8be5\u822a\u884c\u8fc7\u8fdc\uff0c\u63a2\u7a76\u592a\u6df1\u3002","\u4e3a\u4ec0\u4e48\u5931\u7720\u5462\n\u56e0\u4e3a\u6015\u90a3\u4e2a\u68a6\n\u90a3\u4e2a\u4e0d\u662f\u5669\u68a6\u7684\u5669\u68a6\u3002","\u80fd\u7ed9\u522b\u4eba\u5e26\u6765\u5669\u68a6\u7684\u4eba\uff0c\u4ed6\u81ea\u5df1\u5f80\u5f80\u8981\u627f\u8f7d\u7740\u66f4\u591a\u7684\u5669\u68a6\u3002\n\u6240\u4ee5\u90a3\u65e2\u662f\u4e00\u4e2a\u602a\u7269\uff0c\u66f4\u662f\u4e00\u4e2a\u53ef\u601c\u7684\u53d7\u5bb3\u8005\u3002","\u4e0e\u602a\u7269\u6218\u6597\u7684\u4eba\uff0c\u5e94\u5f53\u5c0f\u5fc3\u81ea\u5df1\u4e0d\u8981\u6210\u4e3a\u602a\u7269\u3002\n\u5f53\u4f60\u8fdc\u8fdc\u51dd\u89c6\u6df1\u6e0a\u65f6\uff0c\u6df1\u6e0a\u4e5f\u5728\u51dd\u89c6\u4f60\u3002","\u7cbe\u795e\u5206\u6790\u6709\u4e09\u5927\u652f\u67f1\uff1a\u6f5c\u610f\u8bc6\u7684\u5fc3\u7406\u673a\u5236\uff0c\u53cd\u6297\u548c\u538b\u6291\u7684\u4f5c\u7528\uff0c\u4ee5\u53ca\u6027\u7684\u91cd\u8981\u6027\u3002","\u68a6\u6709\u65f6\u4f1a\u901a\u8fc7\u4e00\u79cd\u975e\u5e38\u795e\u5947\u7684\u590d\u5236\u80fd\u529b\uff0c\u8ba9\u6211\u4eec\u56de\u60f3\u8d77\u9065\u8fdc\u7684\u4e8b\u7269\uff0c\u751a\u81f3\u662f\u6211\u4eec\u5df2\u7ecf\u5fd8\u8bb0\u7684\u81ea\u5df1\u3002","\u4e8b\u5b9e\u4e0a\uff0c\u68a6\u4e4b\u6240\u4ee5\u88ab\u4fee\u6539\u6210\u4e0d\u6109\u5feb\u7684\uff0c\u662f\u56e0\u4e3a\u6709\u4e9b\u68a6\u662f\u7cbe\u795e\u7684\u7b2c\u4e8c\u6b65\u6240\u4e0d\u5141\u8bb8\u7684\uff0c\u800c\u8fd9\u4e9b\u6b63\u662f\u7cbe\u795e\u7684\u7b2c\u4e00\u6b65\u6240\u9700\u8981\u7684\u6b32\u671b\u3002","\u5728\u6211\u4eec\u7684\u68a6\u4e2d\u51fa\u73b0\u7684\u662f\u6211\u4eec\u5728\u5916\u90e8\u4e16\u754c\u6216\u81ea\u8eab\u7ecf\u5386\u7684\u3002","\u6bcf\u4e00\u4e2a\u68a6\u90fd\u8d77\u6e90\u4e8e\u7b2c\u4e00\u79cd\u529b\u91cf\uff08\u6b32\u671b\uff09\uff0c\u4f46\u53d7\u5230\u4e86\u7b2c\u4e8c\u79cd\u529b\u91cf\uff08\u610f\u8bc6\uff09\u7684\u9632\u5fa1\u548c\u62b5\u5236\u3002","\u68a6\u662f\u4e00\u4e2a\u4eba\u4e0e\u81ea\u5df1\u5185\u5fc3\u7684\u771f\u5b9e\u5bf9\u8bdd\uff0c\u662f\u5411\u81ea\u5df1\u5b66\u4e60\u7684\u8fc7\u7a0b\uff0c\u662f\u53e6\u4e00\u6b21\u4e0e\u81ea\u5df1\u606f\u606f\u76f8\u5173\u7684\u4eba\u751f\u3002","\u4e00\u5207\u7684\u4e0d\u5982\u610f\u4e0d\u4e86\u89e3,\u90fd\u53ef\u4ee5\u7528\u4e00\u5c42\u8584\u5e55\u53bb\u906e\u853d,\u8fd9\u5c42\u8584\u5e55,\u6211\u4eec\u53ef\u4ee5\u8bf4\u662f\u68a6\u3002"],n([u(cc.Label)],e.prototype,"label1",void 0),n([u(cc.Node)],e.prototype,"icon",void 0),n([u(cc.Label)],e.prototype,"label2",void 0),i=n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../logic/Logic":"Logic","../utils/Random":"Random"}],LoadingManager:[function(t,e,i){"use strict";cc._RF.push(e,"cdbddTOfANNwo68tyWHiEGz","LoadingManager");var o=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var a=t("../data/ProfessionData"),n=t("../logic/Logic"),r=cc._decorator,s=r.ccclass,l=(r.property,function(){function t(){this.spriteFrameNames=null,this.isEquipmentLoaded=!1,this.isMonsterLoaded=!1,this.isNonplayerLoaded=!1,this.isWorldLoaded=!1,this.isBuffsLoaded=!1,this.isSuitsLoaded=!1,this.isBulletsLoaded=!1,this.isProfessionLoaded=!1,this.isItemsLoaded=!1,this.isSkillsLoaded=!1,this.isBuildingLoaded=!1,this.isFurnituresLoaded=!1,this.isTransportAnimFinished=!0}var e;return e=t,t.prototype.init=function(){this.setAllSpriteFramesUnload(),n.default.spriteFrames||(n.default.spriteFrames={}),n.default.buildings||(n.default.buildings={}),this.isWorldLoaded=!1,this.isEquipmentLoaded=!1,this.isMonsterLoaded=!1,this.isBuffsLoaded=!1,this.isNonplayerLoaded=!1,this.isBuildingLoaded=!1,this.isFurnituresLoaded=!1},t.prototype.reset=function(){this.isWorldLoaded=!1,this.isEquipmentLoaded=!1,this.setAllSpriteFramesUnload(),this.isBuffsLoaded=!1,this.isProfessionLoaded=!1,this.isBulletsLoaded=!1,this.isMonsterLoaded=!1,this.isNonplayerLoaded=!1,this.isItemsLoaded=!1,this.isSkillsLoaded=!1,this.isBuildingLoaded=!1,this.isTransportAnimFinished=!1,this.isSuitsLoaded=!1,this.isFurnituresLoaded=!1},t.prototype.isSpriteFramesLoaded=function(t){return!!this.spriteFrameNames[t]},t.prototype.isAllSpriteFramesLoaded=function(){for(var t in this.spriteFrameNames)if(!this.spriteFrameNames[t])return!1;return!0},t.prototype.setAllSpriteFramesUnload=function(){this.spriteFrameNames={},this.spriteFrameNames[e.KEY_AUTO]=!1,this.spriteFrameNames[e.KEY_TEXTURES]=!1,this.spriteFrameNames[e.KEY_NPC]=!1,this.spriteFrameNames[e.KEY_EQUIPMENT]=!1,this.spriteFrameNames[e.KEY_ITEM]=!1},t.prototype.loadWorld=function(){n.default.worldLoader.isloaded=!1,n.default.worldLoader.loadWorld()},t.prototype.loadEquipment=function(){var t=this;n.default.equipments?this.isEquipmentLoaded=!0:cc.resources.load("Data/equipment",function(e,i){if(e)cc.error(e);else for(var o in n.default.equipments=i.json,t.isEquipmentLoaded=!0,cc.log("equipment loaded"),n.default.equipmentNameList=new Array,i.json)n.default.equipmentNameList.push(o)})},t.prototype.loadProfession=function(){var t=this;n.default.professionList&&n.default.professionList.length>0?this.isProfessionLoaded=!0:cc.resources.load("Data/profession",function(e,i){if(e)cc.error(e);else{n.default.professionList=new Array;for(var o=i.json,r=0;r<o.length;r++){var s=new a.default;s.valueCopy(o[r]),s.id=r,n.default.professionList.push(s)}t.isProfessionLoaded=!0,cc.log("professionList loaded")}})},t.prototype.loadTalents=function(){var t=this;n.default.talents?this.isSkillsLoaded=!0:cc.resources.load("Data/talent",function(e,i){e?cc.error(e):(n.default.talents=i.json,t.isSkillsLoaded=!0,cc.log("talent loaded"))})},t.prototype.loadStatus=function(){var t=this;n.default.status?this.isBuffsLoaded=!0:cc.resources.load("Data/status",function(e,i){e?cc.error(e):(n.default.status=i.json,t.isBuffsLoaded=!0,cc.log("debuffs loaded"))})},t.prototype.loadSuits=function(){var t=this;n.default.suits?this.isSuitsLoaded=!0:cc.resources.load("Data/suits",function(e,i){e?cc.error(e):(n.default.suits=i.json,t.isSuitsLoaded=!0,cc.log("suits loaded"))})},t.prototype.loadFurnitures=function(){var t=this;n.default.furnitures?this.isFurnituresLoaded=!0:cc.resources.load("Data/furnitures",function(e,i){e?cc.error(e):(n.default.furnitures=i.json,t.isFurnituresLoaded=!0,cc.log("furnitures loaded"))})},t.prototype.loadBullets=function(){var t=this;n.default.bullets?this.isBulletsLoaded=!0:cc.resources.load("Data/bullet",function(e,i){e?cc.error(e):(n.default.bullets=i.json,t.isBulletsLoaded=!0,cc.log("bullets loaded"))})},t.prototype.loadMonsters=function(){var t=this;n.default.monsters?this.isMonsterLoaded=!0:cc.resources.load("Data/monsters",function(e,i){e?cc.error(e):(n.default.monsters=i.json,t.isMonsterLoaded=!0,cc.log("monsters loaded"))})},t.prototype.loadNonplayer=function(){var t=this;n.default.nonplayers?this.isNonplayerLoaded=!0:cc.resources.load("Data/nonplayers",function(e,i){e?cc.error(e):(n.default.nonplayers=i.json,t.isNonplayerLoaded=!0,cc.log("nonplayers loaded"))})},t.prototype.loadBuildings=function(){var t=this;n.default.buildings&&n.default.buildings.Door?this.isBuildingLoaded=!0:cc.resources.loadDir("Prefabs/buildings",cc.Prefab,function(e,i){for(var o=0,a=i;o<a.length;o++){var r=a[o];n.default.buildings[r.name]=r}t.isBuildingLoaded=!0,cc.log("buildings loaded")})},t.prototype.loadItems=function(){var t=this;n.default.items?this.isItemsLoaded=!0:cc.resources.load("Data/item",function(e,i){if(e)cc.error(e);else{for(var o in n.default.items=i.json,n.default.itemNameList=new Array,n.default.goodsNameList=new Array,n.default.trashNameList=new Array,n.default.dollNameList=new Array,i.json)n.default.items[o].canSave&&-1==o.indexOf("food")&&-1==o.indexOf("trash")&&-1==o.indexOf("doll")&&-1==o.indexOf("goods")?n.default.itemNameList.push(o):-1!=o.indexOf("goods")?n.default.goodsNameList.push(o):-1!=o.indexOf("trash")?n.default.trashNameList.push(o):-1!=o.indexOf("doll")&&n.default.dollNameList.push(o);t.isItemsLoaded=!0,cc.log("items loaded")}})},t.prototype.loadAutoSpriteFrames=function(){var t=this;n.default.spriteFrames&&n.default.spriteFrameRes("auto")?this.spriteFrameNames[e.KEY_AUTO]=!0:cc.resources.loadDir("Texture/Auto",cc.SpriteFrame,function(i,o){for(var a=0,r=o;a<r.length;a++){var s=r[a];n.default.spriteFrames[s.name]=s}t.spriteFrameNames[e.KEY_AUTO]=!0,cc.log("auto texture loaded")})},t.prototype.loadSpriteAtlas=function(t,e){var i=this;n.default.spriteFrames&&n.default.spriteFrames[e]?this.spriteFrameNames[t]=!0:cc.resources.load("Texture/"+t,cc.SpriteAtlas,function(e,o){for(var a=0,r=o.getSpriteFrames();a<r.length;a++){var s=r[a];n.default.spriteFrames[s.name]=s}i.spriteFrameNames[t]=!0,cc.log(t+" sprite atlas loaded")})},t.loadNpcSpriteAtlas=function(t,i){n.default.spriteFrames&&n.default.spriteFrames[t+"anim000"]?i&&i():e.resourceLoadMap.has(t)?e.resourceLoadMap.get(t).push(i):(e.resourceLoadMap.set(t,new Array),cc.resources.load("Texture/npc/"+t,cc.SpriteAtlas,function(o,a){for(var r=0,s=a.getSpriteFrames();r<s.length;r++){var l=s[r];n.default.spriteFrames[l.name]=l}if(cc.log(t+" sprite atlas loaded"),i&&i(),e.resourceLoadMap.has(t)){for(var c=0,u=e.resourceLoadMap.get(t);c<u.length;c++){var h=u[c];h&&h()}e.resourceLoadMap.delete(t)}}))},t.loadBuilding=function(t,i){n.default.buildings[t]?i&&i():e.resourceLoadMap.has(t)?e.resourceLoadMap.get(t).push(i):(e.resourceLoadMap.set(t,new Array),cc.resources.load("Prefabs/buildings/"+t,cc.Prefab,function(o,a){if(n.default.buildings[t]=a,cc.log(t+" prefab loaded"),i&&i(),e.resourceLoadMap.has(t)){for(var r=0,s=e.resourceLoadMap.get(t);r<s.length;r++){var l=s[r];l&&l()}e.resourceLoadMap.delete(t)}}))},t.allResourceDone=function(){return e.resourceLoadMap.size<1},t.KEY_AUTO="auto",t.KEY_TEXTURES="textures",t.KEY_NPC="npc",t.KEY_EQUIPMENT="equipment",t.KEY_ITEM="item",t.resourceLoadMap=new Map,e=o([s],t)}());i.default=l,cc._RF.pop()},{"../data/ProfessionData":"ProfessionData","../logic/Logic":"Logic"}],Loading:[function(t,e,i){"use strict";cc._RF.push(e,"a2246gAT5JKc4YhD10URG7K","Loading");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Logic"),s=t("../ui/CutScene"),l=t("../manager/LoadingManager"),c=t("../utils/AudioPlayer"),u=cc._decorator,h=u.ccclass,d=u.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadingIcon=null,e.cutScene=null,e.shipTransportScene=null,e.elevatorScene=null,e.timeDelay=0,e.isTransportAnimFinished=!0,e.isElevatorAnimFinished=!0,e.loadingManager=new l.default,e}return a(e,t),e.prototype.onLoad=function(){this.loadingManager.init(),this.loadingIcon.active=!0},e.prototype.start=function(){this.loadingManager.loadWorld(),this.loadingManager.loadEquipment(),this.loadingManager.loadAutoSpriteFrames(),this.loadingManager.loadSpriteAtlas(l.default.KEY_TEXTURES,"singleColor"),this.loadingManager.loadSpriteAtlas(l.default.KEY_NPC,"npcshadow"),this.loadingManager.loadSpriteAtlas(l.default.KEY_EQUIPMENT,"emptyequipment"),this.loadingManager.loadSpriteAtlas(l.default.KEY_ITEM,"ammo"),this.loadingManager.loadMonsters(),this.loadingManager.loadStatus(),this.loadingManager.loadBullets(),this.loadingManager.loadItems(),this.loadingManager.loadTalents(),this.loadingManager.loadProfession(),this.loadingManager.loadNonplayer(),this.loadingManager.loadSuits(),this.loadingManager.loadFurnitures(),this.showLoadingLabel(),1==r.default.isFirst&&(this.cutScene.isSkip=!0,this.cutScene.unregisterClick())},e.prototype.showLoadingLabel=function(){this.loadingManager.isAllSpriteFramesLoaded()||(this.loadingIcon.active=!0)},e.prototype.showCut=function(){this.loadingManager.isAllSpriteFramesLoaded()&&1!=r.default.isFirst&&(r.default.isFirst=1,this.cutScene.playShow())},e.prototype.showElevator=function(){var t=this;this.loadingManager.isAllSpriteFramesLoaded()&&r.default.elevatorScene>0&&(this.isElevatorAnimFinished=!1,this.elevatorScene.active=!0,1==r.default.elevatorScene?this.elevatorScene.getComponent(cc.Animation).play("ElevatorSceneUp"):2==r.default.elevatorScene&&this.elevatorScene.getComponent(cc.Animation).play("ElevatorSceneDown"),r.default.elevatorScene=0,this.scheduleOnce(function(){t.isElevatorAnimFinished=!0},1))},e.prototype.showTransport=function(){var t=this;this.loadingManager.isAllSpriteFramesLoaded()&&r.default.shipTransportScene>0&&(this.isTransportAnimFinished=!1,this.shipTransportScene.active=!0,2==r.default.shipTransportScene&&(this.shipTransportScene.scaleX=-1),c.default.play(c.default.TRANSPORTSHIP),r.default.shipTransportScene=0,this.scheduleOnce(function(){t.isTransportAnimFinished=!0},1))},e.prototype.update=function(t){this.timeDelay+=t,this.loadingManager.isWorldLoaded=r.default.worldLoader.isloaded,this.showCut(),this.showTransport(),this.showElevator(),this.timeDelay>.02&&this.loadingManager.isEquipmentLoaded&&this.loadingManager.isAllSpriteFramesLoaded()&&this.loadingManager.isMonsterLoaded&&this.loadingManager.isNonplayerLoaded&&this.loadingManager.isBuffsLoaded&&this.loadingManager.isProfessionLoaded&&this.loadingManager.isBulletsLoaded&&this.loadingManager.isItemsLoaded&&this.loadingManager.isSkillsLoaded&&this.loadingManager.isWorldLoaded&&this.loadingManager.isSuitsLoaded&&this.loadingManager.isFurnituresLoaded&&this.cutScene.isSkip&&this.isTransportAnimFinished&&this.isElevatorAnimFinished&&(this.timeDelay=0,this.cutScene.unregisterClick(),this.isTransportAnimFinished=!1,this.isElevatorAnimFinished=!1,this.loadingManager.reset(),r.default.mapManager.loadMap(),cc.director.loadScene("game"))},n([d(cc.Node)],e.prototype,"loadingIcon",void 0),n([d(s.default)],e.prototype,"cutScene",void 0),n([d(cc.Node)],e.prototype,"shipTransportScene",void 0),n([d(cc.Node)],e.prototype,"elevatorScene",void 0),n([h],e)}(cc.Component);i.default=p,cc._RF.pop()},{"../manager/LoadingManager":"LoadingManager","../ui/CutScene":"CutScene","../utils/AudioPlayer":"AudioPlayer","./Logic":"Logic"}],LocalStorage:[function(t,e,i){"use strict";cc._RF.push(e,"0a5cbOqRmZJE4RU1wzXgRD/","LocalStorage");var o=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var a=t("../data/AchievementData"),n=t("../data/FurnitureData"),r=cc._decorator,s=r.ccclass,l=(r.property,function(){function t(){}var e;return e=t,t.getValue=function(t){return cc.sys.localStorage.getItem(t)},t.putValue=function(t,e){cc.sys.localStorage.setItem(t,JSON.stringify(e))},t.getData=function(){var t=e.getValue(e.SAVE_NAME);return t||(t="{}"),JSON.parse(t)},t.getValueFromData=function(t){var i=e.getValue(e.SAVE_NAME);return i||(i="{}"),e.getData()[t]},t.saveData=function(t,i){var o=e.getData();o[t]=i,e.putValue(e.SAVE_NAME,o)},t.getAchievementData=function(){var t=new a.default;return t.valueCopy(e.getData()[e.KEY_ACHIEVEMENT]),t},t.saveAchievementData=function(t){e.saveData(e.KEY_ACHIEVEMENT,t)},t.getFurnitureData=function(t){var i=e.getData()[e.KEY_FURNITURES];return i||(i={}),i[t]},t.saveFurnitureData=function(t){if(t){var i=e.getData()[e.KEY_FURNITURES];i||(i={});var o=new n.default;o.valueCopy(i[t.id]);var a=o.purchased,r=o.isOpen;o.valueCopy(t),a&&(o.purchased=a),r&&(o.isOpen=r),i[t.id]=o,e.saveData(e.KEY_FURNITURES,i)}},t.isSwitchOpen=function(t){var i=e.getValueFromData(t);return 1==(i||0==i?parseInt(i):e.DEFAULT_MAP[t])},t.saveSwitch=function(t,i){e.saveData(t,i?1:0)},t.SAVE_NAME="SINKDUNGEON_SAVE",t.SAVE_DUNGEON="SAVE_DUNGEON",t.SAVE_DUNGEON_BY_POINT="SAVE_DUNGEON_BY_POINT",t.KEY_ACHIEVEMENT="KEY_ACHIEVEMENT",t.KEY_COIN="KEY_COIN",t.KEY_COIN_DREAM_COUNT="KEY_DREAM_COIN_COUNT",t.KEY_SWITCH_SHOW_SOFT_SHADOW="KEY_SWITCH_SHOW_SOFT_SHADOW",t.KEY_SWITCH_SHOW_GAMEPAD="KEY_SWITCH_SHOW_GAMEPAD",t.KEY_SWITCH_LOW_POWER="KEY_SWITCH_LOW_POWER",t.KEY_SWITCH_SHOW_EQUIPDIALOG="KEY_SWITCH_SHOW_EQUIPDIALOG",t.KEY_FURNITURES="KEY_FURNITURES",t.VAULE_OPEN="1",t.DEFAULT_MAP={KEY_SWITCH_SHOW_SHADOW:1,KEY_SWITCH_SHOW_GAMEPAD:0,KEY_SWITCH_SHOW_EQUIPDIALOG:0,KEY_SWITCH_LOW_POWER:0},e=o([s],t)}());i.default=l,cc._RF.pop()},{"../data/AchievementData":"AchievementData","../data/FurnitureData":"FurnitureData"}],Logic:[function(t,e,i){"use strict";cc._RF.push(e,"2225fYJ0sRMTZjuD7WFmbVi","Logic");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./EventHelper"),s=t("../data/PlayerData"),l=t("../manager/MapManager"),c=t("./Dungeon"),u=t("../manager/InventoryManager"),h=t("../utils/Random"),d=t("../manager/ProfileManager"),p=t("../utils/AudioPlayer"),f=t("../data/FromData"),g=t("../map/WorldLoader"),y=t("../model/Settings"),m=t("../utils/LocalStorage"),v=t("../data/SavePointData"),E=t("../data/NonPlayerData"),_=t("../data/InventoryData"),T=t("../data/GroundOilGoldData"),D=t("../data/OilGoldData"),S=t("../manager/LoadingManager"),O=cc._decorator,A=O.ccclass,C=(O.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var i;return a(e,t),i=e,e.prototype.onLoad=function(){i.settings.lowPower=m.default.isSwitchOpen(m.default.KEY_SWITCH_LOW_POWER),i.settings.lowPower?cc.game.setFrameRate(50):cc.game.setFrameRate(59),cc.game.addPersistRootNode(this.node),r.EventHelper.on(r.EventHelper.SETTINGS_LOW_POWER,function(){i.settings.lowPower?cc.game.setFrameRate(50):cc.game.setFrameRate(59)})},e.prototype.start=function(){},e.saveData=function(){i.profileManager.data.playerData=i.playerData.clone(),i.profileManager.data.playerEquips=i.inventoryManager.equips,i.profileManager.data.playerItemList=i.inventoryManager.itemList,i.profileManager.data.nonPlayerList=i.nonPlayerList,i.profileManager.data.playerInventoryList=i.inventoryManager.inventoryList,i.profileManager.data.rectDungeons[i.mapManager.rectDungeon.id]=i.mapManager.rectDungeon,i.profileManager.data.level=i.level,i.profileManager.data.chapterIndex=i.chapterIndex,i.profileManager.data.chapterMaxIndex=i.chapterMaxIndex,i.profileManager.data.time=i.time,i.profileManager.data.realTime=i.realTime,i.profileManager.data.savePointData=i.savePoinitData.clone(),i.profileManager.data.groundOilGoldData=i.groundOilGoldData.clone(),i.profileManager.data.killPlayerCounts=i.killPlayerCounts,i.profileManager.data.oilGolds=i.oilGolds,i.profileManager.saveData(),m.default.saveData(m.default.KEY_COIN,i.coins),m.default.saveData(m.default.KEY_COIN_DREAM_COUNT,i.coinDreamCount),i.inventoryManager.furnitureMap.forEach(function(t){m.default.saveFurnitureData(t)})},e.resetData=function(t){for(var e in i.profileManager=new d.default,i.time=i.profileManager.data.time,i.realTime=i.profileManager.data.realTime,i.profileManager.data.chapterIndex=t||i.profileManager.data.chapterIndex,i.profileManager.data.chapterIndex>i.profileManager.data.chapterMaxIndex&&i.profileManager.data.chapterIndex<this.CHAPTER05&&(i.profileManager.data.chapterMaxIndex=i.profileManager.data.chapterIndex),i.chapterIndex=i.profileManager.data.chapterIndex,i.chapterMaxIndex=i.profileManager.data.chapterMaxIndex,i.level=i.profileManager.data.level,i.savePoinitData=i.profileManager.data.savePointData.clone(),i.groundOilGoldData=i.profileManager.data.groundOilGoldData.clone(),i.oilGolds=i.profileManager.data.oilGolds,i.playerData=i.profileManager.data.playerData.clone(),i.inventoryManager=new u.default,i.profileManager.data.playerEquips)i.inventoryManager.equips[e].valueCopy(i.profileManager.data.playerEquips[e]);for(var o=0;o<i.profileManager.data.playerItemList.length;o++)i.inventoryManager.itemList[o].valueCopy(i.profileManager.data.playerItemList[o]);for(o=0;o<i.profileManager.data.playerInventoryList.length;o++)(a=new _.default).valueCopy(i.profileManager.data.playerInventoryList[o]),i.inventoryManager.inventoryList.push(a);for(i.nonPlayerList=[],o=0;o<i.profileManager.data.nonPlayerList.length;o++){var a;(a=new E.default).valueCopy(i.profileManager.data.nonPlayerList[o]),i.nonPlayerList.push(a)}i.isMapReset=!0,c.default.WIDTH_SIZE=15,c.default.HEIGHT_SIZE=9;var n=m.default.getValueFromData(m.default.KEY_COIN);i.coins=n?parseInt(n):0;var r=m.default.getValueFromData(m.default.KEY_COIN_DREAM_COUNT);i.coinDreamCount=r?parseInt(r):0,i.lastBgmIndex=0,i.killPlayerCounts=i.profileManager.data.killPlayerCounts,i.updateOilGoldCount()},e.updateOilGoldCount=function(){for(var t=i.oilGolds,e=new D.default,o=0;o<i.OIL_GOLD_LIST.length;o++){var a=t-i.OIL_GOLD_LIST[o];if(!(a>=0)){e.index=o;break}t=a,e.level++}e.fragments=t,e.Common.damageMin=e.level,e.Common.maxHealth=e.level,e.Common.maxDream=e.level,e.Common.remoteDamage=.25*e.level,i.playerData.OilGoldData.valueCopy(e)},e.changeDungeonSize=function(){var t=i.mapManager.getCurrentMapSize();t&&(c.default.WIDTH_SIZE=t.x,c.default.HEIGHT_SIZE=t.y)},e.posToMapPos=function(t){var e=i.worldLoader.getCurrentLevelData(),o=i.mapManager.rectDungeon.currentPos,a=cc.v3(0,0);return a.x=e.roomWidth*o.x+t.x,a.y=e.height*e.roomHeight-1-e.roomWidth*o.y-t.y,a},e.savePonit=function(t){if(i.chapterIndex!=i.CHAPTER099){var e=new v.default,o=i.posToMapPos(t);e.x=o.x,e.y=o.y,e.level=i.level,e.chapter=i.chapterIndex,i.savePoinitData.valueCopy(e),i.saveData()}},e.saveGroundOilGold=function(t){var e=new T.default;if(t>0){var o=i.mapManager.rectDungeon.currentPos;e.x=o.x,e.y=o.y,e.level=i.level,e.chapter=i.chapterIndex,e.value=t}i.groundOilGoldData.valueCopy(e),i.saveData()},e.loadingNextRoom=function(t){if(i.mapManager.rand4save=null,i.saveData(),p.default.play(p.default.EXIT),i.mapManager.loadingNextRoom(t)){switch(i.changeDungeonSize(),t){case 0:i.playerData.pos=cc.v3(i.playerData.pos.x,1);break;case 1:i.playerData.pos=cc.v3(i.playerData.pos.x,c.default.HEIGHT_SIZE-2);break;case 2:i.playerData.pos=cc.v3(c.default.WIDTH_SIZE-2,i.playerData.pos.y);break;case 3:i.playerData.pos=cc.v3(1,i.playerData.pos.y)}cc.director.loadScene("loading")}},e.loadingNextLevel=function(t){if(t){var e=i.worldLoader.getLevelData(t.toChapter,t.toLevel);if(e){if(t.fromChapter!=i.CHAPTER099&&t.fromChapter!=t.toChapter)for(var o in i.mapManager.rectDungeon.changeAllClearRoomsReborn(),i.profileManager.data.rectDungeons)i.profileManager.data.rectDungeons[o]&&i.profileManager.data.rectDungeons[o].changeAllClearRoomsReborn();i.saveData(),i.chapterIndex=t.toChapter,i.level=t.toLevel,i.chapterMaxIndex<i.chapterIndex&&i.chapterIndex<i.CHAPTER05&&(i.chapterMaxIndex=i.chapterIndex);var a=e.height*e.roomHeight-1-t.toPos.y,n=Math.floor(t.toPos.x/e.roomWidth),r=Math.floor(a/e.roomHeight);i.playerData.pos=cc.v3(t.toPos.x%e.roomWidth,a%e.roomHeight),i.mapManager.reset(cc.v3(n,r)),i.changeDungeonSize(),t.fromChapter==i.CHAPTER00&&i.chapterIndex==i.CHAPTER01?i.shipTransportScene=1:t.fromChapter==i.CHAPTER02&&i.chapterIndex==i.CHAPTER01?i.shipTransportScene=2:t.fromChapter==i.CHAPTER01&&i.chapterIndex==i.CHAPTER00?i.shipTransportScene=2:t.fromChapter==i.CHAPTER01&&i.chapterIndex==i.CHAPTER02&&(i.shipTransportScene=1),t.fromChapter==i.CHAPTER00&&i.chapterIndex==i.CHAPTER00&&(0==t.fromLevel&&0==t.toLevel||(i.elevatorScene=t.fromLevel>i.level?1:2)),cc.director.loadScene("loading")}}},e.getRandomNum=function(t,e){return t+Math.round(h.default.rand()*(e-t))},e.getHalfChance=function(){return h.default.rand()>.5},e.getChance=function(t){return i.getRandomNum(0,100)<t},e.getDistance=function(t,e){var i=t.x-e.x,o=t.y-e.y;return Math.sqrt(i*i+o*o)},e.getDistanceNoSqrt=function(t,e){var i=t.x-e.x,o=t.y-e.y;return Math.abs(i)+Math.abs(o)},e.lerp=function(t,e,i){return t+(e-t)*i},e.lerpPos=function(t,e,i){var o=cc.v3(0,0),a=t.x,n=t.y;return o.x=a+(e.x-a)*i,o.y=n+(e.y-n)*i,o},e.genNonDuplicateID=function(){return Number(h.default.rand().toString().substr(3,16)+Date.now()).toString(36)},e.getRandomEquipType=function(t){return i.equipmentNameList[t.getRandomNum(1,i.equipmentNameList.length-1)]},e.getRandomItemType=function(t){return i.itemNameList[t.getRandomNum(1,i.itemNameList.length-1)]},e.getRandomTrashType=function(t){return i.trashNameList[t.getRandomNum(1,i.trashNameList.length-1)]},e.spriteFrameRes=function(t){return i.spriteFrames[t]?i.spriteFrames[t]:null},e.getBuildings=function(t,e){S.default.loadBuilding(t,function(){e&&e(i.buildings[t])})},e.getKillPlayerCount=function(t){return i.killPlayerCounts[t]?i.killPlayerCounts[t]:0},e.setKillPlayerCounts=function(t,e){if(t&&t.id){i.killPlayerCounts[t.id]=i.getKillPlayerCount(t.id)+(e?1:-1);var o=i.killPlayerCounts;for(var a in i.killPlayerCounts={},o)o[a]&&o[a]>0&&(i.killPlayerCounts[a]=o[a])}},e.BOSS_LEVEL_1=10,e.CHAPTER00=0,e.CHAPTER01=1,e.CHAPTER02=2,e.CHAPTER03=3,e.CHAPTER04=4,e.CHAPTER05=5,e.CHAPTER099=99,e.OIL_GOLD_LIST=[100,150,200,300,500,1e3,1500,2e3,3e3,5e3,1e4,15e3,2e4,3e4,5e4,1e5,15e4,2e5,3e5,5e5,1e6,15e5,2e6,3e6,5e6],e.equipments=null,e.equipmentNameList=[],e.itemNameList=[],e.goodsNameList=[],e.trashNameList=[],e.dollNameList=[],e.monsters=null,e.nonplayers=null,e.spriteFrames=null,e.status=null,e.suits=null,e.bullets=null,e.items=null,e.talents=null,e.furnitures=null,e.professionList=[],e.buildings=null,e.level=0,e.chapterIndex=0,e.chapterMaxIndex=0,e.playerData=new s.default,e.inventoryManager=new u.default,e.mapManager=new l.default,e.worldLoader=new g.default,e.coins=0,e.oilGolds=0,e.killCount=0,e.coinDreamCount=0,e.time="00:00:00",e.realTime=15591456e5,e.seed=5,e.isFirst=1,e.isFirstLoading=!0,e.jumpChapter=0,e.shipTransportScene=0,e.elevatorScene=0,e.isCheatMode=!1,e.isDebug=!1,e.isTour=!1,e.isGamePause=!1,e.dieFrom=new f.default,e.isMapReset=!1,e.lastBgmIndex=1,e.savePoinitData=new v.default,e.groundOilGoldData=new T.default,e.killPlayerCounts={},e.profileManager=new d.default,e.bagSortIndex=0,e.sortIndexs={},e.settings=new y.default,e.nonPlayerList=[],i=n([A],e)}(cc.Component));i.default=C,cc._RF.pop()},{"../data/FromData":"FromData","../data/GroundOilGoldData":"GroundOilGoldData","../data/InventoryData":"InventoryData","../data/NonPlayerData":"NonPlayerData","../data/OilGoldData":"OilGoldData","../data/PlayerData":"PlayerData","../data/SavePointData":"SavePointData","../manager/InventoryManager":"InventoryManager","../manager/LoadingManager":"LoadingManager","../manager/MapManager":"MapManager","../manager/ProfileManager":"ProfileManager","../map/WorldLoader":"WorldLoader","../model/Settings":"Settings","../utils/AudioPlayer":"AudioPlayer","../utils/LocalStorage":"LocalStorage","../utils/Random":"Random","./Dungeon":"Dungeon","./EventHelper":"EventHelper"}],MagicCircle:[function(t,e,i){"use strict";cc._RF.push(e,"4b4e32e5VZL3KOgwsnsl4rh","MagicCircle");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShow=!1,e.spellNow=!1,e}return a(e,t),e.prototype.playMagic=function(t){this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play(),this.anim.getAnimationState("PlayerMagicShow").speed=2,this.isShow=!0,this.spellNow=t,t&&this.talentMaigc&&this.talentMaigc.MagicFinish()},e.prototype.MagicFinish=function(){!this.spellNow&&this.talentMaigc&&this.talentMaigc.MagicFinish(),this.isShow=!1},n([s],e)}(cc.Component));i.default=l,cc._RF.pop()},{}],MagicIce:[function(t,e,i){"use strict";cc._RF.push(e,"593bdTc6U9L8aRhkgXkK2Pf","MagicIce");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShow=!1,e}return a(e,t),e.prototype.showIce=function(){this.anim||(this.anim=this.getComponent(cc.Animation)),this.node.opacity=128,this.anim.play("PlayerMagicIceIdle"),this.isShow=!0},e.prototype.breakIce=function(){this.anim.play("PlayerMagicIceBreak"),this.isShow=!1},n([s],e)}(cc.Component));i.default=l,cc._RF.pop()},{}],MagicLightening:[function(t,e,i){"use strict";cc._RF.push(e,"6dfcbPWaC1Bm5ogHJjkBBm7","MagicLightening");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../utils/AudioPlayer"),l=t("../data/FromData"),c=t("../manager/StatusManager"),u=t("../utils/ActorUtils"),h=t("./Building"),d=cc._decorator,p=d.ccclass,f=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasTargetMap=new Map,e.needPrepare=!1,e.showArea=!1,e.isTrigger=!0,e.isAttacked=!1,e.damagePoint=5,e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.fall=function(t,e,i){i&&i>0&&(this.damagePoint=i),this.needPrepare=t,this.isAttacked=!1;var o="LighteningFall";e&&(o="LighteningFallArea"),t&&(o="LighteningPrepareFall",this.isAttacked=!0),this.anim=this.getComponent(cc.Animation),this.anim.play(o),s.default.play(s.default.BOOM)},e.prototype.AnimBegin=function(){this.isAttacked=!1},e.prototype.AnimFinish=function(){var t=this;this.scheduleOnce(function(){t.node&&t.destroyEntityNode()},2)},e.prototype.onColliderEnter=function(t){u.default.getEnemyCollisionTarget(t)&&this.isTrigger&&(this.isTrigger=!1,this.fall(!0,!0))},e.prototype.onColliderStay=function(t,e){e.radius>0&&!this.isAttacked&&this.attacking(t.node)},e.prototype.attacking=function(t){if(t){var e=new r.default,i=c.default.BURNING;e.magicDamage=this.damagePoint,i=c.default.DIZZ;var o=u.default.getEnemyActorByNode(t,!this.needPrepare);if(o&&!o.sc.isDied){o.takeDamage(e);var a=l.default.getClone("\u95ea\u7535","magiclighteningdown1");o.addStatus(i,a),this.isAttacked=!0}}},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.5&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(){},n([p],e)}(h.default));i.default=f,cc._RF.pop()},{"../data/DamageData":"DamageData","../data/FromData":"FromData","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","./Building":"Building"}],MapData:[function(t,e,i){"use strict";cc._RF.push(e,"9d7bcZhUYBIzJR0A6/ryRxj","MapData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.map=new Array,this.init(t)}return t.prototype.init=function(t){if(t){var e=(t=t.substring(2,t.length-2)).split("\r\n");this.map=new Array;for(var i=0;i<e.length;i++)this.map[i]=new Array;for(i=0;i<e.length;i++)for(var o=e[e.length-1-i].split(""),a=0,n=0;n<o.length-1;a++)this.map[i][a]=o[n]+o[n+1],n+=2;var r=new Array;for(i=0;i<this.map[0].length;i++)for(r[i]=new Array,n=0;n<this.map.length;n++)r[i][n]=this.map[n][i];this.map=r}},t.prototype.logMap=function(){for(var t="",e=this.map[0].length-1;e>=0;e--){for(var i=0;i<this.map.length;i++)t+=""+this.map[i][e];t+="\n"}return t},t.prototype.clone=function(){var e=new t("");return e.map=this.map.slice(),e},t.prototype.valueCopy=function(t){return this.map=t&&t.map?t.map:null,this},t}();i.default=o,cc._RF.pop()},{}],MapLightData:[function(t,e,i){"use strict";cc._RF.push(e,"c7371Xi6Z1FDZidBXLVH9FT","MapLightData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.prototype.valueCopy=function(t){this.name=t.name,this.type=t.type,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.ellipse=t.ellipse,this.polygon=t.polygon},t}();i.default=o,cc._RF.pop()},{}],MapManagerData:[function(t,e,i){"use strict";cc._RF.push(e,"fc23bpSDqZOALYDNPFUGFLx","MapManagerData"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(){},cc._RF.pop()},{}],MapManager:[function(t,e,i){"use strict";cc._RF.push(e,"3b0b2KGAWdGI6jcP8eIcPHE","MapManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../data/MapData"),a=t("../rect/RectRoom"),n=t("../rect/RectDungeon"),r=t("../logic/Logic"),s=t("../utils/Random4Save"),l=t("../rect/RoomType"),c=function(){function t(){this.isloaded=!1,this.rectDungeon=null,this.init()}return t.prototype.init=function(){this.isloaded=!1},t.prototype.clear=function(){},t.prototype.loadMap=function(){r.default.isMapReset&&r.default.mapManager.reset(),cc.log("maps loaded")},t.prototype.reset=function(t){r.default.isMapReset=!1;var e=r.default.worldLoader.getCurrentLevelData();if(this.rand4save=null,this.rectDungeon=new n.default,r.default.profileManager.data&&r.default.profileManager.data.rectDungeons[""+e.chapter+e.index])this.rectDungeon.buildMapFromSave(r.default.profileManager.data.rectDungeons[""+e.chapter+e.index],e);else{this.rectDungeon.buildMap(e);var i=this.rectDungeon.startIndex;this.rectDungeon.currentPos=cc.v3(i.x,i.y)}t&&(this.rectDungeon.currentPos=t.clone()),cc.log(this.rectDungeon.getDisPlay()),this.rectDungeon.changeRoomsIsFound(this.rectDungeon.currentPos.x,this.rectDungeon.currentPos.y)},t.prototype.loadingNextRoom=function(t){var e=this.rectDungeon.getNeighborRoom(this.rectDungeon.currentPos.x,this.rectDungeon.currentPos.y,t);return e&&e.roomType&&(this.rectDungeon.currentPos=cc.v3(e.x,e.y),this.rectDungeon.changeRoomsIsFound(e.x,e.y)),e},t.prototype.getCurrentMapStringArray=function(){var t=this.getCurrentRoom(),e=new o.default(""),i=r.default.worldLoader.getCurrentLevelData();return e.map=i.getRoomMap(t.x,t.y),this.addGenerateThings(e,t.roomType,t.seed,i.needRadomDecorate).map},t.prototype.getCurrentSideMapStringArray=function(t){var e=this.getCurrentRoom(),i=new o.default(""),a=r.default.worldLoader.getCurrentLevelData();return i.map=a.getRoomMap(e.x+t.x,e.y+t.y),i.map},t.prototype.getCurrentMapSize=function(){var t=r.default.worldLoader.getCurrentLevelData();return cc.v3(t.roomWidth,t.roomHeight)},t.prototype.getCurrentRoom=function(){if(this.rectDungeon&&this.rectDungeon.map)return this.rectDungeon.map[this.rectDungeon.currentPos.x][this.rectDungeon.currentPos.y]||new a.default(1,1,l.default.Z_ROOM)},t.prototype.getCurrentMapBuilding=function(t){var e=this.rectDungeon.buildings["x="+this.rectDungeon.currentPos.x+"y="+this.rectDungeon.currentPos.y];return e?e["x="+t.x+"y="+t.y]:null},t.prototype.setCurrentBuildingData=function(t){var e=this.rectDungeon.buildings["x="+this.rectDungeon.currentPos.x+"y="+this.rectDungeon.currentPos.y];e||(e={},this.rectDungeon.buildings["x="+this.rectDungeon.currentPos.x+"y="+this.rectDungeon.currentPos.y]=e),e["x="+t.defaultPos.x+"y="+t.defaultPos.y]=t},t.prototype.getCurrentMapEquipments=function(){return this.rectDungeon.equipments["x="+this.rectDungeon.currentPos.x+"y="+this.rectDungeon.currentPos.y]},t.prototype.setCurrentEquipmentsArr=function(t){this.rectDungeon.equipments["x="+this.rectDungeon.currentPos.x+"y="+this.rectDungeon.currentPos.y]=t},t.prototype.getCurrentMapItems=function(){return this.rectDungeon.items["x="+this.rectDungeon.currentPos.x+"y="+this.rectDungeon.currentPos.y]},t.prototype.setCurrentItemsArr=function(t){this.rectDungeon.items["x="+this.rectDungeon.currentPos.x+"y="+this.rectDungeon.currentPos.y]=t},t.prototype.setRoomClear=function(t,e){this.rectDungeon&&this.rectDungeon.map&&t<this.rectDungeon.map.length&&e<this.rectDungeon.map[0].length&&(this.rectDungeon.map[t][e].state=a.default.STATE_CLEAR,this.rectDungeon.map[t][e].isReborn=!1)},t.prototype.getCurrentRoomState=function(){return this.getCurrentRoom().state},t.prototype.isCurrentRoomStateClear=function(){return this.getCurrentRoomState()==a.default.STATE_CLEAR},t.prototype.getCurrentRoomType=function(){return this.getCurrentRoom().roomType},t.prototype.isNeighborRoomExist=function(t){return!!this.rectDungeon.getNeighborRoom(this.rectDungeon.currentPos.x,this.rectDungeon.currentPos.y,t)},t.prototype.isNeighborRoomNew=function(t){var e=this.rectDungeon.getNeighborRoom(this.rectDungeon.currentPos.x,this.rectDungeon.currentPos.y,t);return!!e&&e.state!=a.default.STATE_CLEAR},t.prototype.isNeighborRoomStateClear=function(t){var e=this.rectDungeon.getNeighborRoom(this.rectDungeon.currentPos.x,this.rectDungeon.currentPos.y,t);return!!e&&e.state==a.default.STATE_CLEAR},t.prototype.getCurrentRoomRandom4Save=function(){var t=this.getCurrentRoom();return t?this.rand4save||(this.rand4save=new s.default(t.seed),this.rand4save.Seed=t.seed):this.rand4save||(this.rand4save=new s.default(0)),this.rand4save},t.prototype.getRebornSeed=function(t){return t+1e8*r.default.mapManager.getCurrentRoom().reborn},t.prototype.getSeedFromRoom=function(){return r.default.mapManager.getCurrentRoomRandom4Save().getRandomNum(0,1e8)},t.prototype.getRandom4Save=function(t){var e=new s.default(t>0?t:this.getSeedFromRoom());return e.rand(),e},t.prototype.addGenerateThings=function(t,e,i,o){var a=new s.default(i);return cc.log("seed:"+i),this.addRandomTile(t,a),l.default.isDecorateRoomType(e)&&o&&(a=new s.default(i),this.addDecorate(t,a)),t},t.prototype.addRandomTile=function(t,e){for(var i=[],o=0;o<10;o++){var a=e.getRandomNum(0,t.map.length-1),n=e.getRandomNum(0,t.map[0].length-1);i.push(cc.v3(a,0)),i.push(cc.v3(0,n)),i.push(cc.v3(a,n))}for(var r=0,s=i;r<s.length;r++){var l=s[r];"**"==t.map[l.x][l.y]&&(t.map[l.x][l.y]="*"+e.getRandomNum(0,2))}},t.prototype.addDecorate=function(t,e){for(var i=[],o=0;o<2;o++){var a=e.getRandomNum(1,t.map.length-2),n=e.getRandomNum(1,t.map[0].length-2);i.push(cc.v3(a,n))}for(var r=0,s=i;r<s.length;r++){var l=s[r];"**"!=t.map[l.x][l.y]&&-1==t.map[l.x][l.y].indexOf("W")||(t.map[l.x][l.y]="W"+e.getRandomNum(0,2))}},t}();i.default=c,cc._RF.pop()},{"../data/MapData":"MapData","../logic/Logic":"Logic","../rect/RectDungeon":"RectDungeon","../rect/RectRoom":"RectRoom","../rect/RoomType":"RoomType","../utils/Random4Save":"Random4Save"}],MartCashier:[function(t,e,i){"use strict";cc._RF.push(e,"88c99phMSBLjpgR45Dw2hZG","MartCashier");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../utils/AudioPlayer"),s=t("./Building"),l=cc._decorator,c=l.ccclass,u=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){r.default.play(r.default.WELCOME)},e.prototype.onColliderEnter=function(){},e.prototype.onColliderExit=function(){},n([c],e)}(s.default));i.default=u,cc._RF.pop()},{"../utils/AudioPlayer":"AudioPlayer","./Building":"Building"}],MartShelvesDialog:[function(t,e,i){"use strict";cc._RF.push(e,"24e528ueQhMDYfsDE3eSpqK","MartShelvesDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../../data/GoodsData"),s=t("../../logic/EventHelper"),l=t("../../item/Goods"),c=t("../../logic/Logic"),u=t("../../utils/AudioPlayer"),h=t("./BaseDialog"),d=cc._decorator,p=d.ccclass,f=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.goods=null,e.layer=null,e.spriteNode=null,e.fridgeNode=null,e.fridgeLayer=null,e.doorLeft=null,e.doorRight=null,e.payNode=null,e.payTitle=null,e.payDesc=null,e.payIcon=null,e.type=i.TYPE_NORMAL,e.goodsList=[],e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;cc.director.on(s.EventHelper.HUD_MART_SHELVES_DIALOG_PAY,function(e){t.node&&t.showPay(e.detail.data)})},e.prototype.showPay=function(t){this.goodsData=t,this.payTitle.string=""+t.item.nameCn,this.payDesc.string="\u4ef7\u683c\uff1a"+t.item.price+"\n\n\u8bf4\u660e\uff1a"+t.item.info+"\n"+t.item.desc,c.default.spriteFrameRes(t.item.resName)&&(this.payIcon.spriteFrame=c.default.spriteFrameRes(t.item.resName),this.payIcon.node.width=this.payIcon.spriteFrame.getOriginalSize().width,this.payIcon.node.height=this.payIcon.spriteFrame.getOriginalSize().height),this.payNode.active=!0},e.prototype.Pay=function(){c.default.coins>=this.goodsData.item.price?(cc.director.emit(s.EventHelper.HUD_ADD_COIN,{detail:{count:-this.goodsData.item.price}}),u.default.play(u.default.CASHIERING),cc.director.emit(s.EventHelper.PLAYER_CHANGEITEM,{detail:{itemData:this.goodsData.item}}),this.close()):u.default.play(u.default.SELECT_FAIL)},e.prototype.Cancel=function(){u.default.play(u.default.SELECT),this.payNode.active=!1},e.prototype.updateUI=function(t,e){this.payNode.active=!1,this.spriteNode.active=!1,this.fridgeNode.active=!1,this.type=t,this.changeBg(t),this.addGoods(t,e)},e.prototype.changeBg=function(t){this.martshelvesbg||(this.martshelvesbg=this.node.getChildByName("sprite").getChildByName("martshelves"),this.martshelvesside0=this.node.getChildByName("sprite").getChildByName("martshelvesside0"),this.martshelvesside1=this.node.getChildByName("sprite").getChildByName("martshelvesside1"),this.martshelvesside2=this.node.getChildByName("sprite").getChildByName("martshelvesside2"),this.martshelvesside3=this.node.getChildByName("sprite").getChildByName("martshelvesside3")),t==i.TYPE_FRIDGE?(this.fridgeNode.active=!0,this.doorLeft.scaleX=1,this.doorRight.scaleX=1):this.spriteNode.active=!0;var e=t==i.TYPE_WOOD?"#DF8143":"#FFFFFF";this.martshelvesbg.color=cc.color().fromHEX(e),this.martshelvesside0.color=cc.color().fromHEX(e),this.martshelvesside1.color=cc.color().fromHEX(e),this.martshelvesside2.color=cc.color().fromHEX(e),this.martshelvesside3.color=cc.color().fromHEX(e)},e.prototype.addGoods=function(t,e){var o=this;this.layer.removeAllChildren(),this.fridgeLayer.removeAllChildren();for(var a=t==i.TYPE_FRIDGE,n=a?this.fridgeLayer:this.layer,s=a?i.SIZE_FRIDGE:i.SIZE,u=0;u<s;u++)if(!(u>e.length-1)){var h=cc.instantiate(this.goods).getComponent(l.default),d=new r.default;d.count=1,d.item.valueCopy(c.default.items[e[u]]),h.init(d),this.goodsList.push(h),n.addChild(h.node)}a&&this.scheduleOnce(function(){o.anim||(o.anim=o.getComponent(cc.Animation)),o.anim.play()},1)},e.prototype.close=function(){u.default.play(u.default.SELECT),this.fridgeNode.active=!1,this.spriteNode.active=!1,this.payNode.active=!1,this.dismiss()},e.SIZE=21,e.SIZE_FRIDGE=12,e.TYPE_NORMAL="Sa",e.TYPE_WOOD="Sb",e.TYPE_FRIDGE="Sc",n([f(cc.Prefab)],e.prototype,"goods",void 0),n([f(cc.Node)],e.prototype,"layer",void 0),n([f(cc.Node)],e.prototype,"spriteNode",void 0),n([f(cc.Node)],e.prototype,"fridgeNode",void 0),n([f(cc.Node)],e.prototype,"fridgeLayer",void 0),n([f(cc.Node)],e.prototype,"doorLeft",void 0),n([f(cc.Node)],e.prototype,"doorRight",void 0),n([f(cc.Node)],e.prototype,"payNode",void 0),n([f(cc.Label)],e.prototype,"payTitle",void 0),n([f(cc.Label)],e.prototype,"payDesc",void 0),n([f(cc.Sprite)],e.prototype,"payIcon",void 0),i=n([p],e)}(h.default);i.default=g,cc._RF.pop()},{"../../data/GoodsData":"GoodsData","../../item/Goods":"Goods","../../logic/EventHelper":"EventHelper","../../logic/Logic":"Logic","../../utils/AudioPlayer":"AudioPlayer","./BaseDialog":"BaseDialog"}],MartShelves:[function(t,e,i){"use strict";cc._RF.push(e,"4800aSbfApGHYS7nMK4o5Bn","MartShelves");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/GoodsData"),s=t("../logic/EventHelper"),l=t("../item/Goods"),c=t("../logic/Logic"),u=t("../ui/Tips"),h=t("./Building"),d=cc._decorator,p=d.ccclass,f=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.goods=null,e.layer=null,e.type=i.TYPE_NORMAL,e.goodsList=[],e.goodsNameList=[],e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.tips=this.getComponentInChildren(u.default),this.tips.onInteract(function(){t.node&&s.EventHelper.emit(s.EventHelper.HUD_MART_SHELVES_DIALOG,{type:t.type,goodsNameList:t.goodsNameList})})},e.prototype.init=function(t,e){this.goodsNameList=e,this.type=t,this.changeBg(t),this.addGoods(e)},e.prototype.changeBg=function(t){this.martshelvesbg||(this.martshelvesbg=this.node.getChildByName("sprite").getChildByName("martshelves"),this.martshelvesside0=this.node.getChildByName("sprite").getChildByName("martshelvesside0"),this.martshelvesside1=this.node.getChildByName("sprite").getChildByName("martshelvesside1"),this.martshelvesside2=this.node.getChildByName("sprite").getChildByName("martshelvesside2"),this.martshelvesside3=this.node.getChildByName("sprite").getChildByName("martshelvesside3"));var e=t==i.TYPE_WOOD?"#DF8143":"#FFFFFF";this.martshelvesbg.color=cc.color().fromHEX(e),t!=i.TYPE_FRIDGE&&(this.martshelvesside0.color=cc.color().fromHEX(e)),this.martshelvesside1.color=cc.color().fromHEX(e),this.martshelvesside2.color=cc.color().fromHEX(e),this.martshelvesside3.color=cc.color().fromHEX(e)},e.prototype.addGoods=function(t){this.layer.removeAllChildren();for(var e=this.type==i.TYPE_FRIDGE?i.SIZE_FRIDGE:i.SIZE_NORMAL,o=0;o<e;o++){if(o>t.length-1)return;var a=cc.instantiate(this.goods).getComponent(l.default),n=new r.default;n.count=10,n.item.valueCopy(c.default.items[t[o]]),a.init(n),this.goodsList.push(a),this.layer.addChild(a.node)}},e.prototype.onColliderEnter=function(){},e.prototype.onColliderExit=function(){},e.SIZE_NORMAL=21,e.SIZE_FRIDGE=12,e.TYPE_NORMAL="Sa",e.TYPE_WOOD="Sb",e.TYPE_FRIDGE="Sc",n([f(cc.Prefab)],e.prototype,"goods",void 0),n([f(cc.Node)],e.prototype,"layer",void 0),i=n([p],e)}(h.default);i.default=g,cc._RF.pop()},{"../data/GoodsData":"GoodsData","../item/Goods":"Goods","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../ui/Tips":"Tips","./Building":"Building"}],MeleeShadowWeapon:[function(t,e,i){"use strict";cc._RF.push(e,"42691fWENBA0qvnMd6/WcCK","MeleeShadowWeapon");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../utils/AudioPlayer"),s=t("../utils/Utils"),l=t("../base/BaseColliderComponent"),c=t("../data/TriggerData"),u=cc._decorator,h=u.ccclass,d=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.player=null,e.isAttacking=!1,e.hv=cc.v2(1,0),e.comboType=0,e.hasTargetMap=new Map,e}return a(e,t),Object.defineProperty(e.prototype,"IsAttacking",{get:function(){return this.isAttacking},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsReflect",{get:function(){return!!this.meleeWeapon&&this.meleeWeapon.IsReflect},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){t.prototype.onLoad.call(this)},e.prototype.init=function(t,e){this.anim=this.getComponent(cc.Animation),this.player=t,this.meleeWeapon=e},Object.defineProperty(e.prototype,"Hv",{get:function(){return this.hv},set:function(t){this.hv=t.normalizeSelf()},enumerable:!1,configurable:!0}),e.prototype.attack=function(t,e,i){this.updateHv(i),this.comboType=e,this.hasTargetMap.clear(),this.isAttacking=!0;var o=this.meleeWeapon.getAttackAnimName(e);return this.anim.play(o),this.anim.getAnimationState(o).speed=this.meleeWeapon.getAnimSpeed(t.FinalCommon),!0},e.prototype.attackIdle=function(t){this.anim&&this.anim.play(t?"MeleeAttackIdleReverse":"MeleeAttackIdle")},e.prototype.MeleeAttackFinish=function(){this.isAttacking=!1},e.prototype.ComboStart=function(){},e.prototype.ComboFinish=function(){},e.prototype.ComboTime=function(){},e.prototype.ExAttackTime=function(){this.player.exTrigger(c.default.GROUP_ATTACK,this.comboType,null,null)},e.prototype.AudioTime=function(){this.meleeWeapon&&this.meleeWeapon.AudioTime()},e.prototype.RefreshTime=function(){this.hasTargetMap.clear()},e.prototype.DashTime=function(){r.default.play(r.default.DASH)},e.prototype.EffectTime=function(){},e.prototype.updateHv=function(t){this.hv=t,this.rotateCollider(this.hv)},e.prototype.rotateCollider=function(t){if(!t.equals(cc.Vec2.ZERO)){var e=Math.abs(this.node.scaleX),i=Math.abs(this.node.scaleY);this.node.scaleX=this.player.node.scaleX>0?e:-e,this.node.scaleY=this.node.scaleX<0?-i:i,this.node.angle=s.default.getRotateAngle(t,this.node.scaleX<0)}},e.prototype.onColliderStay=function(t,e){if(e.w>0&&e.h>0)return this.hasTargetMap.has(t.id)&&this.hasTargetMap.get(t.id)>0?(this.hasTargetMap.set(t.id,this.hasTargetMap.get(t.id)+1),!1):(this.hasTargetMap.set(t.id,1),!!this.meleeWeapon&&this.meleeWeapon.attacking(t,this.anim,!0))},n([h],e)}(l.default));i.default=d,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../data/TriggerData":"TriggerData","../utils/AudioPlayer":"AudioPlayer","../utils/Utils":"Utils"}],MeleeWeaponChild:[function(t,e,i){"use strict";cc._RF.push(e,"81ac4Ib50VMBoiaBfrNyVFU","MeleeWeaponChild");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.meleeWeapon=null,e}return a(e,t),e.prototype.onLoad=function(){this.getComponent(cc.Sprite).spriteFrame},e.prototype.start=function(){},n([s],e)}(cc.Component));i.default=l,cc._RF.pop()},{}],MeleeWeapon:[function(t,e,i){"use strict";cc._RF.push(e,"8747dgi/6dFupzO0r46t7Ya","MeleeWeapon");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Player"),s=t("./NonPlayer"),l=t("./EventHelper"),c=t("../building/Box"),u=t("./Logic"),h=t("./MeleeWeaponChild"),d=t("../data/DamageData"),p=t("../manager/StatusManager"),f=t("../boss/Boss"),g=t("../utils/NextStep"),y=t("../data/FromData"),m=t("../utils/AudioPlayer"),v=t("../utils/IndexZ"),E=t("./PlayerAvatar"),_=t("../manager/InventoryManager"),T=t("../building/HitBuilding"),D=t("../data/CommonData"),S=t("../data/AvatarData"),O=t("../utils/ActorUtils"),A=t("../building/InteractBuilding"),C=t("../utils/Utils"),R=t("../collider/CCollider"),L=t("../base/BaseColliderComponent"),b=t("./Controller"),P=t("../data/TriggerData"),I=cc._decorator,M=I.ccclass,N=I.property,w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.playerNode=null,e.player=null,e.waveWeapon=null,e.iceLight=null,e.fireLight=null,e.lighteningLight=null,e.toxicLight=null,e.curseLight=null,e.meleeLightLeftPos=cc.v3(8,0),e.meleeLightRightPos=cc.v3(-8,0),e.isAttacking=!1,e.hv=cc.v2(1,0),e.isStab=!0,e.isFar=!1,e.isFist=!0,e.isBlunt=!1,e.weaponFirePoints=[],e.isMiss=!1,e.drainSkill=new g.default,e.isReflect=!1,e.spriteNode=null,e.weaponSprite=null,e.weaponLightSprite=null,e.handSprite=null,e.glovesSprite=null,e.comboType=0,e.isComboing=!1,e.hasTargetMap=new Map,e.isSecond=!1,e.currentAngle=0,e.fistCombo=0,e.exBeatBack=0,e.isAttackPressed=!1,e.comboMiss=!1,e.canMove=!1,e}var i;return a(e,t),i=e,Object.defineProperty(e.prototype,"IsSword",{get:function(){return!(this.isStab||this.isFar||this.isFist||this.isBlunt)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsDagger",{get:function(){return this.isStab&&!this.isFar&&!this.isFist&&!this.isBlunt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsSecond",{set:function(t){this.isSecond=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsFist",{get:function(){return this.isFist},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsComboing",{get:function(){return this.isComboing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsAttacking",{get:function(){return this.isAttacking},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsReflect",{get:function(){return this.isReflect},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"GlovesSprite",{get:function(){return this.glovesSprite},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ComboType",{get:function(){return this.comboType},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.anim=this.getComponent(cc.Animation),this.player=this.playerNode.getComponent(r.default),this.weaponFirePoint=this.node.getChildByName("firepoint"),this.spriteNode=this.node.getChildByName("sprite"),this.meleeLightLeftPos=this.player.node.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(this.meleeLightLeftPos)),this.meleeLightRightPos=this.player.node.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(this.meleeLightRightPos)),this.weaponSprite=this.getSpriteChildSprite(["sprite",_.default.WEAPON]),this.weaponLightSprite=this.getSpriteChildSprite(["sprite","meleelight"]),this.handSprite=this.getSpriteChildSprite(["sprite","hand"]),this.glovesSprite=this.getSpriteChildSprite(["sprite","hand","gloves"]),this.handSprite.node.color=cc.Color.WHITE.fromHEX(this.player.avatar.data.skinColor);for(var e=0;e<4;e++)this.weaponFirePoints.push(this.weaponFirePoint.getChildByName("point"+e))},Object.defineProperty(e.prototype,"Hv",{get:function(){return this.hv},set:function(t){if(b.default.isMouseMode()&&b.default.mousePos&&this.dungeon){var e=cc.v2(this.dungeon.node.convertToWorldSpaceAR(this.player.node.position));this.hv=b.default.mousePos.add(cc.v2(this.dungeon.mainCamera.node.position)).sub(e).normalize()}else{var i=O.default.getDirectionFromNearestEnemy(this.player.node.position,!1,this.dungeon,!1,300);i.equals(cc.Vec3.ZERO)?this.hv=t.normalize():this.hv=cc.v2(i).normalize()}},enumerable:!1,configurable:!0}),e.prototype.getSpriteChildSprite=function(t){for(var e=this.node,i=0,o=t;i<o.length;i++){var a=o[i];e=e.getChildByName(a)}return e.getComponent(cc.Sprite)},e.prototype.changeEquipment=function(t,e){this.isStab=1==t.stab,this.isFar=1==t.far,this.isReflect=1==t.isReflect,this.isFist=_.default.WEAPON!=t.equipmetType,this.isBlunt=1==t.blunt,this.exBeatBack=u.default.inventoryManager.getEquipBySuit(t).exBeatBack,this.weaponSprite.spriteFrame=e;var i=cc.color(255,255,255).fromHEX(t.color),o=cc.color(255,255,255).fromHEX(t.lightcolor);this.weaponSprite.node.color=i,this.weaponLightSprite.node.color=o,this.isStab?this.weaponSprite.node.angle=15:this.weaponSprite.node.angle=-235,this.weaponSprite.node.width=this.weaponSprite.spriteFrame.getOriginalSize().width,this.weaponSprite.node.height=this.weaponSprite.spriteFrame.getOriginalSize().height},e.prototype.updateCombo=function(){this.comboType==i.COMBO1?this.comboType=i.COMBO2:this.comboType==i.COMBO2?this.comboType=i.COMBO3:(this.comboType,i.COMBO3,this.comboType=i.COMBO1),this.isComboing||(this.comboType=i.COMBO1)},e.prototype.attack=function(t,e){this.playerData=t.clone();var i=u.default.getRandomNum(0,100)<t.StatusTotalData.missRate;return this.isAttacking||!this.anim?(this.isComboing&&(this.isAttackPressed=!0,this.comboMiss=i),!1):(i&&this.player.showFloatFont(this.node.parent,0,!1,!0,!1,!1,!1),this.attackDo(t,i,e))},e.prototype.attackDo=function(t,e,i){this.hasTargetMap.clear(),this.fistCombo=i,this.isMiss=e,this.isAttacking=!0,this.canMove=!1,this.updateCombo();var o=this.getAttackAnimName();return this.anim.play(o),this.anim.getAnimationState(o).speed=this.getAnimSpeed(t.FinalCommon),!0},e.prototype.getAnimSpeed=function(t){var e=1;this.isStab&&!this.isFar&&(e=1.8),this.isStab||this.isFar||(e=1.5),this.isStab&&this.isFar&&(e=1.2),!this.isStab&&this.isFar&&(e=1),this.isFist&&(e=1);var i=1+t.attackSpeed/500;return i<.8&&(i=.8),i>3&&(i=3),i*e},e.prototype.attackIdle=function(t){this.anim&&this.anim.play(t?"MeleeAttackIdleReverse":"MeleeAttackIdle")},e.prototype.MoveAction=function(){this.canMove=!0},e.prototype.getMeleeSlowRatio=function(){return this.canMove||!this.isAttacking?1:!this.isFar&&this.isStab?.1:this.isFar&&this.isStab?.04:this.isFar||this.isStab?.02:.04},e.prototype.getAttackAnimName=function(t){return(!this.isFar&&this.isStab||this.isFist?this.isFist?"MeleeAttackFist":"MeleeAttackStab":this.isFar&&this.isStab?"MeleeAttackStabFar":this.isFar&&!this.isStab?this.isBlunt?"MeleeAttackBluntFar":"MeleeAttackFar":this.isBlunt?"MeleeAttackBlunt":"MeleeAttack")+this.getComboSuffix(t)},e.prototype.getComboSuffix=function(t){return this.isFist?this.isSecond?"2":"1":(t=t||this.comboType)==i.COMBO1?"1":t==i.COMBO2?"2":t==i.COMBO3?"3":"1"},e.prototype.getWaveLight=function(t,e,i){var o=[this.iceLight,this.fireLight,this.lighteningLight,this.toxicLight,this.curseLight],a=[m.default.ELECTRIC_ATTACK,m.default.FIREBALL,m.default.ELECTRIC_ATTACK,m.default.ELECTRIC_ATTACK,m.default.ELECTRIC_ATTACK];if(!(i<1||i>o.length)&&this.dungeon){var n=cc.instantiate(o[i-1]);m.default.play(a[i-1]);for(var r=this.anim.getAnimationState(this.getAttackAnimName()).speed,s=[e],l=0,c=this.weaponFirePoints;l<c.length;l++){var u=c[l];u&&s.push(e.add(u.position))}for(var h=0;h<s.length;h++){var d=s[h];d=this.node.convertToWorldSpaceAR(d),d=t.convertToNodeSpaceAR(d),s[h]=d.clone()}n.parent=t,n.position=s[0],n.zIndex=v.default.OVERHEAD,n.opacity=255,n.setScale(.2),n.active=!0,cc.tween(n).to(.1/r,{position:s[1]}).to(.1/r,{position:s[2]}).to(.1/r,{position:s[3]}).to(.1/r,{position:s[4]}).start()}},e.prototype.MeleeAttackFinish=function(){this.isAttacking=!1,this.isFist||(this.isComboing=!1)},e.prototype.ComboStart=function(){this.isComboing=!0},e.prototype.ComboFinish=function(){this.isComboing=!1},e.prototype.ComboTime=function(){this.isAttackPressed&&(this.isAttackPressed=!1,this.anim.pause(),this.comboMiss&&this.player.showFloatFont(this.node.parent,0,!1,!0,!1,!1,!1),this.attackDo(this.playerData,this.comboMiss,this.fistCombo),this.player.playerAnim(E.default.STATE_ATTACK,this.player.currentDir),this.player.stopHiding(),this.isComboing=!1)},e.prototype.ExAttackTime=function(){this.player.exTrigger(P.default.GROUP_ATTACK,this.comboType,null,null)},e.prototype.AudioTime=function(){var t=m.default.MELEE,e=[m.default.SWORD_ATTACK,m.default.SWORD_ATTACK1,m.default.SWORD_ATTACK2][u.default.getRandomNum(0,2)],o=[m.default.FIST,m.default.FIST1,m.default.FIST2][u.default.getRandomNum(0,2)];this.isStab&&!this.isFar&&(t=o,this.comboType==i.COMBO3&&(t=e)),this.isStab||this.isFar||(t=e),this.isStab&&this.isFar&&(t=e),!this.isStab&&this.isFar&&(t=e),this.isFist&&(t=o),m.default.play(t)},e.prototype.RefreshTime=function(){this.hasTargetMap.clear()},e.prototype.DashTime=function(t){var e=this;m.default.play(m.default.DASH),t||(t=300),this.schedule(function(){e.player.getWalkSmoke(e.player.node,e.node.position)},.05,4,0);var i=cc.v2(this.hv.x,this.hv.y);this.player.sc.isMoving=!1,this.player.isWeaponDashing=!0,i=i.equals(cc.Vec2.ZERO)?this.player.isFaceRight?cc.v2(1,0):cc.v2(-1,0):i.normalizeSelf();var o=cc.v2(i.x,i.y);this.hv=o.clone(),i=i.mul(t),this.player.entity.Move.linearVelocity=i,this.scheduleOnce(function(){e.player.isWeaponDashing=!1,e.player.entity.Move.linearVelocity=cc.Vec2.ZERO,e.player.playerAnim(E.default.STATE_IDLE,e.player.currentDir)},.2)},e.prototype.EffectTime=function(){var t=this,e=this.weaponFirePoint.position.clone(),o=u.default.getRandomNum(0,100),a=this.playerData.FinalCommon,n=[a.magicDamage>0&&o<a.iceRate?i.ELEMENT_TYPE_ICE:0,a.magicDamage>0&&o<a.fireRate?i.ELEMENT_TYPE_FIRE:0,a.magicDamage>0&&o<a.lighteningRate?i.ELEMENT_TYPE_LIGHTENING:0,a.magicDamage>0&&o<a.toxicRate?i.ELEMENT_TYPE_TOXIC:0,a.magicDamage>0&&o<a.curseRate?i.ELEMENT_TYPE_CURSE:0];this.scheduleOnce(function(){for(var i=0,o=n;i<o.length;i++){var a=o[i];t.dungeon&&t.getWaveLight(t.dungeon.node,e,a,t.isStab,t.isFar)}},0)},e.prototype.setWeaponInVisible=function(t){this.weaponSprite.node.opacity=t?0:255},e.prototype.updateLogic=function(t){if(b.default.isMouseMode()&&b.default.mousePos&&this.dungeon){var e=cc.v2(this.dungeon.node.convertToWorldSpaceAR(this.player.node.position));this.hv=b.default.mousePos.add(cc.v2(this.dungeon.mainCamera.node.position)).sub(e).normalize()}else{var i=O.default.getDirectionFromNearestEnemy(this.player.node.position,!1,this.dungeon,!1,400);i.equals(cc.Vec3.ZERO)||(this.hv=cc.v2(i))}this.isAttacking||this.rotateCollider(this.hv),this.node.angle=u.default.lerp(this.node.angle,this.currentAngle,5*t)},e.prototype.rotateCollider=function(t){if(!t.equals(cc.Vec2.ZERO)){var e=Math.abs(this.node.scaleX);this.node.scaleX=this.player.node.scaleX>0?e:-e;var i=Math.abs(this.node.scaleY);this.node.scaleY=this.node.scaleX<0?-i:i,this.currentAngle=C.default.getRotateAngle(t,this.node.scaleX<0),this.currentAngle<0&&(this.currentAngle+=360),this.currentAngle>=0&&this.currentAngle<=90&&this.node.angle>=225&&this.node.angle<=360?this.node.angle-=360:this.node.angle>=0&&this.node.angle<=90&&this.currentAngle>=225&&this.currentAngle<=360&&(this.node.angle+=360)}},e.prototype.onColliderStay=function(t,e){if(e.w>0&&e.h>0)return this.hasTargetMap.has(t.id)&&this.hasTargetMap.get(t.id)>0?(this.hasTargetMap.set(t.id,this.hasTargetMap.get(t.id)+1),!1):(this.hasTargetMap.set(t.id,1),this.attacking(t,this.anim,!1))},e.prototype.beatBack=function(t){var e=this.Hv.clone();e.equals(cc.Vec2.ZERO)&&(e=cc.v2(1,0));var o=100+this.exBeatBack;o=!this.isFar&&this.isStab?100:this.isFar&&this.isStab?400:this.isFar||this.isStab?100:240,this.comboType==i.COMBO3&&(o+=100),e=e.normalize().mul(o),this.scheduleOnce(function(){t.entity.Move.linearVelocity=cc.v2(e.x,e.y)},.05)},e.prototype.attacking=function(t,e,o){var a=this;if(!t||!this.isAttacking)return!1;var n=new d.default,r=new D.default;this.player&&(n=this.player.data.getFinalAttackPoint(),r=this.player.data.FinalCommon),n.isStab=this.isStab,n.isFist=this.isFist,n.isFar=this.isFar,n.isBlunt=this.isBlunt,n.isMelee=!0,n.comboType=this.comboType,this.isFist&&(n.comboType=this.fistCombo);var u=!1,h=!1;if(t.tag==R.default.TAG.NONPLAYER){var p=t.node.getComponent(s.default);p&&!p.sc.isDied&&!this.isMiss&&p.data.isEnemy>0&&(n.isBackAttack=p.isPlayerBehindAttack()&&r.damageBack>0,n.isBackAttack&&(n.realDamage+=r.damageBack),(u=p.takeDamage(n))&&(this.beatBack(p),this.addTargetAllStatus(r,p),this.addHitExTrigger(n,p)))}else if(t.tag==R.default.TAG.BOSS){var g=t.node.getComponent(f.default);!g||g.sc.isDied||this.isMiss||(u=g.takeDamage(n))&&(this.addTargetAllStatus(r,g),this.addHitExTrigger(n,g))}else if(t.tag==R.default.TAG.BUILDING||t.tag==R.default.TAG.WALL){var y=t.node.getComponent(c.default);if(y&&(h=!0,y.breakBox()),!h){var m=t.node.getComponent(A.default);m&&m.data.currentHealth>0&&(h=!0,m.takeDamage(n))}if(!h){var v=t.node.getComponent(T.default);v&&v.data.currentHealth>0&&(h=!0,v.takeDamage(n))}}return u&&this.drainSkill.next(function(){var t=a.player.data.getLifeDrain();t>0&&a.player.takeDamage(new d.default(-t))},1,!0),this.isMiss=!1,(u||h)&&(e.pause(),o||l.EventHelper.emit(l.EventHelper.CAMERA_SHAKE,{isHeavyShaking:this.comboType==i.COMBO3}),this.scheduleOnce(function(){e.resume()},.1)),u&&this.player.data.AvatarData.organizationIndex==S.default.TECH&&this.player.updateDream(-1),u||h},e.prototype.addHitExTrigger=function(t,e){var i=!1;t.isBackAttack&&(this.player.exTrigger(P.default.GROUP_HIT,P.default.TYPE_HIT_BACK,new y.default,e),i=!0),t.isCriticalStrike&&(this.player.exTrigger(P.default.GROUP_HIT,P.default.TYPE_HIT_CRIT,new y.default,e),i=!0),i||this.player.exTrigger(P.default.GROUP_HIT,P.default.TYPE_HIT,new y.default,e)},e.prototype.addTargetAllStatus=function(t,e){this.addTargetStatus(t.iceRate,e,p.default.FROZEN),this.addTargetStatus(t.fireRate,e,p.default.BURNING),this.addTargetStatus(t.lighteningRate,e,p.default.DIZZ),this.addTargetStatus(t.toxicRate,e,p.default.TOXICOSIS),this.addTargetStatus(t.curseRate,e,p.default.CURSING),this.addTargetStatus(t.realRate,e,p.default.BLEEDING)},e.prototype.addTargetStatus=function(t,e,i){u.default.getRandomNum(0,100)<t&&e.addStatus(i,new y.default)},e.ELEMENT_TYPE_ICE=1,e.ELEMENT_TYPE_FIRE=2,e.ELEMENT_TYPE_LIGHTENING=3,e.ELEMENT_TYPE_TOXIC=4,e.ELEMENT_TYPE_CURSE=5,e.COMBO1=1,e.COMBO2=2,e.COMBO3=3,n([N(cc.Node)],e.prototype,"playerNode",void 0),n([N(h.default)],e.prototype,"waveWeapon",void 0),n([N(cc.Prefab)],e.prototype,"iceLight",void 0),n([N(cc.Prefab)],e.prototype,"fireLight",void 0),n([N(cc.Prefab)],e.prototype,"lighteningLight",void 0),n([N(cc.Prefab)],e.prototype,"toxicLight",void 0),n([N(cc.Prefab)],e.prototype,"curseLight",void 0),i=n([M],e)}(L.default);i.default=w,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../boss/Boss":"Boss","../building/Box":"Box","../building/HitBuilding":"HitBuilding","../building/InteractBuilding":"InteractBuilding","../collider/CCollider":"CCollider","../data/AvatarData":"AvatarData","../data/CommonData":"CommonData","../data/DamageData":"DamageData","../data/FromData":"FromData","../data/TriggerData":"TriggerData","../manager/InventoryManager":"InventoryManager","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/NextStep":"NextStep","../utils/Utils":"Utils","./Controller":"Controller","./EventHelper":"EventHelper","./Logic":"Logic","./MeleeWeaponChild":"MeleeWeaponChild","./NonPlayer":"NonPlayer","./Player":"Player","./PlayerAvatar":"PlayerAvatar"}],MgCrack:[function(t,e,i){"use strict";cc._RF.push(e,"1d929jibO9BjosaDA5nr9aL","MgCrack");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../utils/AudioPlayer"),l=t("./MonsterGenerator"),c=cc._decorator,u=c.ccclass,h=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frames=["crack000","crack001","crack002","crack003"],e}return a(e,t),e.prototype.init=function(e,i,o,a){t.prototype.init.call(this,e,i,o,a),this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite)},e.prototype.setFrames=function(t){this.frames=t},e.prototype.open=function(){var e=this;if(t.prototype.open.call(this)){s.default.play(s.default.SCARABCRAWL);for(var i=cc.tween(this.sprite),o=function(t){i.then(cc.tween(a.sprite).delay(.2).call(function(){e.sprite.spriteFrame=r.default.spriteFrameRes(t)}))},a=this,n=0,l=this.frames;n<l.length;n++)o(l[n]);i.call(function(){e.showMonster()}).start()}return!0},e.prototype.addMonster=function(){return t.prototype.addMonster.call(this)&&(s.default.play(s.default.SCARABCRAWL),this.showMonster()),!0},n([u],e)}(l.default));i.default=h,cc._RF.pop()},{"../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer","./MonsterGenerator":"MonsterGenerator"}],MgWentLine:[function(t,e,i){"use strict";cc._RF.push(e,"657e7MsMqdJ2by+hThG3E0k","MgWentLine");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../utils/AudioPlayer"),s=t("./MonsterGenerator"),l=cc._decorator,c=l.ccclass,u=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.init=function(e,i,o,a){t.prototype.init.call(this,e,i,o,a),this.node.getChildByName("sprite").getChildByName("door").opacity=this.data.isOpen?0:255},e.prototype.open=function(){return t.prototype.open.call(this)&&(this.anim.play("WentLineOpen"),r.default.play(r.default.WENTLINE_OPEN)),!0},e.prototype.ShowFinish=function(){this.showMonster()},e.prototype.addMonster=function(){return t.prototype.addMonster.call(this)&&(this.anim.play("WentLineShow"),r.default.play(r.default.WENTLINE_SHOW)),!0},n([c],e)}(s.default));i.default=u,cc._RF.pop()},{"../utils/AudioPlayer":"AudioPlayer","./MonsterGenerator":"MonsterGenerator"}],MiniMap:[function(t,e,i){"use strict";cc._RF.push(e,"b8f7e0qah9Ot5qnGbL59sxK","MiniMap");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=t("../logic/Logic"),l=t("./MiniTile"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.miniTile=null,e.cover=null,e.layer=null,e.dialog=null,e.closeButton=null,e.width=0,e.height=0,e.tileSize=0,e.startPos=cc.v3(0,0),e.touchPos=cc.v2(0,0),e.isAniming=!1,e.isDrag=!1,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.closeButton.active=!1,cc.director.on(r.EventHelper.CHANGE_MINIMAP,function(e){t.node&&t.changeMap(e.detail.x,e.detail.y)}),r.EventHelper.on(r.EventHelper.OPEN_MINIMAP,function(){t.node&&t.openMap()}),this.cover.on(cc.Node.EventType.TOUCH_END,function(){t.openMap()}),this.layer.on(cc.Node.EventType.TOUCH_START,function(e){t.touchPos=e.getLocation(),t.startPos=t.layer.position.clone(),t.isDrag=!0}),this.layer.on(cc.Node.EventType.TOUCH_MOVE,function(e){var i=e.getLocation().sub(t.touchPos).mul(.5);t.layer.setPosition(t.startPos.x+i.x,t.startPos.y+i.y)}),this.layer.on(cc.Node.EventType.TOUCH_END,function(){t.isDrag=!1}),this.layer.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.isDrag=!1}),this.width=s.default.mapManager.rectDungeon.map.length,this.height=s.default.mapManager.rectDungeon.map[0].length;var e=cc.v3(s.default.mapManager.getCurrentRoom().x,s.default.mapManager.getCurrentRoom().y);this.map=new Array,this.layer.removeAllChildren(),this.layer.width=100*this.width,this.layer.height=100*this.height;for(var i=0;i<this.width;i++){this.map[i]=new Array;for(var o=0;o<this.height;o++){var a=cc.instantiate(this.miniTile);a.group="ui",this.tileSize=a.width,this.map[i][o]=a.getComponent(l.default),this.layer.addChild(this.map[i][o].node),this.map[i][o].init(i,o,!0,i==e.x&&o==e.y),this.map[i][o].isCurrentRoom&&(this.currentBoTile=this.map[i][o])}}},e.prototype.changeMap=function(t,e){this.currentBoTile&&this.currentBoTile.updateMap(t,e)},e.prototype.openMap=function(){var t=this;this.isAniming||(this.isAniming=!0,this.dialog.position.equals(cc.Vec3.ZERO)?(this.closeButton.active=!0,cc.tween(this.dialog).to(.3,{position:cc.v3(550,-40),width:600,height:300,scale:2}).call(function(){t.cover.active=!1,t.isAniming=!1}).start()):(this.closeButton.active=!1,this.cover.active=!0,cc.tween(this.dialog).to(.3,{position:cc.v3(0,0),width:300,height:300,scale:.5}).call(function(){t.isAniming=!1}).start()))},e.prototype.update=function(t){!this.isDrag&&this.currentBoTile&&(this.layer.position=s.default.lerpPos(this.layer.position,cc.v3(-this.currentBoTile.node.position.x,-this.currentBoTile.node.position.y),1*t))},e.ColorLevel={EMPTY:-1,HIDE:0,NORMAL:1,PLAYER:2,CLEAR:3,NORMAL_BOSS:4,CLEAR_PUZZLE:5,CLEAR_END:6,CLEAR_BOSS:7,NORMAL_LOOT:8,CLEAR_LOOT:9,NORMAL_START:10,NORMAL_END:11,NORMAL_REST:12,NORMAL_PREPARE:13,NORMAL_TEST:14,NORMAL_PUZZLE:15,NORMAL_MERCHANT:16,CLEAR_MERCHANT:17},n([h(cc.Prefab)],e.prototype,"miniTile",void 0),n([h(cc.Node)],e.prototype,"cover",void 0),n([h(cc.Node)],e.prototype,"layer",void 0),n([h(cc.Node)],e.prototype,"dialog",void 0),n([h(cc.Node)],e.prototype,"closeButton",void 0),n([u],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","./MiniTile":"MiniTile"}],MiniTile:[function(t,e,i){"use strict";cc._RF.push(e,"fc6deLOAaROjpYY/VRsNTJL","MiniTile");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../manager/BuildingManager"),l=t("../rect/RectRoom"),c=t("../rect/RoomType"),u=t("./MiniMap"),h=cc._decorator,d=h.ccclass,p=h.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.deathSign=null,e.sign=null,e.bg=null,e.needDetails=!1,e.isCurrentRoom=!1,e}return a(e,t),e.prototype.onLoad=function(){this.graphics=this.getComponent(cc.Graphics)},e.prototype.start=function(){},e.prototype.init=function(t,e,i,o){this.isCurrentRoom=o,this.x=t,this.y=e,this.needDetails=i,this.graphics=this.getComponent(cc.Graphics),this.initMap()},e.prototype.isFirstEqual=function(t,e){return t[0]==e},e.prototype.isThe=function(t,e){return-1!=t.indexOf(e)},e.prototype.initMap=function(){var t=r.default.worldLoader.getCurrentLevelData(),e=r.default.groundOilGoldData.clone();if(this.map=t.getRoomMap(this.x,this.y),this.x<0||this.y<0||this.x>r.default.mapManager.rectDungeon.map.length-1||this.y>r.default.mapManager.rectDungeon.map[0].length-1)this.node.opacity=0;else{var i=r.default.mapManager.rectDungeon.map[this.x][this.y];if(i){this.node.opacity=255;var o=i.state,a=i.roomType;t.minimap[this.x][this.y],e.chapter==r.default.chapterIndex&&e.level==r.default.level&&e.x==i.x&&e.y==i.y&&e.value>0&&!this.isCurrentRoom?this.deathSign.node.active=!0:this.deathSign.node.active=!1,this.bg.color=this.getColor(u.default.ColorLevel.HIDE),this.bg.color=this.getColor(u.default.ColorLevel.NORMAL),this.bg.opacity=255;var n=o==l.default.STATE_CLEAR;this.bg.color=this.getColor(n?u.default.ColorLevel.CLEAR:u.default.ColorLevel.NORMAL),this.getMapColor(a,c.default.EMPTY_ROOM,n,u.default.ColorLevel.EMPTY,u.default.ColorLevel.EMPTY),this.getMapColor(a,c.default.BOSS_ROOM,n,u.default.ColorLevel.NORMAL_BOSS,u.default.ColorLevel.CLEAR_BOSS),this.getMapColor(a,c.default.LOOT_ROOM,n,u.default.ColorLevel.NORMAL_LOOT,u.default.ColorLevel.CLEAR_LOOT),this.getMapColor(a,c.default.MERCHANT_ROOM,n,u.default.ColorLevel.NORMAL_MERCHANT,u.default.ColorLevel.CLEAR_MERCHANT),this.getMapColor(a,c.default.START_ROOM,n,u.default.ColorLevel.NORMAL_START,u.default.ColorLevel.NORMAL_START),this.getMapColor(a,c.default.END_ROOM,n,u.default.ColorLevel.NORMAL_END,u.default.ColorLevel.CLEAR_END),this.getMapColor(a,c.default.ELITE_ROOM,n,u.default.ColorLevel.NORMAL_PUZZLE,u.default.ColorLevel.CLEAR_PUZZLE),this.getMapColor(a,c.default.REST_ROOM,n,u.default.ColorLevel.NORMAL_REST,u.default.ColorLevel.NORMAL_REST),this.getMapColor(a,c.default.PREPARE_ROOM,n,u.default.ColorLevel.NORMAL_PREPARE,u.default.ColorLevel.NORMAL_PREPARE),this.getMapColor(a,c.default.TEST_ROOM,n,u.default.ColorLevel.NORMAL_TEST,u.default.ColorLevel.NORMAL_TEST),a==c.default.START_ROOM&&(this.bg.color=this.getColor(u.default.ColorLevel.NORMAL_START)),this.isCurrentRoom&&(this.bg.color=this.getColor(u.default.ColorLevel.PLAYER)),i.isFound&&this.drawMap(-1,-1)}else this.node.opacity=0}},e.prototype.drawMap=function(t,e){if(this.needDetails){var i=r.default.worldLoader.getCurrentLevelData();if(!(this.map.length<1))for(var o=this.node.width/i.roomWidth,a=this.map.length,n=this.map[0].length,l=0;l<n;l++)for(var c=0;c<a;c++){var u=this.map[c][l],h=!1;if(this.graphics.fillColor=cc.color(33,33,33,200),this.isFirstEqual(u,"#"))this.graphics.fillColor=cc.color(119,136,153,200),(this.isThe(u,"#00")||this.isThe(u,"#00")||this.isThe(u,"#00")||this.isThe(u,"#00"))&&(h=!0);else if(this.isFirstEqual(u,"*"))this.graphics.fillColor=cc.color(33,33,33,200);else if(this.isFirstEqual(u,"~"))this.graphics.fillColor=cc.color(0,128,128,200);else if("@S"==u)this.graphics.fillColor=cc.color(60,179,113,200);else if(this.isFirstEqual(u,"D")){var d=s.default.getDoorDir(u),p=d>7&&d<12;this.graphics.fillColor=cc.color(240,248,255,200),p&&(this.graphics.fillColor=cc.color(255,69,0,200)),d>15&&(this.graphics.fillColor=cc.color(33,33,33,200))}else this.isFirstEqual(u,"E")?this.graphics.fillColor=cc.color(0,255,0,200):this.isFirstEqual(u,"P")?this.graphics.fillColor=cc.color(32,178,170,200):this.isFirstEqual(u,"z")&&(this.sign.spriteFrame=r.default.spriteFrameRes("minimapboss"));this.isFirstEqual(u,"-")||(h?(this.graphics.moveTo(c*o-this.node.width/2,l*o-this.node.width/2),this.graphics.lineTo(c*o-this.node.width/2+o,l*o-this.node.width/2),this.graphics.lineTo(c*o-this.node.width/2+o/2,l*o-this.node.width/2+o),this.graphics.close(),this.graphics.fill()):this.graphics.fillRect(c*o-this.node.width/2,l*o-this.node.width/2,o,o)),this.isCurrentRoom&&(this.graphics.strokeColor=cc.color(0,255,0,200),this.graphics.lineWidth=2,this.graphics.rect(t*o-this.node.width/2,e*o-this.node.width/2,o,o),this.graphics.stroke())}}},e.prototype.updateMap=function(t,e){this.graphics.clear(),this.drawMap(t,e)},e.prototype.getMapColor=function(t,e,i,o,a){t.isEqual(e)&&(this.node.color=this.getColor(i?a:o))},e.prototype.getColor=function(t){var e=new cc.Color(0,0,0);switch(t){case u.default.ColorLevel.EMPTY:case u.default.ColorLevel.HIDE:e=new cc.Color(0,0,0);break;case u.default.ColorLevel.NORMAL:e=new cc.Color(128,128,128);break;case u.default.ColorLevel.CLEAR:e=new cc.Color(255,255,255);break;case u.default.ColorLevel.PLAYER:e=new cc.Color(0,255,0);break;case u.default.ColorLevel.NORMAL_START:e=new cc.Color(144,238,144);break;case u.default.ColorLevel.NORMAL_END:e=new cc.Color(100,149,237);break;case u.default.ColorLevel.NORMAL_BOSS:e=new cc.Color(128,0,128);break;case u.default.ColorLevel.NORMAL_LOOT:case u.default.ColorLevel.NORMAL_MERCHANT:e=new cc.Color(255,215,0);break;case u.default.ColorLevel.NORMAL_REST:e=new cc.Color(139,69,19);break;case u.default.ColorLevel.NORMAL_PREPARE:e=new cc.Color(255,165,0);break;case u.default.ColorLevel.NORMAL_TEST:e=new cc.Color(238,130,238);break;case u.default.ColorLevel.NORMAL_PUZZLE:e=new cc.Color(128,0,128);break;case u.default.ColorLevel.CLEAR_LOOT:case u.default.ColorLevel.CLEAR_MERCHANT:e=new cc.Color(240,230,140);break;case u.default.ColorLevel.CLEAR_BOSS:e=new cc.Color(75,0,130);break;case u.default.ColorLevel.CLEAR_END:e=new cc.Color(176,196,222);break;case u.default.ColorLevel.CLEAR_PUZZLE:e=new cc.Color(75,0,130)}return e},e.prototype.getMixColor=function(t,e){var i=t.clone(),o=e.clone(),a=cc.color(),n=i.getR()+o.getR(),r=i.getG()+o.getG(),s=i.getB()+o.getB();return a.setR(n>255?255:n),a.setG(r>255?255:r),a.setB(s>255?255:s),a},n([p(cc.Sprite)],e.prototype,"deathSign",void 0),n([p(cc.Sprite)],e.prototype,"sign",void 0),n([p(cc.Node)],e.prototype,"bg",void 0),n([d],e)}(cc.Component);i.default=f,cc._RF.pop()},{"../logic/Logic":"Logic","../manager/BuildingManager":"BuildingManager","../rect/RectRoom":"RectRoom","../rect/RoomType":"RoomType","./MiniMap":"MiniMap"}],MonsterGenerator:[function(t,e,i){"use strict";cc._RF.push(e,"b0bbeYGzEhP+4L1gNiAPnRb","MonsterGenerator");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../collider/CCollider"),s=t("../logic/Dungeon"),l=t("../logic/Logic"),c=t("../utils/IndexZ"),u=t("./Building"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canAdd=!1,e.addFinish=!1,e.count=0,e.addDelay=2,e.checkTimeDelay=0,e}return a(e,t),e.prototype.init=function(t,e,i,o){this.dungeon=t,this.data.generatorCount=i,this.data.generatorInterval=e,this.data.generatorList=o,this.node.zIndex=c.default.getActorZIndex(this.entity.Transform.position.clone().add(cc.v3(0,120)));var a=l.default.mapManager.getCurrentRoom().isReborn,n=l.default.mapManager.getCurrentMapBuilding(this.data.defaultPos);n?(this.data.isOpen=n.isOpen,a&&(this.data.isOpen=!1)):l.default.mapManager.setCurrentBuildingData(this.data.clone()),this.anim=this.getComponent(cc.Animation),this.addFinish=this.data.isOpen},e.prototype.isTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>this.data.generatorInterval&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){l.default.isGamePause||this.isTimeDelay(t)&&this.addMonster()},e.prototype.addMonster=function(){return this.count>=this.data.generatorCount?(this.addFinish=!0,!1):!!this.canAdd},e.prototype.showMonster=function(){var t=s.default.getIndexInMap(this.entity.Transform.position.clone());this.dungeon.monsterManager.addMonsterFromData(this.data.generatorList[l.default.getRandomNum(0,this.data.generatorList.length-1)],t,this.dungeon,!0),this.count++},e.prototype.open=function(){var t=this;if(this.data.isOpen)return!1;this.data.isOpen=!0,this.scheduleOnce(function(){t.canAdd=!0},this.addDelay);var e=l.default.mapManager.getCurrentMapBuilding(this.data.defaultPos);return e?e.isOpen=this.data.isOpen:l.default.mapManager.setCurrentBuildingData(this.data.clone()),!0},e.prototype.onColliderEnter=function(t){this.data.isOpen||t.tag!=r.default.TAG.PLAYER_INTERACT||this.open()},n([d],e)}(u.default));i.default=p,cc._RF.pop()},{"../collider/CCollider":"CCollider","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../utils/IndexZ":"IndexZ","./Building":"Building"}],MonsterManager:[function(t,e,i){"use strict";cc._RF.push(e,"441f6g4iH9M574s+sdv3n8E","MonsterManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/NonPlayer"),s=t("../logic/Dungeon"),l=t("../logic/Logic"),c=t("../rect/RoomType"),u=t("../boss/Boss"),h=t("./BaseManager"),d=t("../ui/GameHud"),p=t("./MonsterRandomAttr"),f=t("../utils/Random4Save"),g=t("../data/NonPlayerData"),y=t("./LoadingManager"),m=cc._decorator,v=m.ccclass,E=m.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.monster=null,e.kraken=null,e.captain=null,e.slime=null,e.warmachine=null,e.rah=null,e.iceDemon=null,e.evilEye=null,e.dryad=null,e.sphinx=null,e.dragon=null,e.maxHealth00=200,e.maxHealth01=400,e.maxHealth02=600,e.maxHealth03=800,e.maxHealth04=1e3,e.maxHealth05=1200,e.maxHealth06=1400,e.maxHealth07=1600,e.maxHealth08=1800,e.maxHealth09=2e3,e.monsters=new Array,e.bosses=new Array,e.isRoomInitWithEnemy=!1,e.loadingManager=new y.default,e.seed=0,e.monsterRandomAttr=new p.default,e}var i;return a(e,t),i=e,Object.defineProperty(e.prototype,"monsterList",{get:function(){return this.monsters},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bossList",{get:function(){return this.bosses},enumerable:!1,configurable:!0}),e.prototype.clear=function(){for(var t=0,e=this.monsters;t<e.length;t++){var i=e[t];i&&i.isValid&&i.destroyEntityNode()}for(var o=0,a=this.bosses;o<a.length;o++){var n=a[o];n&&n.isValid&&n.destroyEntityNode()}this.monsters=new Array,this.bosses=new Array},e.prototype.addMonsterFromData=function(t,e,i,o){var a=this;this.getMonster(t,i,o,function(t){if((t=a.addMonster(t,e,null)).data.childCount>0&&t.data.childResName.length>0)for(var n=0;n<t.data.childCount;n++)a.getMonster(t.data.childResName,i,o,function(i){t.childNonPlayerList.push(a.addMonster(i,e,t))})})},e.prototype.addMonstersAndBossFromMap=function(t,e,o){if(s.default.isFirstEqual(e,"M")){var a=parseInt(e[1]);if(isNaN(a))"a"==e[1]?this.addMonsterFromData(i.MONSTER_DUMMY,o,t,!1):"b"==e[1]?this.addMonsterFromData(i.MONSTER_CHEST,o,t,!1):"c"==e[1]&&this.addMonsterFromData(i.MONSTER_MICE,o,t,!1);else{var n=new Array;switch(l.default.chapterIndex){case l.default.CHAPTER00:n=i.MONSTERS_LAB;break;case l.default.CHAPTER01:n=i.MONSTERS_SHIP;break;case l.default.CHAPTER02:n=i.MONSTERS_FOREST;break;case l.default.CHAPTER03:n=i.MONSTERS_PYRAMID;break;case l.default.CHAPTER04:case l.default.CHAPTER05:n=i.MONSTERS_DUNGEON;break;case l.default.CHAPTER099:n=i.MONSTERS_LAB}this.addMonsterFromData(n[a],o,t,!1)}}else"z0"==e?this.addBoss(this.iceDemon,"iconboss000",this.maxHealth00,0,2,o,t):"z1"==e?this.addBoss(this.warmachine,"iconboss001",this.maxHealth01,2,3.5,o,t):"z2"==e?this.addBoss(this.captain,"iconboss002",this.maxHealth02,2,0,o,t):"z3"==e?(t.shakeForKraken(),this.addBoss(this.kraken,"iconboss003",this.maxHealth03,2,3.5,o,t)):"z4"==e?this.addBossSlime(0,o,t):"z5"==e?this.addBoss(this.dryad,"iconboss005",this.maxHealth05,2,2,o,t):"z6"==e?this.addBoss(this.rah,"iconboss006",this.maxHealth06,2,2,o,t):"z7"==e?this.addBoss(this.sphinx,"iconboss007",this.maxHealth07,2,2,o,t):"z8"==e?this.addBoss(this.evilEye,"iconboss008",this.maxHealth08,2,2,o,t):"z9"==e&&this.addBoss(this.dragon,"iconboss009",this.maxHealth09,5,2,o,t)},e.prototype.getRandomMonsterSeed=function(){return l.default.mapManager.getCurrentRoom().seed+this.seed++},e.prototype.getMonster=function(t,e,i,o){var a=this;y.default.loadNpcSpriteAtlas(t,function(){var n=null;(n=cc.instantiate(a.monster)).active=!1,n.parent=e.node;var s=n.getComponent(r.default),u=new g.default;s.seed=a.getRandomMonsterSeed(),s.killPlayerCount=l.default.getKillPlayerCount(s.seed);var h=l.default.mapManager.getRandom4Save(s.seed);s.dungeon=e,u.valueCopy(l.default.monsters[t]);var d=l.default.mapManager.getCurrentRoom().reborn;u.reborn=d||0,s.isSummon=i,h.rand()<.1+s.killPlayerCount/10&&(a.monsterRandomAttr.addRandomAttrs(2,h),u=a.monsterRandomAttr.updateMonsterData(u),s.attrmap=a.monsterRandomAttr.attrmap);var p=5+2*s.killPlayerCount,f=0;l.default.mapManager.getCurrentRoomType().isEqual(c.default.DANGER_ROOM)&&(f=10),l.default.mapManager.getCurrentRoomType().isEqual(c.default.INSANE_ROOM)&&(f=30),p=p+2*l.default.chapterIndex+2*l.default.level+f,s.isVariation=h.getRandomNum(0,100)<p&&u.isTest<1,s.isVariation&&(u.Common.maxHealth=2*u.Common.maxHealth,u.Common.maxDream=2*u.Common.maxDream,u.Common.damageMin=2*u.Common.damageMin,u.currentHealth=u.Common.maxHealth,u.melee>0&&(u.melee=u.melee>1?u.melee-1:1),u.remote>0&&(u.remote=u.remote>1?u.remote-1:1),u.dash>0&&(u.dash=u.dash>1?u.dash-1:1),u.Common.moveSpeed=u.Common.moveSpeed>0?u.Common.moveSpeed+50+10*s.killPlayerCount:0),u.Common.maxDream+=.25*u.Common.maxDream*s.killPlayerCount,u.Common.damageMin+=.25*u.Common.damageMin*s.killPlayerCount,u.Common.maxHealth+=.25*u.Common.maxHealth*s.killPlayerCount,u.Common.attackSpeed+=10*s.killPlayerCount,u.Common.defence+=s.killPlayerCount,u.currentHealth=u.Common.maxHealth,u.melee-s.killPlayerCount>1&&(u.melee-=s.killPlayerCount),u.remote-s.killPlayerCount>1&&(u.remote-=s.killPlayerCount),u.dash-s.killPlayerCount>1&&(u.dash-=s.killPlayerCount);var y=h.getRandomNum(0,100),m=h.getRandomNum(80,100),v=h.getRandomNum(80,100),E=y<=5+3*s.killPlayerCount;if(y=h.getRandomNum(0,4),E)switch(u.Common.magicDamage+=1,u.Common.magicDefence=u.Common.magicDefence+m>100?100:u.Common.magicDefence+m,y){case 0:u.Common.iceRate=u.Common.iceRate+v>100?100:u.Common.iceRate+v,u.bodyColor="#CCFFFF";break;case 1:u.Common.fireRate=u.Common.fireRate+v>100?100:u.Common.fireRate+v,u.bodyColor="#FF6633";break;case 2:u.Common.lighteningRate=u.Common.lighteningRate+v>100?100:u.Common.lighteningRate+v,u.bodyColor="#0099FF";break;case 3:u.Common.toxicRate=u.Common.toxicRate+v>100?100:u.Common.toxicRate+v,u.bodyColor="#66CC00";break;case 4:u.Common.curseRate=u.Common.curseRate+v>100?100:u.Common.curseRate+v,u.bodyColor="#660099"}u.isEnemy=1,s.data=u,s.sc.isDisguising=u.disguise>0,s.sc.isDisguising?s.changeBodyRes(u.resName,r.default.RES_DISGUISE):s.changeBodyRes(t,r.default.RES_IDLE000),s.addAttrIcon(),o(s)})},e.prototype.addMonster=function(t,e,i){return t.node.active=!0,t.pos=e,t.defautPos=e,t.updatePlayerPos(),t.parentNonPlayer=i,this.isRoomInitWithEnemy=t.data.isTest<1,this.monsterList.push(t),t},e.prototype.addBossSlime=function(t,e,i){this.bosses&&(this.isRoomInitWithEnemy=!0,this.bosses.push(this.getSlime(i,e.clone(),t)))},e.prototype.addBoss=function(t,e,i,o,a,n,r){var s=cc.instantiate(t);s.active=!1,s.parent=r.node;var l=s.getComponent(u.default);l.initCollider(),l.dungeon=r;var c=new g.default;c.resName=e,c.updateHA(i,i,o),l.data=c,l.transportBoss(n.x,n.y),l.healthBar=this.node.parent.getComponentInChildren(d.default).bossHealthBar,l.node.active=!0,this.bosses.push(l),this.isRoomInitWithEnemy=!0,this.scheduleOnce(function(){l.showBoss()},a)},e.prototype.getSlime=function(t,e,i){var o=null;(o=cc.instantiate(this.slime)).active=!1,o.parent=t.node;var a=o.getComponent(u.default);a.initCollider(),a.dungeon=t;var n=new g.default;switch(n.resName="iconboss004",n.Common.moveSpeed=200,i){case 0:n.updateHA(this.maxHealth04,this.maxHealth04,9);break;case 1:n.updateHA(200,200,7);break;case 2:n.updateHA(100,100,7);break;case 3:n.updateHA(50,50,5);break;case 4:n.updateHA(25,25,3);break;case 5:n.updateHA(10,10,2);break;default:n.updateHA(5,5,1)}return a.data=n,a.init(i),a.transportBoss(e.x,e.y),a.healthBar=this.node.parent.getComponentInChildren(d.default).bossHealthBar,a.node.active=!0,this.bosses.push(a),a},e.prototype.addRandomMonsters=function(t){var e=new Array,o=new f.default(l.default.mapManager.getCurrentRoom().seed),a=o.getRandomNum(1,3),n=0;switch(l.default.mapManager.getCurrentRoomType().isEqual(c.default.DANGER_ROOM)&&(n=2),l.default.mapManager.getCurrentRoomType().isEqual(c.default.INSANE_ROOM)&&(n=5),l.default.chapterIndex){case l.default.CHAPTER00:e=i.MONSTERS_LAB,a=o.getRandomNum(3,6);break;case l.default.CHAPTER01:e=i.MONSTERS_SHIP,a=o.getRandomNum(3,7);break;case l.default.CHAPTER02:e=i.MONSTERS_FOREST,a=o.getRandomNum(4,8);break;case l.default.CHAPTER03:e=i.MONSTERS_PYRAMID,a=o.getRandomNum(4,9);break;case l.default.CHAPTER04:e=i.MONSTERS_DUNGEON,a=o.getRandomNum(5,10);break;case l.default.CHAPTER05:e=i.MONSTERS_DUNGEON,a=o.getRandomNum(5,11);break;case l.default.CHAPTER099:e=i.MONSTERS_LAB,a=o.getRandomNum(1,3)}(l.default.mapManager.getCurrentRoomType().isEqual(c.default.VERTICAL_ROOM)||l.default.mapManager.getCurrentRoomType().isEqual(c.default.HORIZONTAL_ROOM))&&(a=Math.floor(a/2));for(var r=[],s=[],u=0;u<t.floorIndexMap.length;u++)r.push(t.floorIndexMap[u]);for(var h=0,d=t.buildingManager.waterIndexList;h<d.length;h++){var p=d[h];s.push(p)}if(l.default.worldLoader.getCurrentLevelData().isWater){for(u=0;u<=a+n;u++)if(!(s.length<1)){var g=s[y=o.getRandomNum(0,s.length-1)];s.splice(y,1),this.addMonsterFromData(i.MONSTER_FISH,cc.v3(g.x,g.y),t,!1)}}else for(u=0;u<=a+n;u++)if(!(r.length<1)){var y;g=r[y=o.getRandomNum(0,r.length-1)],r.splice(y,1),this.addMonsterFromData(e[o.getRandomNum(0,e.length-1)],cc.v3(g.x,g.y),t,!1)}},e.prototype.updateLogic=function(t){for(var e=this.monsters.length-1;e>=0;e--){var i=this.monsters[e];i&&i.node?i.node.active&&i.updateLogic(t):this.monsters.splice(e,1)}for(e=this.bosses.length-1;e>=0;e--){var o=this.bosses[e];o&&o.node?o.node.active&&o.updateLogic(t):this.bosses.splice(e,1)}},e.BOSS_KRAKEN="BOSS_KRAKEN",e.MONSTER_SLIME="monster000",e.MONSTER_GOBLIN="monster001",e.MONSTER_MUMMY="monster002",e.MONSTER_ANUBIS="monster003",e.MONSTER_PIRATE="monster004",e.MONSTER_SAILOR="monster005",e.MONSTER_OCTOPUS="monster006",e.MONSTER_KILLER="monster007",e.MONSTER_STRONGSAILOR="monster008",e.MONSTER_CHEST="monster009",e.MONSTER_GARGOYLE="monster010",e.MONSTER_CHICKEN="monster011",e.MONSTER_SCARAB="monster012",e.MONSTER_GOBLIN_ARCHER="monster013",e.MONSTER_TERRORDRONE="monster014",e.MONSTER_WEREWOLF="monster015",e.MONSTER_DUMMY="monster016",e.MONSTER_ZEBRA="monster017",e.MONSTER_GIRAFFE="monster018",e.MONSTER_ZOOMBIE="monster019",e.MONSTER_ELECTRICEYE="monster020",e.MONSTER_FISHMAN="monster021",e.MONSTER_CROCODILE="monster022",e.MONSTER_SNAKE="monster023",e.MONSTER_DEMON="monster024",e.MONSTER_WARLOCK="monster025",e.MONSTER_SPIDER="monster026",e.MONSTER_BOOMER="monster027",e.MONSTER_SANDSTATUE="monster028",e.MONSTER_HIPPO="monster029",e.MONSTER_CYCLOPS="monster030",e.MONSTER_ICEDEMON="monster031",e.MONSTER_BITE_ZOMBIE="monster032",e.MONSTER_BANANA="monster033",e.MONSTER_HOLO_DEVICE="monster034",e.MONSTER_HOLO="monster035",e.MONSTER_LASRERDRONE="monster036",e.MONSTER_GHOST="monster037",e.MONSTER_FISH="monster038",e.MONSTER_MICE="monster039",e.MONSTERS_LAB=[i.MONSTER_ZEBRA,i.MONSTER_TERRORDRONE,i.MONSTER_KILLER,i.MONSTER_ZOOMBIE,i.MONSTER_ELECTRICEYE,i.MONSTER_GIRAFFE,i.MONSTER_ICEDEMON,i.MONSTER_BITE_ZOMBIE,i.MONSTER_HOLO_DEVICE,i.MONSTER_LASRERDRONE],e.MONSTERS_SHIP=[i.MONSTER_PIRATE,i.MONSTER_SAILOR,i.MONSTER_OCTOPUS,i.MONSTER_STRONGSAILOR,i.MONSTER_FISHMAN,i.MONSTER_BOOMER,i.MONSTER_GHOST],e.MONSTERS_FOREST=[i.MONSTER_SLIME,i.MONSTER_GOBLIN,i.MONSTER_GOBLIN_ARCHER,i.MONSTER_WEREWOLF,i.MONSTER_SNAKE,i.MONSTER_CHICKEN,i.MONSTER_HIPPO,i.MONSTER_BANANA],e.MONSTERS_PYRAMID=[i.MONSTER_MUMMY,i.MONSTER_ANUBIS,i.MONSTER_SCARAB,i.MONSTER_CROCODILE,i.MONSTER_SANDSTATUE],e.MONSTERS_DUNGEON=[i.MONSTER_GARGOYLE,i.MONSTER_WARLOCK,i.MONSTER_DEMON,i.MONSTER_CYCLOPS,i.MONSTER_SPIDER,i.MONSTER_CYCLOPS],e.MONSTERS_SPECIAL=[i.MONSTER_DUMMY,i.MONSTER_CHEST,i.MONSTER_FISH,i.MONSTER_MICE],n([E(cc.Prefab)],e.prototype,"monster",void 0),n([E(cc.Prefab)],e.prototype,"kraken",void 0),n([E(cc.Prefab)],e.prototype,"captain",void 0),n([E(cc.Prefab)],e.prototype,"slime",void 0),n([E(cc.Prefab)],e.prototype,"warmachine",void 0),n([E(cc.Prefab)],e.prototype,"rah",void 0),n([E(cc.Prefab)],e.prototype,"iceDemon",void 0),n([E(cc.Prefab)],e.prototype,"evilEye",void 0),n([E(cc.Prefab)],e.prototype,"dryad",void 0),n([E(cc.Prefab)],e.prototype,"sphinx",void 0),n([E(cc.Prefab)],e.prototype,"dragon",void 0),i=n([v],e)}(h.default);i.default=_,cc._RF.pop()},{"../boss/Boss":"Boss","../data/NonPlayerData":"NonPlayerData","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../logic/NonPlayer":"NonPlayer","../rect/RoomType":"RoomType","../ui/GameHud":"GameHud","../utils/Random4Save":"Random4Save","./BaseManager":"BaseManager","./LoadingManager":"LoadingManager","./MonsterRandomAttr":"MonsterRandomAttr"}],MonsterRandomAttr:[function(t,e,i){"use strict";cc._RF.push(e,"9949f1Fu8NGLLz3ZQCj49YJ","MonsterRandomAttr"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.attrmap={},this.attrmap={}}return t.prototype.hasAttr=function(t){return this.attrmap[t]&&this.attrmap[t]>0},t.prototype.addAttr=function(t){var e=t>9?""+t:"0"+t;this.attrmap["attr_"+e]=1},t.prototype.removeAttr=function(t){var e=t>9?""+t:"0"+t;this.attrmap["attr_"+e]=0},t.prototype.addRandomAttrs=function(t,e){this.attrmap={};for(var i=0;i<t;i++)this.addAttr(e.getRandomNum(1,23))},t.prototype.updateMonsterData=function(e){return e.isTest>0?e:(this.hasAttr(t.ATTR_01)&&(e.Common.maxHealth=1,e.currentHealth=1,e.Common.defence+=50),this.hasAttr(t.ATTR_02)&&(e.Common.damageMin+=10),this.hasAttr(t.ATTR_03)&&(e.Common.maxHealth+=50,e.currentHealth+=50),this.hasAttr(t.ATTR_04)&&(e.Common.damageMin=1),this.hasAttr(t.ATTR_05)&&(e.Common.moveSpeed-=100,e.Common.moveSpeed<0&&(e.Common.moveSpeed=50)),this.hasAttr(t.ATTR_06)&&(e.Common.moveSpeed+=100),this.hasAttr(t.ATTR_07)&&e.melee>0&&(e.melee+=2),this.hasAttr(t.ATTR_08)&&e.melee>0&&(e.melee=1),this.hasAttr(t.ATTR_09)&&e.remote>0&&e.isLineAim<=0&&e.isArcAim<=0&&(e.remote=1),this.hasAttr(t.ATTR_10)&&e.remote>0&&(e.remote+=2),this.hasAttr(t.ATTR_11)&&e.remote>0&&(e.bulletLineExNum+=1),this.hasAttr(t.ATTR_12)&&e.remote>0&&(e.bulletExSpeed=-100),this.hasAttr(t.ATTR_13)&&e.remote>0&&(e.bulletExSpeed=100),this.hasAttr(t.ATTR_14)&&(e.Common.dodge+=50,e.Common.dodge>60&&(e.Common.dodge=60)),this.hasAttr(t.ATTR_15)&&(e.Common.damageBack=15),this.hasAttr(t.ATTR_16)&&(e.blink>0?e.blink=2:e.blink=5),this.hasAttr(t.ATTR_17)&&(e.Common.magicDamage+=1,e.Common.iceRate=100),this.hasAttr(t.ATTR_18)&&(e.Common.magicDamage+=1,e.Common.fireRate=100),this.hasAttr(t.ATTR_19)&&(e.Common.magicDamage+=1,e.Common.lighteningRate=100),this.hasAttr(t.ATTR_20)&&(e.Common.magicDamage+=1,e.Common.toxicRate=100),this.hasAttr(t.ATTR_21)&&(e.Common.magicDamage+=1,e.Common.curseRate=100),this.hasAttr(t.ATTR_22)&&(e.Common.realDamage+=1,e.Common.realRate=100),this.hasAttr(t.ATTR_23)&&(e.isBoom=1),e)},t.ATTR_01="attr_01",t.ATTR_02="attr_02",t.ATTR_03="attr_03",t.ATTR_04="attr_04",t.ATTR_05="attr_05",t.ATTR_06="attr_06",t.ATTR_07="attr_07",t.ATTR_08="attr_08",t.ATTR_09="attr_09",t.ATTR_10="attr_10",t.ATTR_11="attr_11",t.ATTR_12="attr_12",t.ATTR_13="attr_13",t.ATTR_14="attr_14",t.ATTR_15="attr_15",t.ATTR_16="attr_16",t.ATTR_17="attr_17",t.ATTR_18="attr_18",t.ATTR_19="attr_19",t.ATTR_20="attr_20",t.ATTR_21="attr_21",t.ATTR_22="attr_22",t.ATTR_23="attr_23",t}();i.default=o,cc._RF.pop()},{}],MoveComponent:[function(t,e,i){"use strict";cc._RF.push(e,"e49028tZFJAEpXgxWdi6l8e","MoveComponent");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0}),i.MoveComponent=void 0;var r=t("../ECS"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.linearVelocity=cc.Vec2.ZERO,e.linearDamping=0,e}return a(e,t),e.prototype.reset=function(){this.linearVelocity=cc.Vec2.ZERO,this.linearDamping=0},n([r.ecs.register("Move")],e)}(r.ecs.IComponent);i.MoveComponent=s,cc._RF.pop()},{"../ECS":"ECS"}],MoveSystem:[function(t,e,i){"use strict";cc._RF.push(e,"0fa7ditzD9HI61HkRcz3YwC","MoveSystem");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("../component/MoveComponent"),r=t("../component/TransformComponent"),s=t("../ECS"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.filter=function(){return s.ecs.allOf(n.MoveComponent,r.TransformComponent)},e.prototype.update=function(t){for(var e=0,i=t;e<i.length;e++){var o=i[e],a=o.Move,n=o.Transform;a.linearDamping<0&&(a.linearDamping=0);var r=a.linearVelocity.mul(this.dt);n.position.x+=r.x,n.position.y+=r.y,a.linearVelocity.x>0?(a.linearVelocity.x-=a.linearDamping,a.linearVelocity.x<0&&(a.linearVelocity.x=0)):a.linearVelocity.x<0&&(a.linearVelocity.x+=a.linearDamping,a.linearVelocity.x>0&&(a.linearVelocity.x=0)),a.linearVelocity.y>0?(a.linearVelocity.y-=a.linearDamping,a.linearVelocity.y<0&&(a.linearVelocity.y=0)):a.linearVelocity.y<0&&(a.linearVelocity.y+=a.linearDamping,a.linearVelocity.y>0&&(a.linearVelocity.y=0)),o.NodeRender.node&&o.NodeRender.node.setPosition(n.position)}},e.prototype.lerpPos=function(t,e,i){var o=cc.v2(0,0),a=t.x,n=t.y;return o.x=a+(e.x-a)*i,o.y=n+(e.y-n)*i,o},e.prototype.lerp=function(t,e,i){return t+(e-t)*i},e}(s.ecs.ComblockSystem);i.default=l,cc._RF.pop()},{"../ECS":"ECS","../component/MoveComponent":"MoveComponent","../component/TransformComponent":"TransformComponent"}],MushRoomChild:[function(t,e,i){"use strict";cc._RF.push(e,"1cc30/RGadFmqTqY/1+mFMR","MushRoomChild");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../collider/CCollider"),l=t("../base/BaseColliderComponent"),c=cc._decorator,u=c.ccclass,h=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isRotate=!1,e.isPlus=!1,e}return a(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this)},e.prototype.onColliderEnter=function(t){if(t.tag==s.default.TAG.PLAYER){this.isRotate=!0;var e=t.node.convertToWorldSpaceAR(cc.Vec3.ZERO),i=this.node.convertToWorldSpaceAR(cc.Vec3.ZERO);this.isPlus=e.x>i.x}},e.prototype.onColliderExit=function(t){t.tag==s.default.TAG.PLAYER&&(this.isRotate=!1)},e.prototype.update=function(t){this.isRotate?this.node.angle=r.default.lerp(this.node.angle,this.isPlus?15:-15,5*t):this.node.angle=r.default.lerp(this.node.angle,0,5*t)},n([u],e)}(l.default));i.default=h,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../collider/CCollider":"CCollider","../logic/Logic":"Logic"}],NextStep:[function(t,e,i){"use strict";cc._RF.push(e,"017cbligblAvaHFuvAAHvD9","NextStep");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=cc._decorator,r=(n.ccclass,n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isExcuting=!1,e.storePoint=1,e.storePointMax=1,e.duration=0,e.isLooping=!1,e.excuteRest=!1,e.lastTime=0,e.intervalTime=.1,e}return a(e,t),e.prototype.init=function(t,e,i,o,a,n,r){this.secondCallback=n,this.storePointMax=e||1,this.duration=o&&o>0?o:0,this.intervalTime=r&&r>0?r:this.intervalTime,this.storePointMax<1&&(this.storePointMax=1),this.storePoint=i||0==i?i:1,this.storePoint<=0&&(this.storePoint=0),this.storePoint>this.storePointMax&&(this.storePoint=this.storePointMax),t?this.storePoint=0:this.startLoop(a)},e.prototype.startLoop=function(t){var e=this;if(!this.isLooping){if(this.unscheduleAllCallbacks(),this.isLooping=!0,this.lastTime=t||0==t?t:Date.now(),this.storePointMax==this.storePoint)return this._refreshCoolDown(),void(this.secondCallback&&this.secondCallback(this.lastTime));var i=this.duration<this.intervalTime?this.duration:this.intervalTime;this.schedule(function(){Date.now()-e.lastTime>1e3*e.duration&&(e.excuteRest&&(e.isExcuting=!1),e._refreshCoolDown()),e.secondCallback&&e.secondCallback(e.lastTime)},i,cc.macro.REPEAT_FOREVER,i)}},e.prototype.next=function(t,e,i,o,a){this.secondCallback=o,this.excuteRest=i,this.duration=e,this.intervalTime=a&&a>0?a:this.intervalTime,0!=this.storePoint?(this.storePoint--,this.storePoint<=0&&(this.storePoint=0),this.startLoop(),t&&t()):this.startLoop()},e.prototype.cutCoolDown=function(t){return t&&this.isLooping&&(this.lastTime+=1e3*t),this.lastTime},e.prototype.refreshCoolDown=function(t){return this._refreshCoolDown(),this.cutCoolDown(t)},e.prototype._refreshCoolDown=function(){this.storePoint++,this.storePoint>=this.storePointMax?(this.lastTime=0,this.storePoint=this.storePointMax,this.isLooping=!1,this.unscheduleAllCallbacks()):this.lastTime=Date.now()},Object.defineProperty(e.prototype,"IsInCooling",{get:function(){return this.storePoint<this.StorePointMax},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsExcuting",{get:function(){return this.isExcuting},set:function(t){this.isExcuting=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"StorePoint",{get:function(){return this.storePoint},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"LastTime",{get:function(){return this.lastTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"StorePointMax",{get:function(){return this.storePointMax},enumerable:!1,configurable:!0}),e}(cc.Component));i.default=r,cc._RF.pop()},{}],NodeKey:[function(t,e,i){"use strict";cc._RF.push(e,"61554+RantE/Yzl2Ewb7DHo","NodeKey"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=(o.ccclass,o.property,function(t,e){this.key=t,this.node=e});i.default=a,cc._RF.pop()},{}],NodeRenderComponent:[function(t,e,i){"use strict";cc._RF.push(e,"7caa6sbwkpE5IS2EfvinvA9","NodeRenderComponent");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0}),i.NodeRenderComponent=void 0;var r=t("../ECS"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.reset=function(){this.node=null},n([r.ecs.register("NodeRender")],e)}(r.ecs.IComponent);i.NodeRenderComponent=s,cc._RF.pop()},{"../ECS":"ECS"}],NonPlayerActorState:[function(t,e,i){"use strict";cc._RF.push(e,"9492bjmskVBUqR8oiksJoFq","NonPlayerActorState");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.GLOBAL=i.FALL=i.BLINK=i.DIZZ=i.DODGE=i.DASH=i.DISGUISE=i.BLOCK=i.TALK=i.HURT=i.DIED=i.SHOW=i.PRPARE=i.ATTACK=i.WALK=i.IDLE=void 0;var n=t("../base/BaseNonPlayerActorState"),r=t("../utils/Utils"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(IDLE):enter"),e.enterIdle()},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isDashing?e.stateMachine.changeState(S.DASH):e.sc.isBlinking?e.stateMachine.changeState(S.BLINK):e.sc.isDodging?e.stateMachine.changeState(S.DODGE):e.sc.isAttacking?e.stateMachine.changeState(S.ATTACK):e.sc.isTalking?e.stateMachine.changeState(S.TALK):e.sc.isMoving&&e.stateMachine.changeState(S.WALK)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(IDLE):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(IDLE):event"),!0},e}(n.default);i.IDLE=s;var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),e.enterWalk(),r.default.log(""+e.actorName()+e.node.uuid+"(WALK):enter")},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isMoving?e.sc.isAttacking?e.stateMachine.changeState(S.ATTACK):e.sc.isDodging?e.stateMachine.changeState(S.DODGE):e.sc.isBlinking&&e.stateMachine.changeState(S.BLINK):e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(WALK):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(WALK):event"),!0},e}(n.default);i.WALK=l;var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(ATTACK):enter")},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isAttacking||e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(ATTACK):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(ATTACK):event"),!0},e}(n.default);i.ATTACK=c;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(PRPARE):enter")},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isDisguising?e.stateMachine.changeState(S.DISGUISE):e.stateMachine.changeState(S.SHOW)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(PRPARE):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(PRPARE):event"),!0},e}(n.default);i.PRPARE=u;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(SHOW):enter"),e.enterShow()},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isShow&&e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(SHOW):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(SHOW):event"),!0},e}(n.default);i.SHOW=h;var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(DIE):enter"),e.killed()},e.prototype.update=function(e){t.prototype.update.call(this,e)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(DIE):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(DIE):event"),!0},e}(n.default);i.DIED=d;var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(HURT):enter")},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isHurting?e.sc.isFalling?e.stateMachine.changeState(S.FALL):e.sc.isBlinking&&e.stateMachine.changeState(S.BLINK):e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(HURT):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(TAKEDAMAGE):event"),!0},e}(n.default);i.HURT=p;var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(TALK):enter")},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isTalking||e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(TALK):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(TALK):event"),!0},e}(n.default);i.TALK=f;var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(BLOCK):enter")},e.prototype.update=function(e){t.prototype.update.call(this,e)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(BLOCK):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(BLOCK):event"),!0},e}(n.default);i.BLOCK=g;var y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(DISGUISE):enter"),e.enterDisguise()},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isDisguising||e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(DISGUISE):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(DISGUISE):event"),!0},e}(n.default);i.DISGUISE=y;var m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(DASH):enter")},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isDashing||e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(DASH):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(DASH):event"),!0},e}(n.default);i.DASH=m;var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(DODGE):enter")},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isDodging||e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(DODGE):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(DODGE):event"),!0},e}(n.default);i.DODGE=v;var E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(DIZZ):enter"),e.enterDizz()},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isDizzing||e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(DIZZ):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(DIZZ):event"),!0},e}(n.default);i.DIZZ=E;var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(BLINK):enter"),e.enterBlink()},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isBlinking||e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(BLINK):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(BLINK):event"),!0},e}(n.default);i.BLINK=_;var T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(FALL):enter")},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isFalling||e.stateMachine.changeState(S.IDLE)},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(FALL):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(FALL):event"),!0},e}(n.default);i.FALL=T;var D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.enter=function(e){t.prototype.enter.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(GLOBAL):enter")},e.prototype.update=function(e){t.prototype.update.call(this,e),e.sc.isDied||(e.data.currentHealth<=0?e.stateMachine.changeState(S.DIED):!S.HURT.isRunnig&&e.sc.isHurting&&e.stateMachine.changeState(S.HURT))},e.prototype.exit=function(e){t.prototype.exit.call(this,e),r.default.log(""+e.actorName()+e.node.uuid+"(GLOBAL):exit")},e.prototype.event=function(e,i){return t.prototype.event.call(this,e,i),r.default.log(""+e.actorName()+e.node.uuid+"(GLOBAL):event"),!0},e}(n.default);i.GLOBAL=D;var S=function(){function t(){}return t.GLOBAL=new D,t.WALK=new l,t.ATTACK=new c,t.IDLE=new s,t.DISGUISE=new y,t.DIED=new d,t.DODGE=new v,t.HURT=new p,t.PRPARE=new u,t.SHOW=new h,t.BLINK=new _,t.FALL=new T,t.TALK=new f,t.DASH=new m,t}();i.default=S,cc._RF.pop()},{"../base/BaseNonPlayerActorState":"BaseNonPlayerActorState","../utils/Utils":"Utils"}],NonPlayerData:[function(t,e,i){"use strict";cc._RF.push(e,"e5e26RTCAFA6KSlJtwFy/GC","NonPlayerData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./DamageData"),a=t("./StatusData"),n=t("./CommonData"),r=function(){function t(){this.nameCn="",this.nameEn="",this.resName="",this.chapter=0,this.stageLevel=0,this.invisible=0,this.remote=0,this.melee=0,this.dash=0,this.disguise=0,this.scale=0,this.bulletType="",this.bulletArcExNum=0,this.bulletLineExNum=0,this.bulletLineInterval=0,this.bulletExSpeed=0,this.specialBulletArcExNum=0,this.specialBulletLineExNum=0,this.specialRemoteAngle=0,this.isArcAim=0,this.isLineAim=0,this.blink=0,this.isBoom=0,this.isHeavy=0,this.isStatic=0,this.isRecovery=0,this.shooterOffsetX=0,this.shooterOffsetY=0,this.specialAttack=0,this.specialType="",this.specialDistance=0,this.specialDelay=0,this.specialDash=0,this.bodyColor="#ffffff",this.pos=cc.v3(0,0),this.currentHealth=0,this.boxType=0,this.attackType=0,this.isEnemy=0,this.isFollow=0,this.lifeTime=0,this.isTest=0,this.reborn=0,this.attackFrames=2,this.specialFrames=2,this.attackFrameKeyStart=1,this.specialFrameKeyStart=1,this.attackFrameKeyEnd=2,this.specialFrameKeyEnd=2,this.remoteAudio="",this.specialAudio="",this.isPet=0,this.childResName="",this.childMode=0,this.childCount=0,this.flee=0,this.noLoot=0,this.water=0,this.statusTotalData=new a.default,this.common=new n.default,this.statusList=new Array}return Object.defineProperty(t.prototype,"StatusTotalData",{get:function(){return this.statusTotalData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Common",{get:function(){return this.common},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"FinalCommon",{get:function(){return(new n.default).add(this.common).add(this.statusTotalData.Common)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"StatusList",{get:function(){return this.statusList},set:function(t){if(t){this.statusList=new Array;for(var e=0,i=t;e<i.length;e++){var o=i[e],n=new a.default;n.valueCopy(o),this.statusList.push(n)}}},enumerable:!1,configurable:!0}),t.prototype.updateHA=function(t,e,i){this.currentHealth=t,this.common.maxHealth=e,this.common.damageMin=i},t.prototype.valueCopy=function(t){t&&(this.common.valueCopy(t.common),this.StatusList=t.statusList,this.nameCn=t.nameCn,this.nameEn=t.nameEn,this.resName=t.resName,this.chapter=t.chapter,this.stageLevel=t.stageLevel,this.currentHealth=t.currentHealth?t.currentHealth:0,this.invisible=t.invisible?t.invisible:0,this.remote=t.remote?t.remote:0,this.melee=t.melee?t.melee:0,this.dash=t.dash?t.dash:0,this.pos=t.pos?cc.v3(t.pos.x,t.pos.y):cc.v3(0,0),this.disguise=t.disguise?t.disguise:0,this.scale=t.scale?t.scale:0,this.bulletType=t.bulletType,this.bulletArcExNum=t.bulletArcExNum?t.bulletArcExNum:0,this.bulletLineExNum=t.bulletLineExNum?t.bulletLineExNum:0,this.bulletLineInterval=t.bulletLineInterval?t.bulletLineInterval:0,this.isArcAim=t.isArcAim?t.isArcAim:0,this.isLineAim=t.isLineAim?t.isLineAim:0,this.blink=t.blink?t.blink:0,this.isBoom=t.isBoom?t.isBoom:0,this.bulletExSpeed=t.bulletExSpeed?t.bulletExSpeed:0,this.isHeavy=t.isHeavy?t.isHeavy:0,this.isStatic=t.isStatic?t.isStatic:0,this.shooterOffsetX=t.shooterOffsetX?t.shooterOffsetX:0,this.shooterOffsetY=t.shooterOffsetY?t.shooterOffsetY:0,this.specialAttack=t.specialAttack?t.specialAttack:0,this.specialType=t.specialType?t.specialType:"",this.specialDistance=t.specialDistance?t.specialDistance:0,this.specialBulletArcExNum=t.specialBulletArcExNum?t.specialBulletArcExNum:0,this.specialBulletLineExNum=t.specialBulletLineExNum?t.specialBulletLineExNum:0,this.specialDelay=t.specialDelay?t.specialDelay:0,this.specialDash=t.specialDash?t.specialDash:0,this.boxType=t.boxType?t.boxType:0,this.attackType=t.attackType?t.attackType:0,this.isRecovery=t.isRecovery?t.isRecovery:0,this.isEnemy=t.isEnemy?t.isEnemy:0,this.isFollow=t.isFollow?t.isFollow:0,this.lifeTime=t.lifeTime?t.lifeTime:0,this.isTest=t.isTest?t.isTest:0,this.reborn=t.reborn?t.reborn:0,this.attackFrames=t.attackFrames?t.attackFrames:2,this.specialFrames=t.specialFrames?t.specialFrames:2,this.attackFrameKeyStart=t.attackFrameKeyStart?t.attackFrameKeyStart:1,this.specialFrameKeyStart=t.specialFrameKeyStart?t.specialFrameKeyStart:1,this.attackFrameKeyEnd=t.attackFrameKeyEnd?t.attackFrameKeyEnd:2,this.specialFrameKeyEnd=t.specialFrameKeyEnd?t.specialFrameKeyEnd:2,this.bodyColor=t.bodyColor?t.bodyColor:"#ffffff",this.remoteAudio=t.remoteAudio?t.remoteAudio:"",this.specialAudio=t.specialAudio?t.specialAudio:"",this.isPet=t.isPet?t.isPet:0,this.childResName=t.childResName?t.childResName:"",this.childMode=t.childMode?t.childMode:0,this.childCount=t.childCount?t.childCount:0,this.flee=t.flee?t.flee:0,this.noLoot=t.noLoot?t.noLoot:0,this.water=t.water?t.water:0,this.specialRemoteAngle=t.specialRemoteAngle?t.specialRemoteAngle:0)},t.prototype.clone=function(){var e=new t;return e.common=this.common.clone(),e.nameCn=this.nameCn,e.nameEn=this.nameEn,e.resName=this.resName,e.chapter=this.chapter,e.stageLevel=this.stageLevel,e.currentHealth=this.currentHealth,e.invisible=this.invisible,e.remote=this.remote,e.melee=this.melee,e.dash=this.dash,e.pos=this.pos,e.disguise=this.disguise,e.scale=this.scale,e.bulletType=this.bulletType,e.bulletArcExNum=this.bulletArcExNum,e.bulletLineExNum=this.bulletLineExNum,e.bulletLineInterval=this.bulletLineInterval,e.isArcAim=this.isArcAim,e.isLineAim=this.isLineAim,e.blink=this.blink,e.isBoom=this.isBoom,e.bulletExSpeed=this.bulletExSpeed,e.isHeavy=this.isHeavy,e.isStatic=this.isStatic,e.shooterOffsetX=this.shooterOffsetX,e.shooterOffsetY=this.shooterOffsetY,e.specialAttack=this.specialAttack,e.specialType=this.specialType,e.specialDistance=this.specialDistance,e.specialBulletArcExNum=this.specialBulletArcExNum,e.specialBulletLineExNum=this.specialBulletLineExNum,e.specialDelay=this.specialDelay,e.specialDash=this.specialDash,e.boxType=this.boxType,e.attackType=this.attackType,e.isRecovery=this.isRecovery,e.bodyColor=this.bodyColor,e.isEnemy=this.isEnemy,e.isFollow=this.isFollow,e.lifeTime=this.lifeTime,e.isTest=this.isTest,e.reborn=this.reborn,e.remoteAudio=this.remoteAudio,e.specialAudio=this.specialAudio,e.isPet=this.isPet,e.StatusList=this.statusList,e.childMode=this.childMode,e.childResName=this.childResName,e.childCount=this.childCount,e.flee=this.flee,e.noLoot=this.noLoot,e.water=this.water,e.specialFrameKeyStart=this.specialFrameKeyStart,e.attackFrameKeyStart=this.attackFrameKeyStart,e.specialFrameKeyEnd=this.specialFrameKeyEnd,e.attackFrameKeyEnd=this.attackFrameKeyEnd,e.attackFrames=this.attackFrames,e.specialFrames=this.specialFrames,e.specialRemoteAngle=this.specialRemoteAngle,e},t.prototype.getAttackPoint=function(){var t=this.FinalCommon,e=new o.default;return e.realDamage=t.realDamage,e.physicalDamage=t.damageMin,e.magicDamage=t.magicDamage,e.physicalDamage<0&&(e.physicalDamage=0),e},t.prototype.getDamage=function(t){var e=this.FinalCommon,i=t.clone(),o=e.defence,a=e.magicDefence;return i.physicalDamage=o>=0?i.physicalDamage*(1-.06*o/(.06*o+1)):i.physicalDamage*(2-Math.pow(.94,-o)),i.magicDamage=i.magicDamage*(1-a/100),i},t.prototype.getHealth=function(){var t=1,e=this.FinalCommon.maxHealth;return e>0?(t=this.currentHealth/e,cc.v3(e*t,e)):cc.v3(1,1)},t}();i.default=r,cc._RF.pop()},{"./CommonData":"CommonData","./DamageData":"DamageData","./StatusData":"StatusData"}],NonPlayerManager:[function(t,e,i){"use strict";cc._RF.push(e,"2a4f27Fn0RPWppWDoGhOHT3","NonPlayerManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Logic"),l=t("./BaseManager"),c=t("../utils/Utils"),u=t("../logic/NonPlayer"),h=t("../data/NonPlayerData"),d=t("../logic/Achievement"),p=t("./LoadingManager"),f=cc._decorator,g=f.ccclass,y=f.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadingManager=new p.default,e.nonplayer=null,e.nonplayers=new Array,e.timeDelay=0,e}var i;return a(e,t),i=e,Object.defineProperty(e.prototype,"nonPlayerList",{get:function(){return this.nonplayers},enumerable:!1,configurable:!0}),e.prototype.clear=function(){c.default.clearComponentArray(this.nonplayers)},e.prototype.addNonPlayerListFromSave=function(t,e,i){for(var o=this,a=0,n=e;a<n.length;a++){var r=n[a];(r.isPet||r.lifeTime>0)&&this.getNonPlayer(r,t,function(t){o.addNonPlayer(t,i)})}},e.prototype.addNonPlayerFromData=function(t,e,i){var o=this,a=new h.default;a.valueCopy(s.default.nonplayers[t]),d.default.addNpcsAchievement(a.resName),this.getNonPlayer(a,i,function(t){o.addNonPlayer(t,e)})},e.prototype.isPetAlive=function(){return!!(this.pet&&this.pet.isValid&&this.pet.node.active&&this.pet.data.currentHealth>0)},e.prototype.addPetFromData=function(t,e,i){for(var o=this,a=0,n=this.nonPlayerList;a<n.length;a++)n[a].data.isPet;this.isPetAlive()||(d.default.addNpcsAchievement(t.resName),this.getNonPlayer(t,i,function(t){o.addNonPlayer(t,e)}))},e.prototype.addNonPlayerFromMap=function(t,e,o){"N0"==e&&this.addNonPlayerFromData(i.NON_SHADOW,r.default.getPosInMap(o),t)},e.prototype.getNonPlayer=function(t,e,i){var o=this;p.default.loadNpcSpriteAtlas(t.resName,function(){var a=null;(a=cc.instantiate(o.nonplayer)).active=!1,a.parent=e.node;var n=a.getComponent(u.default),r=new h.default;n.dungeon=e,r.valueCopy(t),r.isEnemy=0,n.data=r,n.sc.isDisguising=r.disguise>0,n.sc.isDisguising?n.changeBodyRes(r.resName,u.default.RES_DISGUISE):n.changeBodyRes(r.resName,u.default.RES_IDLE000),i(n)})},e.prototype.addNonPlayer=function(t,e){t.node.active=!0,t.pos=r.default.getIndexInMap(e),t.entity.Transform.position=e,this.nonPlayerList.push(t),t.data.isPet>0&&(this.pet=t)},e.prototype.updateLogic=function(t){s.default.nonPlayerList=[];for(var e=this.nonplayers.length-1;e>=0;e--){var i=this.nonPlayerList[e];if(i&&i.node){if(i.node.active){i.updateLogic(t);var o=i.data.clone();i.leftLifeTime>0&&(o.lifeTime=i.leftLifeTime),o.currentHealth>0&&s.default.nonPlayerList.push(o)}}else this.nonplayers.splice(e,1)}},e.NON_SHADOW="nonplayer001",e.SHOP_KEEPER="nonplayer002",e.DOG="nonplayer100",e.CAT="nonplayer101",e.FISH="nonplayer102",n([y(cc.Prefab)],e.prototype,"nonplayer",void 0),i=n([g],e)}(l.default);i.default=m,cc._RF.pop()},{"../data/NonPlayerData":"NonPlayerData","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../logic/NonPlayer":"NonPlayer","../utils/Utils":"Utils","./BaseManager":"BaseManager","./LoadingManager":"LoadingManager"}],NonPlayer:[function(t,e,i){"use strict";cc._RF.push(e,"b7513vXKLpHGrSf+utaohLs","NonPlayer");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=r.property,c=t("./EventHelper"),u=t("./HealthBar"),h=t("./Logic"),d=t("./Dungeon"),p=t("./Shooter"),f=t("../manager/StatusManager"),g=t("../data/DamageData"),y=t("../manager/FloatingLabelManager"),m=t("../utils/Random"),v=t("../utils/NextStep"),E=t("../item/Item"),_=t("../base/Actor"),T=t("./Achievement"),D=t("../utils/AudioPlayer"),S=t("../manager/SpecialManager"),O=t("../data/FromData"),A=t("../utils/IndexZ"),C=t("../actor/AreaOfEffect"),R=t("../data/AreaOfEffectData"),L=t("../actor/ActorAttackBox"),b=t("../base/fsm/DefaultStateMachine"),P=t("../actor/NonPlayerActorState"),I=t("../data/NonPlayerData"),M=t("../utils/ActorUtils"),N=t("../collider/CCollider"),w=t("../actor/AreaDetector"),H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pos=cc.v3(0,0),e.defautPos=cc.v3(0,0),e.healthBar=null,e.statusManager=null,e.floatinglabelManager=null,e.specialManager=null,e.boom=null,e.dangerBox=null,e.dangerTips=null,e.attrPrefab=null,e.isFaceRight=!0,e.shooter=null,e.currentlinearVelocitySpeed=cc.Vec2.ZERO,e.isVariation=!1,e.isSummon=!1,e.killPlayerCount=0,e.moveStep=new v.default,e.remoteStep=new v.default,e.meleeStep=new v.default,e.specialStep=new v.default,e.dashStep=new v.default,e.blinkStep=new v.default,e.attrmap={},e.animStatus=i.ANIM_NONE,e.data=new I.default,e.leftLifeTime=0,e.childNonPlayerList=[],e.isLevelWater=!1,e.hurtReset=function(){e.node&&(e.hitLight(!1),e.resetBodyColor(),e.sc.isHurting&&(e.sc.isHurting=!1,e.anim.resume()))},e.stopMove=function(){e.sc.isMoving=!1},e.moveTimeDelay=0,e}var i;return a(e,t),i=e,Object.defineProperty(e.prototype,"IsVariation",{get:function(){return this.isVariation||this.data.StatusTotalData.variation>0},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.initCollider(),this.graphics=this.getComponent(cc.Graphics),this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite"),this.bodySprite=this.sprite.getChildByName("body").getComponent(cc.Sprite),this.mat=this.bodySprite.getComponent(cc.Sprite).getMaterial(0),this.boxCollider=this.getComponent(N.default),this.node.scale=this.getScaleSize(),this.dashlight=this.sprite.getChildByName("dashlight"),this.dashlight.opacity=0,this.shadow=this.sprite.getChildByName("shadow"),this.shooter=this.node.getChildByName("Shooter").getComponent(p.default),this.effectNode=this.node.getChildByName("Effect"),this.hitLightSprite=this.node.getChildByName("Effect").getChildByName("hitlight").getComponent(cc.Sprite),this.hitLightSprite.node.opacity=0,this.particleBlood=this.node.getChildByName("Effect").getChildByName("blood").getComponent(cc.ParticleSystem),this.particleBlood.stopSystem(),this.attrNode=this.node.getChildByName("attr"),this.areaDetector=this.getComponentInChildren(w.default),this.resetBodyColor(),this.isLevelWater=h.default.worldLoader.getCurrentLevelData().isWater,this.data.isStatic>0&&(this.entity.Collider.colliders[0].isStatic=!0),this.dangerBox.init(this,this.dungeon,this.data.isEnemy>0),this.dangerTips.opacity=0,this.specialStep.init(),this.stateMachine=new b.default(this,P.default.PRPARE,P.default.GLOBAL)},e.prototype.start=function(){var t=this;if(this.changeZIndex(),this.healthBar.refreshHealth(this.data.getHealth().x,this.data.getHealth().y),this.data.lifeTime>0){var e=new v.default;this.leftLifeTime=this.data.lifeTime,e.next(function(){},this.data.lifeTime,!0,function(){t.leftLifeTime--,t.leftLifeTime<=0&&t.data&&(t.data.currentHealth=0)},1)}this.addSaveStatusList(),this.entity.Move.linearDamping=5,this.entity.Move.linearVelocity=cc.v2(0,0)},e.prototype.hitLightS=function(t){var e=!0,i="hitlight1",o=8,a=[D.default.PUNCH,D.default.PUNCH1,D.default.PUNCH2],n=[D.default.SWORD_HIT,D.default.SWORD_HIT1,D.default.SWORD_HIT2];t.isFist?(i=h.default.getHalfChance()?"hitlight1":"hitlight2",D.default.play(a[h.default.getRandomNum(0,2)])):t.isRemote?i=h.default.getHalfChance()?"hitlight9":"hitlight10":t.isBlunt?(i=h.default.getHalfChance()?"hitlight3":"hitlight4",o=t.isFar?10:8,D.default.play(n[h.default.getRandomNum(0,2)])):t.isMelee?(D.default.play(n[h.default.getRandomNum(0,2)]),t.isStab?(i=h.default.getHalfChance()?"hitlight5":"hitlight6",o=t.isFar?10:8):(i=h.default.getHalfChance()?"hitlight7":"hitlight8",o=t.isFar?10:8)):e=!1,e&&(this.hitLightSprite.node.stopAllActions(),this.hitLightSprite.spriteFrame=h.default.spriteFrameRes(i),this.hitLightSprite.node.opacity=220,this.hitLightSprite.node.color=cc.Color.WHITE,this.hitLightSprite.node.scale=t.isCriticalStrike?o:o+3,cc.tween(this.hitLightSprite.node).delay(.2).to(.3,{opacity:0,color:cc.Color.BLACK}).to(.3,{opacity:0}).start())},e.prototype.addSaveStatusList=function(){this.statusManager&&this.statusManager.addStatusListFromSave(this.data.StatusList)},e.prototype.hitLight=function(t){this.mat||(this.mat=this.node.getChildByName("sprite").getChildByName("body").getComponent(cc.Sprite).getMaterial(0)),this.mat.setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT)},e.prototype.addAttrIcon=function(){for(var t in this.attrNode||(this.attrNode=this.node.getChildByName("attr")),this.attrNode.removeAllChildren(),this.attrmap){var e=cc.instantiate(this.attrPrefab);e.getComponent(cc.Sprite).spriteFrame=h.default.spriteFrameRes(t),this.attrNode.addChild(e)}},e.prototype.showDangerTips=function(){var t=this;this.dangerTips.opacity=255,this.scheduleOnce(function(){t.dangerTips.opacity=0},1)},e.prototype.getCurrentBodyRes=function(){return this.sprite||(this.sprite=this.node.getChildByName("sprite"),this.bodySprite=this.sprite.getChildByName("body").getComponent(cc.Sprite)),this.bodySprite.spriteFrame.name},e.prototype.changeBodyRes=function(t,e){this.sprite||(this.sprite=this.node.getChildByName("sprite"),this.bodySprite=this.sprite.getChildByName("body").getComponent(cc.Sprite)),this.boxCollider||(this.boxCollider=this.getComponent(N.default)),this.shadow||(this.shadow=this.sprite.getChildByName("shadow"));var i=this.getSpriteFrameByName(t,e);i?(this.bodySprite.spriteFrame=i,this.bodySprite.node.width=i.getOriginalSize().width,this.bodySprite.node.height=i.getOriginalSize().height,this.setInWaterMat(this.bodySprite,this.isLevelWater&&this.data.water<1)):this.bodySprite.spriteFrame=null;var o=48,a=80,n=80;switch(this.data.boxType){case 0:o=32,a=80,n=64;break;case 1:o=48,a=48,n=96;break;case 2:o=48,a=80,n=80;break;case 3:o=64,a=80,n=128;break;case 4:o=32,a=128,n=48;break;case 5:o=48,a=128,n=96;break;default:o=48,a=80,n=80}this.boxCollider.offset=cc.v2(0,o),this.boxCollider.w=a,this.boxCollider.h=n,this.boxCollider.tag=this.data.isEnemy>0?N.default.TAG.NONPLAYER:N.default.TAG.GOODNONPLAYER,this.data.blink>0&&(this.boxCollider.setIgnoreTags([N.default.TAG.WALL]),this.boxCollider.setIgnoreTags([N.default.TAG.WALL_TOP]),this.boxCollider.setIgnoreTags([N.default.TAG.BUILDING]),this.boxCollider.setIgnoreTags([N.default.TAG.WARTER])),this.data.boxType>2?this.shadow.scale=3:this.shadow.scale=2},e.prototype.getSpriteFrameByName=function(t,e){var i=h.default.spriteFrameRes(t+e);return i||(i=h.default.spriteFrameRes(t)),i},e.prototype.updatePlayerPos=function(){this.entity.Transform.position=d.default.getPosInMap(this.pos),this.node.position=this.entity.Transform.position.clone()},e.prototype.transportPlayer=function(t,e){this.sprite.angle=0,this.sprite.scale=1,this.sprite.opacity=255,this.sprite.x=0,this.sprite.y=0,this.pos.x=t,this.pos.y=e,this.changeZIndex(),this.updatePlayerPos()},e.prototype.changeZIndex=function(){this.node.zIndex=A.default.getActorZIndex(this.node.position)},e.prototype.showFloatFont=function(t,e,i,o,a,n){if(this.floatinglabelManager){var r=this.floatinglabelManager.getFloaingLabel(t);i?r.showDoge():o?r.showMiss():0!=e?r.showDamage(-e,a,n):r.hideLabel()}},e.prototype.remoteAttack=function(t,e){this.remoteStep.IsExcuting=!1;var i=this.shooter.node.position.clone();i.x=this.shooter.node.scaleX>0?i.x+30:-i.x-30;var o=t.getCenterPosition().sub(this.node.position.add(i));o.equals(cc.Vec3.ZERO)||(this.shooter.setHv(cc.v2(o).normalize()),this.shooter.from.valueCopy(O.default.getClone(this.data.nameCn,this.data.resName+"anim000",this.seed)),this.IsVariation&&(this.shooter.data.bulletSize=.5),this.shooter.dungeon=this.dungeon,this.shooter.data.remoteAudio=this.data.remoteAudio,this.shooter.isFromPlayer=this.data.isEnemy<1,this.shooter.data.bulletArcExNum=this.data.bulletArcExNum,this.shooter.data.bulletLineExNum=this.data.bulletLineExNum,this.shooter.data.bulletLineInterval=this.data.bulletLineInterval,e&&(this.shooter.data.bulletLineExNum=this.data.specialBulletLineExNum,this.shooter.data.bulletArcExNum=this.data.specialBulletArcExNum),this.shooter.data.isLineAim=this.data.isLineAim,this.shooter.data.bulletType=this.data.bulletType?this.data.bulletType:"bullet001",this.shooter.data.bulletExSpeed=this.data.bulletExSpeed,this.shooter.node.position=cc.v3(this.data.shooterOffsetX,this.data.shooterOffsetY),this.shooter.fireBullet(this.data.Common.remoteAngle))},e.prototype.showAttackAnim=function(t,e,o,a,n,r,s){var l=this,c=1-this.data.FinalCommon.attackSpeed/1e3;c<.5&&(c=.5),c>2&&(c=2);var u=cc.v2(a.node.position.clone().sub(this.node.position));this.anim.pause(),u.equals(cc.Vec2.ZERO)&&(u=cc.v2(1,0)),u=u.normalize().mul(this.node.scaleX>0?48:-48),this.node.scaleX<0&&(u.y=-u.y),this.sprite.stopAllActions();var h=0;this.data.attackType==L.default.ATTACK_STAB&&r&&(h=.8*c);for(var d=cc.tween().delay(.5*c).call(function(){t&&t(n)}),p=cc.tween().by(.1,{position:cc.v3(5,0)}).by(.1,{position:cc.v3(-5,0)}).by(.1,{position:cc.v3(5,0)}).by(.1,{position:cc.v3(-5,0)}).by(.1,{position:cc.v3(5,0)}).by(.1,{position:cc.v3(-5,0)}).by(.1,{position:cc.v3(5,0)}).by(.1,{position:cc.v3(-5,0)}),f=["anim009"],g=[],y=0,m=n?this.data.specialFrameKeyStart:this.data.attackFrameKeyStart,v=n?this.data.specialFrameKeyEnd:this.data.attackFrameKeyEnd;y<this.data.attackFrames-1;)f.push("anim0"+(10+y++));for(var E=0;E<this.data.specialFrames;E++)g.push("anim0"+(10+y++));var _=n?g:f,T=cc.tween().delay(0),A=function(t){T.then(cc.tween().delay(.2*c).call(function(){l.changeBodyRes(l.data.resName,_[t])}))};for(E=0;E<m;E++)A(E);var C=cc.tween().delay(0),R=function(t){C.then(cc.tween().delay(.2*c).call(function(){l.changeBodyRes(l.data.resName,_[t])}))};for(E=m;E<v;E++)R(E);var b=cc.tween().delay(0),P=function(t){b.then(cc.tween().delay(.2*c).call(function(){l.changeBodyRes(l.data.resName,_[t])}))};for(E=v;E<_.length;E++)P(E);var I=cc.tween().by(.5*c,{position:cc.v3(-u.x/8,-u.y/8)}).delay(h),M=cc.tween().by(.2*c,{position:cc.v3(u.x,u.y)}).delay(h),N=this.data.specialType.length<=0||this.data.specialType==S.default.AFTER_ASH,w=cc.tween().call(function(){(r&&!n||n&&r&&N)&&l.dangerBox.show(l.data.attackType,n,5==l.data.boxType,u),n&&(l.data.specialDash>0&&l.dangerBox.show(L.default.ATTACK_STAB,!1,!1,u),l.scheduleOnce(function(){l.sc.isDied||(l.specialManager.dungeon=l.dungeon,l.specialManager.addEffect(l.data.specialType,l.data.specialDistance,l.isFaceRight,O.default.getClone(l.data.nameCn,l.data.resName+"anim000",l.seed),l.IsVariation))},l.data.specialDelay))}),H=cc.tween().call(function(){l.dangerBox.hide(s),(r&&!n||n&&l.data.specialType.length<=0)&&l.data.attackType==L.default.ATTACK_STAB&&l.move(cc.v3(l.isFaceRight?l.dangerBox.hv.x:-l.dangerBox.hv.x,l.dangerBox.hv.y),n?600:300),n&&(l.data.specialDash>0&&l.move(cc.v3(l.isFaceRight?l.dangerBox.hv.x:-l.dangerBox.hv.x,l.dangerBox.hv.y),l.data.specialDash),l.scheduleOnce(function(){l.specialManager.dungeon=l.dungeon,l.specialManager.addPlacement(l.data.specialType,l.data.specialDistance,l.isFaceRight,O.default.getClone(l.data.nameCn,l.data.resName+"anim000",l.seed),l.IsVariation)},l.data.specialDelay)),e&&e(n)}),x=cc.tween().call(function(){l.dangerBox.finish()}),B=cc.tween().delay(.2*c).call(function(){l.dangerBox.finish(),l.changeBodyRes(l.data.resName,i.RES_IDLE000),l.setLinearVelocity(cc.Vec2.ZERO)}),F=cc.tween().to(.2*c,{position:cc.v3(0,0)}).delay(.2*c).call(function(){o&&o(n)}),k=cc.tween().then(w).then(T).then(I).parallel(H,C,M).parallel(x,b).then(B),j=cc.tween().then(w).then(T).parallel(H,C).parallel(x,b).then(B),G=cc.tween().then(w).then(T).then(I).then(p).parallel(H,C,M).parallel(x,b).then(B),U=cc.tween().then(w).parallel(p,T).parallel(H,C).parallel(x,b).then(B),W=cc.tween().then(d).then(r?k:j).then(F);n&&(this.showDangerTips(),D.default.play(this.data.specialAudio),W=cc.tween().then(d).then(U).then(F),r&&N&&(W=cc.tween().then(d).then(G).then(F))),cc.tween(this.sprite).then(W).start()},e.prototype.move=function(t,e){if(!t.equals(cc.Vec3.ZERO)){(t=t.normalizeSelf()).equals(cc.Vec3.ZERO)||(this.pos=d.default.getIndexInMap(this.node.position));var i=t.x,o=t.y,a=Math.abs(i),n=Math.abs(o),r=a>n?a:n;r=0==r?1:r;var s=cc.v2(i,o);e<0&&(e=0),s=s.mul(e),this.setLinearVelocity(s),this.changeZIndex()}},e.prototype.setLinearVelocity=function(t){this.currentlinearVelocitySpeed=t,this.entity.Move.linearVelocity=this.currentlinearVelocitySpeed.clone()},e.prototype.isPlayerBehindAttack=function(){var t=this.dungeon.player.node.position.x>this.node.position.x,e=this.node.scaleX>0;return t&&!e||!t&&e},e.prototype.isFaceTargetBehind=function(t){var e=t.node.position.x>this.node.position.x,i=t.isFaceRight;return e&&i||!e&&!i},e.prototype.fall=function(){D.default.play(D.default.BLEEDING),this.data.isStatic>0||this.data.isHeavy>0||this.IsVariation||(this.sc.isFalling=!0,this.bodySprite.node.angle=this.isPlayerBehindAttack()?-75:105,this.anim.play("MonsterFall"))},e.prototype.FallFinish=function(){this.sc.isFalling=!1,this.bodySprite.node.angle=0,this.sprite.y=0,this.sprite.x=0},e.prototype.takeDamage=function(t){if(!this.sc.isShow||this.sc.isDied)return!1;if(this.data.invisible>0&&this.sprite.opacity<100&&h.default.getRandomNum(1,10)>4)return this.showFloatFont(this.dungeon.node,0,!0,!1,t.isCriticalStrike,!1),!1;if(this.sc.isBlinking)return this.showFloatFont(this.dungeon.node,0,!0,!1,t.isCriticalStrike,!1),!1;var e=this.data.getDamage(t),o=this.data.FinalCommon.dodge/100,a=m.default.rand()<=o&&e.getTotalDamage()>0;if(e=a?new g.default:e,a)return this.showFloatFont(this.dungeon.node,0,!0,!1,t.isCriticalStrike,!1),!1;var n=e.getTotalDamage()>0;if(this.sc.isHurting=n&&!this.specialStep.IsExcuting&&t.isMelee,this.sc.isHurting&&(this.sc.isDisguising=!1,this.sc.isAttacking=!1,t.isCriticalStrike&&this.fall(),this.sprite.stopAllActions(),this.changeBodyRes(this.data.resName,h.default.getHalfChance()?i.RES_HIT001:i.RES_HIT002),this.anim.getAnimationState("MonsterIdle").isPlaying&&this.anim.pause(),this.dangerBox.finish()),n){var r=[D.default.MONSTER_HIT,D.default.MONSTER_HIT1,D.default.MONSTER_HIT2];D.default.play(r[h.default.getRandomNum(0,2)]),this.hitLight(!0),this.hitLightS(t),t.isBackAttack&&this.showBloodEffect(),this.unschedule(this.hurtReset),this.scheduleOnce(this.hurtReset,.15)}return this.sprite.opacity=255,this.data.currentHealth-=e.getTotalDamage(),this.data.currentHealth>this.data.getHealth().y&&(this.data.currentHealth=this.data.getHealth().y),this.healthBar.refreshHealth(this.data.currentHealth,this.data.getHealth().y),this.showFloatFont(this.dungeon.node,e.getTotalDamage(),!1,!1,t.isCriticalStrike,t.isBackAttack),this.data.isRecovery>0&&n&&this.addStatus(f.default.RECOVERY,new O.default),n},e.prototype.resetBodyColor=function(){this.data&&(this.bodySprite.node.color=cc.color(255,255,255).fromHEX(this.data.bodyColor))},e.prototype.getMixColor=function(t,e){var i=cc.color().fromHEX(t),o=cc.color().fromHEX(e),a=cc.color(),n=i.getR()+o.getR(),r=i.getG()+o.getG(),s=i.getB()+o.getB();return a.setR(n>255?255:n),a.setG(r>255?255:r),a.setB(s>255?255:s),"#"+a.toHEX("#rrggbb")},e.prototype.addStatus=function(t,e){this.node&&!this.sc.isDied&&this.statusManager.addStatus(t,e)},e.prototype.addCustomStatus=function(t,e){this.node&&!this.sc.isDied&&this.statusManager.addCustomStatus(t,e)},e.prototype.stopAllDebuffs=function(){this.node&&this.statusManager.stopAllDebuffs()},e.prototype.showAttackEffect=function(t){this.effectNode.setPosition(cc.v3(0,32)),t||cc.tween(this.effectNode).to(.2,{position:cc.v3(32,32)}).to(.2,{position:cc.v3(0,16)}).start()},e.prototype.showBloodEffect=function(){var t=this;D.default.play(D.default.BLEEDING),this.particleBlood.resetSystem(),this.scheduleOnce(function(){t.particleBlood.stopSystem()},.5)},e.prototype.addPlayerStatus=function(t,e){h.default.getRandomNum(0,100)<this.data.FinalCommon.iceRate&&t.addStatus(f.default.FROZEN,e),h.default.getRandomNum(0,100)<this.data.FinalCommon.fireRate&&t.addStatus(f.default.BURNING,e),h.default.getRandomNum(0,100)<this.data.FinalCommon.lighteningRate&&t.addStatus(f.default.DIZZ,e),h.default.getRandomNum(0,100)<this.data.FinalCommon.toxicRate&&t.addStatus(f.default.TOXICOSIS,e),h.default.getRandomNum(0,100)<this.data.FinalCommon.curseRate&&t.addStatus(f.default.CURSING,e),h.default.getRandomNum(0,100)<this.data.FinalCommon.realRate&&t.addStatus(f.default.BLEEDING,e)},e.prototype.killed=function(){var t=this;this.sc.isDied||(this.sc.isDied=!0,this.sc.isDisguising=!1,this.dashStep.IsExcuting=!1,this.sprite.stopAllActions(),this.dangerBox.finish(),this.bodySprite.node.angle=0,this.anim.play("MonsterDie"),this.changeBodyRes(this.data.resName,i.RES_HIT003),this.getComponent(N.default).sensor=!0,this.data.isEnemy>0&&this.data.noLoot<1&&this.getLoot(),T.default.addMonsterKillAchievement(this.data.resName),h.default.setKillPlayerCounts(O.default.getClone(this.actorName(),this.data.resName+"anim000",this.seed),!1),this.scheduleOnce(function(){if(t.node){if(t.setLinearVelocity(cc.Vec2.ZERO),t.data.isBoom>0){var e=cc.instantiate(t.boom).getComponent(C.default);e&&(e.show(t.node.parent,t.node.position,cc.v2(1,0),0,(new R.default).init(1,.2,0,0,A.default.OVERHEAD,t.data.isEnemy>0,!0,!0,!1,!1,new g.default(2),O.default.getClone("\u7206\u70b8","boom000anim004"),[])),D.default.play(D.default.BOOM),cc.director.emit(c.EventHelper.CAMERA_SHAKE,{detail:{isHeavyShaking:!0}}))}t.scheduleOnce(function(){t.destroyEntityNode()},t.data.isPet?0:5)}},2))},e.prototype.getLoot=function(){var t=h.default.mapManager.getRandom4Save(h.default.mapManager.getRebornSeed(this.seed)),e=t.rand(),i=.1,o=.75;this.IsVariation&&(o=.6,i=.3),i+=this.killPlayerCount/10,(o-=this.killPlayerCount/10)<.3&&(o=.3);var a=(1-o)/10,n=1+this.killPlayerCount/2;if((n=Math.floor(n))>4&&(n=4),this.dungeon){var r=1;this.IsVariation&&(r=2),this.killPlayerCount>0&&(r=5),this.dungeon.player.data.StatusTotalData.exOilGold>0&&(r+=this.dungeon.player.data.StatusTotalData.exOilGold),c.EventHelper.emit(c.EventHelper.DUNGEON_ADD_OILGOLD,{pos:this.node.position,count:r}),e<i&&!this.isSummon&&this.dungeon.addEquipment(h.default.getRandomEquipType(t),d.default.getPosInMap(this.pos),null,n),e<o?c.EventHelper.emit(c.EventHelper.DUNGEON_ADD_COIN,{pos:this.node.position,count:t.getRandomNum(1,10)}):e>=o&&e<o+a?this.addLootSaveItem(E.default.HEART,!0):e>=o+a&&e<o+2*a?this.addLootSaveItem(E.default.HEART,!0):e>=o+2*a&&e<o+3*a?this.addLootSaveItem(E.default.BOTTLE_ATTACK):e>=o+3*a&&e<o+4*a?this.addLootSaveItem(E.default.BOTTLE_MOVESPEED):e>=o+4*a&&e<o+5*a?this.addLootSaveItem(E.default.BOTTLE_HEALING):e>=o+5*a&&e<o+6*a?this.addLootSaveItem(E.default.BOTTLE_DREAM):e>=o+6*a&&e<o+7*a&&this.addLootSaveItem(E.default.BOTTLE_REMOTE)}},e.prototype.addLootSaveItem=function(t,e){!e&&this.isSummon||this.dungeon.addItem(this.node.position.clone(),t)},e.prototype.getCenterPosition=function(){return this.node.position.clone()},Object.defineProperty(e.prototype,"isPassive",{get:function(){return!this.dungeon||this.sc.isDied||this.sc.isHurting||this.sc.isFalling||this.sc.isAttacking||!this.sc.isShow||this.sc.isDizzing||this.sc.isDisguising||this.sc.isDodging||this.sc.isDashing},enumerable:!1,configurable:!0}),e.prototype.updateAttack=function(){var t=this;if(!this.isPassive){var e=M.default.getNearestEnemyActor(this.node.position,this.data.isEnemy>0,this.dungeon),i=M.default.getTargetDistance(this,e);if(M.default.isTargetAlive(e)){this.data.specialAttack>0&&this.specialStep.next(function(){t.specialStep.IsExcuting=!0},this.data.specialAttack,!0);var o=100;this.specialStep.IsExcuting&&this.data.specialType.length>0&&(o=200),this.data.attackType==L.default.ATTACK_STAB&&(o=300,this.specialStep.IsExcuting&&(o=600));var a=this.data.melee>0&&i<o*this.node.scaleY,n=this.data.remote>0&&i<600*this.node.scaleY;a&&!this.meleeStep.IsInCooling?this.meleeStep.next(function(){t.changeFaceRight(e),t.setLinearVelocity(cc.Vec2.ZERO),t.sc.isAttacking=!0,t.sprite.opacity=255,t.showAttackEffect(!1),cc.director.emit(c.EventHelper.PLAY_AUDIO,{detail:{name:D.default.MELEE}});var i=h.default.getRandomNum(0,100)<t.data.StatusTotalData.missRate;i&&t.showFloatFont(t.dungeon.node,0,!1,!0,!1,!1),t.showAttackAnim(function(){},function(){},function(){t.sc.isAttacking=!1,t.specialStep.IsExcuting=!1},e,t.specialStep.IsExcuting,!0,i)},this.data.melee):n&&this.remoteStep.next(function(){t.sc.isAttacking=!0,t.sprite.opacity=255,t.changeFaceRight(e);var i=h.default.bullets[t.data.bulletType]&&h.default.bullets[t.data.bulletType].isLaser>0;t.showAttackAnim(function(o){i&&o&&t.remoteAttack(e,o)},function(o){i&&o||t.remoteAttack(e,o)},function(){t.specialStep.IsExcuting=!1,i?t.scheduleOnce(function(){t.sc.isAttacking=!1},1):t.sc.isAttacking=!1},e,t.specialStep.IsExcuting,!1,!1)},this.data.remote,!0)}}},e.prototype.dodge=function(t){var e=this;if(!this.isPassive){this.sc.isDodging=!0;var i=this.data.FinalCommon.moveSpeed;this.move(t,2.5*i),this.scheduleOnce(function(){e.sc.isDodging=!1},.1)}},e.prototype.updateLogic=function(t){var e=this;if(this.dungeon){this.stateMachine.update(),this.entity.Transform.position=d.default.fixOuterMap(this.entity.Transform.position),this.pos=d.default.getIndexInMap(this.entity.Transform.position),this.changeZIndex(),this.updateAttack();var i=M.default.getNearestEnemyActor(this.entity.Transform.position,this.data.isEnemy>0,this.dungeon),o=M.default.getTargetDistance(this,i);this.data.disguise>0&&o<this.data.disguise&&this.sc.isDisguising&&(this.sc.isDisguising=!1),this.data.blink>0&&!this.sc.isBlinking&&this.blinkStep.next(function(){e.sc.isBlinking=!0},this.data.blink,!0);var a=this.data.FinalCommon.moveSpeed;this.data.dash>0&&!this.isPassive&&M.default.isTargetAlive(i)&&o<600&&o>100&&this.dashStep.next(function(){e.sc.isDashing=!0,e.dangerBox.show(L.default.ATTACK_DASH,!1,5==e.data.boxType,cc.v2(1,0)),e.dangerBox.hide(!1),e.enterWalk(),cc.director.emit(c.EventHelper.PLAY_AUDIO,{detail:{name:D.default.MELEE}}),e.showAttackEffect(!0),e.move(e.getMovePosFromTarget(i),a),e.scheduleOnce(function(){e.node&&(e.sc.isDashing=!1,e.dangerBox.finish())},2)},this.data.dash);var n=o<500&&this.data.melee>0;o<500&&o>300&&this.data.remote>0&&(n=!0),M.default.isTargetAlive(i)||(n=!1),!n&&this.data.isFollow>0&&this.data.isEnemy<1&&(i=this.dungeon.player,o=M.default.getTargetDistance(this,this.dungeon.player),n=!0),this.isPassive||(this.data.melee>0&&o<64||this.data.remote>0&&this.data.melee<=0&&o<300||this.shooter.isAiming?this.sc.isMoving=!1:n?(this.sc.isMoving=!0,this.moveStep.next(function(){var t=e.getMovePosFromTarget(i);e.data.flee>0&&(t=e.getMovePosFromTarget(i,!0),t=cc.v3(-t.x,-t.y)),e.move(t,.5*a)},.2,!0)):(this.moveStep.next(function(){e.move(e.getMovePosFromTarget(),a),e.sc.isMoving=!0,e.unschedule(e.stopMove),e.scheduleOnce(e.stopMove,2)},8,!0),this.entity.Move.linearVelocity.equals(cc.Vec2.ZERO)&&(this.sc.isMoving=!1,this.unschedule(this.stopMove)))),this.data.invisible>0&&this.sprite.opacity>20&&(this.sprite.opacity=this.lerp(this.sprite.opacity,19,3*t)),this.entity.Move.linearDamping=this.sc.isDashing?0:5,this.dashlight.opacity=this.sc.isDashing?128:0,this.healthBar.node.opacity=this.sc.isDisguising?0:255,this.shadow&&(this.shadow.opacity=this.sc.isDisguising||this.data.water>0||this.isLevelWater?0:128),this.sc.isDisguising&&this.anim&&this.anim.pause(),this.data.invisible>0&&(this.healthBar.node.opacity=this.sprite.opacity>20?255:9),this.healthBar.node.active=!this.sc.isDied;var r=this.getScaleSize();if(this.node.scaleX=this.isFaceRight?r:-r,this.node.scaleY=r,this.healthBar.node.scaleX=this.node.scaleX>0?1:-1,this.healthBar.node.x=-30*this.node.scaleX,this.healthBar.node.y=3==this.data.boxType||5==this.data.boxType?150:120,this.healthBar.progressBar.barSprite.node.color=this.IsVariation?cc.color(128,0,128):cc.color(194,0,0),this.healthBar.progressBar.barSprite.node.color=this.killPlayerCount>0?cc.color(255,215,0):this.healthBar.progressBar.barSprite.node.color,this.dashlight.color=this.IsVariation?cc.color(0,0,0):cc.color(255,255,255),this.attrNode&&(this.attrNode.opacity=this.healthBar.node.opacity),this.data.isTest>0&&this.isTestResetTimeDelay(t)&&!this.isPassive&&(this.pos=this.defautPos.clone(),this.updatePlayerPos()),this.parentNonPlayer&&this.parentNonPlayer.data)if(this.graphics.clear(),this.graphics.strokeColor=cc.color(0,255,0,128),this.graphics.lineWidth=5,0==this.parentNonPlayer.data.childMode&&this.parentNonPlayer.sc.isDied)this.data.currentHealth=0;else{this.graphics.moveTo(0,32);var s=cc.v3(this.parentNonPlayer.node.position.x-this.node.position.x,this.parentNonPlayer.node.position.y-this.node.position.y);this.graphics.lineTo(this.node.scaleX>0?s.x:-s.x,s.y+32),this.graphics.stroke()}if(1==this.data.childMode&&this.childNonPlayerList.length>0){for(var l=0,u=0,h=this.childNonPlayerList;u<h.length;u++)h[u].sc.isDied&&l++;l==this.childNonPlayerList.length&&(this.data.currentHealth=0)}}},e.prototype.setInWaterMat=function(t,e){if(t&&t.spriteFrame){t.spriteFrame.getOffset();var i=t.spriteFrame.getRect(),o=t.spriteFrame.getTexture();t.getMaterial(0).setProperty("rect",[i.x/o.width,i.y/o.height,i.width/o.width,i.height/o.height]),t.getMaterial(0).setProperty("hidebottom",e?1:0),t.getMaterial(0).setProperty("isRotated",t.spriteFrame.isRotated()?1:0)}},e.prototype.getMovePosFromTarget=function(t,e){var i=cc.v3(0,0);if(i.x+=h.default.getRandomNum(0,400)-200,i.y+=h.default.getRandomNum(0,400)-200,!M.default.isTargetAlive(t))return i;i=t.node.position.clone(),e&&(i=(i=i.y>this.node.position.y?i.addSelf(cc.v3(0,-128)):i.addSelf(cc.v3(0,128))).x>this.node.position.x?i.addSelf(cc.v3(-64,0)):i.addSelf(cc.v3(64,0)));var o=(i=i.x>this.node.position.x?i.addSelf(cc.v3(32,0)):i.addSelf(cc.v3(-32,0))).sub(this.node.position);return!this.sc.isAttacking&&!this.sc.isDisguising&&this.data.isStatic<1&&this.changeFaceRight(t),o},e.prototype.changeFaceRight=function(t){var e=t.node.position.clone(),i=(e=e.sub(this.node.position)).x;this.isFaceRight=i>=0},e.prototype.lerp=function(t,e,i){return t+(e-t)*i},e.prototype.onColliderEnter=function(t,e){e.tag==N.default.TAG.NONPLAYER||e.tag==N.default.TAG.GOODNONPLAYER?this.dungeon&&this.sc.isDashing&&!t.sensor&&(this.sc.isDashing=!1,this.dangerBox.finish()):e.tag==N.default.TAG.DEFAULT&&this.areaDetector.onColliderEnter(t,e)},e.prototype.onColliderStay=function(t,e){e.tag!=N.default.TAG.NONPLAYER_HIT&&e.tag!=N.default.TAG.GOODNONPLAYER_HIT||this.dangerBox.onColliderStay(t,e)},e.prototype.takeDizz=function(t){var e=this;t>0&&(this.sc.isDizzing=!0,this.scheduleOnce(function(){e.sc.isDizzing=!1},t))},e.prototype.getScaleSize=function(){var t=this.data.scale&&this.data.scale>0?this.data.scale:1;return this.IsVariation?i.SCALE_NUM*t:t},e.prototype.actorName=function(){return this.data.nameCn},e.prototype.enterShow=function(){var t=this;this.sprite.stopAllActions(),this.bodySprite.node.color=cc.Color.BLACK,cc.tween(this.bodySprite.node).to(1,{color:cc.color(255,255,255).fromHEX(this.data.bodyColor)}).call(function(){t.sc.isShow=!0}).start()},e.prototype.enterDisguise=function(){this.sc.isShow=!0,this.sprite.stopAllActions(),this.anim.getAnimationState("MonsterIdle").isPlaying&&this.anim.pause(),this.changeBodyRes(this.data.resName,i.RES_DISGUISE)},e.prototype.enterIdle=function(){var t=this;this.sc.isMoving=!1,this.setLinearVelocity(cc.Vec2.ZERO),this.entity.NodeRender.node=this.node;var e=cc.tween().delay(.2).call(function(){t.changeBodyRes(t.data.resName,i.RES_IDLE000)}).delay(.2).call(function(){t.changeBodyRes(t.data.resName,i.RES_IDLE001)});this.sprite.stopAllActions(),cc.tween(this.sprite).repeatForever(e).start(),this.anim.getAnimationState("MonsterIdle").isPlaying||this.anim.play("MonsterIdle"),this.dangerBox.finish()},e.prototype.enterWalk=function(){var t=this,e=cc.tween().delay(.2).call(function(){t.changeBodyRes(t.data.resName,i.RES_WALK00)}).delay(.2).call(function(){t.changeBodyRes(t.data.resName,i.RES_WALK01)}).delay(.2).call(function(){t.changeBodyRes(t.data.resName,i.RES_WALK02)}).delay(.2).call(function(){t.changeBodyRes(t.data.resName,i.RES_WALK03)});this.sprite.stopAllActions(),cc.tween(this.sprite).repeatForever(e).start(),this.anim.getAnimationState("MonsterIdle").isPlaying||this.anim.play("MonsterIdle")},e.prototype.enterDizz=function(){this.sprite.stopAllActions()},e.prototype.enterBlink=function(){var t=this;this.setLinearVelocity(cc.Vec2.ZERO),this.sc.isMoving=!1,cc.director.emit(c.EventHelper.PLAY_AUDIO,{detail:{name:D.default.BLINK}});var e=this.bodySprite.node;cc.tween(e).to(.2,{opacity:0}).call(function(){var e=M.default.getNearestEnemyPosition(t.node.position,!0,t.dungeon,!0);e=(e=d.default.getIndexInMap(e)).x>t.pos.x?e.addSelf(cc.v3(1,0)):e.addSelf(cc.v3(-1,0));var i=d.default.getPosInMap(e);t.entity.Transform.position=i,t.node.setPosition(i)}).to(.2,{opacity:255}).call(function(){t.sc.isBlinking=!1}).start()},e.prototype.isTestResetTimeDelay=function(t){return this.moveTimeDelay+=t,this.moveTimeDelay>10&&(this.moveTimeDelay=0,!0)},e.prototype.updateStatus=function(t,e){this.data.StatusTotalData.valueCopy(e),this.data.StatusList=t},e.prototype.hideSelf=function(){},e.prototype.updateDream=function(){return 0},e.prototype.updateLife=function(){},e.prototype.onColliderExit=function(){},e.RES_DISGUISE="disguise",e.RES_IDLE000="anim000",e.RES_IDLE001="anim001",e.RES_WALK00="anim002",e.RES_WALK01="anim003",e.RES_WALK02="anim004",e.RES_WALK03="anim005",e.RES_HIT001="anim006",e.RES_HIT002="anim007",e.RES_HIT003="anim008",e.RES_ATTACK01="anim009",e.SCALE_NUM=1.5,e.ANIM_NONE=-1,e.ANIM_IDLE=0,e.ANIM_WALK=1,e.ANIM_ATTACK=2,e.ANIM_HIT=3,e.ANIM_DIED=4,n([l(cc.Vec3)],e.prototype,"pos",void 0),n([l(u.default)],e.prototype,"healthBar",void 0),n([l(f.default)],e.prototype,"statusManager",void 0),n([l(y.default)],e.prototype,"floatinglabelManager",void 0),n([l(S.default)],e.prototype,"specialManager",void 0),n([l(cc.Prefab)],e.prototype,"boom",void 0),n([l(L.default)],e.prototype,"dangerBox",void 0),n([l(cc.Node)],e.prototype,"dangerTips",void 0),n([l(cc.Prefab)],e.prototype,"attrPrefab",void 0),i=n([s],e)}(_.default);i.default=H,cc._RF.pop()},{"../actor/ActorAttackBox":"ActorAttackBox","../actor/AreaDetector":"AreaDetector","../actor/AreaOfEffect":"AreaOfEffect","../actor/NonPlayerActorState":"NonPlayerActorState","../base/Actor":"Actor","../base/fsm/DefaultStateMachine":"DefaultStateMachine","../collider/CCollider":"CCollider","../data/AreaOfEffectData":"AreaOfEffectData","../data/DamageData":"DamageData","../data/FromData":"FromData","../data/NonPlayerData":"NonPlayerData","../item/Item":"Item","../manager/FloatingLabelManager":"FloatingLabelManager","../manager/SpecialManager":"SpecialManager","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/NextStep":"NextStep","../utils/Random":"Random","./Achievement":"Achievement","./Dungeon":"Dungeon","./EventHelper":"EventHelper","./HealthBar":"HealthBar","./Logic":"Logic","./Shooter":"Shooter"}],NoticeDialog:[function(t,e,i){"use strict";cc._RF.push(e,"967d5EFvotD245D4O3/qmU4","NoticeDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../../utils/AudioPlayer"),s=t("./BaseDialog"),l=cc._decorator,c=l.ccclass,u=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.show=function(){t.prototype.show.call(this)},e.prototype.close=function(){r.default.play(r.default.SELECT),this.dismiss()},n([c],e)}(s.default));i.default=u,cc._RF.pop()},{"../../utils/AudioPlayer":"AudioPlayer","./BaseDialog":"BaseDialog"}],OilGoldCount:[function(t,e,i){"use strict";cc._RF.push(e,"12dafP9eVJAZosCqqpFY/Vi","OilGoldCount");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Logic"),s=t("./EventHelper"),l=t("../utils/AudioPlayer"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fragmentLabel=null,e.gemLabel=null,e.gemCountLerp=0,e.fragmentCountLerp=0,e.progreesBar=null,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.anim=this.getComponent(cc.Animation),cc.director.on(s.EventHelper.HUD_ADD_OILGOLD,function(e){t.addCount(e.detail.count)}),cc.director.on(s.EventHelper.HUD_LOSE_OILGOLD,function(){if(t.node){var e=r.default.playerData.OilGoldData.fragments;t.addCount(""+-e),r.default.saveGroundOilGold(e)}})},e.prototype.start=function(){},e.prototype.addCount=function(t){if(this.anim){r.default.oilGolds+=parseInt(t);var e=r.default.playerData.OilGoldData.index;r.default.updateOilGoldCount(),e<r.default.playerData.OilGoldData.index&&l.default.play(l.default.LEVELUP),s.EventHelper.emit(s.EventHelper.PLAYER_UPDATE_OILGOLD_DATA)}},e.prototype.update=function(t){this.gemCountLerp=r.default.lerp(this.gemCountLerp,r.default.playerData.OilGoldData.level,5*t),this.fragmentCountLerp=r.default.lerp(this.fragmentCountLerp,r.default.playerData.OilGoldData.fragments,5*t),this.gemLabel&&(this.gemLabel.string=""+this.gemCountLerp.toFixed(0)),this.fragmentLabel&&(this.fragmentLabel.string=this.fragmentCountLerp.toFixed(0)+"/"+r.default.OIL_GOLD_LIST[r.default.playerData.OilGoldData.index]),this.progreesBar&&(this.progreesBar.progress=r.default.lerp(this.progreesBar.progress,r.default.playerData.OilGoldData.fragments/r.default.OIL_GOLD_LIST[r.default.playerData.OilGoldData.index],5*t))},n([h(cc.Label)],e.prototype,"fragmentLabel",void 0),n([h(cc.Label)],e.prototype,"gemLabel",void 0),n([h(cc.ProgressBar)],e.prototype,"progreesBar",void 0),n([u],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../utils/AudioPlayer":"AudioPlayer","./EventHelper":"EventHelper","./Logic":"Logic"}],OilGoldData:[function(t,e,i){"use strict";cc._RF.push(e,"700faV6hzxA44Hyyhr1kVep","OilGoldData");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("./BaseData"),r=t("./CommonData"),s=function(t){function e(){var e=t.call(this)||this;return e.value=0,e.fragments=0,e.level=0,e.index=0,e.common=new r.default,e}return a(e,t),Object.defineProperty(e.prototype,"Common",{get:function(){return this.common},enumerable:!1,configurable:!0}),e.prototype.valueCopy=function(t){t&&(this.common.valueCopy(t.common),this.fragments=t.fragments?t.fragments:0,this.level=t.level?t.level:0,this.index=t.index?t.index:0,this.value=t.value?t.value:0)},e.prototype.clone=function(){var t=new e;return t.fragments=this.fragments,t.common=this.common.clone(),t.level=this.level,t.index=this.index,t.value=this.value,t},e}(n.default);i.default=s,cc._RF.pop()},{"./BaseData":"BaseData","./CommonData":"CommonData"}],OilGold:[function(t,e,i){"use strict";cc._RF.push(e,"8833cW2JN9EQJVhihMruuSF","OilGold");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../logic/EventHelper"),l=t("../utils/Random"),c=t("../utils/AudioPlayer"),u=t("../base/BaseColliderComponent"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=0,e.isReady=!1,e.checkTimeDelay=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.initCollider()},e.prototype.onEnable=function(){var t=this,e=l.default.rand()*(r.default.getHalfChance()?1:-1)*1200,i=l.default.rand()*(r.default.getHalfChance()?1:-1)*1200;this.entity.Move.linearVelocity=cc.v2(e,i),this.entity.Move.linearDamping=10,this.isReady=!1,this.scheduleOnce(function(){t.isReady=!0,t.entity.Transform.position=t.node.position.clone(),t.entity.NodeRender.node=t.node},1)},e.prototype.changeValue=function(t){this.value=t,this.value>=i.FACE_VALUE?this.node.scale=2:this.node.scale=1},e.prototype.getFinalValue=function(){var t=this.value;switch(r.default.chapterIndex){case r.default.CHAPTER00:break;case r.default.CHAPTER01:t*=10;break;case r.default.CHAPTER02:t*=100;break;case r.default.CHAPTER03:t*=1e3;break;case r.default.CHAPTER04:case r.default.CHAPTER05:t*=1e4}return t},e.prototype.start=function(){},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.2&&(this.checkTimeDelay=0,!0)},e.prototype.getNearPlayerDistance=function(t){return r.default.getDistanceNoSqrt(this.node.position,t.position.clone().addSelf(cc.v3(0,32)))},e.prototype.update=function(t){if(this.isCheckTimeDelay(t)&&this.player&&this.getNearPlayerDistance(this.player.node)<800&&this.node.active&&this.isReady){var e=this.player.node.position.clone();e.y+=10;var i=e.sub(this.node.position);i.equals(cc.Vec3.ZERO)||(i=i.normalizeSelf(),this.entity.Move.linearVelocity=cc.v2(i.x,i.y).normalize().mul(800),this.entity.Move.linearDamping=1)}this.player&&this.getNearPlayerDistance(this.player.node)<64&&this.node.active&&this.isReady&&(this.isReady=!1,c.default.play(c.default.OILGOLD),s.EventHelper.emit(s.EventHelper.HUD_ADD_OILGOLD,{count:this.getFinalValue()}),s.EventHelper.emit("destoryoilgold",{oilGoldNode:this.node}))},e.FACE_VALUE=100,i=n([d],e)}(u.default));i.default=p,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer","../utils/Random":"Random"}],OilLake:[function(t,e,i){"use strict";cc._RF.push(e,"8cd153I1qFEbb/uteHyUJpM","OilLake");var o=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var a=t("./PerlinNoise2D"),n=t("../utils/Random"),r=cc._decorator,s=r.ccclass,l=(r.property,function(){function t(){this.map=new Array;var t,i,o,r,s=new a.default;s.seed(n.default.rand()),o=20+this.getRandomNum(20),r=20+this.getRandomNum(20),t=this.getRandomNum(9999),i=this.getRandomNum(9999);var l=e.WIDTH,c=e.HEIGHT;this.map=new Array;for(var u=0;u<l;u++){this.map[u]=new Array;for(var h=0;h<c;h++){this.map[u][h]=".";var d=o*u/l+t,p=r*h/c+i,f=s.simplex2(d,p);f>.14?this.map[u][h]="Y":f<-.14&&(this.map[u][h]="~");var g=n.default.rand();g>=0&&g<.2&&"~"!=this.map[u][h]&&(this.map[u][h]="o"),g>=.2&&g<.25&&"~"!=this.map[u][h]&&(this.map[u][h]="w")}}}var e;return e=t,t.prototype.getRandomNum=function(t){return Math.round(n.default.rand()*t)},t.prototype.getDisPlay=function(){for(var t="",i=e.HEIGHT-1;i>=0;i--){for(var o=0;o<e.WIDTH;o++)t+=this.map[o][i];t+="\n"}return t},t.WIDTH=64,t.HEIGHT=64,e=o([s],t)}());i.default=l,cc._RF.pop()},{"../utils/Random":"Random","./PerlinNoise2D":"PerlinNoise2D"}],OnContactListener:[function(t,e,i){"use strict";cc._RF.push(e,"b0fc5P4IfpMPqUea64e7JrA","OnContactListener"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],OrganizationTalent:[function(t,e,i){"use strict";cc._RF.push(e,"05cb5HVifxPKYxNiXzzrtHe","OrganizationTalent");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/AvatarData"),s=t("../data/FromData"),l=t("../data/NonPlayerData"),c=t("../data/StatusData"),u=t("../data/TriggerData"),h=t("../logic/Logic"),d=t("../manager/StatusManager"),p=t("../ui/CoolDownView"),f=t("../utils/AudioPlayer"),g=t("../utils/Utils"),y=t("./Talent"),m=cc._decorator,v=m.ccclass,E=m.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.energyShieldList=[],e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.changePerformance=function(){},e.prototype.init=function(e){t.prototype.init.call(this,e),this.coolDownId=p.default.ORGANIZATION;var i=1;this.player.data.AvatarData.organizationIndex==r.default.GURAD?i=1+Math.floor(h.default.playerData.OilGoldData.level/5):this.player.data.AvatarData.organizationIndex==r.default.FOLLOWER&&this.player.initShadowList(!0,Math.floor(h.default.playerData.OilGoldData.level/5+1),30+2*h.default.playerData.OilGoldData.level),this.initCoolDown(e,i)},e.prototype.skillCanUse=function(){return!0},e.prototype.doSkill=function(){var t=this;if(this.player.exTrigger(u.default.GROUP_USE,u.default.TYPE_USE_TALENT,null,null),this.player.data.AvatarData.organizationIndex==r.default.GURAD){if(this.energyShieldList.length>this.talentSkill.StorePointMax){var e=this.energyShieldList.pop();e.isShow=!1,e&&e.isValid&&e.destroyEntityNode()}var i=this.player.dungeon.buildingManager.addEnergyShield(this.player);i&&(this.energyShieldList.push(i),this.scheduleOnce(function(){t.talentSkill.IsExcuting=!1},1))}else if(this.player.data.AvatarData.organizationIndex==r.default.HUNTER)if(this.player.dungeon.nonPlayerManager.isPetAlive()){var o=new l.default;o.valueCopy(h.default.nonplayers[this.player.data.AvatarData.petName]),(a=new c.default).valueCopy(h.default.status[d.default.PET_DOG]),a.Common.realRate+=1*h.default.playerData.OilGoldData.level,a.Common.remoteCritRate=100,a.Common.realDamage+=h.default.playerData.OilGoldData.level,a.realDamageOvertime-=h.default.playerData.OilGoldData.level/5,this.player.dungeon.nonPlayerManager.pet.data.Common.maxHealth=o.Common.maxHealth+5*h.default.playerData.OilGoldData.level+3*this.data.useCount,this.player.dungeon.nonPlayerManager.pet.addCustomStatus(a,new s.default),f.default.play(o.specialAudio),g.default.toast("\u5ba0\u7269\u83b7\u5f97"+(5*h.default.playerData.OilGoldData.level+3*this.data.useCount)+"\u70b9\u8840\u91cf\u4e0a\u9650\uff0c\u5f53\u524d\u4e3a"+this.player.dungeon.nonPlayerManager.pet.data.Common.maxHealth+"\uff0c\u653b\u51fb\u529b\u4e3a"+o.getAttackPoint().getTotalDamage(),!1,!0)}else this.data.useCount>1&&(this.data.useCount=Math.floor(this.data.useCount/2),this.data.useCount<1&&(this.data.useCount=1)),(a=new l.default).valueCopy(h.default.nonplayers[this.player.data.AvatarData.petName]),a.Common.maxHealth+=5*h.default.playerData.OilGoldData.level+3*this.data.useCount,a.currentHealth=a.Common.maxHealth,a.Common.damageMin+=h.default.playerData.OilGoldData.level,a.Common.remoteDamage+=h.default.playerData.OilGoldData.level,a.Common.defence+=h.default.playerData.OilGoldData.level,this.player.dungeon.nonPlayerManager.addPetFromData(a,this.player.node.position,this.player.dungeon),f.default.play(a.specialAudio),g.default.toast("\u4f60\u53ec\u5524\u4e86\u5ba0\u7269"+a.nameCn+"\uff1a\u8840\u91cf\u4e0a\u9650\u4e3a"+this.player.dungeon.nonPlayerManager.pet.data.Common.maxHealth+"\uff0c\u653b\u51fb\u529b\u4e3a"+a.getAttackPoint().getTotalDamage(),!1,!0);else if(this.player.data.AvatarData.organizationIndex==r.default.TECH){var a;f.default.play(f.default.PICK_ITEM),(a=new c.default).valueCopy(h.default.status[d.default.REAGENT]),a.duration+=3*h.default.playerData.OilGoldData.level;var n=this.player.data.FinalCommon;a.Common.maxHealth=n.maxHealth*(.5+.1*h.default.playerData.OilGoldData.level),a.Common.damageMin=n.damageMin*(.5+.1*h.default.playerData.OilGoldData.level),a.Common.defence=n.defence*(.5+.1*h.default.playerData.OilGoldData.level),a.Common.remoteDamage=n.remoteDamage*(.5+.05*h.default.playerData.OilGoldData.level),a.realDamageDirect-=a.Common.maxHealth,this.player.addCustomStatus(a,new s.default)}else this.player.data.AvatarData.organizationIndex==r.default.FOLLOWER&&(f.default.play(f.default.BLINK),this.player.initShadowList(!1,Math.floor(h.default.playerData.OilGoldData.level/5+1),30+2*h.default.playerData.OilGoldData.level))},e.prototype.takeDamage=function(t){return this.energyShieldBlock(t)},e.prototype.energyShieldBlock=function(t){for(var e=this.energyShieldList.length-1;e>=0;e--){var i=this.energyShieldList[e];if(i.node&&i.node.isValid)return i.isShow&&i.checkTargetIn(this.player.node)&&i.takeDamage(t);this.energyShieldList.splice(e,1)}return!1},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},n([E(cc.Sprite)],e.prototype,"sprite",void 0),n([v],e)}(y.default);i.default=_,cc._RF.pop()},{"../data/AvatarData":"AvatarData","../data/FromData":"FromData","../data/NonPlayerData":"NonPlayerData","../data/StatusData":"StatusData","../data/TriggerData":"TriggerData","../logic/Logic":"Logic","../manager/StatusManager":"StatusManager","../ui/CoolDownView":"CoolDownView","../utils/AudioPlayer":"AudioPlayer","../utils/Utils":"Utils","./Talent":"Talent"}],PaletteSelector:[function(t,e,i){"use strict";cc._RF.push(e,"2484805pD1NW4q2UMrBMgzJ","PaletteSelector");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layout=null,e.colors=[],e.currentIndex=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){},e.prototype.init=function(t,e){var o=this;switch(t){case i.TYPE_EYES:this.colors=i.EYESCOLORS;break;case i.TYPE_HAIR:this.colors=i.HAIRCOLORS;break;case i.TYPE_FACE:this.colors=i.FACECOLORS}this.currentIndex=e||0;for(var a=function(t){var e=n.layout.children[t];t>n.colors.length-1?e.color=cc.Color.BLACK:e.color=cc.Color.WHITE.fromHEX(n.colors[t]),e.on(cc.Node.EventType.TOUCH_START,function(){o.updateAttribute(e.color)})},n=this,r=0;r<this.layout.childrenCount;r++)a(r);this.updateAttribute(cc.Color.WHITE.fromHEX(this.colors[this.currentIndex]))},e.prototype.selectRandom=function(){this.currentIndex=r.default.getRandomNum(0,this.colors.length-1),this.updateAttribute(cc.Color.WHITE.fromHEX(this.colors[this.currentIndex]))},e.prototype.setSelectorCallback=function(t){this.selectorCallback=t},e.prototype.updateAttribute=function(t){this.selectorCallback&&this.selectorCallback(t)},e.TYPE_HAIR=0,e.TYPE_EYES=1,e.TYPE_FACE=2,e.EYESCOLORS=["#000000","#222034","#45283c","#663931","#fbf236","#6abe30","#37946e","#524b24","#306082","#5b6ee1","#639bff","#5fcde4","#cbdbfc","#ffc500","#ffffff","#9badb7","#76428a","#ac3232","#d95763","#8f974a","#c20000"],e.HAIRCOLORS=["#000000","#222034","#45283c","#663931","#fbf236","#6abe30","#37946e","#524b24","#306082","#5b6ee1","#639bff","#5fcde4","#cbdbfc","#ffc500","#ffffff","#9badb7","#76428a","#ac3232","#d95763","#8f974a","#c20000"],e.FACECOLORS=["#FBA1DE","#d95763","#818185","#d9a066","#663931","#fbf236","#6abe30","#37946e","#524b24","#306082","#5b6ee1","#639bff","#5fcde4","#cbdbfc","#ffc500","#ffffff","#9badb7","#76428a","#ac3232","#8f974a","#c20000"],n([c(cc.Node)],e.prototype,"layout",void 0),i=n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../logic/Logic":"Logic"}],ParallaxBackground:[function(t,e,i){"use strict";cc._RF.push(e,"509a7aimNhEX5/e74VkypMj","ParallaxBackground");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Logic"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.background=null,e.layer1=null,e.layer2=null,e}return a(e,t),e.prototype.init=function(){this.layer1.getComponent(cc.Sprite).spriteFrame=s.default.spriteFrameRes("chapter0"+s.default.chapterIndex+"layer1"),this.layer2.getComponent(cc.Sprite).spriteFrame=s.default.spriteFrameRes("chapter0"+s.default.chapterIndex+"layer2")},e.prototype.getPlayer=function(){return this.player||(this.player=this.node.parent.getComponent(r.default).player),this.player},e.prototype.start=function(){},e.prototype.lateUpdate=function(){var t=this.getPlayer();if(t){var e=t.node.convertToWorldSpaceAR(cc.Vec3.ZERO);this.layer1.position=this.lerp(this.layer1.position,this.node.convertToNodeSpaceAR(e),.005),this.layer2.position=this.lerp(this.layer2.position,this.node.convertToNodeSpaceAR(e),.015)}},e.prototype.lerp=function(t,e,i){var o=cc.v3(0,0),a=t.x,n=t.y;return o.x=a+(e.x-a)*i,o.y=n+(e.y-n)*i,o},n([u(cc.Node)],e.prototype,"background",void 0),n([u(cc.Node)],e.prototype,"layer1",void 0),n([u(cc.Node)],e.prototype,"layer2",void 0),n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../logic/Dungeon":"Dungeon","../logic/Logic":"Logic"}],PerlinNoise2D:[function(t,e,i){"use strict";cc._RF.push(e,"59901zRRqlG9KvoKLDTbxq7","PerlinNoise2D");var o=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var a=cc._decorator,n=a.ccclass,r=(a.property,function(){function t(){this.grad3=[new s(1,1,0),new s(-1,1,0),new s(1,-1,0),new s(-1,-1,0),new s(1,0,1),new s(-1,0,1),new s(1,0,-1),new s(-1,0,-1),new s(0,1,1),new s(0,-1,1),new s(0,1,-1),new s(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6,this.F3=1/3,this.G3=1/6}return t.prototype.simplex2=function(t,e){var i,o,a=(t+e)*this.F2,n=Math.floor(t+a),r=Math.floor(e+a),s=(n+r)*this.G2,l=t-n+s,c=e-r+s;l>c?(i=1,o=0):(i=0,o=1);var u=l-i+this.G2,h=c-o+this.G2,d=l-1+2*this.G2,p=c-1+2*this.G2;n&=255,r&=255;var f=this.gradP[n+this.perm[r]],g=this.gradP[n+i+this.perm[r+o]],y=this.gradP[n+1+this.perm[r+1]],m=.5-l*l-c*c,v=.5-u*u-h*h,E=.5-d*d-p*p;return 70*((m<0?0:(m*=m)*m*f.dot2(l,c))+(v<0?0:(v*=v)*v*g.dot2(u,h))+(E<0?0:(E*=E)*E*y.dot2(d,p)))},t.prototype.simplex3=function(t,e,i){var o,a,n,r,s,l,c=(t+e+i)*this.F3,u=Math.floor(t+c),h=Math.floor(e+c),d=Math.floor(i+c),p=(u+h+d)*this.G3,f=t-u+p,g=e-h+p,y=i-d+p;f>=g?g>=y?(o=1,a=0,n=0,r=1,s=1,l=0):f>=y?(o=1,a=0,n=0,r=1,s=0,l=1):(o=0,a=0,n=1,r=1,s=0,l=1):g<y?(o=0,a=0,n=1,r=0,s=1,l=1):f<y?(o=0,a=1,n=0,r=0,s=1,l=1):(o=0,a=1,n=0,r=1,s=1,l=0);var m=f-o+this.G3,v=g-a+this.G3,E=y-n+this.G3,_=f-r+2*this.G3,T=g-s+2*this.G3,D=y-l+2*this.G3,S=f-1+3*this.G3,O=g-1+3*this.G3,A=y-1+3*this.G3;u&=255,h&=255,d&=255;var C=this.gradP[u+this.perm[h+this.perm[d]]],R=this.gradP[u+o+this.perm[h+a+this.perm[d+n]]],L=this.gradP[u+r+this.perm[h+s+this.perm[d+l]]],b=this.gradP[u+1+this.perm[h+1+this.perm[d+1]]],P=.6-f*f-g*g-y*y,I=.6-m*m-v*v-E*E,M=.6-_*_-T*T-D*D,N=.6-S*S-O*O-A*A;return 32*((P<0?0:(P*=P)*P*C.dot3(f,g,y))+(I<0?0:(I*=I)*I*R.dot3(m,v,E))+(M<0?0:(M*=M)*M*L.dot3(_,T,D))+(N<0?0:(N*=N)*N*b.dot3(S,O,A)))},t.prototype.perlin2=function(t,e){var i=Math.floor(t),o=Math.floor(e);t-=i,e-=o,i&=255,o&=255;var a=this.gradP[i+this.perm[o]].dot2(t,e),n=this.gradP[i+this.perm[o+1]].dot2(t,e-1),r=this.gradP[i+1+this.perm[o]].dot2(t-1,e),s=this.gradP[i+1+this.perm[o+1]].dot2(t-1,e-1),l=this.fade(t);return this.lerp(this.lerp(a,r,l),this.lerp(n,s,l),this.fade(e))},t.prototype.perlin3=function(t,e,i){var o=Math.floor(t),a=Math.floor(e),n=Math.floor(i);t-=o,e-=a,i-=n,o&=255,a&=255,n&=255;var r=this.gradP[o+this.perm[a+this.perm[n]]].dot3(t,e,i),s=this.gradP[o+this.perm[a+this.perm[n+1]]].dot3(t,e,i-1),l=this.gradP[o+this.perm[a+1+this.perm[n]]].dot3(t,e-1,i),c=this.gradP[o+this.perm[a+1+this.perm[n+1]]].dot3(t,e-1,i-1),u=this.gradP[o+1+this.perm[a+this.perm[n]]].dot3(t-1,e,i),h=this.gradP[o+1+this.perm[a+this.perm[n+1]]].dot3(t-1,e,i-1),d=this.gradP[o+1+this.perm[a+1+this.perm[n]]].dot3(t-1,e-1,i),p=this.gradP[o+1+this.perm[a+1+this.perm[n+1]]].dot3(t-1,e-1,i-1),f=this.fade(t),g=this.fade(e),y=this.fade(i);return this.lerp(this.lerp(this.lerp(r,u,f),this.lerp(s,h,f),y),this.lerp(this.lerp(l,d,f),this.lerp(c,p,f),y),g)},t.prototype.seed=function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=0;e<256;e++){var i;i=1&e?this.p[e]^255&t:this.p[e]^t>>8&255,this.perm[e]=this.perm[e+256]=i,this.gradP[e]=this.gradP[e+256]=this.grad3[i%12]}},t.prototype.lerp=function(t,e,i){return(1-i)*t+i*e},t.prototype.fade=function(t){return t*t*t*(t*(6*t-15)+10)},o([n],t)}());i.default=r;var s=function(){function t(t,e,i){this.x=t,this.y=e,this.z=i}return t.prototype.dot2=function(t,e){return this.x*t+this.y*e},t.prototype.dot3=function(t,e,i){return this.x*t+this.y*e+this.z*i},t}();cc._RF.pop()},{}],PickAvatar:[function(t,e,i){"use strict";cc._RF.push(e,"c7974nYPCdMvb6AS/8/NF4d","PickAvatar");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../utils/AudioPlayer"),l=t("./AttributeSelector"),c=t("../data/AttributeData"),u=t("./BrightnessBar"),h=t("./PaletteSelector"),d=t("../data/AvatarData"),p=t("../manager/EquipmentManager"),f=t("../manager/InventoryManager"),g=t("../manager/LoadingManager"),y=t("./LoadingIcon"),m=cc._decorator,v=m.ccclass,E=m.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.SELECTOR_ORGANIZATION=0,e.SELECTOR_GENGER=1,e.SELECTOR_HAIR=2,e.COLOR_PATTLE_HAIR=3,e.SELECTOR_EYES=4,e.COLOR_PATTLE_EYES=5,e.SELECTOR_FACE=6,e.COLOR_PATTLE_FACE=7,e.SELECTOR_BODY=8,e.PROGRESS_SKIN_COLOR=9,e.SELECTOR_PROFESSION=10,e.loadingBackground=null,e.avatarTable=null,e.attributeLayout=null,e.randomLayout=null,e.randomLabelTitle=null,e.randomLabelName=null,e.randomLabelDesc=null,e.randomLabelSkillName=null,e.randomLabelSkillDesc=null,e.randomButton=null,e.selectorPrefab=null,e.brightnessBarPrefab=null,e.palettePrefab=null,e.cloakSprite=null,e.shoesSprite1=null,e.shoesSprite2=null,e.helmetSprite=null,e.pantsSprite=null,e.clothesSprite=null,e.glovesSprite1=null,e.glovesSprite2=null,e.weaponSprite=null,e.remoteSprite=null,e.shieldSprite=null,e.petSprite=null,e.randomTouched=!1,e.isShow=!1,e.loadingManager=new g.default,e.delayTime=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.loadingManager.init(),this.data=new d.default,this.bedSprite=this.getSpriteChildSprite(this.avatarTable,["bed"]),this.coverSprite=this.getSpriteChildSprite(this.avatarTable,["cover"]),this.petSprite=this.getSpriteChildSprite(this.avatarTable,["pet"]),this.bodySprite=this.getSpriteChildSprite(this.avatarTable,["avatar","body"]),this.handSprite1=this.getSpriteChildSprite(this.avatarTable,["avatar","body","hand1"]),this.handSprite2=this.getSpriteChildSprite(this.avatarTable,["avatar","body","hand2"]),this.legSprite1=this.getSpriteChildSprite(this.avatarTable,["avatar","body","leg1"]),this.legSprite2=this.getSpriteChildSprite(this.avatarTable,["avatar","body","leg2"]),this.headSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","head"]),this.hairSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","head","hair"]),this.faceSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","head","face"]),this.eyesSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","head","eyes"]),this.helmetSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","head","helmet"]),this.pantsSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","body","pants"]),this.cloakSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","cloak"]),this.weaponSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","weapon"]),this.remoteSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","remote"]),this.shieldSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","shield"]),this.clothesSprite=this.getSpriteChildSprite(this.avatarTable,["avatar","body","clothes"]),this.glovesSprite1=this.getSpriteChildSprite(this.avatarTable,["avatar","body","hand1","gloves"]),this.glovesSprite2=this.getSpriteChildSprite(this.avatarTable,["avatar","body","hand2","gloves"]),this.shoesSprite1=this.getSpriteChildSprite(this.avatarTable,["avatar","body","leg1","shoes"]),this.shoesSprite2=this.getSpriteChildSprite(this.avatarTable,["avatar","body","leg2","shoes"]),this.loadingBackground.active=!0,this.loadingManager.loadSpriteAtlas(g.default.KEY_TEXTURES,"singleColor"),this.loadingManager.loadSpriteAtlas(g.default.KEY_EQUIPMENT,"emptyequipment"),this.loadingManager.loadProfession(),this.loadingManager.loadEquipment(),this.loadingManager.loadTalents(),this.loadingManager.loadItems(),this.loadingManager.loadSuits(),this.attributeLayout.active=!1,this.randomButton.on(cc.Node.EventType.TOUCH_START,function(){t.randomTouched=!0},this),this.randomButton.on(cc.Node.EventType.TOUCH_END,function(){t.randomTouched=!1},this),this.randomButton.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.randomTouched=!1},this)},e.prototype.getSpriteChildSprite=function(t,e){for(var i=0,o=e;i<o.length;i++){var a=o[i];t=t.getChildByName(a)}return t.getComponent(cc.Sprite)},e.prototype.show=function(){var t=this;this.isShow=!0;var e=this.loadingBackground.getComponentInChildren(y.default);e&&e.isFirst?cc.tween(this.loadingBackground).to(.5,{opacity:0}).call(function(){t.loadingBackground.active=!1}).start():this.loadingBackground.active=!1;for(var i=new Array,o=0;o<d.default.ORGANIZATION.length;o++)i.push(new c.default(o,d.default.ORGANIZATION[o],"","","",""));this.organizationSelector=this.addAttributeSelector("\u7ec4\u7ec7\uff1a",i),this.organizationSelector.selectorCallback=function(e){t.data.organizationIndex=e.id,t.bedSprite.spriteFrame=r.default.spriteFrameRes("avatarbed00"+e.id),t.coverSprite.spriteFrame=r.default.spriteFrameRes("avatarcover00"+e.id),t.randomLabelTitle.string=e.name,t.petSelector&&(t.petSelector.node.active=e.id==d.default.HUNTER),t.petSprite.node.active=e.id==d.default.HUNTER};var a=new Array;for(o=0;o<r.default.professionList.length;o++){var n=r.default.professionList[o],s=r.default.talents[n.talent];a.push(new c.default(n.id,n.nameCn,"",n.desc,"\u6280\u80fd\uff1a"+s.nameCn,""+s.desc))}this.professionSelector=this.addAttributeSelector("\u804c\u4e1a\uff1a",a),this.professionSelector.selectorCallback=function(e){t.data.professionData.valueCopy(r.default.professionList[e.id]),t.randomLabelName.string=""+e.name,t.randomLabelDesc.string=""+e.desc,t.randomLabelSkillName.string=""+e.name1,t.randomLabelSkillDesc.string=""+e.desc1,t.changeEquipment(r.default.professionList[e.id])},this.skinSelector=this.addBrightnessBar(),this.skinSelector.setSelectorCallback(function(e){t.bodySprite.node.color=e,t.headSprite.node.color=e,t.handSprite1.node.color=e,t.handSprite2.node.color=e,t.legSprite1.node.color=e,t.legSprite2.node.color=e,t.data.skinColor=e.toHEX("#rrggbb")});var l=[];for(o=0;o<10;o++)l.push(new c.default(o,"\u6837\u5f0f"+o,"avatarhair0"+(o>9?"":"0")+o+"anim00","","",""));this.hairSelector=this.addAttributeSelector("\u53d1\u578b\uff1a",l),this.hairSelector.selectorCallback=function(e){t.hairSprite.spriteFrame=r.default.spriteFrameRes(e.resName+"0"),t.data.hairResName=e.resName},this.hairColorSelector=this.addPaletteSelector(h.default.TYPE_HAIR),this.hairColorSelector.setSelectorCallback(function(e){t.hairSprite.node.color=e,t.data.hairColor=e.toHEX("#rrggbb")});var u=[];for(o=0;o<22;o++)u.push(new c.default(o,"\u6837\u5f0f"+o,"avatareyes0"+(o>9?"":"0")+o,"","",""));this.eyesSelector=this.addAttributeSelector("\u773c\u775b\uff1a",u),this.eyesSelector.selectorCallback=function(e){t.eyesSprite.spriteFrame=r.default.spriteFrameRes(e.resName),t.data.eyesResName=e.resName},this.eyesColorSelector=this.addPaletteSelector(h.default.TYPE_EYES),this.eyesColorSelector.setSelectorCallback(function(e){t.eyesSprite.getMaterial(0).setProperty("eyeColor",e),t.data.eyesColor=e.toHEX("#rrggbb")});var p=[];for(o=0;o<15;o++)p.push(new c.default(o,"\u6837\u5f0f"+o,"avatarface0"+(o>9?"":"0")+o,"","",""));this.faceSelector=this.addAttributeSelector("\u9762\u988a\uff1a",p),this.faceSelector.selectorCallback=function(e){t.faceSprite.spriteFrame=r.default.spriteFrameRes(e.resName),t.data.faceResName=e.resName},this.faceColorSelector=this.addPaletteSelector(h.default.TYPE_FACE),this.faceColorSelector.setSelectorCallback(function(e){t.faceSprite.node.color=e,t.faceSprite.node.opacity=128,t.data.faceColor=e.toHEX("#rrggbb")});var f=["\u67ef\u57fa","\u5bb6\u732b","\u6a59\u5b50\u9c7c"],m=[];for(o=0;o<f.length;o++)m.push(new c.default(o,""+f[o],"nonplayer1"+(o>9?"":"0")+o,"","",""));this.petSelector=this.addAttributeSelector("\u5ba0\u7269\uff1a",m),this.petSelector.selectorCallback=function(e){g.default.loadNpcSpriteAtlas(e.resName,function(){t.petSprite.spriteFrame=r.default.spriteFrameRes(e.resName+"anim000")}),t.data.petName="nonplayer1"+(e.id>9?"":"0")+e.id},this.petSelector.node.active=this.organizationSelector.CurrentData.id==d.default.HUNTER,this.petSprite.node.active=this.organizationSelector.CurrentData.id==d.default.HUNTER,this.ButtonRandom()},e.prototype.changeEquipment=function(t){this.changeRes(this.helmetSprite,t.equips[f.default.HELMET],"anim0"),this.changeRes(this.pantsSprite,t.equips[f.default.TROUSERS]),this.changeRes(this.cloakSprite,t.equips[f.default.CLOAK]),this.changeRes(this.weaponSprite,t.equips[f.default.WEAPON]),this.changeRes(this.remoteSprite,t.equips[f.default.REMOTE],"anim0"),this.changeRes(this.shieldSprite,t.equips[f.default.SHIELD]),this.changeRes(this.clothesSprite,t.equips[f.default.CLOTHES],"anim0"),this.changeRes(this.glovesSprite1,t.equips[f.default.GLOVES]),this.changeRes(this.glovesSprite2,t.equips[f.default.GLOVES]),this.changeRes(this.shoesSprite1,t.equips[f.default.SHOES]),this.changeRes(this.shoesSprite2,t.equips[f.default.SHOES]),this.resetSpriteSize(this.weaponSprite),this.resetSpriteSize(this.remoteSprite),this.resetSpriteSize(this.shieldSprite)},e.prototype.resetSpriteSize=function(t){t.spriteFrame&&(t.node.width=t.spriteFrame.getOriginalSize().width,t.node.height=t.spriteFrame.getOriginalSize().height)},e.prototype.changeRes=function(t,e,i){if(!t)return!1;var o=r.default.spriteFrameRes(e);i&&r.default.spriteFrameRes(e+i)&&(o=r.default.spriteFrameRes(e+i)),t.spriteFrame=o||null},e.prototype.startGame=function(){this.isShow&&(r.default.profileManager.clearData(),r.default.resetData(r.default.jumpChapter),r.default.jumpChapter=0,s.default.play(s.default.SELECT),r.default.playerData.AvatarData=this.data.clone(),this.addPorfessionEquipment(),cc.director.loadScene("loading"))},e.prototype.backToHome=function(){cc.director.loadScene("start"),s.default.play(s.default.SELECT)},e.prototype.addPorfessionEquipment=function(){for(var t in r.default.inventoryManager.equips)r.default.inventoryManager.equips[t].valueCopy(p.default.getNewEquipData(this.data.professionData.equips[t]?this.data.professionData.equips[t]:""))},e.prototype.addBrightnessBar=function(){var t=cc.instantiate(this.brightnessBarPrefab),e=t.getComponent(u.default);return this.attributeLayout.addChild(t),e},e.prototype.addAttributeSelector=function(t,e,i){var o=cc.instantiate(this.selectorPrefab),a=o.getComponent(l.default);return this.attributeLayout.addChild(o),a.init(t,e,i),a},e.prototype.addPaletteSelector=function(t,e){var i=cc.instantiate(this.palettePrefab),o=i.getComponent(h.default);return this.attributeLayout.addChild(i),o.init(t,e),o},e.prototype.update=function(t){this.loadingManager.isSpriteFramesLoaded(g.default.KEY_TEXTURES)&&this.loadingManager.isSpriteFramesLoaded(g.default.KEY_EQUIPMENT)&&this.loadingManager.isProfessionLoaded&&this.loadingManager.isEquipmentLoaded&&this.loadingManager.isSkillsLoaded&&this.loadingManager.isItemsLoaded&&this.loadingManager.isSuitsLoaded&&(this.loadingManager.reset(),this.show()),this.isShow&&this.isTimeDelay(t)&&this.randomTouched&&(this.randomButton.angle=0,cc.tween(this.randomButton).to(.2,{angle:360}).start(),this.ButtonRandom())},e.prototype.isTimeDelay=function(t){return this.delayTime+=t,this.delayTime>.2&&(this.delayTime=0,!0)},e.prototype.ButtonSwitch=function(){this.isShow&&(this.randomLayout.active=!this.randomLayout.active,this.attributeLayout.active=!this.attributeLayout.active,s.default.play(s.default.SELECT))},e.prototype.ButtonRandom=function(){this.isShow&&(this.organizationSelector.selectRandom(),this.professionSelector.selectRandom(),this.skinSelector.selectRandom(),this.hairSelector.selectRandom(),this.hairColorSelector.selectRandom(),this.eyesSelector.selectRandom(),this.eyesColorSelector.selectRandom(),this.faceSelector.selectRandom(),this.faceColorSelector.selectRandom(),this.petSelector.selectRandom(),s.default.play(s.default.SELECT))},e.prototype.ButtonSelect=function(t,e){this.isShow&&(this.professionSelector.selectNext(0==e),s.default.play(s.default.SELECT))},n([E(cc.Node)],e.prototype,"loadingBackground",void 0),n([E(cc.Node)],e.prototype,"avatarTable",void 0),n([E(cc.Node)],e.prototype,"attributeLayout",void 0),n([E(cc.Node)],e.prototype,"randomLayout",void 0),n([E(cc.Label)],e.prototype,"randomLabelTitle",void 0),n([E(cc.Label)],e.prototype,"randomLabelName",void 0),n([E(cc.Label)],e.prototype,"randomLabelDesc",void 0),n([E(cc.Label)],e.prototype,"randomLabelSkillName",void 0),n([E(cc.Label)],e.prototype,"randomLabelSkillDesc",void 0),n([E(cc.Node)],e.prototype,"randomButton",void 0),n([E(cc.Prefab)],e.prototype,"selectorPrefab",void 0),n([E(cc.Prefab)],e.prototype,"brightnessBarPrefab",void 0),n([E(cc.Prefab)],e.prototype,"palettePrefab",void 0),n([v],e)}(cc.Component);i.default=_,cc._RF.pop()},{"../data/AttributeData":"AttributeData","../data/AvatarData":"AvatarData","../logic/Logic":"Logic","../manager/EquipmentManager":"EquipmentManager","../manager/InventoryManager":"InventoryManager","../manager/LoadingManager":"LoadingManager","../utils/AudioPlayer":"AudioPlayer","./AttributeSelector":"AttributeSelector","./BrightnessBar":"BrightnessBar","./LoadingIcon":"LoadingIcon","./PaletteSelector":"PaletteSelector"}],PlayerAvatar:[function(t,e,i){"use strict";cc._RF.push(e,"7621b1Y+05Jj7j6YdAgY785","PlayerAvatar");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Logic"),s=t("../manager/InventoryManager"),l=t("../utils/AudioPlayer"),c=cc._decorator,u=c.ccclass,h=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dir=i.DIR_RIGHT,e.status=i.STATE_IDLE,e.shadowSprite=null,e.cloakSprite=null,e.legLeftSprite=null,e.legRightSprite=null,e.footLeftSprite=null,e.footRightSprite=null,e.shoesLeftSprite=null,e.shoesRightSprite=null,e.handLeftSprite=null,e.glovesLeftSprite=null,e.handRightSprite=null,e.glovesRightSprite=null,e.headSprite=null,e.faceSprite=null,e.eyesSprite=null,e.hairSprite=null,e.helmetSprite=null,e.bodySprite=null,e.pantsSprite=null,e.clothesSprite=null,e.avatarNode=null,e.spriteNode=null,e.isAniming=!1,e.idlehair=[0,1],e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.init()},e.prototype.init=function(){var t=this;this.data=r.default.playerData.AvatarData.clone(),this.anim=this.getComponent(cc.Animation),this.avatarNode=this.getSpriteChildNode(["sprite","avatar"]),this.spriteNode=this.getSpriteChildNode(["sprite"]),this.cloakSprite=this.getSpriteChildSprite(["sprite","cloak"]),this.shadowSprite=this.getSpriteChildSprite(["sprite","shadow"]),this.legLeftSprite=this.getSpriteChildSprite(["sprite","avatar","legleft"]),this.legRightSprite=this.getSpriteChildSprite(["sprite","avatar","legright"]),this.footLeftSprite=this.getSpriteChildSprite(["sprite","avatar","legleft","foot"]),this.footRightSprite=this.getSpriteChildSprite(["sprite","avatar","legright","foot"]),this.shoesLeftSprite=this.getSpriteChildSprite(["sprite","avatar","legleft","foot","shoes"]),this.shoesRightSprite=this.getSpriteChildSprite(["sprite","avatar","legright","foot","shoes"]),this.handLeftSprite=this.getSpriteChildSprite(["sprite","avatar","handleft"]),this.handRightSprite=this.getSpriteChildSprite(["sprite","avatar","handright"]),this.glovesLeftSprite=this.getSpriteChildSprite(["sprite","avatar","handleft","gloves"]),this.glovesRightSprite=this.getSpriteChildSprite(["sprite","avatar","handright","gloves"]),this.headSprite=this.getSpriteChildSprite(["sprite","avatar","head"]),this.faceSprite=this.getSpriteChildSprite(["sprite","avatar","head","face"]),this.eyesSprite=this.getSpriteChildSprite(["sprite","avatar","head","eyes"]),this.hairSprite=this.getSpriteChildSprite(["sprite","avatar","head","hair"]),this.helmetSprite=this.getSpriteChildSprite(["sprite","avatar","head","helmet"]),this.bodySprite=this.getSpriteChildSprite(["sprite","avatar","body"]),this.pantsSprite=this.getSpriteChildSprite(["sprite","avatar","body","pants"]),this.clothesSprite=this.getSpriteChildSprite(["sprite","avatar","body","clothes"]),this.headSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.faceSprite.node.color=cc.Color.WHITE.fromHEX(this.data.faceColor),this.faceSprite.node.opacity=128;var e=cc.Color.WHITE.fromHEX(this.data.eyesColor);this.eyesSprite.getMaterial(0).setProperty("eyeColor",e),this.hairSprite.node.color=cc.Color.WHITE.fromHEX(this.data.hairColor),this.bodySprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.legLeftSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.legRightSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.footLeftSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.footRightSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.handLeftSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.handRightSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.hairSprite.node.stopAllActions(),this.changeAvatarByDir(i.DIR_RIGHT);var o=0;this.schedule(function(){t.hairSprite.spriteFrame=r.default.spriteFrameRes(t.data.hairResName+t.idlehair[o++]),o>1&&(o=0)},.2,cc.macro.REPEAT_FOREVER,.1)},e.prototype.getSpriteChildSprite=function(t){for(var e=this.node,i=0,o=t;i<o.length;i++){var a=o[i];e=e.getChildByName(a)}return e.getComponent(cc.Sprite)},e.prototype.getSpriteChildNode=function(t){for(var e=this.node,i=0,o=t;i<o.length;i++){var a=o[i];e=e.getChildByName(a)}return e},e.prototype.showHandsWithInteract=function(t,e){this.handLeftSprite.node.scaleY=.2,this.handRightSprite.node.scaleY=.2,this.handLeftSprite.node.opacity=0,this.handRightSprite.node.opacity=0,this.handLeftSprite.node.y=8,this.handRightSprite.node.y=8,t&&(this.handLeftSprite.node.opacity=255,this.handRightSprite.node.opacity=255,e&&(this.handLeftSprite.node.scaleY=.3,this.handRightSprite.node.scaleY=.3,this.handLeftSprite.node.y=16,this.handRightSprite.node.y=16))},e.prototype.playAnim=function(t,e){if(this.anim||this.init(),!this.isAniming){switch(t){case i.STATE_IDLE:this.status!=t&&i.STATE_DIE!=this.status&&this.playIdle(e);break;case i.STATE_WALK:this.status==t&&this.dir==e||i.STATE_ATTACK==this.status||i.STATE_DIE==this.status||this.playWalk(e);break;case i.STATE_ATTACK:i.STATE_DIE!=this.status&&this.playAttack(e);break;case i.STATE_DIE:i.STATE_DIE!=this.status&&this.playDie();break;case i.STATE_FALL:i.STATE_DIE!=this.status&&this.anim.play("AvatarFall");break;case i.STATE_JUMP:i.STATE_DIE!=this.status&&this.anim.play("AvatarJump")}this.status=t,this.dir=e}},e.prototype.changeLegColor=function(t,e){t?(this.legLeftSprite.node.color=cc.Color.WHITE.fromHEX(e),this.legRightSprite.node.color=cc.Color.WHITE.fromHEX(e),this.footLeftSprite.node.color=cc.Color.WHITE.fromHEX(e),this.footRightSprite.node.color=cc.Color.WHITE.fromHEX(e)):(this.legLeftSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.legRightSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.footLeftSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor),this.footRightSprite.node.color=cc.Color.WHITE.fromHEX(this.data.skinColor))},e.prototype.hitLight=function(t){this.bodySprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT),this.headSprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT),this.hairSprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT),this.faceSprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT),this.eyesSprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT),this.handLeftSprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT),this.handRightSprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT),this.legLeftSprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT),this.legRightSprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT),this.footLeftSprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT),this.footLeftSprite.getMaterial(0).setProperty("addColor",t?cc.color(200,200,200,100):cc.Color.TRANSPARENT)},e.prototype.changeEquipDirSpriteFrame=function(t,e){var i=t.equips[s.default.HELMET],o=t.equips[s.default.CLOTHES];this.cloakSprite.node.zIndex=0==e?this.avatarNode.zIndex+1:this.avatarNode.zIndex-1,0==e&&r.default.spriteFrameRes(i.img+"anim2")?this.helmetSprite.spriteFrame=r.default.spriteFrameRes(i.img+"anim2"):1==e&&r.default.spriteFrameRes(i.img+"anim1")?this.helmetSprite.spriteFrame=r.default.spriteFrameRes(i.img+"anim1"):this.helmetSprite.spriteFrame=r.default.spriteFrameRes(i.img+"anim0"),0==e&&r.default.spriteFrameRes(o.img+"anim2")?this.clothesSprite.spriteFrame=r.default.spriteFrameRes(o.img+"anim2"):1==e&&r.default.spriteFrameRes(o.img+"anim1")?this.clothesSprite.spriteFrame=r.default.spriteFrameRes(o.img+"anim1"):this.clothesSprite.spriteFrame=r.default.spriteFrameRes(o.img+"anim0")},e.prototype.playDie=function(){this.anim.play("AvatarDie")},e.prototype.playIdle=function(){this.anim.play("AvatarIdle")},e.prototype.changeAvatarByDir=function(t){var e=this.data.eyesResName,o=this.data.faceResName;switch(t){case i.DIR_UP:this.idlehair=[2,3],this.eyesSprite.spriteFrame=null,this.faceSprite.spriteFrame=null;break;case i.DIR_DOWN:this.idlehair=[0,1],this.eyesSprite.spriteFrame=r.default.spriteFrameRes(e),this.faceSprite.spriteFrame=r.default.spriteFrameRes(o);break;case i.DIR_LEFT:case i.DIR_RIGHT:this.idlehair=[4,5],this.eyesSprite.spriteFrame=r.default.spriteFrameRes("side"+e),this.faceSprite.spriteFrame=r.default.spriteFrameRes("side"+o)}var a=cc.Color.WHITE.fromHEX(this.data.eyesColor);this.eyesSprite.getMaterial(0).setProperty("eyeColor",a),this.hairSprite.spriteFrame=r.default.spriteFrameRes(this.data.hairResName+this.idlehair[0]),4!=t&&(this.cloakSprite.node.zIndex=0==t?this.avatarNode.zIndex+1:this.avatarNode.zIndex-1,this.handRightSprite.node.zIndex=0==t?this.bodySprite.node.zIndex-1:this.bodySprite.node.zIndex+1)},e.prototype.showLegsWithWater=function(t){this.legLeftSprite.node.opacity=t?0:255,this.legRightSprite.node.opacity=t?0:255,this.shadowSprite.node.opacity=t?0:255,this.pantsSprite.node.opacity=t?0:255,this.setInWaterMat(this.bodySprite,t),this.setInWaterMat(this.clothesSprite,t)},e.prototype.setInWaterMat=function(t,e){if(t&&t.spriteFrame){t.spriteFrame.getOffset();var i=t.spriteFrame.getRect(),o=t.spriteFrame.getTexture();t.getMaterial(0).setProperty("rect",[i.x/o.width,i.y/o.height,i.width/o.width,i.height/o.height]),t.getMaterial(0).setProperty("hidebottom",e?1:0),t.getMaterial(0).setProperty("isRotated",t.spriteFrame.isRotated()?1:0)}},e.prototype.playWalk=function(t){this.anim.play(t==i.DIR_UP||t==i.DIR_DOWN?"AvatarWalkVertical":"AvatarWalkHorizontal")},e.prototype.playAttack=function(t){var e=this;this.anim.play(t==i.DIR_UP||t==i.DIR_DOWN?"AvatarAttackVertical":"AvatarAttackHorizontal");var o=0,a=0;switch(t){case i.DIR_UP:a=-16;break;case i.DIR_DOWN:a=16;break;case i.DIR_LEFT:case i.DIR_RIGHT:o=-16}cc.tween(this.spriteNode).stop(),cc.tween(this.spriteNode).to(.1,{position:cc.v3(o,a)}).to(.1,{position:cc.v3(-o,-a)}).to(.1,{position:cc.v3(0,0)}).delay(.1).call(function(){e.playAnim(i.STATE_IDLE,t)}).start()},e.prototype.cooking=function(){var t=this;this.isAniming=!0,this.scheduleOnce(function(){t.isAniming=!1},3)},e.prototype.drink=function(){var t=this;this.anim.play("AvatarDrink"),l.default.play(l.default.DRINK),this.isAniming=!0,this.scheduleOnce(function(){t.isAniming=!1},1.5)},e.prototype.toilet=function(){var t=this;this.isAniming=!0,this.scheduleOnce(function(){t.isAniming=!1},5)},e.prototype.sleep=function(){var t=this;this.isAniming=!0,this.scheduleOnce(function(){t.isAniming=!1},5)},e.prototype.read=function(){var t=this;this.isAniming=!0,this.scheduleOnce(function(){t.isAniming=!1},5)},e.prototype.start=function(){},e.DIR_UP=0,e.DIR_DOWN=1,e.DIR_LEFT=2,e.DIR_RIGHT=3,e.STATE_IDLE=0,e.STATE_WALK=1,e.STATE_ATTACK=2,e.STATE_FALL=3,e.STATE_DIE=4,e.STATE_JUMP=5,i=n([u],e)}(cc.Component));i.default=h,cc._RF.pop()},{"../manager/InventoryManager":"InventoryManager","../utils/AudioPlayer":"AudioPlayer","./Logic":"Logic"}],PlayerData:[function(t,e,i){"use strict";cc._RF.push(e,"802a53ZqslNorozVvKYFivM","PlayerData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./EquipmentData"),a=t("./DamageData"),n=t("./StatusData"),r=t("./CommonData"),s=t("../utils/Random"),l=t("./AvatarData"),c=t("./OilGoldData"),u=t("./TalentData"),h=t("../logic/Shield"),d=t("./LifeData"),p=function(){function t(){this.name="",this.pos=cc.v3(5,5),this.currentHealth=t.DEFAULT_HEALTH,this.currentDream=t.DEFAULT_DREAM,this.currentAmmo=0,this.equipmentTotalData=new o.default,this.statusTotalData=new n.default,this.avatarData=new l.default,this.oilGoldData=new c.default,this.organizationTalentData=new u.default,this.professionTalentData=new u.default,this.lifeData=new d.default,this.statusList=new Array,this.common=new r.default,this.common.maxHealth=t.DEFAULT_HEALTH,this.common.moveSpeed=t.DEFAULT_SPEED,this.common.damageMin=t.DEFAULT_ATTACK,this.common.damageBack=t.DEFAULT_BACK_ATTACK,this.common.maxDream=t.DEFAULT_DREAM,this.shadowList=[]}return Object.defineProperty(t.prototype,"ShadowList",{get:function(){return this.shadowList},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"StatusList",{get:function(){return this.statusList},set:function(t){if(t){this.statusList=new Array;for(var e=0,i=t;e<i.length;e++){var o=i[e],a=new n.default;a.valueCopy(o),this.statusList.push(a)}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"LifeData",{get:function(){return this.lifeData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"EquipmentTotalData",{get:function(){return this.equipmentTotalData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"StatusTotalData",{get:function(){return this.statusTotalData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AvatarData",{get:function(){return this.avatarData},set:function(t){this.avatarData=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"OilGoldData",{get:function(){return this.oilGoldData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"OrganizationTalentData",{get:function(){return this.organizationTalentData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ProfessionTalentData",{get:function(){return this.professionTalentData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Common",{get:function(){return this.common},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"FinalCommon",{get:function(){return(new r.default).add(this.common).add(this.statusTotalData.Common).add(this.equipmentTotalData.Common).add(this.avatarData.professionData.Common).add(this.oilGoldData.Common)},enumerable:!1,configurable:!0}),t.prototype.valueCopy=function(t){this.common.valueCopy(t.common),this.pos=t.pos?cc.v3(t.pos.x,t.pos.y):cc.v3(4,7),this.name=t.name?t.name:"",this.equipmentTotalData.valueCopy(t.equipmentTotalData),this.statusTotalData.valueCopy(t.statusTotalData),this.avatarData.valueCopy(t.avatarData),this.oilGoldData.valueCopy(t.oilGoldData),this.lifeData.valueCopy(t.lifeData),this.StatusList=t.statusList,this.currentHealth=t.currentHealth?t.currentHealth:0,this.currentDream=t.currentDream?t.currentDream:0,this.currentAmmo=t.currentAmmo?t.currentAmmo:0,this.common.maxHealth=t.common.maxHealth?t.common.maxHealth:0,this.common.moveSpeed=t.common.moveSpeed?t.common.moveSpeed:0,this.shadowList=t.shadowList},t.prototype.clone=function(){var e=new t;return e.common=this.common.clone(),e.pos=this.pos,e.name=this.name,e.currentHealth=this.currentHealth,e.currentDream=this.currentDream,e.currentAmmo=this.currentAmmo,e.equipmentTotalData=this.equipmentTotalData.clone(),e.statusTotalData=this.statusTotalData.clone(),e.avatarData=this.avatarData.clone(),e.oilGoldData=this.oilGoldData.clone(),e.organizationTalentData=this.organizationTalentData.clone(),e.professionTalentData=this.professionTalentData.clone(),e.lifeData=this.lifeData.clone(),e.StatusList=this.statusList,e.shadowList=this.shadowList,e},t.prototype.getFinalAttackPoint=function(){var t=this.FinalCommon,e=new a.default,i=t.damageMin,o=t.damageMax,n=t.criticalStrikeRate/100,r=s.default.rand()<n,c=r?i+o:i;return c<0&&(c=0),e.isCriticalStrike=r,e.realDamage=t.realDamage,e.magicDamage=t.magicDamage,e.physicalDamage=c,this.avatarData.organizationIndex==l.default.TECH&&(e.physicalDamage+=.5*this.currentDream),e},t.prototype.getFinalRemoteDamage=function(){var t=this.FinalCommon,e=new a.default,i=t.remoteDamage;this.avatarData.organizationIndex==l.default.HUNTER&&(i+=.5*this.currentDream);var o=t.remoteCritRate/100,n=s.default.rand()<o,r=n?i+i:i;return r<0&&(r=0),e.physicalDamage=r,e.isCriticalStrike=n,e},t.prototype.getDamage=function(t,e){var i=this.FinalCommon,o=t.clone(),a=i.defence,n=i.magicDefence/100,r=i.blockPhysical/100,s=i.blockMagic/100;return o.physicalDamage=a>=0?o.physicalDamage*(1-.06*a/(.06*a+1)):o.physicalDamage*(2-Math.pow(.94,-a)),o.magicDamage=o.magicDamage*(1-n),(o.physicalDamage>0||o.magicDamage>0)&&(e==h.default.BLOCK_NORMAL?(o.physicalDamage=o.physicalDamage*(1-r),o.magicDamage=o.magicDamage*(1-s)):e==h.default.BLOCK_PARRY&&(o.physicalDamage=0,o.magicDamage=0,o.realDamage=0)),o},t.prototype.getLifeDrain=function(){var t=this.FinalCommon,e=t.criticalStrikeRate/100,i=t.lifeDrain/100,o=0;return s.default.rand()<i&&(o=.2,s.default.rand()<e&&(o=1)),o},t.prototype.getMoveSpeed=function(){var e=this.FinalCommon.moveSpeed;return e>2*t.DEFAULT_SPEED&&(e=2*t.DEFAULT_SPEED),e<2*-t.DEFAULT_SPEED&&(e=2*-t.DEFAULT_SPEED),e},t.prototype.getHealth=function(t){var e=1,i=t.maxHealth;return this.lifeData.sanity<=0&&(i=1),i>0?(e=this.currentHealth/i,cc.v3(i*e,i)):cc.v3(1,1)},t.prototype.getDream=function(t){var e=1,i=t.maxDream;return this.lifeData.sanity<=0&&(i=1),i>0?(e=this.currentDream/i,cc.v3(i*e,i)):cc.v3(1,1)},t.DEFAULT_HEALTH=10,t.DEFAULT_SPEED=350,t.DEFAULT_ATTACK=1,t.DEFAULT_BACK_ATTACK=0,t.DEFAULT_DREAM=5,t}();i.default=p,cc._RF.pop()},{"../logic/Shield":"Shield","../utils/Random":"Random","./AvatarData":"AvatarData","./CommonData":"CommonData","./DamageData":"DamageData","./EquipmentData":"EquipmentData","./LifeData":"LifeData","./OilGoldData":"OilGoldData","./StatusData":"StatusData","./TalentData":"TalentData"}],PlayerInfoDialog:[function(t,e,i){"use strict";cc._RF.push(e,"15316LuMnlLl6y6PlDqoReo","PlayerInfoDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/AvatarData"),s=cc._decorator,l=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.attack=null,e.organization=null,e.criticalStrikeRate=null,e.defence=null,e.lifeDrain=null,e.damageBack=null,e.moveSpeed=null,e.attackSpeed=null,e.dodge=null,e.health=null,e.dream=null,e.realDamage=null,e.realRate=null,e.magicDamage=null,e.magicDefence=null,e.iceRate=null,e.fireRate=null,e.lighteningRate=null,e.toxicRate=null,e.curseRate=null,e.remoteDamage=null,e.remoteCritRate=null,e.remoteCooldown=null,e.sanity=null,e.solidSatiety=null,e.liquidSatiety=null,e.isShow=!1,e.layout=null,e}return a(e,t),e.prototype.onLoad=function(){this.attack=this.node.getChildByName("layout").getChildByName("attack").getChildByName("label").getComponent(cc.Label),this.organization=this.node.getChildByName("layout").getChildByName("organization").getChildByName("label").getComponent(cc.Label),this.criticalStrikeRate=this.node.getChildByName("layout").getChildByName("criticalStrikeRate").getChildByName("label").getComponent(cc.Label),this.defence=this.node.getChildByName("layout").getChildByName("defence").getChildByName("label").getComponent(cc.Label),this.lifeDrain=this.node.getChildByName("layout").getChildByName("lifeDrain").getChildByName("label").getComponent(cc.Label),this.damageBack=this.node.getChildByName("layout").getChildByName("damageBack").getChildByName("label").getComponent(cc.Label),this.moveSpeed=this.node.getChildByName("layout").getChildByName("moveSpeed").getChildByName("label").getComponent(cc.Label),this.attackSpeed=this.node.getChildByName("layout").getChildByName("attackSpeed").getChildByName("label").getComponent(cc.Label),this.dodge=this.node.getChildByName("layout").getChildByName("dodge").getChildByName("label").getComponent(cc.Label),this.health=this.node.getChildByName("layout").getChildByName("health").getChildByName("label").getComponent(cc.Label),this.dream=this.node.getChildByName("layout").getChildByName("dream").getChildByName("label").getComponent(cc.Label),this.realDamage=this.node.getChildByName("layout").getChildByName("realDamage").getChildByName("label").getComponent(cc.Label),this.realRate=this.node.getChildByName("layout").getChildByName("realRate").getChildByName("label").getComponent(cc.Label),this.magicDamage=this.node.getChildByName("layout").getChildByName("magicDamage").getChildByName("label").getComponent(cc.Label),this.magicDefence=this.node.getChildByName("layout").getChildByName("magicDefence").getChildByName("label").getComponent(cc.Label),this.iceRate=this.node.getChildByName("layout").getChildByName("iceRate").getChildByName("label").getComponent(cc.Label),this.fireRate=this.node.getChildByName("layout").getChildByName("fireRate").getChildByName("label").getComponent(cc.Label),this.lighteningRate=this.node.getChildByName("layout").getChildByName("lighteningRate").getChildByName("label").getComponent(cc.Label),this.toxicRate=this.node.getChildByName("layout").getChildByName("toxicRate").getChildByName("label").getComponent(cc.Label),this.curseRate=this.node.getChildByName("layout").getChildByName("curseRate").getChildByName("label").getComponent(cc.Label),this.remoteCooldown=this.node.getChildByName("layout").getChildByName("remoteCooldown").getChildByName("label").getComponent(cc.Label),this.remoteCritRate=this.node.getChildByName("layout").getChildByName("remoteCritRate").getChildByName("label").getComponent(cc.Label),this.remoteDamage=this.node.getChildByName("layout").getChildByName("remoteDamage").getChildByName("label").getComponent(cc.Label),this.sanity=this.node.getChildByName("layout").getChildByName("sanity").getChildByName("label").getComponent(cc.Label),this.solidSatiety=this.node.getChildByName("layout").getChildByName("solidSatiety").getChildByName("label").getComponent(cc.Label),this.liquidSatiety=this.node.getChildByName("layout").getChildByName("liquidSatiety").getChildByName("label").getComponent(cc.Label),this.layout=this.node.getChildByName("layout"),this.addSpriteTouchEvent()},e.prototype.start=function(){},e.prototype.refreshDialog=function(t,e,i){if(this.attack){var o=t.Common.clone().add(t.AvatarData.professionData.Common);this.organization.string=r.default.ORGANIZATION[t.AvatarData.organizationIndex],this.attack.string=this.getInfo(o.damageMin,e.Common.damageMin,i.Common.damageMin)+"    MAX:"+this.getInfo(o.damageMax,e.Common.damageMax,i.Common.damageMax),this.criticalStrikeRate.string=this.getInfo(o.criticalStrikeRate,e.Common.criticalStrikeRate,i.Common.criticalStrikeRate,!0),this.defence.string=this.getInfo(o.defence,e.Common.defence,i.Common.defence),this.lifeDrain.string=this.getInfo(o.lifeDrain,e.Common.lifeDrain,i.Common.lifeDrain,!0),this.damageBack.string=this.getInfo(o.damageBack,e.Common.damageBack,i.Common.damageBack),this.moveSpeed.string=this.getInfo(o.moveSpeed,e.Common.moveSpeed,i.Common.moveSpeed),this.attackSpeed.string=this.getInfo(o.attackSpeed,e.Common.attackSpeed,i.Common.attackSpeed),this.dodge.string=this.getInfo(o.dodge,e.Common.dodge,i.Common.dodge,!0),this.health.string=t.currentHealth.toFixed(1).replace(".0","")+"/"+this.getInfo(o.maxHealth,e.Common.maxHealth,i.Common.maxHealth),this.dream.string=t.currentDream.toFixed(1).replace(".0","")+"/"+this.getInfo(o.maxDream,e.Common.maxDream,i.Common.maxDream),this.realDamage.string=this.getInfo(o.realDamage,e.Common.realDamage,i.Common.realDamage),this.realRate.string=this.getInfo(o.realRate,e.Common.realRate,i.Common.realRate,!0),this.magicDamage.string=this.getInfo(o.magicDamage,e.Common.magicDamage,i.Common.magicDamage),this.magicDefence.string=this.getInfo(o.magicDefence,e.Common.magicDefence,i.Common.magicDefence,!0),this.iceRate.string=this.getInfo(o.iceRate,e.Common.iceRate,i.Common.iceRate,!0),this.fireRate.string=this.getInfo(o.fireRate,e.Common.fireRate,i.Common.fireRate,!0),this.lighteningRate.string=this.getInfo(o.lighteningRate,e.Common.lighteningRate,i.Common.lighteningRate,!0),this.toxicRate.string=this.getInfo(o.toxicRate,e.Common.toxicRate,i.Common.toxicRate,!0),this.curseRate.string=this.getInfo(o.curseRate,e.Common.curseRate,i.Common.curseRate,!0),this.remoteCritRate.string=this.getInfo(o.remoteCritRate,e.Common.remoteCritRate,i.Common.remoteCritRate,!0),this.remoteDamage.string=this.getInfo(o.remoteDamage,e.Common.remoteDamage,i.Common.remoteDamage),this.remoteCooldown.string=this.getInfo(o.remoteCooldown,e.Common.remoteCooldown,i.Common.remoteCooldown),this.sanity.string=this.getInfo(t.LifeData.sanity,0,0,!0),this.solidSatiety.string=this.getInfo(t.LifeData.solidSatiety,0,0,!0),this.liquidSatiety.string=this.getInfo(t.LifeData.liquidSatiety,0,0,!0)}},e.prototype.getInfo=function(t,e,i,o){var a=""+(t+e+i).toFixed(1).replace(".0","");return o&&(a+="%"),e>0?(a+=" E:+"+e.toFixed(1).replace(".0",""),o&&(a+="%")):e<0&&(a+=" E:"+e.toFixed(1).replace(".0",""),o&&(a+="%")),i>0?(a+=" S:+"+i.toFixed(1).replace(".0",""),o&&(a+="%")):i<0&&(a+=" S:"+i.toFixed(1).replace(".0",""),o&&(a+="%")),a},e.prototype.addSpriteTouchEvent=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_START,function(){t.isShow=!0}),this.node.on(cc.Node.EventType.TOUCH_END,function(){t.isShow=!1}),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.isShow=!1})},e.prototype.update=function(){this.layout.active=this.isShow},n([l],e)}(cc.Component));i.default=c,cc._RF.pop()},{"../data/AvatarData":"AvatarData"}],PlayerWeapon:[function(t,e,i){"use strict";cc._RF.push(e,"e3affyq+pdEIqRjlXOazN5E","PlayerWeapon");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./EventHelper"),s=t("./MeleeWeapon"),l=t("./Shooter"),c=t("../manager/InventoryManager"),u=t("./PlayerAvatar"),h=t("./MeleeShadowWeapon"),d=t("./Logic"),p=t("../utils/Random"),f=cc._decorator,g=f.ccclass,y=(f.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.player=null,e.meleeWeapon=null,e.shadowWeapon=null,e.shooter=null,e.isLeftHand=!1,e.isHeavyRemotoAttacking=!1,e.isShadow=!1,e.selfDefaultPos=cc.v3(-15,40),e.otherDefaultPos=cc.v3(20,40),e.handsUpPosX=32,e.handsUpPosY=32,e.handsUpPos=cc.v3(0,0),e.remoteIntervalTime=0,e.isCooling=!1,e.remoteAngleOffset=0,e.isHandsUp=!1,e.interactBuildingAttacking=!1,e.interactBuildingLift=!1,e}return a(e,t),e.prototype.init=function(t,e,i){this.isShadow=i,this.isLeftHand=e,this.player=t,this.initMelee(),this.initShooter(),e?(this.selfDefaultPos=cc.v3(20,40),this.otherDefaultPos=cc.v3(-15,40)):(this.selfDefaultPos=cc.v3(-15,40),this.otherDefaultPos=cc.v3(20,40))},e.prototype.initMelee=function(){this.isShadow?(this.shadowWeapon=this.getComponentInChildren(h.default),this.shadowWeapon.init(this.player,this.isLeftHand?this.player.weaponLeft.meleeWeapon:this.player.weaponRight.meleeWeapon)):(this.meleeWeapon=this.getComponentInChildren(s.default),this.meleeWeapon.IsSecond=this.isLeftHand)},e.prototype.initShooter=function(){this.shooter=this.getComponentInChildren(l.default),this.shooter.player=this.player,this.shooter.parentNode=this.player.node},e.prototype.handsUp=function(t,e,i){var o=this;this.isHandsUp&&t?(this.interactBuildingAttacking=i,this.interactBuildingLift=e):this.interactBuildingAttacking=!1,this.meleeWeapon.setWeaponInVisible(t),t&&!this.isHandsUp&&(this.isHandsUp=!0,this.handsUpPos=cc.v3(this.handsUpPosX,0),e&&this.scheduleOnce(function(){o.handsUpPos=cc.v3(0,o.handsUpPosY)},.1)),!t&&this.isHandsUp&&(this.isHandsUp=!1,this.handsUpPos=cc.v3(this.handsUpPosX,0),this.scheduleOnce(function(){o.handsUpPos=cc.v3(0,0)},.1))},e.prototype.changeZIndexByDir=function(t,e){switch(e){case u.default.DIR_UP:this.node.zIndex=t-1;break;case u.default.DIR_DOWN:this.node.zIndex=t+1;break;case u.default.DIR_LEFT:this.node.zIndex=this.isLeftHand?t+1:t-1;break;case u.default.DIR_RIGHT:this.node.zIndex=this.isLeftHand?t-1:t+1}},e.prototype.changeWeapon=function(t,e){switch(t.equipmetType){case c.default.WEAPON:this.meleeWeapon.changeEquipment(t,e);break;case c.default.REMOTE:this.shooter.data=t.clone(),this.shooter.changeRes(this.shooter.data.img);var i=cc.color(255,255,255).fromHEX(this.shooter.data.color);this.shooter.changeResColor(i)}},e.prototype.meleeAttack=function(t,e){this.meleeWeapon&&!this.meleeWeapon.IsAttacking&&this.meleeWeapon.attack(t,e)},e.prototype.remoteAttack=function(t,e,i,o){var a=this;if(this.isCooling)return!1;var n=!1,s=t.FinalCommon,l=s.remoteCooldown,c=s.remoteInterval;l<100&&(l=100),c<0&&(c=0);var u=Date.now(),h=u-this.remoteIntervalTime;return h>c&&(h<2*c?(this.remoteAngleOffset+=s.remoteAngle/5,this.remoteAngleOffset>s.remoteAngle&&(this.remoteAngleOffset=s.remoteAngle)):this.remoteAngleOffset=0,this.remoteIntervalTime=u,n=!0),!!n&&(t.currentAmmo--,this.isHeavyRemotoAttacking=1==this.shooter.data.isHeavy,this.scheduleOnce(function(){a.isHeavyRemotoAttacking=!1},.2),this.shooter&&(this.shooter.remoteDamagePlayer=t.getFinalRemoteDamage(),this.shooter.fireBullet(p.default.getRandomNum(-this.remoteAngleOffset,this.remoteAngleOffset),cc.v3(30,0),i,o)),t.currentAmmo<=0&&e&&(this.isCooling=!0,e.width=80,e.stopAllActions(),cc.tween(e).to(l/1e3,{width:0}).call(function(){t.currentAmmo=s.maxAmmo,a.isCooling=!1}).start()),r.EventHelper.emit(r.EventHelper.HUD_UPDATE_PLAYER_AMMO,{x:t.currentAmmo,y:s.maxAmmo}),!0)},e.prototype.updateLogic=function(t){var e=this.player.isFaceRight?this.handsUpPos.x:-this.handsUpPos.x;this.interactBuildingAttacking&&(e=0);var i=this.interactBuildingAttacking||!this.interactBuildingLift?0:this.handsUpPos.y;this.node.position=d.default.lerpPos(this.node.position,this.player.isFaceRight?this.selfDefaultPos.add(cc.v3(e,i)):this.otherDefaultPos.add(cc.v3(e,i)),5*t),this.meleeWeapon&&this.meleeWeapon.updateLogic(t),this.shooter&&this.shooter.updateLogic(t)},n([g],e)}(cc.Component));i.default=y,cc._RF.pop()},{"../manager/InventoryManager":"InventoryManager","../utils/Random":"Random","./EventHelper":"EventHelper","./Logic":"Logic","./MeleeShadowWeapon":"MeleeShadowWeapon","./MeleeWeapon":"MeleeWeapon","./PlayerAvatar":"PlayerAvatar","./Shooter":"Shooter"}],Player:[function(t,e,i){"use strict";cc._RF.push(e,"03570PUzDdNyIu4Asd1jFZT","Player");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=r.property,c=t("./Shooter"),u=t("./Logic"),h=t("./Dungeon"),d=t("./Achievement"),p=t("./PlayerAvatar"),f=t("./PlayerWeapon"),g=t("./EventHelper"),y=t("../actor/ShadowPlayer"),m=t("../base/Actor"),v=t("../data/AvatarData"),E=t("../data/DamageData"),_=t("../data/EquipmentData"),T=t("../data/FromData"),D=t("../data/StatusData"),S=t("../data/TalentData"),O=t("../effect/ShadowOfSight"),A=t("../equipment/Equipment"),C=t("../item/Item"),R=t("../manager/FloatingLabelManager"),L=t("../manager/InventoryManager"),b=t("../manager/LightManager"),P=t("../manager/StatusManager"),I=t("../talent/OrganizationTalent"),M=t("../talent/ProfessionTalent"),N=t("../talent/Talent"),w=t("../ui/Tips"),H=t("../utils/AudioPlayer"),x=t("../utils/IndexZ"),B=t("../utils/Random"),F=t("./MeleeWeapon"),k=t("./Shield"),j=t("../collider/CCollider"),G=t("../utils/Utils"),U=t("../utils/NextStep"),W=t("../data/LifeData"),q=t("../data/TriggerData"),Y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.floatinglabelManager=null,e.pos=null,e.walksmoke=null,e.smokePool=null,e.weaponLeft=null,e.weaponRight=null,e.shooterEx=null,e.statusManager=null,e.avatar=null,e.shield=null,e.remoteCooldown=null,e.shadowCamera=null,e.shadowPrefab=null,e.professionTalent=null,e.organizationTalent=null,e.isStone=!1,e.baseAttackPoint=1,e.touchDelay=!1,e.inventoryManager=null,e.currentDir=3,e.defaultPos=cc.v3(0,0),e.isWeaponDashing=!1,e.fistCombo=0,e.isAvoidDeathed=!1,e.shadowList=[],e.isLevelWater=!1,e.lastConsumeTime=0,e.solidStep=new U.default,e.liquidStep=new U.default,e.pooStep=new U.default,e.peeStep=new U.default,e.smokeTimeDelay=0,e.dreamTimeDelay=0,e.dreamLongTimeDelay=0,e.dreamShortTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.lastConsumeTime=u.default.realTime,this.entity.Move.linearDamping=5,this.entity.Move.linearVelocity=cc.v2(0,0),this.statusManager.statusIconList=this.statusIconList,this.inventoryManager=u.default.inventoryManager,this.data=u.default.playerData.clone(),this.updateStatus(this.data.StatusList,this.data.StatusTotalData),this.pos=cc.v3(0,0),this.sc.isDied=!1,this.isStone=!1,this.sc.isShow=!1,this.isLevelWater=u.default.worldLoader.getCurrentLevelData().isWater,this.scheduleOnce(function(){t.sc.isShow=!0,t.addSaveStatusList()},.5),this.initTalent(),this.initCollider(),this.weaponLeft.init(this,!0,!1),this.weaponRight.init(this,!1,!1),this.remoteCooldown.width=0,this.remoteCooldown.opacity=200,g.EventHelper.on(g.EventHelper.PLAYER_TRIGGER,function(e){t.node&&t.triggerThings(e&&e.isLongPress)}),g.EventHelper.on(g.EventHelper.PLAYER_EXIT_FROM_SETTINGS,function(){cc.director.loadScene("start")}),g.EventHelper.on(g.EventHelper.PLAYER_USEITEM,function(e){t.node&&t.useItem(e.itemData)}),g.EventHelper.on(g.EventHelper.PLAYER_SKILL,function(){t.node&&t.useSkill()}),g.EventHelper.on(g.EventHelper.PLAYER_SKILL1,function(){t.node&&t.useSkill1()}),g.EventHelper.on(g.EventHelper.PLAYER_UPDATE_OILGOLD_DATA,function(){t.node&&t.data.OilGoldData.valueCopy(u.default.playerData.OilGoldData)}),g.EventHelper.on(g.EventHelper.PLAYER_ATTACK,function(){t.useInteractBuilding(!0)||t.node&&t.meleeAttack()}),g.EventHelper.on(g.EventHelper.PLAYER_REMOTEATTACK_CANCEL,function(){t.shield&&t.shield.data.equipmetType==L.default.SHIELD&&t.shield.cancel(t.isFaceRight)}),g.EventHelper.on(g.EventHelper.PLAYER_REMOTEATTACK,function(){t.useInteractBuilding(!1)||(t.shield&&t.shield.data.equipmetType==L.default.SHIELD?t.shield.use(t.isFaceRight):t.node&&t.remoteAttack())}),g.EventHelper.on(g.EventHelper.PLAYER_USEDREAM,function(e){t.node&&t.data.AvatarData.organizationIndex==v.default.HUNTER&&t.updateDream(e.value)}),g.EventHelper.on(g.EventHelper.HUD_TIME_TICK,function(){t.node&&t.timeConsumeLife()}),u.default.playerData.pos.y==h.default.HEIGHT_SIZE-1&&(u.default.playerData.pos.y=h.default.HEIGHT_SIZE-2),this.pos=u.default.playerData.pos.clone(),this.defaultPos=u.default.playerData.pos.clone(),this.baseAttackPoint=u.default.playerData.FinalCommon.damageMin,this.updatePlayerPos(),this.entity.NodeRender.node=this.node,g.EventHelper.emit(g.EventHelper.CAMERA_LOOK,{pos:this.getCenterPosition(),isDirect:!0}),this.shooterEx.player=this,this.shooterEx.isEx=!0,this.smokePool=new cc.NodePool,g.EventHelper.on(g.EventHelper.POOL_DESTORY_WALKSMOKE,function(e){t.destroySmoke(e.coinNode)}),this.playerAnim(p.default.STATE_IDLE,this.currentDir),u.default.isCheatMode&&this.scheduleOnce(function(){t.addStatus(P.default.PERFECTDEFENCE,new T.default),t.data.Common.damageMin=499,t.data.Common.moveSpeed=999},.2),this.lights=this.getComponentsInChildren(O.default),b.default.registerLight(this.lights,this.node)},e.prototype.initShadowList=function(t,e,i){e>5&&(e=5),this.shadowTexture||(this.shadowTexture=new cc.RenderTexture,this.shadowTexture.initWithSize(this.shadowCamera.node.width,this.shadowCamera.node.height),this.shadowTexture.setFilters(cc.Texture2D.Filter.NEAREST,cc.Texture2D.Filter.NEAREST),this.shadowCamera.targetTexture=this.shadowTexture,this.shadowSpriteframe=new cc.SpriteFrame(this.shadowTexture));for(var o=0,a=this.shadowList;o<a.length;o++){var n=a[o];(n.isValid||n.enabled)&&n.stop()}if(this.shadowList=[],t)for(var r=Date.now(),s=0;s<e;s++)this.data.ShadowList[s]&&r-this.data.ShadowList[s]<1e3*i&&((l=cc.instantiate(this.shadowPrefab).getComponent(y.default)).init(this,this.shadowSpriteframe,s,i),this.shadowList.push(l));else for(s=0;s<e;s++){var l;(l=cc.instantiate(this.shadowPrefab).getComponent(y.default)).init(this,this.shadowSpriteframe,s,i),this.shadowList.push(l)}},e.prototype.addSaveStatusList=function(){this.statusManager&&this.statusManager.addStatusListFromSave(this.data.StatusList)},e.prototype.initTalent=function(){var t=this,e=new S.default,i=new S.default;e.valueCopy(u.default.talents["talent10"+this.data.AvatarData.organizationIndex]),i.valueCopy(u.default.talents[this.data.AvatarData.professionData.talent]),e.resName==this.data.OrganizationTalentData.resName&&e.valueCopy(this.data.OrganizationTalentData),i.resName==this.data.ProfessionTalentData.resName&&i.valueCopy(this.data.ProfessionTalentData),this.data.OrganizationTalentData.valueCopy(e),this.data.ProfessionTalentData.valueCopy(i),this.professionTalent=this.getComponent(M.default),this.organizationTalent=this.getComponent(I.default),this.scheduleOnce(function(){t.professionTalent.init(t.data.ProfessionTalentData),t.organizationTalent.init(t.data.OrganizationTalentData)},.1)},e.prototype.actorName=function(){return"Player"},e.prototype.turnStone=function(t){this.avatar.hitLight(t)},e.prototype.updateFistCombo=function(){this.weaponRight.meleeWeapon.IsFist?(this.fistCombo==F.default.COMBO1?this.fistCombo=F.default.COMBO2:this.fistCombo==F.default.COMBO2?this.fistCombo=F.default.COMBO3:(this.fistCombo,F.default.COMBO3,this.fistCombo=F.default.COMBO1),this.weaponLeft.meleeWeapon.IsComboing||this.weaponRight.meleeWeapon.IsComboing||(this.fistCombo=F.default.COMBO1)):this.fistCombo=F.default.COMBO1},e.prototype.takeDizz=function(t){var e=this;t>0&&!this.sc.isJumping&&(this.sc.isDizzing=!0,this.entity.Move.linearVelocity=cc.Vec2.ZERO,this.playerAnim(p.default.STATE_IDLE,this.currentDir),this.scheduleOnce(function(){e.sc.isDizzing=!1},t))},e.prototype.hideSelf=function(t){var e=this;t>0&&(this.invisible=!0,this.scheduleOnce(function(){e.stopHiding()},t))},e.prototype.stopHiding=function(){this.invisible=!1,this.statusManager.stopStatus(P.default.TALENT_INVISIBLE)},e.prototype.updateStatus=function(t,e){this.inventoryManager&&(this.data.StatusTotalData.valueCopy(e),this.data.StatusList=t,this.updateInfoUi())},e.prototype.getWalkSmoke=function(t,e){var i=null;this.smokePool.size()>0&&(i=this.smokePool.get()),i&&!i.active||(i=cc.instantiate(this.walksmoke)),this.isLevelWater&&!this.sc.isJumping&&(e=e.add(cc.v3(0,32))),i.parent=t,i.position=e,i.zIndex=x.default.ACTOR,i.opacity=255,i.active=!0},e.prototype.destroySmoke=function(t){t&&(t.active=!1,this.smokePool&&this.smokePool.put(t))},e.prototype.changeEquipment=function(t,e,i){switch(t){case L.default.WEAPON:this.weaponRight.meleeWeapon.changeEquipment(e,i);break;case L.default.REMOTE:this.weaponLeft.shooter.data=e.clone();var o=this.data.FinalCommon;(this.data.currentAmmo>o.maxAmmo||this.data.currentAmmo<=0)&&(this.data.currentAmmo=o.maxAmmo,g.EventHelper.emit(g.EventHelper.HUD_UPDATE_PLAYER_AMMO,{x:this.data.currentAmmo,y:o.maxAmmo})),this.weaponLeft.shooter.changeRes(this.weaponLeft.shooter.data.img);var a=cc.color(255,255,255).fromHEX(this.weaponLeft.shooter.data.color);this.weaponLeft.shooter.changeResColor(a),e.equipmetType!=L.default.EMPTY?(this.shield.data=new _.default,this.updateEquipment(this.shield.sprite,this.inventoryManager.equips[L.default.SHIELD].color,u.default.spriteFrameRes(L.default.EMPTY),1==this.shield.data.isHeavy?80:64),g.EventHelper.emit(g.EventHelper.HUD_CHANGE_CONTROLLER_SHIELD,{isShield:!1})):g.EventHelper.emit(g.EventHelper.HUD_CHANGE_CONTROLLER_SHIELD,{isShield:!0});break;case L.default.SHIELD:this.shield.data=e.clone(),this.shield.node.color=cc.Color.WHITE.fromHEX(e.color),this.updateEquipment(this.shield.sprite,e.color,i,1==this.shield.data.isHeavy?80:64),e.equipmetType!=L.default.EMPTY?(this.weaponLeft.shooter.data=new _.default,this.weaponLeft.shooter.changeRes(this.weaponLeft.shooter.data.img),g.EventHelper.emit(g.EventHelper.HUD_CHANGE_CONTROLLER_SHIELD,{isShield:!0})):g.EventHelper.emit(g.EventHelper.HUD_CHANGE_CONTROLLER_SHIELD,{isShield:!1});break;case L.default.HELMET:this.avatar.hairSprite.node.opacity=1==e.hideHair?0:255,this.updateEquipment(this.avatar.helmetSprite,e.color,i);break;case L.default.CLOTHES:this.updateEquipment(this.avatar.clothesSprite,e.color,i);break;case L.default.TROUSERS:var n=1==e.trouserslong;this.avatar.changeLegColor(n,e.color),this.updateEquipment(this.avatar.pantsSprite,e.color,i);break;case L.default.GLOVES:this.updateEquipment(this.weaponRight.meleeWeapon.GlovesSprite,e.color,i),this.updateEquipment(this.weaponLeft.meleeWeapon.GlovesSprite,e.color,i),this.updateEquipment(this.avatar.glovesLeftSprite,e.color,i),this.updateEquipment(this.avatar.glovesRightSprite,e.color,i);break;case L.default.SHOES:this.updateEquipment(this.avatar.shoesLeftSprite,e.color,i),this.updateEquipment(this.avatar.shoesRightSprite,e.color,i);break;case L.default.CLOAK:this.updateEquipment(this.avatar.cloakSprite,e.color,i)}this.avatar.changeEquipDirSpriteFrame(this.inventoryManager,this.currentDir),this.shield.changeZIndexByDir(this.avatar.node.zIndex,this.currentDir,this.isFaceRight),this.updateInfoUi()},e.prototype.updateEquipment=function(t,e,i,o){t.spriteFrame=i,o&&o>0&&(t.node.width=o,t.node.height=o);var a=cc.color(255,255,255).fromHEX(e);t.node.color=a},e.prototype.updateInfoUi=function(){var t=this.data.FinalCommon,e=this.data.getHealth(t),i=this.data.getDream(t),o=this.data.LifeData;g.EventHelper.emit(g.EventHelper.HUD_UPDATE_PLAYER_HEALTHBAR,{x:e.x,y:e.y}),g.EventHelper.emit(g.EventHelper.HUD_UPDATE_PLAYER_DREAMBAR,{x:i.x,y:i.y}),g.EventHelper.emit(g.EventHelper.HUD_UPDATE_PLAYER_LIFE_BAR,{sanity:o.sanity,solid:o.solidSatiety,poo:o.poo,liquid:o.liquidSatiety,pee:o.pee}),this.inventoryManager.updateTotalEquipData(),this.data.EquipmentTotalData.valueCopy(this.inventoryManager.TotalEquipData),cc.director.emit(g.EventHelper.HUD_UPDATE_PLAYER_INFODIALOG,{detail:{data:this.data}})},e.prototype.getCenterPosition=function(){return this.entity.Transform.position.clone()},e.prototype.updatePlayerPos=function(){this.entity.Transform.position=h.default.getPosInMap(this.pos),this.node.position=this.entity.Transform.position.clone()},e.prototype.transportPlayer=function(t){this.avatar.spriteNode&&(this.avatar.spriteNode.angle=0,this.avatar.spriteNode.scale=5,this.avatar.spriteNode.opacity=255,this.avatar.spriteNode.x=0,this.avatar.spriteNode.y=0,this.pos=t,this.changeZIndex(this.pos),this.updatePlayerPos())},e.prototype.changeZIndex=function(){this.node.zIndex=x.default.getActorZIndex(this.entity.Transform.position)},e.prototype.addStatus=function(t,e){this.node&&!this.sc.isDied&&this.statusManager.addStatus(t,e)},e.prototype.addCustomStatus=function(t,e){this.node&&!this.sc.isDied&&this.statusManager.addCustomStatus(t,e)},Object.defineProperty(e.prototype,"IsVariation",{get:function(){return this.data.StatusTotalData.variation>0},enumerable:!1,configurable:!0}),e.prototype.stopAllDebuffs=function(){this.node&&this.statusManager.stopAllDebuffs()},Object.defineProperty(e.prototype,"isInteractBuildingAniming",{get:function(){return this.interactBuilding&&this.interactBuilding.isTaken&&this.interactBuilding.isAniming},enumerable:!1,configurable:!0}),e.prototype.meleeAttack=function(){var t=this;if(!(!this.weaponRight||this.sc.isDizzing||this.sc.isDied||this.sc.isFalling||this.sc.isJumping||this.sc.isVanishing||this.isInteractBuildingAniming||this.weaponLeft.meleeWeapon.IsAttacking&&this.weaponLeft.meleeWeapon.IsFist||this.weaponRight.meleeWeapon.IsAttacking&&this.weaponRight.meleeWeapon.IsFist||this.shield.isDefendOrParrying)){this.updateFistCombo();var e=!1;if(this.fistCombo==F.default.COMBO1){if(e=this.weaponRight.meleeWeapon.attack(this.data,this.fistCombo),this.weaponLeft.meleeWeapon.attackIdle(!1),e)for(var i=0,o=this.shadowList;i<o.length;i++)o[i].attack(this.data,this.fistCombo,this.weaponRight.meleeWeapon.Hv,!1)}else if(this.fistCombo==F.default.COMBO2){if(this.weaponRight.meleeWeapon.attackIdle(!0),e=this.weaponLeft.meleeWeapon.attack(this.data,this.fistCombo))for(var a=0,n=this.shadowList;a<n.length;a++)n[a].attack(this.data,this.fistCombo,this.weaponLeft.meleeWeapon.Hv,!0)}else if(this.fistCombo==F.default.COMBO3){if(e=this.weaponRight.meleeWeapon.attack(this.data,this.fistCombo),this.weaponRight.meleeWeapon.DashTime(400),e)for(var r=0,s=this.shadowList;r<s.length;r++)s[r].attack(this.data,this.fistCombo,this.weaponRight.meleeWeapon.Hv,!1);this.scheduleOnce(function(){if(t.weaponLeft.meleeWeapon.attack(t.data,t.fistCombo))for(var e=0,i=t.shadowList;e<i.length;e++)i[e].attack(t.data,t.fistCombo,t.weaponLeft.meleeWeapon.Hv,!0)},.15)}if(e){var l=this.weaponRight.meleeWeapon.Hv.clone();if(!this.shield.isAniming&&!this.shield.isDefendOrParrying){var c=this.isFaceRight;this.isFaceRight=l.x>0,c!=this.isFaceRight&&this.shield.faceRightChange(this.isFaceRight)}this.isFaceUp=l.y>0,this.playerAnim(p.default.STATE_ATTACK,this.currentDir),this.stopHiding()}}},e.prototype.useShield=function(){!this.weaponRight||this.sc.isDizzing||this.sc.isDied||this.sc.isFalling||this.sc.isJumping||this.sc.isVanishing||this.weaponRight.meleeWeapon.IsAttacking||this.weaponLeft.meleeWeapon.IsAttacking||this.isInteractBuildingAniming||this.shield.Status!=k.default.STATUS_PARRY&&(this.shield.Status,k.default.STATUS_PUTDOWN)},e.prototype.useInteractBuilding=function(t){return!!this.interactBuilding&&!!this.interactBuilding.isTaken&&(!!this.interactBuilding.isAniming||(this.stopHiding(),this.playerAnim(p.default.STATE_ATTACK,this.currentDir),this.interactBuilding.interact(this,!1,t,!t)))},e.prototype.remoteAttack=function(){if(!(!this.data||this.sc.isDizzing||this.sc.isDied||this.sc.isFalling||this.sc.isVanishing||!this.weaponLeft.shooter||this.sc.isJumping)){var t=0,e=0;if(this.professionTalent.hashTalent(N.default.TALENT_005)&&this.professionTalent.IsExcuting&&(t=2,e=1),this.weaponLeft.shooter.data.bulletSize=this.IsVariation?.5:0,this.weaponLeft.remoteAttack(this.data,this.remoteCooldown,t,e)){for(var i=0,o=this.shadowList;i<o.length;i++)o[i].remoteAttack(!0,this.weaponLeft.shooter.data,this.weaponLeft.shooter.Hv,this.data.getFinalRemoteDamage(),t,e);this.stopHiding(),this.exTrigger(q.default.GROUP_ATTACK,q.default.TYPE_ATTTACK_REMOTE,null,null)}}},e.prototype.exTrigger=function(t,e,i,o,a){if(!a)for(var n=0,r=this.inventoryManager.TotalEquipData.exTriggers;n<r.length;n++){var s=r[n];this.exTriggerDo(s,t,e,i,o)}for(var l=0,c=this.inventoryManager.itemList;l<c.length;l++)for(var u=0,h=c[l].exTriggers;u<h.length;u++)s=h[u],this.exTriggerDo(s,t,e,i,o)},e.prototype.exTriggerDo=function(t,e,i,o,a){if(t.group==e&&t.type==i)switch(t.id){case q.default.ID_STATUS:this.exTriggerStatus(t,o,a);break;case q.default.ID_BULLET:this.exTriggerBullet(t);break;case q.default.ID_TALENT:}},e.prototype.exTriggerBullet=function(t){var e=t.count,i=!0;if(e<1?(i=B.default.rand()<e,e=1):e=Math.floor(e),i)if(e>1)for(var o=0;o<e;o++)this.exTriggerBulletDo(t);else this.exTriggerBulletDo(t)},e.prototype.exTriggerBulletDo=function(t){var e=this,i=t.bulletInterval?t.bulletInterval:100,o=t.maxAmmo?t.maxAmmo:0;o>1?this.schedule(function(){e.exTriggerBulletFire(t)},i,o-1):this.exTriggerBulletFire(t)},e.prototype.exTriggerBulletFire=function(t){var e=t.bulletAngle?t.bulletAngle:0;this.shooterEx.data.bulletType=t.res,this.shooterEx.data.bulletArcExNum=t.bulletArcExNum,this.shooterEx.data.bulletLineExNum=t.bulletLineExNum,this.shooterEx.data.bulletSize=t.bulletSize,this.shooterEx.data.bulletSize+=this.IsVariation?.5:0,this.shooterEx.data.bulletExSpeed=t.bulletSpeed;var i=B.default.getRandomNum(-e,e);this.shooterEx.fireBullet(i,cc.v3(t.bulletOffsetX,24));for(var o=0,a=this.shadowList;o<a.length;o++){var n=a[o];n.node&&(n.shooterEx.setHv(this.shooterEx.Hv),n.shooterEx.data=this.shooterEx.data.clone(),n.shooterEx.fireBullet(i,cc.v3(t.bulletOffsetX,24)))}},e.prototype.exTriggerStatus=function(t,e,i){var o=t.count,a=!0;if(o<1?(a=B.default.rand()<o,o=1):o=Math.floor(o),a)for(var n=0;n<o;n++)q.default.TARGET_OTHER==t.target&&i&&i.addStatus(t.res,new T.default),q.default.TARGET_OTHER_NEAREST==t.target?P.default.addStatus2NearEnemy(this,t.res,e):q.default.TARGET_SELF==t.target?this.addStatus(t.res,new T.default):q.default.TARGET_ALL_ALLY==t.target?P.default.addStatus2NearAllies(this,this.node,t.res,t.range,e):q.default.TARGET_ALL_ENEMY==t.target?P.default.addStatus2NearEnemies(this,this.node,t.res,t.range,e):q.default.TARGET_ALL==t.target&&(this.addStatus(t.res,new T.default),P.default.addStatus2NearEnemies(this,this.node,t.res,t.range,e),P.default.addStatus2NearAllies(this,this.node,t.res,t.range,e))},e.prototype.move=function(t,e){if(!(this.sc.isDied||this.sc.isFalling||this.sc.isDizzing||!this.sc.isShow||this.sc.isVanishing)){e.equals(cc.Vec3.ZERO)||(e=e.mul(this.weaponRight.meleeWeapon.getMeleeSlowRatio())),e.equals(cc.Vec3.ZERO)||(e=e.mul(this.weaponLeft.meleeWeapon.getMeleeSlowRatio())),this.weaponLeft.isHeavyRemotoAttacking&&!e.equals(cc.Vec3.ZERO)&&(e=e.mul(.01)),1==this.shield.data.isHeavy&&this.shield.Status>k.default.STATUS_IDLE&&(e=e.mul(.5)),this.interactBuilding&&this.interactBuilding.isTaken&&(e=e.mul(.5)),this.professionTalent.IsExcuting&&this.professionTalent.hashTalent(N.default.TALENT_007)&&!e.equals(cc.Vec3.ZERO)&&(e=e.mul(.01)),this.isLevelWater&&!this.sc.isJumping&&(e=e.mul(.5)),e.equals(cc.Vec3.ZERO)||(this.pos=h.default.getIndexInMap(this.entity.Transform.position),this.data.pos=this.pos.clone()),e.equals(cc.Vec3.ZERO)||(this.shooterEx.setHv(cc.v2(e.x,e.y)),this.weaponLeft.shooter.setHv(cc.v2(e.x,e.y)),this.weaponRight.shooter.setHv(cc.v2(e.x,e.y)));var i=e.x,o=e.y,a=Math.abs(i),n=Math.abs(o),r=a>n?a:n;r=0==r?1:r;var s=cc.v2(i,o),l=this.data.getMoveSpeed();l<0&&(l=0),s=s.mul(l),this.entity.Move.linearVelocity=s,this.sc.isMoving=0!=i||0!=o,!this.weaponRight.meleeWeapon||e.equals(cc.Vec3.ZERO)||this.weaponRight.meleeWeapon.IsAttacking||(this.weaponRight.meleeWeapon.Hv=cc.v2(e.x,e.y)),!this.weaponLeft.meleeWeapon||e.equals(cc.Vec3.ZERO)||this.weaponLeft.meleeWeapon.IsAttacking||(this.weaponLeft.meleeWeapon.Hv=cc.v2(e.x,e.y)),!this.sc.isMoving||this.weaponLeft.meleeWeapon.IsAttacking||this.weaponRight.meleeWeapon.IsAttacking||(this.shield.isAniming||this.shield.isDefendOrParrying||(this.isFaceRight=this.weaponLeft.meleeWeapon.Hv.x>0,this.isFaceRight!=this.isFaceRight&&this.shield.faceRightChange(this.isFaceRight)),this.isFaceUp=this.weaponLeft.meleeWeapon.Hv.y>0),this.sc.isJumping||(this.sc.isMoving&&!this.isStone?this.playerAnim(p.default.STATE_WALK,t):this.playerAnim(p.default.STATE_IDLE,t)),4!=t&&this.changeZIndex(this.pos),4==t||this.shield.isAniming||this.shield.isDefendOrParrying||this.avatar.isAniming||(this.currentDir=t,t==p.default.DIR_DOWN&&this.isFaceUp?t=p.default.DIR_UP:t!=p.default.DIR_UP||this.isFaceUp||(t=p.default.DIR_DOWN),this.weaponLeft.changeZIndexByDir(this.avatar.node.zIndex,t),this.weaponRight.changeZIndexByDir(this.avatar.node.zIndex,t),this.avatar.changeEquipDirSpriteFrame(this.inventoryManager,t),this.shield.changeZIndexByDir(this.avatar.node.zIndex,t,this.isFaceRight),this.avatar.changeAvatarByDir(t))}},e.prototype.playerAnim=function(t,e){switch(t==p.default.STATE_IDLE&&this.avatar.status!=p.default.STATE_IDLE&&(this.weaponLeft.shooter.playWalk(!1),this.weaponRight.shooter.playWalk(!1)),t){case p.default.STATE_IDLE:this.avatar.status!=p.default.STATE_IDLE&&(this.weaponLeft.shooter.playWalk(!1),this.weaponRight.shooter.playWalk(!1));break;case p.default.STATE_WALK:this.avatar.status!=p.default.STATE_ATTACK&&(this.weaponLeft.shooter.playWalk(!0),this.weaponRight.shooter.playWalk(!0));break;case p.default.STATE_ATTACK:this.weaponLeft.shooter.playWalk(!0),this.weaponRight.shooter.playWalk(!0);break;case p.default.STATE_FALL:case p.default.STATE_DIE:}this.avatar.playAnim(t,e)},e.prototype.start=function(){this.node&&(this.changeZIndex(this.pos),this.updateInfoUi())},e.prototype.fall=function(){var t=this;this.sc.isFalling||this.sc.isJumping||this.sc.isVanishing||(this.sc.isFalling=!0,this.avatar.playAnim(p.default.STATE_FALL,this.currentDir),this.scheduleOnce(function(){t.transportPlayer(t.defaultPos),t.playerAnim(p.default.STATE_IDLE,1);var e=new E.default;e.realDamage=1,t.takeDamage(e,T.default.getClone("\u8dcc\u843d","")),t.sc.isFalling=!1},2))},Object.defineProperty(e.prototype,"CanJump",{get:function(){return!(this.sc.isDied||this.sc.isFalling||this.sc.isDizzing||!this.sc.isShow||this.sc.isJumping||this.sc.isVanishing||this.weaponRight.meleeWeapon.IsAttacking||this.weaponLeft.meleeWeapon.IsAttacking||this.isInteractBuildingAniming)},enumerable:!1,configurable:!0}),e.prototype.vanish=function(t){var e=this;this.sc.isVanishing=!0,this.scheduleOnce(function(){e.sc.isVanishing=!1},t)},e.prototype.jump=function(){var t=this;this.CanJump&&(this.sc.isJumping=!0,this.scheduleOnce(function(){t.weaponLeft.node.opacity=0,t.weaponRight.node.opacity=0,t.shield.node.opacity=0},.1),this.avatar.playAnim(p.default.STATE_JUMP,this.currentDir),this.scheduleOnce(function(){t.avatar.playAnim(p.default.STATE_IDLE,t.currentDir),t.sc.isJumping=!1,t.weaponLeft.node.opacity=255,t.weaponRight.node.opacity=255,t.shield.node.opacity=255},1.3))},e.prototype.takeDamage=function(t,e,i){if(!this.data||this.sc.isJumping||this.sc.isDied||this.sc.isVanishing)return!1;var o=this.data.FinalCommon,a=this.shield.blockDamage(this,t,e,i),n=this.data.getDamage(t,a),r=o.dodge/100,s=B.default.rand()<=r&&n.getTotalDamage()>0;this.professionTalent.hashTalent(N.default.TALENT_015)&&this.professionTalent.IsExcuting&&n.getTotalDamage()>0&&(s=!0);var l=!1;this.organizationTalent.takeDamage(n,i)&&(n=new E.default,l=!0),n=s?new E.default:n;var c=this.data.getHealth(o),u=n.getTotalDamage();if(u>0&&this.data.AvatarData.organizationIndex==v.default.GURAD){var h=this.updateDream(u);h<u&&this.exTrigger(q.default.GROUP_HURT,q.default.TYPE_HURT_DREAM,e,i),u=h}c.x-=u,c.x>c.y&&(c.x=c.y),this.data.currentHealth=c.x;var d=!1;this.data.currentHealth<=0&&(!this.isAvoidDeathed&&this.data.StatusTotalData.avoidDeath>0?(this.isAvoidDeathed=!0,d=!0,this.data.currentHealth=0):this.killed(e)),g.EventHelper.emit(g.EventHelper.HUD_UPDATE_PLAYER_HEALTHBAR,{x:c.x,y:c.y}),this.showFloatFont(this.node.parent,n.getTotalDamage(),s,!1,!1,l,d),s&&this.exTrigger(q.default.GROUP_HURT,q.default.TYPE_HURT_DODGE,e,i);var p=!s&&n.getTotalDamage()>0;return p&&this.exTrigger(q.default.GROUP_HURT,q.default.TYPE_HURT,e,i),(p||a==k.default.BLOCK_PARRY)&&this.showDamageEffect(a,e,i),p},e.prototype.updateDream=function(t){var e=this.data.getDream(this.data.FinalCommon);e.x-=t;var i=-e.x;return e.x>e.y&&(e.x=e.y),e.x<0&&(e.x=0),this.data.currentDream=e.x,g.EventHelper.emit(g.EventHelper.HUD_UPDATE_PLAYER_DREAMBAR,{x:e.x,y:e.y}),i<0?0:i},e.prototype.showDamageEffect=function(t){cc.director.emit(g.EventHelper.CAMERA_SHAKE,{detail:{isHeavyShaking:!1}}),t==k.default.BLOCK_NORMAL?(H.default.play(H.default.BOSS_ICEDEMON_HIT),cc.director.emit(g.EventHelper.HUD_DAMAGE_CORNER_SHOW)):t==k.default.BLOCK_PARRY?H.default.play(H.default.MELEE_PARRY):(H.default.play(H.default.PLAYER_HIT),cc.director.emit(g.EventHelper.HUD_DAMAGE_CORNER_SHOW))},e.prototype.showFloatFont=function(t,e,i,o,a,n,r){if(this.floatinglabelManager){var s=this.floatinglabelManager.getFloaingLabel(t);i?s.showDoge():o?s.showMiss():n?s.showBlock():r?s.showAvoidDeath():0!=e&&e?s.showDamage(-e,a):s.hideLabel()}},e.prototype.killed=function(t){this.sc.isDied||(this.sc.isDied=!0,this.avatar.playAnim(p.default.STATE_DIE,this.currentDir),g.EventHelper.emit(g.EventHelper.HUD_STOP_COUNTTIME),this.scheduleOnce(function(){g.EventHelper.emit(g.EventHelper.HUD_FADE_OUT)},1.5),H.default.play(H.default.DIE),g.EventHelper.emit(g.EventHelper.HUD_LOSE_OILGOLD),g.EventHelper.emit(g.EventHelper.DUNGEON_DISAPPEAR),g.EventHelper.emit(g.EventHelper.HUD_OILGOLD_LOSE_SHOW),d.default.addPlayerDiedLifesAchievement(),this.weaponLeft.node.opacity=0,this.weaponRight.node.opacity=0,u.default.dieFrom.valueCopy(t),u.default.setKillPlayerCounts(t,!0),u.default.saveData(),this.scheduleOnce(function(){cc.audioEngine.stopMusic(),cc.director.loadScene("gameover")},3),this.dungeon.darkAfterKill())},e.prototype.playerAction=function(t,e,i,o){this.dungeon=o,this.weaponLeft.meleeWeapon&&!this.weaponLeft.meleeWeapon.dungeon&&(this.weaponLeft.meleeWeapon.dungeon=o,this.weaponLeft.shooter.dungeon=o,this.weaponRight.meleeWeapon.dungeon=o,this.weaponRight.shooter.dungeon=o,this.shooterEx.dungeon=o);for(var a=0,n=this.shadowList;a<n.length;a++){var r=n[a];r.node&&!r.weaponLeft.shadowWeapon.dungeon&&(r.weaponLeft.shadowWeapon.dungeon=o,r.weaponLeft.shooter.dungeon=o,r.weaponRight.shadowWeapon.dungeon=o,r.weaponRight.shooter.dungeon=o,r.shooterEx.dungeon=o)}if(this.sc.isShow){var s=this.professionTalent.hashTalent(N.default.TALENT_015)&&this.professionTalent.IsExcuting;!this.professionTalent||s||this.isWeaponDashing||this.avatar.isAniming||this.move(t,e,i)}},e.prototype.isSmokeTimeDelay=function(t){return this.smokeTimeDelay+=t,this.smokeTimeDelay>.3&&(this.smokeTimeDelay=0,!0)},e.prototype.isDreamTimeDelay=function(t){return this.dreamTimeDelay+=t,this.dreamTimeDelay>5&&(this.dreamTimeDelay=0,!0)},e.prototype.isDreamShortTimeDelay=function(t){return this.dreamShortTimeDelay+=t,this.dreamShortTimeDelay>1&&(this.dreamShortTimeDelay=0,!0)},e.prototype.isDreamLongTimeDelay=function(t){return this.dreamLongTimeDelay+=t,this.dreamLongTimeDelay>20&&(this.dreamLongTimeDelay=0,!0)},e.prototype.update=function(t){if(!u.default.isGamePause){this.isSmokeTimeDelay(t)&&this.sc.isMoving&&!this.sc.isJumping&&this.getWalkSmoke(this.node.parent,this.entity.Transform.position),this.isDreamLongTimeDelay(t)&&this.updateDream(-1),this.dungeon&&this.dungeon.isClear&&this.isDreamShortTimeDelay(t)&&this.data.AvatarData.organizationIndex==v.default.FOLLOWER&&this.updateDream(-1),this.isDreamTimeDelay(t)&&this.data.AvatarData.organizationIndex==v.default.TECH&&this.updateDream(1);var e=this.isStone;this.isStone=this.statusManager.hasStatus(P.default.STONE),e==!this.isStone&&this.turnStone(this.isStone),this.node.scaleX=this.getScaleSize(),this.avatar.node.scaleX=this.isFaceRight?1:-1,this.node.scaleY=this.getScaleSize(),this.node.opacity=this.invisible?80:255,this.sc.isVanishing&&(this.node.opacity=0);var i=this.interactBuilding&&this.interactBuilding.isTaken&&!this.interactBuilding.isThrowing,o=this.interactBuilding&&this.interactBuilding.isTaken&&this.interactBuilding.isLift;this.weaponLeft&&(this.weaponLeft.updateLogic(t),this.weaponLeft.handsUp(i,o,this.interactBuilding&&this.interactBuilding.isAttacking)),this.weaponRight&&(this.weaponRight.updateLogic(t),this.weaponRight.handsUp(i,o,this.interactBuilding&&this.interactBuilding.isAttacking)),this.avatar&&this.avatar.showLegsWithWater(this.isLevelWater&&!this.sc.isJumping),this.showUiButton();for(var a=0,n=this.shadowList;a<n.length;a++){var r=n[a];r.node&&r.updateLogic(t)}}},e.prototype.getScaleSize=function(){return this.IsVariation?1.5:1},e.prototype.useSkill=function(){!this.professionTalent||this.sc.isJumping||this.sc.isAttacking||this.sc.isVanishing||this.professionTalent.useSKill()},e.prototype.useSkill1=function(){!this.organizationTalent||this.sc.isJumping||this.sc.isAttacking||this.sc.isVanishing||this.organizationTalent.useSKill()},e.prototype.triggerThings=function(t){!this.sc.isJumping&&this.dungeon&&(this.dungeon.equipmentManager.lastGroundEquip&&this.dungeon.equipmentManager.lastGroundEquip.taken(t)&&(this.dungeon.equipmentManager.lastGroundEquip=null),this.dungeon.itemManager.lastGroundItem&&this.dungeon.itemManager.lastGroundItem.taken(this,t)&&(this.dungeon.itemManager.lastGroundItem=null),this.interactBuilding&&this.interactBuilding.isTaken?this.interactBuilding.interact(this,t,!1,!1):this.dungeon.buildingManager.lastInteractBuilding&&this.dungeon.buildingManager.lastInteractBuilding.taken(this,t)&&(this.interactBuilding=this.dungeon.buildingManager.lastInteractBuilding,this.dungeon.buildingManager.lastInteractBuilding=null),this.touchedTips&&this.touchedTips.next(t,this))},e.prototype.showUiButton=function(){this.dungeon&&(this.dungeon.equipmentManager.lastGroundEquip||this.dungeon.itemManager.lastGroundItem||this.dungeon.buildingManager.lastInteractBuilding||this.interactBuilding&&this.interactBuilding.isTaken||this.touchedTips?g.EventHelper.emit(g.EventHelper.HUD_CONTROLLER_INTERACT_SHOW,{isShow:!0}):g.EventHelper.emit(g.EventHelper.HUD_CONTROLLER_INTERACT_SHOW,{isShow:!1}),this.shield&&this.shield.data.equipmetType==L.default.SHIELD||this.interactBuilding&&this.interactBuilding.isTaken||this.weaponLeft.shooter.data.equipmetType==L.default.REMOTE?g.EventHelper.emit(g.EventHelper.HUD_CONTROLLER_REMOTE_SHOW,{isShow:!0}):g.EventHelper.emit(g.EventHelper.HUD_CONTROLLER_REMOTE_SHOW,{isShow:!1}))},e.prototype.onColliderEnter=function(t,e){e.tag==j.default.TAG.PLAYER_INTERACT&&(this.touchedTips=null)},e.prototype.onColliderStay=function(t,e){var i=this;if(e.tag==j.default.TAG.PLAYER_INTERACT){if(this.touchDelay)return;var o=!1;t.node.getComponent(A.default)&&(o=!0),t.node.getComponent(C.default)&&(o=!0);var a=t.node.getComponent(w.default);a&&(o=!0,this.touchedTips=a),o&&(this.touchDelay=!0,this.scheduleOnce(function(){i.touchDelay=!1},.1))}},e.prototype.onColliderExit=function(t,e){e.tag==j.default.TAG.PLAYER_INTERACT&&(this.touchedTips=null)},e.prototype.onColliderPreSolve=function(t,e){t.tag!=j.default.TAG.NONPLAYER&&t.tag!=j.default.TAG.GOODNONPLAYER||(e.disabledOnce=!0)},Object.defineProperty(e.prototype,"Hv",{get:function(){return this.weaponRight.meleeWeapon.Hv},enumerable:!1,configurable:!0}),e.prototype.useItem=function(t){C.default.userIt(t,this),this.exTrigger(q.default.GROUP_USE,q.default.TYPE_USE_ITEM,null,null,!0)},e.prototype.setLinearVelocity=function(){},e.prototype.timeConsumeLife=function(){var t=this,e=u.default.realTime-this.lastConsumeTime;this.lastConsumeTime=u.default.realTime;var i=this.data.LifeData,o=W.default.SOLID_LOSS*i.timeScale*e/1e3,a=W.default.LIQUID_LOSS*i.timeScale*e/1e3,n=i.solidSatiety>0,r=i.liquidSatiety>0;n&&(i.poo+=o*W.default.POO_RATE,i.poo>100&&(i.poo=100,this.pooStep.next(function(){t.sanityChange(-1),G.default.toast("\u4f60\u7684\u809a\u5b50\u4e00\u9635\u7ffb\u817e\u3002",!1,!0)},30))),r&&(i.pee+=a*W.default.PEERATE,i.pee>100&&(i.pee=100,this.peeStep.next(function(){t.sanityChange(-1),G.default.toast("\u4f60\u7684\u8180\u80f1\u5feb\u8981\u70b8\u4e86\u3002",!1,!0)},30))),this.data.LifeData.solidSatiety<=0&&this.solidStep.next(function(){t.sanityChange(-1),G.default.toast("\u4f60\u5feb\u8981\u997f\u6b7b\u4e86\u3002",!1,!0)},30),this.data.LifeData.liquidSatiety<=0&&this.liquidStep.next(function(){t.sanityChange(-1),G.default.toast("\u4f60\u5feb\u8981\u6e34\u6b7b\u4e86\u3002",!1,!0)},30),this.updateLife(0,-o,-a)},e.prototype.updateLife=function(t,e,i){if(this.data.LifeData.sanity+=t,this.data.LifeData.solidSatiety+=e,this.data.LifeData.liquidSatiety+=i,this.data.LifeData.sanity>100)this.data.LifeData.sanity=100;else if(this.data.LifeData.sanity<=0){if(this.data.LifeData.sanity=0,0!=t){G.default.toast("\u7cbe\u795e\u5d29\u6e83\u4e86\u3002\u3002\u3002",!1,!0);var o=new D.default;o.valueCopy(u.default.status[P.default.INSANE]),o.Common.damageMin+=this.data.getFinalAttackPoint().physicalDamage,this.addCustomStatus(o,new T.default)}}else this.statusManager.stopStatus(P.default.INSANE);this.data.LifeData.solidSatiety>100?this.data.LifeData.solidSatiety=100:this.data.LifeData.solidSatiety<0&&(this.data.LifeData.solidSatiety=0),this.data.LifeData.liquidSatiety>100?this.data.LifeData.liquidSatiety=100:this.data.LifeData.liquidSatiety<0&&(this.data.LifeData.liquidSatiety=0),this.updateInfoUi()},e.prototype.sanityChange=function(t){if(0!=t){var e=new D.default;t>0?e.valueCopy(u.default.status[P.default.SANITY_UP]):t<0&&e.valueCopy(u.default.status[P.default.SANITY_DOWN]),e.sanityDirect=t,this.addCustomStatus(e,new T.default)}},e.prototype.sleep=function(){this.avatar.sleep()},e.prototype.toilet=function(){this.avatar.toilet(),cc.tween(this.data.LifeData).to(3,{poo:0,pee:0}).call(function(){G.default.toast("\u4f60\u611f\u89c9\u4e00\u8eab\u8f7b\u677e\u3002",!1,!0)}).start(),this.data.LifeData.pee+this.data.LifeData.poo>100?this.sanityChange(2):this.sanityChange(1)},e.prototype.read=function(){this.avatar.read(),B.default.getRandomNum(0,100)>90?(G.default.toast("\u4f60\u7528\u91cf\u5b50\u6ce2\u52a8\u901f\u8bfb\u770b\u5b8c\u4e86\u4e00\u672c\u4e66,\u4e66\u91cc\u7684\u5185\u5bb9\u8ba9\u4f60\u4e0d\u5bd2\u800c\u6817\u3002",!1,!0),this.sanityChange(-10)):(G.default.toast("\u4f60\u7528\u91cf\u5b50\u6ce2\u52a8\u901f\u8bfb\u770b\u5b8c\u4e86\u4e00\u672c\u4e66,\u5947\u602a\u7684\u77e5\u8bc6\u53c8\u589e\u52a0\u4e86\u3002",!1,!0),this.sanityChange(5))},e.prototype.cooking=function(){this.avatar.cooking(),G.default.toast("\u4f60\u7092\u4e86\u4e24\u4e2a\u9e21\u86cb\u53c8\u7528\u6628\u665a\u5269\u4e0b\u7684\u7c73\u996d\u62cc\u4e86\u62cc\u3002",!1,!0)},e.prototype.drink=function(){this.avatar.drink(),this.addStatus(P.default.HEALING,new T.default),this.addStatus(P.default.DRINK,new T.default),this.avatar.changeAvatarByDir(p.default.DIR_RIGHT)},e.prototype.canEatOrDrink=function(t){var e=this.data.LifeData,i="\u4f60\u89c9\u5f97",o=!0;return t.solidSatiety>0?e.solidSatiety>90?(o=!1,i+="\u592a\u9971\u4e86",e.poo>90&&(i+="\uff0c\u800c\u4e14\u8981\u618b\u4e0d\u4f4f"),i+="\uff0c\u5b8c\u5168\u5403\u4e0d\u4e0b\u4e86\u3002"):e.poo>90&&(o=!1,i+="\u8981\u618b\u4e0d\u4f4f\u4e86,\u5b8c\u5168\u5403\u4e0d\u4e0b\u4e86\u3002"):t.liquidSatiety>0&&(e.liquidSatiety>90?(o=!1,i+="\u592a\u80c0\u4e86",e.pee>90&&(i+="\uff0c\u800c\u4e14\u8981\u618b\u4e0d\u4f4f"),i+="\uff0c\u5b8c\u5168\u559d\u4e0d\u4e0b\u4e86\u3002"):e.poo>90&&(o=!1,i+="\u8981\u618b\u4e0d\u4f4f\u4e86,\u5b8c\u5168\u559d\u4e0d\u4e0b\u4e86\u3002")),o||(G.default.toast(i,!1,!0),H.default.play(H.default.SELECT_FAIL)),o},n([l(R.default)],e.prototype,"floatinglabelManager",void 0),n([l(cc.Vec3)],e.prototype,"pos",void 0),n([l(cc.Prefab)],e.prototype,"walksmoke",void 0),n([l(f.default)],e.prototype,"weaponLeft",void 0),n([l(f.default)],e.prototype,"weaponRight",void 0),n([l(c.default)],e.prototype,"shooterEx",void 0),n([l(P.default)],e.prototype,"statusManager",void 0),n([l(p.default)],e.prototype,"avatar",void 0),n([l(k.default)],e.prototype,"shield",void 0),n([l(cc.Node)],e.prototype,"remoteCooldown",void 0),n([l(cc.Camera)],e.prototype,"shadowCamera",void 0),n([l(cc.Prefab)],e.prototype,"shadowPrefab",void 0),n([s],e)}(m.default);i.default=Y,cc._RF.pop()},{"../actor/ShadowPlayer":"ShadowPlayer","../base/Actor":"Actor","../collider/CCollider":"CCollider","../data/AvatarData":"AvatarData","../data/DamageData":"DamageData","../data/EquipmentData":"EquipmentData","../data/FromData":"FromData","../data/LifeData":"LifeData","../data/StatusData":"StatusData","../data/TalentData":"TalentData","../data/TriggerData":"TriggerData","../effect/ShadowOfSight":"ShadowOfSight","../equipment/Equipment":"Equipment","../item/Item":"Item","../manager/FloatingLabelManager":"FloatingLabelManager","../manager/InventoryManager":"InventoryManager","../manager/LightManager":"LightManager","../manager/StatusManager":"StatusManager","../talent/OrganizationTalent":"OrganizationTalent","../talent/ProfessionTalent":"ProfessionTalent","../talent/Talent":"Talent","../ui/Tips":"Tips","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/NextStep":"NextStep","../utils/Random":"Random","../utils/Utils":"Utils","./Achievement":"Achievement","./Dungeon":"Dungeon","./EventHelper":"EventHelper","./Logic":"Logic","./MeleeWeapon":"MeleeWeapon","./PlayerAvatar":"PlayerAvatar","./PlayerWeapon":"PlayerWeapon","./Shield":"Shield","./Shooter":"Shooter"}],Portal:[function(t,e,i){"use strict";cc._RF.push(e,"deb90P3hX5AB5svKZmVAO6Q","Portal");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Player"),l=t("./Building"),c=t("../utils/IndexZ"),u=t("../logic/Logic"),h=t("../data/ExitData"),d=t("../utils/AudioPlayer"),p=t("../logic/EventHelper"),f=cc._decorator,g=f.ccclass,y=(f.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isOpen=!1,e.exitData=new h.default,e}return a(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation)},e.prototype.start=function(){this.anim=this.getComponent(cc.Animation),this.anim.play("PortalCloseIdle")},e.prototype.setPos=function(t){this.entity.Transform.position=r.default.getPosInMap(t),this.node.position=this.entity.Transform.position.clone(),this.node.zIndex=c.default.BASE+10*(r.default.HEIGHT_SIZE-t.y)+1},e.prototype.AnimGateClose=function(){this.anim.play("PortalCloseIdle")},e.prototype.AnimGateOpen=function(){this.anim.play("PortalOpenIdle")},e.prototype.openGate=function(){var t=this;this.isOpen||(this.isOpen=!0,this.scheduleOnce(function(){t.anim||(t.anim=t.getComponent(cc.Animation)),t.anim.play("PortalOpen")},.1))},e.prototype.closeGate=function(){this.isOpen&&(this.isOpen=!1,this.anim.play("PortalClose"))},e.prototype.onColliderEnter=function(t){var e=t.node.getComponent(s.default);e&&this.isOpen&&(this.closeGate(),u.default.playerData=e.data.clone(),cc.director.emit(p.EventHelper.PLAY_AUDIO,{detail:{name:d.default.EXIT}}),u.default.loadingNextLevel(this.exitData))},n([g],e)}(l.default));i.default=y,cc._RF.pop()},{"../data/ExitData":"ExitData","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Player":"Player","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","./Building":"Building"}],ProfessionData:[function(t,e,i){"use strict";cc._RF.push(e,"a352fkUprhBDLnAwraLUc3I","ProfessionData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./CommonData"),a=function(){function t(){this.id=0,this.desc="",this.nameCn="",this.nameEn="",this.equips={},this.talent="",this.items=[],this.common=new o.default}return Object.defineProperty(t.prototype,"Common",{get:function(){return this.common},enumerable:!1,configurable:!0}),t.prototype.valueCopy=function(t){this.common.valueCopy(t.common),this.nameCn=t.nameCn?t.nameCn:this.nameCn,this.nameEn=t.nameEn?t.nameEn:this.nameEn,this.desc=t.desc?t.desc:this.desc,this.equips=t.equips?t.equips:{},this.id=t.id?t.id:0,this.talent=t.talent?t.talent:"",this.items=t.items?t.items:[]},t.prototype.clone=function(){var e=new t;return e.common=this.common.clone(),e.nameCn=this.nameCn,e.nameEn=this.nameEn,e.desc=this.desc,e.id=this.id,e.equips=this.equips,e.talent=this.talent,e.items=this.items,e},t}();i.default=a,cc._RF.pop()},{"./CommonData":"CommonData"}],ProfessionTalent:[function(t,e,i){"use strict";cc._RF.push(e,"a250fm206dD/bouLDpaklSh","ProfessionTalent");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../data/FromData"),l=t("../logic/EventHelper"),c=t("../logic/Logic"),u=t("../logic/Shooter"),h=t("./FireGhost"),d=t("./Talent"),p=t("../utils/AudioPlayer"),f=t("../utils/IndexZ"),g=t("../manager/StatusManager"),y=t("../logic/PlayerAvatar"),m=t("../logic/NonPlayer"),v=t("../boss/Boss"),E=t("../data/AreaOfEffectData"),_=t("../manager/NonPlayerManager"),T=t("../utils/ActorUtils"),D=t("../ui/CoolDownView"),S=t("../manager/InventoryManager"),O=t("../utils/Utils"),A=cc._decorator,C=A.ccclass,R=A.property,L=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.aoe=null,e.fireball=null,e.icethron=null,e.fireGhost=null,e.healingLight=null,e.rageLight=null,e.broomPrefab=null,e.cookingPrefab=null,e.swordLightPrefab=null,e.smokePrefab=null,e.skyhandPrefab=null,e.daggerLightPrefab=null,e.fireGhostNum=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.ghostPool=new cc.NodePool(h.default),cc.director.on("destoryfireghost",function(e){t.destroyGhost(e.detail.coinNode)})},e.prototype.destroyGhost=function(t){t&&(t.active=!1,this.ghostPool&&(this.ghostPool.put(t),this.fireGhostNum--,cc.log("destroyGhost")))},e.prototype.init=function(e){t.prototype.init.call(this,e),this.coolDownId=D.default.PROFESSION;var i=1;this.data.resName==d.default.TALENT_014&&(i=3),this.initCoolDown(e,i)},e.prototype.skillCanUse=function(){switch(this.data.resName){case d.default.TALENT_009:return this.canSteal();case d.default.TALENT_019:return this.player.CanJump}return!0},e.prototype.doSkill=function(){this.excuteSkill(null);for(var t=0,e=this.player.shadowList;t<e.length;t++){var i=e[t];i.node&&this.excuteSkill(i)}},e.prototype.excuteSkill=function(t){var e=this,i=t?t.shooterEx:this.player.shooterEx;switch(this.data.resName){case d.default.TALENT_000:O.default.toast("\u68a6\u5883\u5f00\u53d1\u4e2d,\u65e0\u6cd5\u4f7f\u7528\u3002");break;case d.default.TALENT_001:p.default.play(p.default.MELEE_PARRY),this.shoot(i,0,0,"bullet040",null,null);break;case d.default.TALENT_002:this.healing();break;case d.default.TALENT_003:this.cooking(i);break;case d.default.TALENT_004:this.showIceThron(i);break;case d.default.TALENT_005:t||this.rageShoot();break;case d.default.TALENT_006:this.flash(t);break;case d.default.TALENT_007:this.addSwordLight(i);break;case d.default.TALENT_008:this.addDaggerLight(i,t);break;case d.default.TALENT_009:this.steal(t);break;case d.default.TALENT_010:O.default.toast("\u68a6\u5883\u5f00\u53d1\u4e2d,\u65e0\u6cd5\u4f7f\u7528\u3002");break;case d.default.TALENT_011:t||this.aimedShoot();break;case d.default.TALENT_012:this.addBroom(i);break;case d.default.TALENT_013:this.showFireBall(i);break;case d.default.TALENT_014:p.default.play(p.default.SKILL_MAGICBALL1),this.shoot(i,u.default.ARC_EX_NUM_8,0,"bullet035",null,null),this.scheduleOnce(function(){e.IsExcuting=!1},.1);break;case d.default.TALENT_015:t||this.dash();break;case d.default.TALENT_016:this.addClearCircle(t);break;case d.default.TALENT_017:this.showSmoke(i);break;case d.default.TALENT_018:this.addShadowFighter(t);break;case d.default.TALENT_019:this.jump(i)}},e.prototype.addClearCircle=function(t){this.player.stopAllDebuffs(),this.player.dungeon.nonPlayerManager.isPetAlive()&&this.player.dungeon.nonPlayerManager.pet.stopAllDebuffs(),this.addAoe(this.aoe,t?t.getCenterPosition():this.player.getCenterPosition(),(new E.default).init(2,.2,0,this.player.IsVariation?3:2,f.default.getActorZIndex(this.player.getCenterPosition()),!1,!1,!0,!1,!1,new r.default(0),new s.default,[]),["clearcircle1","clearcircle2","clearcircle3","clearcircle4"],!1,!0)},e.prototype.addShadowFighter=function(t){for(var e=0;e<3;e++)this.player.weaponRight.meleeWeapon.dungeon.nonPlayerManager.addNonPlayerFromData(_.default.NON_SHADOW,t?t.node.position:this.player.node.position,this.player.weaponRight.meleeWeapon.dungeon)},e.prototype.healing=function(){p.default.play(p.default.PICK_ITEM);var t=cc.instantiate(this.healingLight);t.parent=this.player.node,t.position=cc.v3(0,64),t.zIndex=f.default.OVERHEAD,this.player.addStatus(g.default.HEALING,new s.default),this.player.dungeon.nonPlayerManager.isPetAlive()&&this.player.dungeon.nonPlayerManager.pet.addStatus(g.default.HEALING,new s.default)},e.prototype.rageShoot=function(){var t=this;p.default.play(p.default.PICK_ITEM);var e=cc.instantiate(this.rageLight);e.parent=this.player.node,e.position=cc.v3(0,64),e.zIndex=f.default.OVERHEAD,this.scheduleOnce(function(){t.talentSkill.IsExcuting=!1,e&&cc.isValid(e)&&e.destroy()},3)},e.prototype.flash=function(t){var e=this;p.default.play(p.default.TAKEPHOTO),cc.tween(this.sprite.node).call(function(){e.player.addStatus(g.default.TALENT_FLASH_SPEED,new s.default),e.player.dungeon.nonPlayerManager.isPetAlive()&&e.player.dungeon.nonPlayerManager.pet.addStatus(g.default.TALENT_FLASH_SPEED,new s.default),e.sprite.spriteFrame=c.default.spriteFrameRes("flash"),e.sprite.node.width=128,e.sprite.node.height=128,e.sprite.node.opacity=255,e.sprite.node.position=cc.v3(0,32)}).to(.1,{opacity:0}).call(function(){e.sprite.spriteFrame=c.default.spriteFrameRes("singleColor"),e.sprite.node.width=2e3,e.sprite.node.height=2e3,e.sprite.node.opacity=255}).to(.1,{opacity:0}).call(function(){g.default.addStatus2NearEnemies(e.player,t?t.node:e.player.node,g.default.TALENT_FLASH_DIZZ,e.player.IsVariation?500:400,new s.default),e.sprite.spriteFrame=null}).start()},e.prototype.aimedShoot=function(){var t=this;p.default.play(p.default.RELOAD),cc.tween(this.sprite.node).call(function(){t.player.addStatus(g.default.TALENT_AIMED,new s.default),t.player.dungeon.nonPlayerManager.isPetAlive()&&t.player.dungeon.nonPlayerManager.pet.addStatus(g.default.TALENT_AIMED,new s.default),t.sprite.spriteFrame=c.default.spriteFrameRes("talentshoot"),t.sprite.node.width=64,t.sprite.node.height=64,t.sprite.node.opacity=255,t.sprite.node.scale=1,t.sprite.node.position=cc.v3(0,128)}).repeat(5,cc.tween().to(1,{scale:1.5}).to(1,{scale:1})).call(function(){t.sprite.spriteFrame=null}).start()},e.prototype.dash=function(){var t=this,e=1500;this.player.IsVariation&&(e=2e3),p.default.play(p.default.DASH),this.schedule(function(){t.player.getWalkSmoke(t.node.parent,t.node.position)},.05,4,0);var i=this.player.entity.Move.linearVelocity.clone();this.player.sc.isMoving=!1,i=i.equals(cc.Vec2.ZERO)?cc.v2(this.player.Hv.clone()):i.normalizeSelf();var o=cc.v2(i.x,i.y);this.hv=o.clone(),i=i.mul(e),this.player.entity.Move.linearVelocity=i,this.scheduleOnce(function(){t.player.entity.Move.linearVelocity=cc.Vec2.ZERO,t.player.playerAnim(y.default.STATE_IDLE,t.player.currentDir),t.IsExcuting=!1},.5)},e.prototype.jump=function(t){var e=this;p.default.play(p.default.JUMP),this.player.jump(),this.scheduleOnce(function(){p.default.play(p.default.BOOM);var i=e.player.data.getFinalAttackPoint();i.isMelee=!0,i.isCriticalStrike=!0;var o=2;e.player.IsVariation&&(o+=1),t.fireAoe(e.skyhandPrefab,(new E.default).init(0,.15,0,o,f.default.OVERHEAD,!1,!0,!0,!1,!1,i,new s.default,[g.default.DIZZ])),e.talentSkill.IsExcuting=!1},.8)},e.prototype.canSteal=function(){var t=T.default.getNearestEnemyActor(this.player.node.position,!1,this.player.weaponRight.meleeWeapon.dungeon);if(!t)return!1;var e=t.getComponent(m.default),i=t.getComponent(v.default);return!!(e&&e.data.noLoot<1)||!!i},e.prototype.steal=function(t){var e=this;p.default.play(p.default.FIREBALL);var i=T.default.getNearestEnemyActor(this.player.node.position,!1,this.player.weaponRight.meleeWeapon.dungeon);if(i){var o=i.getComponent(m.default),a=i.getComponent(v.default);o&&o.data.noLoot<1&&o.getLoot(),a&&a.getLoot(),t||(this.sprite.node.width=128,this.sprite.node.height=128,this.sprite.node.opacity=255,this.sprite.node.scale=1,this.sprite.node.position=cc.v3(0,128),cc.tween(this.sprite.node).call(function(){e.sprite.spriteFrame=c.default.spriteFrameRes("talenthand01")}).delay(.2).call(function(){e.sprite.spriteFrame=c.default.spriteFrameRes("talenthand02")}).delay(.2).call(function(){e.sprite.spriteFrame=c.default.spriteFrameRes("talenthand03")}).delay(.2).call(function(){e.sprite.spriteFrame=c.default.spriteFrameRes("talenthand04")}).delay(.2).call(function(){e.sprite.spriteFrame=null}).start())}},e.prototype.showSmoke=function(t){p.default.play(p.default.MELEE_PARRY),(new r.default).magicDamage=3+c.default.playerData.OilGoldData.level;var e=1;this.player.IsVariation&&(e+=1),this.shoot(t,0,0,"bullet041",this.smokePrefab,(new E.default).init(7,.1,0,e,f.default.OVERHEAD,!1,!1,!1,!1,!1,new r.default,new s.default,[g.default.WINE_CLOUD]))},e.prototype.showFireBall=function(t){p.default.play(p.default.SKILL_FIREBALL);var e=new r.default;e.magicDamage=3+c.default.playerData.OilGoldData.level,e.isMelee=!0;var i=4;this.player.IsVariation&&(i+=1),t.fireAoe(this.fireball,(new E.default).init(0,.1,0,i,f.default.OVERHEAD,!1,!0,!0,!1,!0,e,new s.default,[g.default.BURNING]))},e.prototype.showIceThron=function(t){this.scheduleOnce(function(){p.default.play(p.default.SKILL_ICETHRON)},1);var e=new r.default;e.magicDamage=3+c.default.playerData.OilGoldData.level,e.isMelee=!0;var i=100,o=60,a=3;this.player.IsVariation&&(a+=1,i=150,o=90);for(var n=[0,45,90,135,180,225,270,315],l=[cc.v3(0,i),cc.v3(-o,o),cc.v3(-i,0),cc.v3(-o,-o),cc.v3(0,-i),cc.v3(o,-o),cc.v3(i,0),cc.v3(o,o)],u=(cc.v3(0,-i),cc.v3(-o,-o),cc.v3(-i,0),cc.v3(-o,o),cc.v3(0,i),cc.v3(o,o),cc.v3(i,0),cc.v3(o,-o),[n]),h=0;h<u[0].length;h++)t.fireAoe(this.icethron,(new E.default).init(0,2,0,a,f.default.OVERHEAD,!1,!0,!0,!1,!0,e,new s.default,[g.default.FROZEN]),cc.v3(l[h]),n[h],null,!0)},e.prototype.changePerformance=function(){},e.prototype.takeDamage=function(){return!1},e.prototype.addLighteningFall=function(t,e){l.EventHelper.emit(l.EventHelper.DUNGEON_ADD_LIGHTENINGFALL,{pos:T.default.getNearestEnemyPosition(this.player.node.position,!1,this.player.weaponRight.meleeWeapon.dungeon,!0),showArea:t,damage:e})},e.prototype.addBroom=function(t){p.default.play(p.default.MELEE_PARRY);var e=this.player.data.getFinalAttackPoint();e.isMelee=!0;var i=1.5;this.player.IsVariation&&(i+=1),t.fireAoe(this.broomPrefab,(new E.default).init(0,.5,.2,i,f.default.OVERHEAD,!1,!0,!0,!0,!0,e,new s.default,[g.default.FROZEN]),cc.v3(0,32*this.player.node.scaleY))},e.prototype.cooking=function(t){p.default.play(p.default.MELEE_PARRY);var e=this.player.data.getFinalAttackPoint();e.isMelee=!0;var i=1;this.player.IsVariation&&(i+=1),t.fireAoe(this.cookingPrefab,(new E.default).init(0,2,0,i,f.default.OVERHEAD,!1,!1,!1,!1,!1,e,new s.default,[]),cc.v3(0,32),0,function(t){var e=t.node.getComponent(m.default);e&&e.dungeon.addItem(e.node.position.clone(),"foodmonster"+e.data.resName.replace("monster",""));var i=t.node.getComponent(v.default);i&&i.dungeon.addItem(i.node.position.clone(),"foodboss"+i.data.resName.replace("iconboss",""))})},e.prototype.addSwordLight=function(t){var e=this;p.default.play(p.default.SKILL_MAGICBALL),p.default.play(p.default.SWORD_SHOW);var i=new r.default;i.isMelee=!0;var o=5;i.physicalDamage=2+c.default.playerData.OilGoldData.level,this.player.weaponRight.meleeWeapon.IsSword&&(i=this.player.data.getFinalAttackPoint(),o=6),this.player.IsVariation&&(o+=1);var a=t.fireAoe(this.swordLightPrefab,(new E.default).init(0,.35,0,o,f.default.OVERHEAD,!1,!0,!0,!1,!0,i,new s.default,[g.default.FROZEN])),n=cc.color(255,255,255).fromHEX(this.player.inventoryManager.equips[S.default.WEAPON].lightcolor);a.node.getChildByName("sprite").color=n,this.scheduleOnce(function(){e.talentSkill.IsExcuting=!1},1)},e.prototype.addDaggerLight=function(t,e){var i=this;if(this.player.weaponRight.meleeWeapon.IsDagger){e||this.scheduleOnce(function(){i.player.addStatus(g.default.TALENT_INVISIBLE,new s.default)},2.4),p.default.play(p.default.SKILL_MAGICBALL),p.default.play(p.default.SWORD_SHOW);var o=2,a=this.player.data.getFinalAttackPoint();a.isMelee=!0,a.physicalDamage=a.physicalDamage/2,this.player.IsVariation&&(o+=1);for(var n=t.fireAoe(this.daggerLightPrefab,(new E.default).init(0,.24,0,o,f.default.OVERHEAD,!1,!0,!0,!1,!1,a,new s.default,[g.default.FROZEN]),cc.Vec3.ZERO),r=cc.color(255,255,255).fromHEX(this.player.inventoryManager.equips[S.default.WEAPON].lightcolor),l=0,c=n.node.getComponentsInChildren(cc.Sprite);l<c.length;l++){var u=c[l];u.node.color=e?cc.Color.BLACK:r,u.node.opacity=200}this.player.vanish(2.4),e&&e.vanish(2.4),this.scheduleOnce(function(){i.talentSkill.IsExcuting=!1},3)}else e||this.player.addStatus(g.default.TALENT_INVISIBLE,new s.default)},e.prototype.initFireGhosts=function(){for(var t=this.fireGhostNum,e=0;e<5-t;e++){var i=null;this.ghostPool.size()>0&&(i=this.ghostPool.get()),i&&!i.active||(i=cc.instantiate(this.fireGhost)),this.fireGhostNum++,i.active=!0;var o=i.getComponent(h.default);o.initCollider(),this.player.node.parent.addChild(o.node),o.init(this.player,72*e)}},n([R(cc.Sprite)],e.prototype,"sprite",void 0),n([R(cc.Prefab)],e.prototype,"aoe",void 0),n([R(cc.Prefab)],e.prototype,"fireball",void 0),n([R(cc.Prefab)],e.prototype,"icethron",void 0),n([R(cc.Prefab)],e.prototype,"fireGhost",void 0),n([R(cc.Prefab)],e.prototype,"healingLight",void 0),n([R(cc.Prefab)],e.prototype,"rageLight",void 0),n([R(cc.Prefab)],e.prototype,"broomPrefab",void 0),n([R(cc.Prefab)],e.prototype,"cookingPrefab",void 0),n([R(cc.Prefab)],e.prototype,"swordLightPrefab",void 0),n([R(cc.Prefab)],e.prototype,"smokePrefab",void 0),n([R(cc.Prefab)],e.prototype,"skyhandPrefab",void 0),n([R(cc.Prefab)],e.prototype,"daggerLightPrefab",void 0),n([C],e)}(d.default);i.default=L,cc._RF.pop()},{"../boss/Boss":"Boss","../data/AreaOfEffectData":"AreaOfEffectData","../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/NonPlayer":"NonPlayer","../logic/PlayerAvatar":"PlayerAvatar","../logic/Shooter":"Shooter","../manager/InventoryManager":"InventoryManager","../manager/NonPlayerManager":"NonPlayerManager","../manager/StatusManager":"StatusManager","../ui/CoolDownView":"CoolDownView","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/Utils":"Utils","./FireGhost":"FireGhost","./Talent":"Talent"}],ProfileData:[function(t,e,i){"use strict";cc._RF.push(e,"6ba48LTPitPa5dUl/wXJcJ0","ProfileData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./PlayerData"),a=t("./SavePointData"),n=t("./GroundOilGoldData");i.default=function(){this.rectDungeons={},this.chapterIndex=0,this.chapterMaxIndex=0,this.playerData=new o.default,this.playerEquips={},this.playerItemList=new Array,this.playerInventoryList=new Array,this.nonPlayerList=new Array,this.level=0,this.time="00:00:00",this.realTime=1526273746e3,this.savePointData=new a.default,this.groundOilGoldData=new n.default,this.oilGolds=0,this.killPlayerCounts={}},cc._RF.pop()},{"./GroundOilGoldData":"GroundOilGoldData","./PlayerData":"PlayerData","./SavePointData":"SavePointData"}],ProfileManager:[function(t,e,i){"use strict";cc._RF.push(e,"5915dTUdVpDi5LG7x2qxIEk","ProfileManager");var o=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var a=t("../data/ProfileData"),n=t("../rect/RectDungeon"),r=t("../utils/LocalStorage"),s=cc._decorator,l=s.ccclass,c=(s.property,function(){function t(){this.data=new a.default,this.hasSaveData=!1,this.loadData()}return t.prototype.loadData=function(){this.loadProfile()},t.prototype.getSaveData=function(){var t=r.default.getValue(r.default.SAVE_DUNGEON);return t?JSON.parse(t):null},t.prototype.saveData=function(){r.default.putValue(r.default.SAVE_DUNGEON,this.data),this.hasSaveData=!0,console.log("save data")},t.prototype.clearData=function(){cc.sys.localStorage.setItem(r.default.SAVE_DUNGEON,""),this.hasSaveData=!1,this.data=new a.default,console.log("clear data")},t.prototype.loadProfile=function(){var t=this.getSaveData();if(!t)return this.hasSaveData=!1,!1;if(!(t.savePointData&&t.playerData&&t.playerEquips&&t.playerItemList&&t.rectDungeons))return this.hasSaveData=!1,!1;for(var e in this.data=new a.default,this.hasSaveData=!0,this.data.playerData.valueCopy(t.playerData),this.data.chapterIndex=t.chapterIndex,this.data.chapterMaxIndex=t.chapterMaxIndex,this.data.level=t.level,this.data.savePointData.valueCopy(t.savePointData),this.data.oilGolds=t.oilGolds?t.oilGolds:0,this.data.groundOilGoldData.valueCopy(t.groundOilGoldData),t.playerEquips)this.data.playerEquips[e]=t.playerEquips[e];if(t.playerItemList)for(var i=0;i<t.playerItemList.length;i++)this.data.playerItemList[i]=t.playerItemList[i];if(t.playerInventoryList)for(i=0;i<t.playerInventoryList.length;i++)this.data.playerInventoryList[i]=t.playerInventoryList[i];if(t.nonPlayerList)for(i=0;i<t.nonPlayerList.length;i++)this.data.nonPlayerList[i]=t.nonPlayerList[i];for(var e in t.rectDungeons){var o=new n.default;o.buildMapFromSave(t.rectDungeons[e]),this.data.rectDungeons[e]=o}return t.killPlayerCounts&&(this.data.killPlayerCounts=t.killPlayerCounts),t.time&&(this.data.time=t.time),t.realTime&&(this.data.realTime=t.realTime),console.log("data",this),!0},o([l],t)}());i.default=c,cc._RF.pop()},{"../data/ProfileData":"ProfileData","../rect/RectDungeon":"RectDungeon","../utils/LocalStorage":"LocalStorage"}],Quadtree:[function(t,e,i){"use strict";cc._RF.push(e,"fde53Hh/HdFoYBBgbxP4uef","Quadtree"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e,i,o){this.max_objects=e||10,this.max_levels=i||4,this.level=o||0,this.bounds=t,this.objects=[],this.nodes=[]}return t.prototype.split=function(){var e=this.level+1,i=this.bounds.width/2,o=this.bounds.height/2,a=this.bounds.x,n=this.bounds.y;this.nodes[0]=new t({x:a+i,y:n,width:i,height:o},this.max_objects,this.max_levels,e),this.nodes[1]=new t({x:a,y:n,width:i,height:o},this.max_objects,this.max_levels,e),this.nodes[2]=new t({x:a,y:n+o,width:i,height:o},this.max_objects,this.max_levels,e),this.nodes[3]=new t({x:a+i,y:n+o,width:i,height:o},this.max_objects,this.max_levels,e)},t.prototype.getIndex=function(t){var e=t.Aabb,i=[],o=this.bounds.x+this.bounds.width/2,a=this.bounds.y+this.bounds.height/2,n=e.y<a,r=e.x<o,s=e.x+e.width>o,l=e.y+e.height>a;return n&&s&&i.push(0),r&&n&&i.push(1),r&&l&&i.push(2),s&&l&&i.push(3),i},t.prototype.insert=function(t){var e,i=0;if(this.nodes.length)for(e=this.getIndex(t),i=0;i<e.length;i++)this.nodes[e[i]].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){for(this.nodes.length||this.split(),i=0;i<this.objects.length;i++){e=this.getIndex(this.objects[i]);for(var o=0;o<e.length;o++)this.nodes[e[o]].insert(this.objects[i])}this.objects=[]}},t.prototype.retrieve=function(t){var e=this.getIndex(t),i=this.objects;if(this.nodes.length)for(var o=0;o<e.length;o++)i=i.concat(this.nodes[e[o]].retrieve(t));return i=i.filter(function(t,e){return i.indexOf(t)>=e})},t.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]},t}();i.default=o,cc._RF.pop()},{}],Rah:[function(t,e,i){"use strict";cc._RF.push(e,"d367aUD8qtMnYoMv/zpvvi2","Rah");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Boss"),s=t("../data/DamageData"),l=t("../logic/Shooter"),c=t("../logic/Dungeon"),u=t("../logic/Logic"),h=t("../manager/StatusManager"),d=t("../utils/NextStep"),p=t("../logic/EventHelper"),f=t("../utils/AudioPlayer"),g=t("../data/FromData"),y=t("../logic/Achievement"),m=t("../utils/ActorUtils"),v=t("../collider/CCollider"),E=cc._decorator,_=E.ccclass,T=(E.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeDelay=0,e.isFaceRight=!0,e.isMoving=!1,e.darkSkill=new d.default,e.blinkSkill=new d.default,e.snakeSkill=new d.default,e.bugsSkill=new d.default,e.meleeSkill=new d.default,e.actionTimeDelay=0,e}return a(e,t),e.prototype.init=function(){throw new Error("Method not implemented.")},e.prototype.onLoad=function(){this.sc.isDied=!1,this.sc.isShow=!1,this.anim=this.getComponent(cc.Animation),this.shooter=this.node.getChildByName("Shooter").getComponent(l.default),this.statusManager=this.node.getChildByName("StatusManager").getComponent(h.default),this.shooter.from.valueCopy(g.default.getClone(this.actorName(),"bossrahhead"))},e.prototype.start=function(){t.prototype.start.call(this)},e.prototype.takeDamage=function(t){if(this.sc.isDied||!this.sc.isShow||this.blinkSkill.IsExcuting)return!1;this.data.currentHealth-=this.data.getDamage(t).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth);var e=[f.default.MONSTER_HIT,f.default.MONSTER_HIT1,f.default.MONSTER_HIT2];return f.default.play(e[u.default.getRandomNum(0,2)]),!0},e.prototype.killed=function(){var t=this;this.sc.isDied||(y.default.addMonsterKillAchievement(this.data.resName),cc.tween(this.node).to(3,{opacity:0}).start(),this.sc.isDied=!0,cc.tween(this.dungeon.fog).to(3,{scale:5}).start(),this.scheduleOnce(function(){t.node&&(t.node.active=!1)},5),this.getLoot())},e.prototype.bossAction=function(){if(!this.sc.isDied&&this.sc.isShow&&this.dungeon){this.entity.Transform.position=c.default.fixOuterMap(this.entity.Transform.position),this.pos=c.default.getIndexInMap(this.entity.Transform.position),this.changeZIndex();var t=this.dungeon.player.pos.clone(),e=c.default.getPosInMap(t).sub(this.entity.Transform.position),i=this.getNearPlayerDistance(this.dungeon.player.node),o=e.x,a=e.y;Math.abs(o),Math.abs(a),this.isFaceRight=o>0;var n=this.data.currentHealth<this.data.Common.maxHealth/2;i<100&&(this.entity.Move.linearVelocity=cc.Vec2.ZERO),u.default.getChance(20)&&n&&this.dark(),u.default.getChance(80)&&this.blink(),i<600&&!this.blinkSkill.IsExcuting&&this.fireSnake(),u.default.getChance(90)&&!this.blinkSkill.IsExcuting&&this.fireBugs(n),i<100&&!this.blinkSkill.IsExcuting&&this.attack(),!e.equals(cc.Vec3.ZERO)&&!this.meleeSkill.IsExcuting&&!this.blinkSkill.IsExcuting&&i>100&&(e=e.normalizeSelf(),this.move(e,100))}},e.prototype.blink=function(){var t=this;this.blinkSkill.next(function(){cc.director.emit(p.EventHelper.PLAY_AUDIO,{detail:{name:f.default.BLINK}}),t.blinkSkill.IsExcuting=!0,t.entity.Move.linearVelocity=cc.Vec2.ZERO,cc.tween(t.node).to(1,{opacity:0}).call(function(){var e=t.dungeon.player.pos.clone();e.y>c.default.HEIGHT_SIZE-1?e.y-=1:e.y+=1,t.transportBoss(e.x,e.y)}).to(1,{opacity:255}).call(function(){t.attack()}).start(),t.scheduleOnce(function(){t.blinkSkill.IsExcuting=!1},5)},10)},e.prototype.attack=function(){var t=this;this.meleeSkill.next(function(){cc.director.emit(p.EventHelper.PLAY_AUDIO,{detail:{name:f.default.MELEE}}),t.meleeSkill.IsExcuting=!0,t.anim||(t.anim=t.getComponent(cc.Animation)),t.anim.playAdditive("RahAttack001")},2,!0)},e.prototype.dark=function(){var t=this;this.darkSkill.next(function(){cc.tween(t.dungeon.fog).to(2,{scale:1.75}).to(6,{angle:0}).to(2,{scale:.6}).start(),t.anim||(t.anim=t.getComponent(cc.Animation)),t.anim.playAdditive("RahSpellDark")},20)},e.prototype.fireSnake=function(){var t=this;this.snakeSkill.next(function(){t.shooter.setHv(cc.v2(0,-1));var e=t.entity.Transform.position.clone().add(t.shooter.node.position),i=t.dungeon.player.getCenterPosition().sub(e);i.equals(cc.Vec3.ZERO)||(t.shooter.setHv(cc.v2(i).normalize()),t.fireShooter(t.shooter,"bullet014",1,0)),t.anim||(t.anim=t.getComponent(cc.Animation)),t.anim.playAdditive("RahSpellSnake")},6)},e.prototype.fireBugs=function(){var t=this;this.bugsSkill.next(function(){t.shooter.data.bulletLineInterval=.5;var e=t.entity.Transform.position.clone().add(t.shooter.node.position),i=t.dungeon.player.getCenterPosition().sub(e);i.equals(cc.Vec3.ZERO)||t.shooter.setHv(cc.v2(i).normalize()),t.fireShooter(t.shooter,"bullet017",99,0),t.anim||(t.anim=t.getComponent(cc.Animation)),t.anim.playAdditive("RahSpellBugs")},4)},e.prototype.fireShooter=function(t,e,i,o,a){t.dungeon=this.dungeon,t.data.bulletType=e,t.data.bulletArcExNum=i,t.data.bulletLineExNum=o,t.fireBullet(a)},e.prototype.showBoss=function(){this.sc.isShow=!0,this.entity.NodeRender.node=this.node,this.entity.Move.linearDamping=10,this.healthBar&&(this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.healthBar.node.active=!this.sc.isDied)},e.prototype.isActionTimeDelay=function(t){return this.actionTimeDelay+=t,this.actionTimeDelay>.2&&(this.actionTimeDelay=0,!0)},e.prototype.updateLogic=function(t){this.timeDelay+=t,this.timeDelay>1&&(this.timeDelay=0),this.isActionTimeDelay(t)&&this.bossAction(),this.data.currentHealth<1&&this.killed(),this.healthBar.node.active=!this.sc.isDied,this.sc.isDied&&(this.entity.Move.linearVelocity=cc.Vec2.ZERO),this.node.scaleX=this.isFaceRight?1:-1},e.prototype.move=function(t,e){if(!this.sc.isDied){t.equals(cc.Vec3.ZERO)||(this.pos=c.default.getIndexInMap(this.entity.Transform.position));var i=t.x,o=t.y,a=(Math.abs(i),Math.abs(o),cc.v2(i,o));a=a.normalize().mul(e),this.entity.Move.linearVelocity=a,this.isMoving=0!=i||0!=o,this.changeZIndex()}},e.prototype.onColliderEnter=function(t,e){if(e.tag==v.default.TAG.BOSS_HIT){var i=m.default.getEnemyCollisionTarget(t);if(i&&this.meleeSkill.IsExcuting&&!this.sc.isDied){var o=new s.default;o.physicalDamage=15,i.takeDamage(o,g.default.getClone(this.actorName(),"bossrahhead"),this)}}},e.prototype.actorName=function(){return"\u673a\u68b0\u62c9\u795e"},n([_],e)}(r.default));i.default=T,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/NextStep":"NextStep","./Boss":"Boss"}],Random4Save:[function(t,e,i){"use strict";cc._RF.push(e,"74f98/L5YNOk7ZP1QlogXyD","Random4Save"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.seed=0,this.seed=t,t<=0&&(t=(new Date).getTime())}return Object.defineProperty(t.prototype,"Seed",{get:function(){return this.seed},set:function(t){this.seed=t},enumerable:!1,configurable:!0}),t.prototype.rand=function(){return this.seed=(9301*this.seed+49297)%233280,this.seed/233280},t.prototype.getRandomNum=function(t,e){return t+Math.round(this.rand()*(e-t))},t.prototype.getHalfChance=function(){return this.rand()>.5},t}();i.default=o,cc._RF.pop()},{}],Random:[function(t,e,i){"use strict";cc._RF.push(e,"b33a81ZfJ9HoIP2sjcUTtfA","Random"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.prototype.setSeed=function(e){t.seed=e},t.rand=function(){return t.seed=(9301*t.seed+49297)%233280,t.seed/233280},t.getRandomNum=function(e,i){return e+Math.round(t.rand()*(i-e))},t.getHalfChance=function(){return t.rand()>.5},t.seed=(new Date).getTime(),t}();i.default=o,cc._RF.pop()},{}],RayCastResult:[function(t,e,i){"use strict";cc._RF.push(e,"d7154QJ7udPJZTxGf5BSkDh","RayCastResult"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(t,e){this.collider=t,this.point=e},cc._RF.pop()},{}],RectDoor:[function(t,e,i){"use strict";cc._RF.push(e,"d41e5HipSBBVLDWw2G1WR/C","RectDoor"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(t,e,i){this.isDoor=!1,this.isHidden=!1,this.dir=t,this.isDoor=e,this.isHidden=i},cc._RF.pop()},{}],RectDungeon:[function(t,e,i){"use strict";cc._RF.push(e,"3b710jO571KQpPd9DCAmaJb","RectDungeon"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./RectRoom"),a=t("./RoomType"),n=t("../data/BuildingData"),r=t("../data/EquipmentData"),s=t("../data/ItemData"),l=function(){function t(){this.id="00",this.width=0,this.height=0,this.currentPos=cc.v3(1,1),this.buildings={},this.equipments={},this.items={},this.startIndex=cc.Vec2.ZERO,this.endIndex=cc.v2(-1,-1)}return t.prototype.buildMapFromSave=function(t,e){for(var i in this.id=t.id,this.width=t.width,this.height=t.height,this.map=new Array,this.currentPos=t.currentPos?cc.v3(t.currentPos.x,t.currentPos.y):cc.v3(0,0),t.buildings){var l=t.buildings[i];for(var c in this.buildings[i]={},l){var u=new n.default;u.valueCopy(l[c]),this.buildings[i][c]=u}}for(var h in t.equipments){var d=t.equipments[h];this.equipments[h]=new Array;for(var p=0;p<d.length;p++){var f=new r.default;f.valueCopy(d[p]),this.equipments[h][p]=f}}for(var h in t.items)for(d=t.items[h],this.items[h]=new Array,p=0;p<d.length;p++){var g=new s.default;g.valueCopy(d[p]),this.items[h][p]=g}for(p=0;p<this.width;p++){this.map[p]=new Array;for(var y=0;y<this.height;y++)this.map[p][y]=new o.default(p,y,a.default.EMPTY_ROOM).initFromSave(t.map[p][y]),e&&(this.map[p][y].roomType=a.default.getTypeByName(e.roomTypes[p][y])),this.map[p][y]&&this.map[p][y].roomType.isEqual(a.default.START_ROOM)&&(this.map[p][y].state!=o.default.STATE_CLEAR&&(this.map[p][y].state=o.default.STATE_FOUND),this.startIndex=cc.v2(p,y)),this.map[p][y]&&this.map[p][y].roomType.isEqual(a.default.END_ROOM)&&(this.map[p][y].state!=o.default.STATE_CLEAR&&(this.map[p][y].state=o.default.STATE_FOUND),this.endIndex=cc.v2(p,y))}return this.endIndex.x<0&&this.endIndex.y<0&&(this.endIndex=this.startIndex.clone()),this},t.prototype.buildMap=function(t){this.map=new Array,this.id=""+t.chapter+t.index,this.width=t.width,this.height=t.height,this.buildings={},this.equipments={},this.items={};for(var e=0;e<t.width;e++){this.map[e]=new Array;for(var i=0;i<t.height;i++)this.map[e][i]=new o.default(e,i,a.default.getTypeByName(t.roomTypes[e][i])),this.map[e][i].roomType.isEqual(a.default.START_ROOM)&&(this.map[e][i].state!=o.default.STATE_CLEAR&&(this.map[e][i].state=o.default.STATE_FOUND),this.startIndex=cc.v2(e,i)),this.map[e][i].roomType.isEqual(a.default.END_ROOM)&&(this.map[e][i].state!=o.default.STATE_CLEAR&&(this.map[e][i].state=o.default.STATE_FOUND),this.endIndex=cc.v2(e,i))}this.endIndex.x<0&&this.endIndex.y<0&&(this.endIndex=this.startIndex.clone())},t.prototype.getDisPlay=function(){for(var t="",e=this.height-1;e>=0;e--){for(var i=0;i<this.width;i++)t+=this.map[i][e].roomType.NAME;t+="\n"}return t},t.prototype.getNeighborRoom=function(t,e,i){var o=t,a=e;return-1==i?this.map[o][a]:(0==i&&(a+=1),1==i&&(a-=1),2==i&&(o-=1),3==i&&(o+=1),o>=this.width||o<0||a>=this.height||a<0||i<0||i>4?null:this.map[o][a])},t.prototype.changeRoomsIsFound=function(t,e){this.changeRoomIsFound(t,e),this.changeRoomIsFound(t+1,e),this.changeRoomIsFound(t-1,e),this.changeRoomIsFound(t,e+1),this.changeRoomIsFound(t,e-1),this.changeRoomIsFound(t+1,e-1),this.changeRoomIsFound(t-1,e-1),this.changeRoomIsFound(t+1,e-1),this.changeRoomIsFound(t-1,e-1)},t.prototype.changeRoomIsFound=function(t,e){t>=this.width||t<0||e>=this.height||e<0||this.map[t][e].state!=o.default.STATE_CLEAR&&(this.map[t][e].state=o.default.STATE_FOUND)},t.isRoomEqual=function(t,e){return t.x==e.x&&t.y==e.y},t.prototype.changeAllClearRoomsReborn=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.map[t][e].isClear()&&(this.map[t][e].reborn++,this.map[t][e].isReborn=!0)},t}();i.default=l,cc._RF.pop()},{"../data/BuildingData":"BuildingData","../data/EquipmentData":"EquipmentData","../data/ItemData":"ItemData","./RectRoom":"RectRoom","./RoomType":"RoomType"}],RectRoom:[function(t,e,i){"use strict";cc._RF.push(e,"d55edjfV4pLuKPki2DqAONx","RectRoom"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./RoomType"),a=t("../utils/Random"),n=function(){function t(e,i,o){this.state=t.STATE_SLEEP,this.seed=0,this.isReborn=!1,this.reborn=0,this.x=e,this.y=i,this.roomType=o,this.seed=t.getRandomNum(0,1e8),this.init()}return t.prototype.initFromSave=function(e){if(e)return this.x=e.x,this.y=e.y,this.roomType=new o.default(0,""),this.roomType.valueCopy(e.roomType),this.state=e.state,this.reborn=e.reborn,this.isReborn=e.isReborn,this.seed=e.seed?e.seed:t.getRandomNum(0,1e8),this},t.prototype.init=function(){this.state=t.STATE_SLEEP},t.prototype.isFound=function(){return this.state==t.STATE_FOUND||this.state==t.STATE_CLEAR},t.prototype.isClear=function(){return this.state==t.STATE_CLEAR},t.getRandomNum=function(t,e){return t+Math.round(a.default.rand()*(e-t))},t.STATE_SLEEP=0,t.STATE_FOUND=1,t.STATE_CLEAR=2,t}();i.default=n,cc._RF.pop()},{"../utils/Random":"Random","./RoomType":"RoomType"}],RoomBed:[function(t,e,i){"use strict";cc._RF.push(e,"3cd15zS7p1FoqGJnOp3C8cF","RoomBed");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/ExitData"),s=t("../logic/Dungeon"),l=t("../effect/ShadowOfSight"),c=t("../logic/Logic"),u=t("../logic/Player"),h=t("../ui/Tips"),d=t("../utils/AudioPlayer"),p=t("./Building"),f=t("../collider/CCollider"),g=cc._decorator,y=g.ccclass,m=(g.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isWakeUp=!1,e.isFirst=!0,e.isDecorate=!1,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.lights=this.getComponentsInChildren(l.default),this.tips=this.getComponentInChildren(h.default),this.tips.onInteract(function(e,i){t.node&&t.enterDream(i)})},e.prototype.init=function(t,e){this.dungeon=t,this.isDecorate=e,this.tips.node.active=!e},e.prototype.start=function(){this.node.getChildByName("sprite").getChildByName("bed").getComponent(cc.Sprite).spriteFrame=c.default.spriteFrameRes("avatarbed00"+c.default.playerData.AvatarData.organizationIndex),this.node.getChildByName("sprite").getChildByName("cover").getComponent(cc.Sprite).spriteFrame=c.default.spriteFrameRes("avatarcover00"+c.default.playerData.AvatarData.organizationIndex);for(var t=0,e=this.lights;t<e.length;t++)e[t].updateRender(!this.isDecorate)},e.prototype.onColliderEnter=function(t,e){if(!this.isDecorate&&e.tag!=f.default.TAG.TIPS){var i=t.node.getComponent(u.default);this.enterDream(i)}},e.prototype.enterDream=function(t){var e=this;t&&!this.isWakeUp&&this.isFirst&&(this.isFirst=!1,this.dungeon&&(this.dungeon.CameraZoom=s.default.DEFAULT_ZOOM_MAX),t.sleep(),this.scheduleOnce(function(){c.default.playerData=t.data.clone(),c.default.playerData.pos.equals(e.data.defaultPos)&&(c.default.playerData.pos.y=e.data.defaultPos.y-1),d.default.play(d.default.EXIT),c.default.loadingNextLevel(r.default.getDreamExitDataFromReal())},.5))},e.prototype.onColliderExit=function(t){this.isDecorate||t.node.getComponent(u.default)&&!this.isWakeUp&&(this.isWakeUp=!0)},n([y],e)}(p.default));i.default=m,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/ExitData":"ExitData","../effect/ShadowOfSight":"ShadowOfSight","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../logic/Player":"Player","../ui/Tips":"Tips","../utils/AudioPlayer":"AudioPlayer","./Building":"Building"}],RoomClock:[function(t,e,i){"use strict";cc._RF.push(e,"95f17FO9E9CGrNQqz9tayr4","RoomClock");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../utils/Utils"),l=t("./Building"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeLabel=null,e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.init=function(t){this.data.defaultPos=t},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.isCheckTimeDelay(t)&&(this.timeLabel.string=""+s.default.getHour(r.default.realTime))},n([h(cc.Label)],e.prototype,"timeLabel",void 0),n([u],e)}(l.default);i.default=d,cc._RF.pop()},{"../logic/Logic":"Logic","../utils/Utils":"Utils","./Building":"Building"}],RoomFishtank:[function(t,e,i){"use strict";cc._RF.push(e,"30f0d2Yp1xAsZ+my9YFNTdG","RoomFishtank");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=t("../logic/Logic"),l=t("../manager/LoadingManager"),c=t("../manager/NonPlayerManager"),u=t("../utils/AudioPlayer"),h=t("../utils/Utils"),d=t("./Building"),p=cc._decorator,f=p.ccclass,g=p.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fish=null,e.food=null,e.layout=null,e.isFeeding=!1,e.foodList=[],e.isFirst=!0,e.showAudio=!1,e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){this.fishSprite=this.fish.getChildByName("sprite").getComponent(cc.Sprite),this.fishIdle(),this.fishMove(),l.default.loadNpcSpriteAtlas(c.default.FISH)},e.prototype.init=function(t,e){this.dungeon=e,this.data.defaultPos=t},e.prototype.zoomCamera=function(t){this.isFirst||(t?(this.showAudio=!0,this.dungeon&&(this.dungeon.cameraTargetNode=this.node)):(this.showAudio=!1,this.dungeon&&(this.dungeon.cameraTargetNode=this.dungeon.player.node)),r.EventHelper.emit(t?r.EventHelper.HUD_CAMERA_ZOOM_IN:r.EventHelper.HUD_CAMERA_ZOOM_OUT))},e.prototype.feed=function(t){var e=this;if(!this.isFeeding)if(this.foodList.length>50)h.default.toast("\u5582\u5f97\u592a\u591a\u4e86\u554a\uff01");else{t&&t.sanityChange(1),this.isFirst=!1,this.zoomCamera(!0);for(var i=0;i<5;i++)this.initFood();this.isFeeding=!0,this.unscheduleAllCallbacks(),u.default.play(u.default.FEED_FISH),this.scheduleOnce(function(){e.isFeeding=!1},2)}},e.prototype.initFood=function(){var t=this,e=cc.instantiate(this.food);e.parent=this.layout;var i=this.layout.width,o=this.layout.height,a=cc.v3(s.default.getRandomNum(e.width/2,i-e.width/2-this.fish.width*this.fish.anchorX),s.default.getRandomNum(o,1.5*o)),n=cc.v3(a.x,s.default.getRandomNum(e.height/2+this.fish.height*this.fish.anchorY,o/2));e.position=a;var r=s.default.getRandomNum(700,1e3)/1e3;cc.tween(e).call(function(){t.scheduleOnce(function(){t.foodList.push(e)},r/2)}).to(r,{position:n}).start()},e.prototype.changeFishRes=function(t,e){var i=s.default.spriteFrameRes(t+e);i||(i=s.default.spriteFrameRes(t)),this.fishSprite.spriteFrame=i},e.prototype.fishIdle=function(){var t=this,e=cc.tween().delay(.2).call(function(){t.changeFishRes("nonplayer102anim002")}).delay(.2).call(function(){t.changeFishRes("nonplayer102anim003")}).delay(.2).call(function(){t.changeFishRes("nonplayer102anim004")}).delay(.2).call(function(){t.changeFishRes("nonplayer102anim005")});this.fishSprite.node.stopAllActions(),cc.tween(this.fishSprite.node).repeatForever(e).start()},e.prototype.fishEat=function(t){var e=this;this.fishSprite.node.stopAllActions(),cc.tween(this.fishSprite.node).delay(.2).call(function(){e.changeFishRes("nonplayer102anim010"),t>=0&&t<e.foodList.length&&e.foodList[t].isValid&&(e.foodList[t].active=!1,e.foodList[t].destroy(),e.foodList.splice(t,1))}).delay(.2).call(function(){e.changeFishRes("nonplayer102anim009")}).delay(.2).call(function(){e.fishIdle(),e.foodList.length>0?e.fishSearch():e.fishMove()}).start()},e.prototype.fishSearch=function(){var t=this;this.bubbleSort();var e=this.foodList[0].position.clone(),i=e.x>this.fish.position.x?1:-1,o=s.default.getDistanceNoSqrt(this.fish.position,e);cc.tween(this.fish).to(.2,{scaleX:i}).to(o/10,{position:e}).call(function(){t.fishEat(0)}).start()},e.prototype.fishMove=function(){var t=this,e=this.layout.width,i=this.layout.height,o=cc.v3(s.default.getRandomNum(this.fish.width/2,e-this.fish.width/2),s.default.getRandomNum(this.fish.height/2,i-this.fish.height/2)),a=o.x>this.fish.position.x?1:-1,n=s.default.getDistanceNoSqrt(this.fish.position,o);cc.tween(this.fish).to(.2,{scaleX:a}).to(n/5,{position:o}).delay(.5).call(function(){t.foodList.length>0?t.fishSearch():t.fishMove()}).start()},e.prototype.bubbleSort=function(){for(var t=this.foodList.length,e=0;e<t-1;e++)for(var i=0;i<t-1-e;i++)if(Math.abs(this.foodList[i].x-this.fish.x)>Math.abs(this.foodList[i+1].x-this.fish.x)){var o=this.foodList[i+1];this.foodList[i+1]=this.foodList[i],this.foodList[i]=o}},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>5&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.showAudio&&this.isCheckTimeDelay(t)&&u.default.play(u.default.FISHTANK)},n([g(cc.Node)],e.prototype,"fish",void 0),n([g(cc.Prefab)],e.prototype,"food",void 0),n([g(cc.Node)],e.prototype,"layout",void 0),n([f],e)}(d.default);i.default=y,cc._RF.pop()},{"../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../manager/LoadingManager":"LoadingManager","../manager/NonPlayerManager":"NonPlayerManager","../utils/AudioPlayer":"AudioPlayer","../utils/Utils":"Utils","./Building":"Building"}],RoomKitchen:[function(t,e,i){"use strict";cc._RF.push(e,"c8d0fgTekxAGY7UXDwjf5LN","RoomKitchen");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../item/Item"),s=t("../logic/Dungeon"),l=t("../utils/Utils"),c=t("./Building"),u=cc._decorator,h=u.ccclass,d=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasFood=!1,e.isAniming=!1,e}return a(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation)},e.prototype.init=function(t){this.data.defaultPos=t},e.prototype.getFood=function(t){var e=this;this.isAniming||(t.cooking(),this.isAniming=!0,this.scheduleOnce(function(){e.hasFood=!0,e.isAniming=!1,l.default.toast("\u4e00\u4efd\u9999\u55b7\u55b7\u7684\u86cb\u7092\u996d\u5b8c\u6210\u4e86\u3002",!1,!0),t.dungeon&&t.dungeon.addItem(s.default.getPosInMap(e.data.defaultPos).add(cc.v3(0,-24)),r.default.FRIEDRICE)},3))},e.prototype.AnimFinish=function(){},e.prototype.update=function(){},n([h],e)}(c.default));i.default=d,cc._RF.pop()},{"../item/Item":"Item","../logic/Dungeon":"Dungeon","../utils/Utils":"Utils","./Building":"Building"}],RoomStool:[function(t,e,i){"use strict";cc._RF.push(e,"b3a88wYknRFJqEjNBOhztfv","RoomStool");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../utils/AudioPlayer"),s=t("../utils/IndexZ"),l=t("./Building"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mosaic=null,e.isOpen=!1,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.init=function(t,e){this.dungeon=e,this.data.defaultPos=t;var i=this.mosaic.convertToWorldSpaceAR(cc.v3(0,0));this.mosaic.parent=this.node.parent,this.mosaic.position=this.mosaic.parent.convertToNodeSpaceAR(i),this.mosaic.zIndex=s.default.OVERHEAD,this.mosaic.opacity=0},e.prototype.open=function(){var t=this;this.isOpen||(this.isOpen=!0,this.mosaic.opacity=255,this.unscheduleAllCallbacks(),this.dungeon&&this.dungeon.player.toilet(),this.scheduleOnce(function(){t.mosaic.opacity=0,r.default.play(r.default.CLOSESTOOL)},5),this.scheduleOnce(function(){t.isOpen=!1},10))},n([h(cc.Node)],e.prototype,"mosaic",void 0),n([u],e)}(l.default);i.default=d,cc._RF.pop()},{"../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","./Building":"Building"}],RoomTrashCan:[function(t,e,i){"use strict";cc._RF.push(e,"68b3es2qrxMmaO3Lx7yWbz3","RoomTrashCan");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=t("../logic/Logic"),l=t("../manager/EquipmentManager"),c=t("../utils/AudioPlayer"),u=t("../utils/NextStep"),h=t("../utils/Random4Save"),d=t("./Building"),p=cc._decorator,f=p.ccclass,g=p.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.trash=null,e.next=new u.default,e.rand=new h.default(0),e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.trash.active=!1},e.prototype.init=function(t){this.data.defaultPos=t},e.prototype.getTrash=function(){var t=this;this.next.next(function(){t.trash.active=!0,t.anim.play("RoomTrashOut"),c.default.play(c.default.TRASH),t.scheduleOnce(function(){t.rand.rand()>.8&&cc.director.emit(r.EventHelper.DUNGEON_ADD_ITEM,{detail:{res:s.default.getRandomTrashType(t.rand)}}),t.rand.rand()>.95?r.EventHelper.emit(r.EventHelper.DUNGEON_SETEQUIPMENT,{res:l.default.WEAPON_BROKEN_GLASS}):t.rand.rand()>.98&&r.EventHelper.emit(r.EventHelper.DUNGEON_SETEQUIPMENT,{res:l.default.WEAPON_WINE_BOTTLE}),t.trash.active=!1},1)},2)},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(){},n([g(cc.Node)],e.prototype,"trash",void 0),n([f],e)}(d.default);i.default=y,cc._RF.pop()},{"../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../manager/EquipmentManager":"EquipmentManager","../utils/AudioPlayer":"AudioPlayer","../utils/NextStep":"NextStep","../utils/Random4Save":"Random4Save","./Building":"Building"}],RoomTv:[function(t,e,i){"use strict";cc._RF.push(e,"8c83fKZL65BO7yZt9toJ0M8","RoomTv");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../effect/ShadowOfSight"),s=t("../logic/Logic"),l=t("../utils/AudioPlayer"),c=t("../utils/Random"),u=t("../utils/Utils"),h=t("./Building"),d=cc._decorator,p=d.ccclass,f=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.screen=null,e.isOpen=!1,e.channel=0,e}return a(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.lights=this.getComponentsInChildren(r.default)},e.prototype.start=function(){for(var t=0,e=this.lights;t<e.length;t++)e[t].updateRender(!1)},e.prototype.open=function(t){var e=this;if(this.isOpen=!0,this.lights)for(var i=0,o=this.lights;i<o.length;i++)o[i].updateRender(!0);this.unscheduleAllCallbacks(),this.anim.stop(),this.anim.play("RoomTvOpen"),this.scheduleOnce(function(){e.channel=s.default.getRandomNum(0,5),e.switchChannel(t)},.5)},e.prototype.switchChannel=function(t){var e=this;switch(this.unscheduleAllCallbacks(),this.anim.stop(),l.default.stopAllEffect(),this.channel++,this.channel>5&&(this.channel=0),this.channel){case 0:this.anim.play("RoomTvOpenIdle"),l.default.play(l.default.TVCOLOR,!1,!0);break;case 1:this.anim.play("RoomTvNoSignalIdle"),l.default.play(l.default.TVWHITE,!1,!0);break;case 2:this.screen.spriteFrame=s.default.spriteFrameRes("roomtvscreen4");break;case 3:this.screen.spriteFrame=s.default.spriteFrameRes("roomtvscreen5");break;case 4:this.screen.spriteFrame=s.default.spriteFrameRes("roomtvscreen6");break;case 5:this.screen.spriteFrame=s.default.spriteFrameRes("roomtvscreen7")}this.channel>1&&this.schedule(function(){l.default.play(l.default.VOICE,!1,!0),e.scheduleOnce(function(){l.default.stopAllEffect()},.2+c.default.rand())},2,cc.macro.REPEAT_FOREVER),this.schedule(function(){e.isOpen&&e.channel>1&&(u.default.toast("\u770b\u4e86\u4e00\u4f1a\u513f\u7535\u89c6,\u611f\u89c9\u5fc3\u60c5\u53d8\u597d\u4e86"),t&&t.sanityChange(3))},10,cc.macro.REPEAT_FOREVER,5)},e.prototype.close=function(){var t=this;if(this.isOpen){if(this.isOpen=!1,this.lights)for(var e=0,i=this.lights;e<i.length;e++)i[e].updateRender(!1);this.unscheduleAllCallbacks(),this.anim.stop(),this.anim.play("RoomTvClose"),l.default.stopAllEffect(),this.scheduleOnce(function(){t.anim.play("RoomTvClosedIdle")},.5)}},e.prototype.interact=function(t){this.isOpen?this.switchChannel(t):this.open(t)},n([f(cc.Sprite)],e.prototype,"screen",void 0),n([p],e)}(h.default);i.default=g,cc._RF.pop()},{"../effect/ShadowOfSight":"ShadowOfSight","../logic/Logic":"Logic","../utils/AudioPlayer":"AudioPlayer","../utils/Random":"Random","../utils/Utils":"Utils","./Building":"Building"}],RoomType:[function(t,e,i){"use strict";cc._RF.push(e,"877a0zZc/9EjpFiULm+otfY","RoomType"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e){this.id=0,this.name="",this.id=t,this.name=e}return Object.defineProperty(t.prototype,"ID",{get:function(){return this.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"NAME",{get:function(){return this.name},enumerable:!1,configurable:!0}),t.prototype.valueCopy=function(t){this.id=t.id,this.name=t.name},t.getIdByName=function(t){return t.charCodeAt(0)-"A".charCodeAt(0)},t.getNameById=function(t){return String.fromCharCode("A".charCodeAt(0)+t)},t.getTypeByName=function(e){return new t(t.getIdByName(e),e)},t.getTypeById=function(e){return new t(e,t.getNameById(e))},t.isDecorateRoomType=function(e){return t.START_ROOM.isNotEqual(e)&&t.TEST_ROOM.isNotEqual(e)&&t.PREPARE_ROOM.isNotEqual(e)},t.isMonsterGenerateRoom=function(e){return t.DANGER_ROOM.isEqual(e)||t.INSANE_ROOM.isEqual(e)||t.BOSS_ROOM.isEqual(e)||t.KEY_ROOM.isEqual(e)||t.LOOT_ROOM.isEqual(e)||t.NORMAL_ROOM.isEqual(e)||t.END_ROOM.isEqual(e)||t.VERTICAL_ROOM.isEqual(e)||t.HORIZONTAL_ROOM.isEqual(e)},t.prototype.isEqual=function(t){return t.ID==this.ID},t.prototype.isNotEqual=function(t){return t.ID!=this.ID},t.ELITE_ROOM=new t(0,"A"),t.BOSS_ROOM=new t(1,"B"),t.CROSS_ROOM=new t(2,"C"),t.DANGER_ROOM=new t(3,"D"),t.END_ROOM=new t(4,"E"),t.FINAL_ROOM=new t(5,"F"),t.G_ROOM=new t(6,"G"),t.HORIZONTAL_ROOM=new t(7,"H"),t.INSANE_ROOM=new t(8,"I"),t.TUTORIAL_ROOM=new t(9,"J"),t.KEY_ROOM=new t(10,"K"),t.LOOT_ROOM=new t(11,"L"),t.MERCHANT_ROOM=new t(12,"M"),t.NORMAL_ROOM=new t(13,"N"),t.EMPTY_ROOM=new t(14,"O"),t.PREPARE_ROOM=new t(15,"P"),t.Q_ROOM=new t(16,"Q"),t.REST_ROOM=new t(17,"R"),t.START_ROOM=new t(18,"S"),t.TEST_ROOM=new t(19,"T"),t.U_ROOM=new t(20,"U"),t.VERTICAL_ROOM=new t(21,"V"),t.WATER_ROOM=new t(22,"W"),t.X_ROOM=new t(23,"X"),t.HIDDEN_ROOM=new t(24,"Y"),t.Z_ROOM=new t(25,"Z"),t}();i.default=o,cc._RF.pop()},{}],RoomWaterDispenser:[function(t,e,i){"use strict";cc._RF.push(e,"636caPAwH1EkaM8RamKmvm5","RoomWaterDispenser");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/ItemData"),s=t("../utils/AudioPlayer"),l=t("./Building"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cup=null,e.hasWater=!1,e.isAniming=!1,e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation)},e.prototype.init=function(t){this.data.defaultPos=t},e.prototype.getWater=function(t){if(!this.isAniming)if(this.hasWater){this.cup.opacity=0,this.hasWater=!1;var e=new r.default;e.liquidSatiety=15,t.canEatOrDrink(e)&&t.drink()}else this.isAniming=!0,this.anim.play("RoomWaterDispenser"),s.default.play(s.default.WATERDISPENSER)},e.prototype.AnimFinish=function(){this.hasWater=!0,this.isAniming=!1},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>5&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(){},n([h(cc.Node)],e.prototype,"cup",void 0),n([u],e)}(l.default);i.default=d,cc._RF.pop()},{"../data/ItemData":"ItemData","../utils/AudioPlayer":"AudioPlayer","./Building":"Building"}],SatietyView:[function(t,e,i){"use strict";cc._RF.push(e,"0209bBn/xJKQ4t4J010Y1Yq","SatietyView");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sanityLabel=null,e.solid=null,e.solid1=null,e.liquid=null,e.liquid1=null,e.tips=null,e.solidlabel=null,e.liquidlabel=null,e.solidlabel1=null,e.liquidlabel1=null,e.sanitybar=null,e.sanityPercentLabel=null,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.tips.active=!1,this.node.on(cc.Node.EventType.TOUCH_START,function(){t.tips.active=!0}),this.node.on(cc.Node.EventType.TOUCH_END,function(){t.tips.active=!1}),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.tips.active=!1})},e.prototype.start=function(){},e.prototype.refreshPercent=function(t,e,o,a,n){this.node&&(this.node.stopAllActions(),cc.tween(this.solid).to(.5,{height:e}).start(),cc.tween(this.solid1).to(.5,{height:o}).start(),cc.tween(this.liquid).to(.5,{height:a}).start(),cc.tween(this.liquid1).to(.5,{height:n}).start(),this.sanityLabel.string=this.getStr(t,i.SANITYTIPS,!1),this.solidlabel.string=this.getStr(e,i.SOLIDTIPS,!1),this.liquidlabel.string=this.getStr(a,i.LIQUIDTIPS,!1),this.solidlabel1.string=this.getStr(100-o,i.POOTIPS,!0),this.liquidlabel1.string=this.getStr(100-n,i.PEETIPS,!0),this.sanityLabel.node.color=this.getColor(t,!1),this.solidlabel.node.color=this.getColor(e,!1),this.liquidlabel.node.color=this.getColor(a,!1),this.solidlabel1.node.color=this.getColor(o,!0),this.liquidlabel1.node.color=this.getColor(n,!0),this.sanitybar.progress=t/100,this.sanityPercentLabel.string=t.toFixed(2)+"%")},e.prototype.getStr=function(t,e,i){var o=t;return i&&(o=100-t),(0==t?e[0]:t<20?e[1]:t<40?e[2]:t<60?e[3]:t<80?e[4]:e[5])+"("+o.toFixed()+"/100)"},e.prototype.getColor=function(t,e){var i=["#DC143C","#FFC0CB","#FFFF00","#ADFF2F","#90EE90"];return e&&(i=["#90EE90","#ADFF2F","#FFFF00","#FFC0CB","#DC143C"]),t<20?cc.color().fromHEX(i[0]):t<40?cc.color().fromHEX(i[1]):t<60?cc.color().fromHEX(i[2]):t<80?cc.color().fromHEX(i[3]):cc.color().fromHEX(i[4])},e.SANITYTIPS=["\u7cbe\u795e\u5d29\u6e83","\u7cbe\u795e\u5931\u5e38","\u7cbe\u795e\u840e\u9761","\u7cbe\u795e\u5e73\u7a33","\u7cbe\u795e\u4ea2\u594b","\u7cbe\u795e\u7115\u53d1"],e.SOLIDTIPS=["\u51e0\u4e4e\u997f\u6b7b","\u9965\u80a0\u8f98\u8f98","\u7565\u5fae\u5c0f\u98df","\u83dc\u8fc7\u4e94\u5473","\u9152\u8db3\u996d\u9971","\u5feb\u6491\u7206\u4e86"],e.LIQUIDTIPS=["\u5feb\u8981\u6e34\u6b7b","\u5589\u5499\u5192\u70df","\u53e3\u5e72\u820c\u71e5","\u9152\u8fc7\u4e09\u5de1","\u975e\u5e38\u6ee1\u8db3","\u5feb\u6491\u7206\u4e86"],e.POOTIPS=["\u7ef7\u4e0d\u4f4f\u4e86","\u5bf8\u6b65\u96be\u884c","\u4e0d\u582a\u91cd\u8d1f","\u4eba\u6709\u4e09\u6025","\u5982\u91ca\u91cd\u8d1f","\u8eab\u8f7b\u5982\u71d5"],e.PEETIPS=["\u7ef7\u4e0d\u4f4f\u4e86","\u72c2\u6d9b\u6012\u543c","\u6ce2\u6d9b\u6c79\u6d8c","\u6d93\u6d93\u7ec6\u6d41","\u6cdb\u8d77\u5fae\u6ce2","\u98ce\u5e73\u6d6a\u9759"],n([l(cc.Label)],e.prototype,"sanityLabel",void 0),n([l(cc.Node)],e.prototype,"solid",void 0),n([l(cc.Node)],e.prototype,"solid1",void 0),n([l(cc.Node)],e.prototype,"liquid",void 0),n([l(cc.Node)],e.prototype,"liquid1",void 0),n([l(cc.Node)],e.prototype,"tips",void 0),n([l(cc.Label)],e.prototype,"solidlabel",void 0),n([l(cc.Label)],e.prototype,"liquidlabel",void 0),n([l(cc.Label)],e.prototype,"solidlabel1",void 0),n([l(cc.Label)],e.prototype,"liquidlabel1",void 0),n([l(cc.ProgressBar)],e.prototype,"sanitybar",void 0),n([l(cc.Label)],e.prototype,"sanityPercentLabel",void 0),i=n([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{}],SavePointData:[function(t,e,i){"use strict";cc._RF.push(e,"2940aORMiBLQ5k/LNcPv2bl","SavePointData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.x=16,this.y=16,this.chapter=0,this.level=0}return t.prototype.valueCopy=function(t){t&&(this.x=t.x||0==t.x?t.x:16,this.y=t.y||0==t.y?t.y:16,this.chapter=t.chapter?t.chapter:0,this.level=t.level?t.level:0)},t.prototype.clone=function(){var e=new t;return e.x=this.x,e.y=this.y,e.chapter=this.chapter,e.level=this.level,e},t}();i.default=o,cc._RF.pop()},{}],SavePoint:[function(t,e,i){"use strict";cc._RF.push(e,"b080bpXecxCVaM8ctiNSXZl","SavePoint");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/ExitData"),s=t("../effect/ShadowOfSight"),l=t("../logic/EventHelper"),c=t("../logic/Logic"),u=t("../ui/Tips"),h=t("../utils/AudioPlayer"),d=t("./Building"),p=cc._decorator,f=p.ccclass,g=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isOpen=!1,e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.anim=this.getComponent(cc.Animation),this.lights=this.getComponentsInChildren(s.default),this.tips=this.getComponentInChildren(u.default),this.tips.onInteract(function(e,i){t.node&&(i&&(c.default.playerData=i.data.clone()),c.default.savePonit(t.data.defaultPos),c.default.resetData(),l.EventHelper.emit(l.EventHelper.DUNGEON_DISAPPEAR),h.default.play(h.default.EXIT),t.scheduleOnce(function(){l.EventHelper.emit(l.EventHelper.HUD_CAMERA_ZOOM_IN,{}),c.default.loadingNextLevel(r.default.getRealWorldExitDataFromDream(c.default.chapterIndex,c.default.level))},1))})},e.prototype.start=function(){for(var t=0,e=this.lights;t<e.length;t++)e[t].updateRender(!1)},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.05&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){if(this.lights.length>0&&this.lights[0].showShadow&&this.isCheckTimeDelay(t)){var e=this.lights[0].radius;e=c.default.lerp(e,300,5*t),this.lights[0].radius=e}},e.prototype.open=function(){var t=this;this.isOpen||(c.default.savePonit(this.data.defaultPos),this.isOpen=!0,this.scheduleOnce(function(){t.anim.play("SavePointActive"),t.scheduleOnce(function(){for(var e=0,i=t.lights;e<i.length;e++){var o=i[e];o.radius=0,o.updateRender(!0)}t.anim.play("SavePointIdleActive"),t.tips.node.active=!0},1)},1))},n([f],e)}(d.default));i.default=g,cc._RF.pop()},{"../data/ExitData":"ExitData","../effect/ShadowOfSight":"ShadowOfSight","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../ui/Tips":"Tips","../utils/AudioPlayer":"AudioPlayer","./Building":"Building"}],Saw:[function(t,e,i){"use strict";cc._RF.push(e,"e4758hHN8ZNFpX/Yga2qrRo","Saw");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../data/DamageData"),l=t("./Building"),c=t("../manager/StatusManager"),u=t("../utils/Random"),h=t("../data/FromData"),d=t("../utils/IndexZ"),p=t("../utils/ActorUtils"),f=cc._decorator,g=f.ccclass,y=f.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.normalSpriteFrame=null,e.bloodSpriteFrame=null,e.pos=cc.v3(0,0),e}return a(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.sprite.spriteFrame=this.normalSpriteFrame},e.prototype.start=function(){},e.prototype.setPos=function(t){this.pos=t;var e=r.default.getPosInMap(t);this.entity.Transform.position=cc.v3(e.x,e.y),this.node.position=this.entity.Transform.position.clone(),this.node.zIndex=d.default.FLOOR},e.prototype.onColliderEnter=function(t){var e=p.default.getEnemyCollisionTarget(t);if(e){var i=h.default.getClone(this.actorName(),"saw002");e.takeDamage(new s.default(1),i),u.default.rand()<.1&&e.addStatus(c.default.BLEEDING,i),this.sprite.spriteFrame=this.bloodSpriteFrame}},e.prototype.update=function(){for(var t=0,e=this.ccolliders;t<e.length;t++)e[t].updateChildOffset()},e.prototype.actorName=function(){return"\u952f\u9f7f\u8f6e"},n([y(cc.SpriteFrame)],e.prototype,"normalSpriteFrame",void 0),n([y(cc.SpriteFrame)],e.prototype,"bloodSpriteFrame",void 0),n([g],e)}(l.default);i.default=m,cc._RF.pop()},{"../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/Dungeon":"Dungeon","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/IndexZ":"IndexZ","../utils/Random":"Random","./Building":"Building"}],Seeker:[function(t,e,i){"use strict";cc._RF.push(e,"9d901Qk1AZCcpW5rnbx33wB","Seeker");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=cc._decorator,l=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isMoving=!1,e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.rigidbody=this.getComponent(cc.RigidBody),this.node.zIndex=1e3,cc.director.on(r.EventHelper.PLAYER_MOVE,function(e){t.move(e.detail.dir,e.detail.pos,e.detail.dt)})},e.prototype.move=function(t,e){var i=e.x,o=e.y,a=Math.abs(i),n=Math.abs(o),r=a>n?a:n;r=0==r?1:r;var s=cc.v2(i,o),l=500;l<0&&(l=0),s=s.mul(l),this.rigidbody.linearVelocity=s,this.isMoving=0!=i||0!=o},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.2&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.isCheckTimeDelay(t)&&this.isMoving&&cc.director.emit(r.EventHelper.CHUNK_LOAD,{detail:{pos:this.node.position.clone()}})},n([l],e)}(cc.Component));i.default=c,cc._RF.pop()},{"../logic/EventHelper":"EventHelper"}],SettingsDialog:[function(t,e,i){"use strict";cc._RF.push(e,"201faQ17bhLsoyeY0sNn6x5","SettingsDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../../logic/EventHelper"),s=t("../../logic/Logic"),l=t("../../utils/AudioPlayer"),c=t("../../utils/LocalStorage"),u=t("./BaseDialog"),h=cc._decorator,d=h.ccclass,p=h.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tgShadow=null,e.tgGamepad=null,e.tgFps=null,e.pcInfo=null,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.show=function(){t.prototype.show.call(this),this.pcInfo.active=!c.default.isSwitchOpen(c.default.KEY_SWITCH_SHOW_GAMEPAD),this.initToggle(this.tgShadow,c.default.isSwitchOpen(c.default.KEY_SWITCH_SHOW_SOFT_SHADOW)),this.initToggle(this.tgGamepad,c.default.isSwitchOpen(c.default.KEY_SWITCH_SHOW_GAMEPAD)),this.initToggle(this.tgFps,c.default.isSwitchOpen(c.default.KEY_SWITCH_LOW_POWER))},e.prototype.initToggle=function(t,e){e?t.check():t.uncheck()},e.prototype.toggleShadow=function(t){l.default.play(l.default.SELECT),s.default.settings.showSoftShadow=t.isChecked,c.default.saveSwitch(c.default.KEY_SWITCH_SHOW_SOFT_SHADOW,s.default.settings.showSoftShadow)},e.prototype.toggleGamepad=function(t){l.default.play(l.default.SELECT),s.default.settings.showGamepad=t.isChecked,c.default.saveSwitch(c.default.KEY_SWITCH_SHOW_GAMEPAD,s.default.settings.showGamepad),this.pcInfo.active=!s.default.settings.showGamepad,cc.director.emit(r.EventHelper.HUD_CONTROLLER_UPDATE_GAMEPAD)},e.prototype.toggleFps=function(t){l.default.play(l.default.SELECT),s.default.settings.lowPower=t.isChecked,c.default.saveSwitch(c.default.KEY_SWITCH_LOW_POWER,s.default.settings.lowPower),cc.director.emit(r.EventHelper.SETTINGS_LOW_POWER)},e.prototype.close=function(){cc.director.getScheduler().setTimeScale(1),l.default.play(l.default.SELECT),this.dismiss()},e.prototype.home=function(){l.default.play(l.default.SELECT),cc.director.getScheduler().setTimeScale(1),cc.director.loadScene("start")},n([p(cc.Toggle)],e.prototype,"tgShadow",void 0),n([p(cc.Toggle)],e.prototype,"tgGamepad",void 0),n([p(cc.Toggle)],e.prototype,"tgFps",void 0),n([p(cc.Node)],e.prototype,"pcInfo",void 0),n([d],e)}(u.default);i.default=f,cc._RF.pop()},{"../../logic/EventHelper":"EventHelper","../../logic/Logic":"Logic","../../utils/AudioPlayer":"AudioPlayer","../../utils/LocalStorage":"LocalStorage","./BaseDialog":"BaseDialog"}],Settings:[function(t,e,i){"use strict";cc._RF.push(e,"9f7a3vE481MQYBScX8VK6ox","Settings"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(){this.showSoftShadow=!1,this.showGamepad=!0,this.showEquipDialog=!1,this.lowPower=!1},cc._RF.pop()},{}],ShadowOfSight:[function(t,e,i){"use strict";cc._RF.push(e,"f6922FctbtKnrAA7zoIN/Yg","ShadowOfSight");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../collider/CCollider"),s=t("../ecs/system/GameWorldSystem"),l=t("../base/Actor"),c=cc._decorator,u=c.ccclass,h=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ray=null,e.rayNum=180,e.renderColor=cc.color(255,255,255,1),e.showLight=!0,e.showRayCast=!1,e.fromSky=!1,e.showShadow=!0,e.lightVertsArray=new Array,e.lightRects={},e.circle=cc.v3(0,0,0),e.offset=0,e.offsetPlus=!1,e.lightTargetMap=new Map,e.sensorTargetMap=new Map,e.ignoreMap=new Map,e}return a(e,t),e.prototype.onLoad=function(){this.mat=this.ray.getMaterial(0),this.polygonCollider=this.getComponent(cc.PolygonCollider),this.customCollider=this.getComponent(r.default);for(var t=0,e=[r.default.TAG.BOSS,r.default.TAG.BUILDING,r.default.TAG.GOODNONPLAYER,r.default.TAG.NONPLAYER,r.default.TAG.PLAYER,r.default.TAG.WALL,r.default.TAG.WALL_TOP];t<e.length;t++){var i=e[t];this.lightTargetMap.set(i,!0)}if(this.customCollider&&this.customCollider.ignoreTagList)for(var o=0,a=this.customCollider.ignoreTagList;o<a.length;o++)i=a[o],this.lightTargetMap.has(i)&&this.lightTargetMap.delete(i);var n=this.initIgnoreMap(this.node.parent.getComponent(l.default));!n&&this.node.parent.parent&&!(n=this.initIgnoreMap(this.node.parent.parent.getComponent(l.default)))&&this.node.parent.parent.parent&&(n=this.initIgnoreMap(this.node.parent.parent.parent.getComponent(l.default)))},e.prototype.initIgnoreMap=function(t){if(!t)return!1;var e=t.node.getComponentsInChildren(r.default);if(e&&e.length>0)for(var i=0,o=e;i<o.length;i++){var a=o[i];this.ignoreMap.set(a.id,!0)}return!0},e.prototype.renderSightArea=function(t){var e=this.node.convertToWorldSpaceAR(cc.v2(0,0));this.offset>20?this.offsetPlus=!1:this.offset<-20&&(this.offsetPlus=!0),this.offset=this.offsetPlus?this.offset+.1:this.offset-.1,this.ray.clear(),this.showShadow&&(this.lightRects={},this.lightVertsArray=[],this.circle=cc.v3(0,0,0),this.showRayCast?this.drawRayByNum(e,t,this.showLight):this.drawCustom(e,t,this.showLight))},e.prototype.updateRender=function(t){this.showShadow=t},e.prototype.setCustomColliderStyle=function(t,e,i,o){this.customCollider&&(this.customCollider.w=e,this.customCollider.h=i,this.customCollider.radius=o,this.customCollider.type=t?r.default.TYPE.RECT:r.default.TYPE.CIRCLE,this.customCollider.fixCenterAndScale())},e.prototype.drawCustom=function(t,e,i){if(this.ray.lineWidth=10,this.ray.fillColor=this.renderColor,this.polygonCollider&&this.polygonCollider.points.length>2){for(var o=0;o<this.polygonCollider.points.length;o++){var a=this.node.convertToWorldSpaceAR(this.polygonCollider.points[o]);this.lightVertsArray.push(a),i&&(0==o?this.ray.moveTo(this.polygonCollider.points[o].x,this.polygonCollider.points[o].y):this.ray.lineTo(this.polygonCollider.points[o].x,this.polygonCollider.points[o].y))}if(i){this.ray.close(),this.ray.fill();var n=e.getWorldToScreenPoint(t);this.updateMat(this.mat,cc.v2(n.x,n.y),e.zoomRatio)}}if(this.customCollider&&this.customCollider.type==r.default.TYPE.RECT&&this.customCollider.w>0&&this.customCollider.h>0){for(o=0;o<this.customCollider.points.length;o++)a=this.node.convertToNodeSpaceAR(this.customCollider.points[o]),this.lightVertsArray.push(this.customCollider.points[o]),i&&(0==o?this.ray.moveTo(a.x,a.y):this.ray.lineTo(a.x,a.y));i&&(this.ray.close(),this.ray.fill(),n=e.getWorldToScreenPoint(t),this.updateMat(this.mat,cc.v2(n.x,n.y),e.zoomRatio))}if(this.customCollider&&this.customCollider.type==r.default.TYPE.CIRCLE&&this.customCollider.radius>0&&(a=this.node.convertToWorldSpaceAR(cc.v2(this.customCollider.offsetX,this.customCollider.offsetY)),this.circle=cc.v3(a.x,a.y,this.getRadius()),i)){this.ray.lineWidth=10,this.ray.fillColor=this.renderColor;var s=this.customCollider.offset;this.ray.circle(s.x,s.y,this.getRadius()),this.ray.fill(),n=e.getWorldToScreenPoint(t),this.updateMat(this.mat,cc.v2(n.x,n.y),e.zoomRatio)}},e.prototype.drawRayByNum=function(t,e,i){if(this.customCollider&&!(this.customCollider.radius<=0)){this.ray.lineWidth=10,this.ray.fillColor=this.renderColor;var o=2*Math.PI/this.rayNum;this.lightVertsArray=new Array,this.lightRects={};for(var a=0;a<this.rayNum;a++){var n=cc.v2(Math.cos(a*o)*this.getRadius()+t.x,Math.sin(a*o)*this.getRadius()+t.y),r=s.default.colliderSystem.nearestRayCast(cc.v2(t),cc.v2(n),this.lightTargetMap,this.sensorTargetMap,this.ignoreMap);if(r){n=r.point;var l=r.collider.node;if(l.convertToNodeSpaceAR(n).y<=0&&n.y>t.y){var c=l.convertToWorldSpaceAR(cc.v3(0,0)),u=cc.rect(c.x-l.width*l.anchorX,c.y-l.height*l.anchorY-0,l.width,l.height+0);this.lightRects[l.uuid]=u}}if(this.lightVertsArray.push(n),this.ray.lineWidth=3,this.ray.strokeColor=cc.color(0,0,0,80),i)if(0==a){var h=this.node.convertToNodeSpaceAR(n);this.ray.moveTo(h.x,h.y)}else{var d=this.node.convertToNodeSpaceAR(n);this.ray.lineTo(d.x,d.y)}}if(i){for(var p in this.ray.close(),this.ray.fill(),this.ray.fillColor.a=this.ray.fillColor.a/2,this.lightRects)u=this.lightRects[p],d=this.node.convertToNodeSpaceAR(cc.v3(u.x,u.y)),this.ray.rect(d.x,d.y,u.width,u.height),this.ray.fill();var f=e.getWorldToScreenPoint(t);this.updateMat(this.mat,cc.v2(f.x,f.y),e.zoomRatio)}}},e.prototype.getRadius=function(){return this.radius+this.offset},Object.defineProperty(e.prototype,"radius",{get:function(){return this.customCollider&&!this.polygonCollider?this.customCollider.radius*this.customCollider.node.scale:this.node.width/2},set:function(t){this.customCollider&&(this.customCollider.radius=t)},enumerable:!1,configurable:!0}),e.prototype.updateMat=function(t,e,i){var o=cc.view.getCanvasSize(),a=cc.view.getVisibleSize(),n=a.width/a.height,r=this.getRadius()/a.height,s=o.width/a.width;t.setProperty("screen",cc.v2(o.width,o.height)),t.setProperty("maxRadius",r*i),t.setProperty("whRatio",n);var l=cc.v2(e.x/a.width,e.y/a.height),c=Math.abs(l.y-.5)*a.height*s/o.height;this.mat.setProperty("lightPos",cc.v2(l.x,l.y>.5?.5+c:.5-c))},n([h(cc.Graphics)],e.prototype,"ray",void 0),n([h(cc.Color)],e.prototype,"renderColor",void 0),n([h],e.prototype,"showLight",void 0),n([h],e.prototype,"showRayCast",void 0),n([h],e.prototype,"fromSky",void 0),n([u],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../base/Actor":"Actor","../collider/CCollider":"CCollider","../ecs/system/GameWorldSystem":"GameWorldSystem"}],ShadowPlayer:[function(t,e,i){"use strict";cc._RF.push(e,"37457/YUj5OXbrBhQ2rg17W","ShadowPlayer");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Logic"),l=t("../logic/PlayerWeapon"),c=t("../logic/Shooter"),u=t("../utils/IndexZ"),h=t("../utils/NextStep"),d=cc._decorator,p=d.ccclass,f=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.weaponLeft=null,e.weaponRight=null,e.shooterEx=null,e.sprite=null,e.index=0,e.lifeNext=new h.default,e.isStop=!1,e.targetPos=cc.v3(0,0),e.movePos=cc.v3(0,0),e.playerLastPos=cc.v3(0,0),e.moveList=[],e.SCALE=3,e.isVanishing=!1,e}return a(e,t),e.prototype.init=function(t,e,i,o){var a=this,n=o||30;this.player=t,this.index=i,this.player.data.ShadowList[this.index]=Date.now(),this.node.parent=this.player.node.parent,this.weaponLeft.init(this.player,!0,!0),this.weaponRight.init(this.player,!1,!0),this.weaponLeft.node.opacity=0,this.weaponRight.node.opacity=0,this.shooterEx.player=this.player,this.shooterEx.isEx=!0,this.mat=this.sprite.getMaterial(0),this.sprite.node.scaleX=this.SCALE,this.sprite.node.scaleY=-this.SCALE,this.sprite.spriteFrame=e,this.node.zIndex=u.default.getActorZIndex(r.default.getIndexInMap(this.node.position)),this.sprite.node.width=this.sprite.spriteFrame.getOriginalSize().width,this.sprite.node.height=this.sprite.spriteFrame.getOriginalSize().height,this.node.position=this.player.node.position.clone(),this.targetPos=this.player.node.position.clone(),this.playerLastPos=this.player.node.position.clone(),this.isStop=!1,this.isVanishing=!1,this.lifeNext.next(function(){},n,!0,function(t){var e=Date.now();e-t<1e3*n&&a.node&&a.isValid&&!a.isStop&&(a.player.data.ShadowList[a.index]=t),e-t>1e3*n&&a.stop()})},e.prototype.attack=function(t,e,i,o){return!!this.node&&(o?this.weaponLeft.shadowWeapon.attack(t,e,i):this.weaponRight.shadowWeapon.attack(t,e,i))},e.prototype.remoteAttack=function(t,e,i,o,a,n){if(!this.node)return!1;var r=t?this.weaponLeft.shooter:this.weaponRight.shooter;r.data=e.clone(),r.setHv(i),r.remoteDamagePlayer=o,r.fireBullet(0,cc.v3(30,0),a,n)},e.prototype.stop=function(){this.isValid&&(this.isStop=!0,this.player.data.ShadowList[this.index]=0,this.node.active=!1,this.enabled=!1,this.destroy())},e.prototype.getCenterPosition=function(){return this.node.position.clone().addSelf(cc.v3(0,32*this.node.scaleY))},e.prototype.vanish=function(t){var e=this;this.isVanishing=!0,this.scheduleOnce(function(){e.isVanishing=!1},t)},e.prototype.updateLogic=function(t){if(this.player){if(this.movePos.x+=Math.abs(this.player.node.position.x-this.playerLastPos.x),this.movePos.y+=Math.abs(this.player.node.position.y-this.playerLastPos.y),this.playerLastPos=this.player.node.position.clone(),this.movePos.x>5||this.movePos.y>5){this.movePos=cc.v3(0,0);var e=this.player.node.position.clone();e.z=this.player.isFaceRight?1:-1,this.moveList.push(e)}if(this.moveList.length>0){var i=this.moveList[0].x-this.targetPos.x,o=this.moveList[0].y-this.targetPos.y;i*i+o*o<25&&this.moveList.splice(0,1),this.moveList.length>10*(this.index+1)&&(this.targetPos=this.moveList[0].clone())}this.node.zIndex=u.default.getActorZIndex(r.default.getIndexInMap(this.node.position)),this.sprite.node.opacity=200-20*this.index,this.isVanishing&&(this.sprite.node.opacity=0),this.mat.setProperty("textureSizeWidth",this.sprite.spriteFrame.getTexture().width*this.SCALE),this.mat.setProperty("textureSizeHeight",this.sprite.spriteFrame.getTexture().height*this.SCALE),this.mat.setProperty("outlineColor",cc.color(200,200,200)),this.mat.setProperty("outlineSize",4),this.weaponLeft.shadowWeapon.IsAttacking||this.weaponRight.shadowWeapon.IsAttacking||(this.node.position=s.default.lerpPos(this.node.position,this.targetPos,3*t))}},n([f(l.default)],e.prototype,"weaponLeft",void 0),n([f(l.default)],e.prototype,"weaponRight",void 0),n([f(c.default)],e.prototype,"shooterEx",void 0),n([f(cc.Sprite)],e.prototype,"sprite",void 0),n([p],e)}(cc.Component);i.default=g,cc._RF.pop()},{"../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../logic/PlayerWeapon":"PlayerWeapon","../logic/Shooter":"Shooter","../utils/IndexZ":"IndexZ","../utils/NextStep":"NextStep"}],Shield:[function(t,e,i){"use strict";cc._RF.push(e,"a9e32odPWRNMpWClq+mn20V","Shield");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../data/EquipmentData"),l=t("../data/FromData"),c=t("../data/TriggerData"),u=t("../effect/BlockLight"),h=t("../manager/InventoryManager"),d=t("../manager/StatusManager"),p=t("../utils/IndexZ"),f=t("./EventHelper"),g=t("./Logic"),y=t("./PlayerAvatar"),m=cc._decorator,v=m.ccclass,E=m.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.blockLightPrefab=null,e.status=-1,e.data=new s.default,e.isBehind=!1,e.avatarZindex=0,e.isBehindChange=!1,e.dir=3,e.isButtonPressing=!1,e}var i;return a(e,t),i=e,Object.defineProperty(e.prototype,"isAniming",{get:function(){return this.status==i.STATUS_PUTDOWN||this.status==i.STATUS_PARRY},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDefendOrParrying",{get:function(){return this.status==i.STATUS_DEFEND||this.status==i.STATUS_PARRY},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Status",{get:function(){return this.status},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){var t=this;cc.director.on(f.EventHelper.POOL_DESTORY_BLOCKLIGHT,function(e){t.destroySmoke(e.detail.targetNode)}),this.blocklightPool=new cc.NodePool},e.prototype.getBlockLight=function(t,e){var o=null;this.blocklightPool.size()>0&&(o=this.blocklightPool.get()),o&&!o.active||(o=cc.instantiate(this.blockLightPrefab)),o.parent=t,o.position=e,o.zIndex=p.default.OVERHEAD,o.scale=this.status==i.STATUS_PARRY?2:1,o.opacity=255,o.active=!0,o.getComponent(u.default).show()},e.prototype.blockDamage=function(t,e,o,a){if(this.status<0||this.status==i.STATUS_IDLE||this.status==i.STATUS_PUTDOWN)return 0;if(e.getTotalDamage()<=0)return 0;var n=t.node.parent.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(cc.Vec2.ZERO));return this.getBlockLight(t.node.parent,cc.v3(n.x,n.y)),a&&(this.status==i.STATUS_PARRY&&(a.addStatus(d.default.SHIELD_PARRY,new l.default),a.takeDamage(new r.default(this.data.Common.blockDamage)),t.exTrigger(c.default.GROUP_HURT,c.default.TYPE_HURT_PARRAY,o,a)),this.status==i.STATUS_DEFEND&&t.exTrigger(c.default.GROUP_HURT,c.default.TYPE_HURT_BLOCK,o,a)),this.status==i.STATUS_PARRY?i.BLOCK_PARRY:i.BLOCK_NORMAL},e.prototype.destroySmoke=function(t){t&&(t.active=!1,this.blocklightPool&&this.blocklightPool.put(t))},e.prototype.playIdle=function(){if(this.status!=i.STATUS_DEFEND&&this.status!=i.STATUS_PARRY&&this.status!=i.STATUS_IDLE){this.status=i.STATUS_IDLE,cc.log("\u7b49\u5f85 isBehind:"+this.isBehind+" zIndex:"+this.node.zIndex),this.sprite.node.stopAllActions();var t=1==this.data.isHeavy?.4:.2,e=cc.tween().to(t,{y:2}).to(t,{y:-2});cc.tween(this.sprite.node).repeatForever(e).start()}},e.prototype.playParry=function(t){var e=this;if(this.status!=i.STATUS_PUTDOWN&&this.status!=i.STATUS_DEFEND&&this.status!=i.STATUS_PARRY){this.status=i.STATUS_PARRY;var o=1==this.data.isHeavy?.15:.1,a=1==this.data.isHeavy?.1:.15,n=i.DEFAULT_POS[this.dir].clone(),r=i.TRANSFORM_POS[this.dir].clone();t||(n.x=-n.x,r.x=-r.x),cc.log("\u4e3e\u8d77 isBehind:"+this.isBehind+" zIndex:"+this.node.zIndex),cc.tween(this.node).to(o,{position:r}).call(function(){e.node.zIndex=e.isBehind?e.avatarZindex+i.ZOFFSET:e.avatarZindex-i.ZOFFSET,e.sprite.node.color=e.isBehind?cc.Color.WHITE:cc.color(32,32,32)}).to(o,{position:n}).delay(a).call(function(){e.isButtonPressing?e.playDefend():e.playPutDown(t)}).start()}},e.prototype.playDefend=function(){this.status!=i.STATUS_PUTDOWN&&this.status!=i.STATUS_DEFEND&&(this.status=i.STATUS_DEFEND,cc.log("\u9632\u5fa1 isBehind:"+this.isBehind+" zIndex:"+this.node.zIndex))},e.prototype.playPutDown=function(t){var e=this;if(this.status!=i.STATUS_PUTDOWN&&this.status!=i.STATUS_IDLE){var o=this.isBehindChange?!this.isBehind:this.isBehind;this.status=i.STATUS_PUTDOWN;var a=1==this.data.isHeavy?.2:.1,n=i.DEFAULT_POS[this.dir].clone(),r=i.TRANSFORM_POS[this.dir].clone();t||(n.x=-n.x,r.x=-r.x),cc.log("\u653e\u4e0b isBehind:"+this.isBehind+" isBehindTemp:"+o+" zIndex:"+this.node.zIndex),cc.tween(this.node).to(a,{position:r}).call(function(){e.node.zIndex=o?e.avatarZindex-i.ZOFFSET:e.avatarZindex+i.ZOFFSET,e.sprite.node.color=o?cc.color(32,32,32):cc.Color.WHITE}).to(a,{position:n}).call(function(){e.playIdle()}).start()}},e.prototype.changeZIndexByDir=function(t,e,o){if(!this.isAniming){this.avatarZindex=t,this.dir=e;var a=this.status==i.STATUS_DEFEND,n=t-i.ZOFFSET;switch(e){case y.default.DIR_UP:n=t+(a?-i.ZOFFSET:i.ZOFFSET),this.sprite.node.color=a?cc.color(32,32,32):cc.Color.WHITE;break;case y.default.DIR_DOWN:n=t+(a?i.ZOFFSET:-i.ZOFFSET),this.sprite.node.color=a?cc.Color.WHITE:cc.color(32,32,32);break;case y.default.DIR_LEFT:case y.default.DIR_RIGHT:n=t+(a?i.ZOFFSET:-i.ZOFFSET),this.sprite.node.color=a?cc.Color.WHITE:cc.color(32,32,32)}var r=this.isBehind;this.isBehind=e!=y.default.DIR_UP,this.isBehindChange=this.isBehind!=r,this.node.zIndex=n;var s=a?i.DEFEND_POS[e]:i.DEFAULT_POS[e].clone();o||(s.x=-s.x),this.node.position=s}},e.prototype.use=function(t){this.isButtonPressing=!0,this.data.equipmetType==h.default.SHIELD&&this.status!=i.STATUS_PUTDOWN&&(this.isDefendOrParrying||this.playParry(t))},e.prototype.cancel=function(t){this.isButtonPressing=!1,this.status==i.STATUS_DEFEND&&this.playPutDown(t)},e.prototype.changeRes=function(t){!t||t.length<1||(this.sprite.spriteFrame=g.default.spriteFrameRes(t),this.sprite.node.width=1==this.data.isHeavy?80:64,this.sprite.node.height=1==this.data.isHeavy?80:64,this.data.equipmetType==h.default.SHIELD&&this.playIdle())},e.prototype.faceRightChange=function(t){if(this.status!=i.STATUS_PUTDOWN&&this.status!=i.STATUS_DEFEND&&this.status!=i.STATUS_PARRY){var e=1==this.data.isHeavy?.2:.1,o=i.DEFAULT_POS[this.dir].clone();t||(o.x=-o.x),cc.tween(this.node).to(e,{position:o}).start()}},e.BLOCK_FAILED=0,e.BLOCK_NORMAL=1,e.BLOCK_PARRY=2,e.STATUS_IDLE=0,e.STATUS_PARRY=1,e.STATUS_DEFEND=2,e.STATUS_PUTDOWN=3,e.ZOFFSET=2,e.DEFAULT_POS=[cc.v3(0,32),cc.v3(0,48),cc.v3(-8,48),cc.v3(-8,48)],e.TRANSFORM_POS=[cc.v3(10,40),cc.v3(10,40),cc.v3(32,44),cc.v3(32,44)],e.DEFEND_POS=[cc.v3(0,48),cc.v3(0,32),cc.v3(24,40),cc.v3(24,40)],n([E(cc.Sprite)],e.prototype,"sprite",void 0),n([E(cc.Prefab)],e.prototype,"blockLightPrefab",void 0),i=n([v],e)}(cc.Component);i.default=_,cc._RF.pop()},{"../data/DamageData":"DamageData","../data/EquipmentData":"EquipmentData","../data/FromData":"FromData","../data/TriggerData":"TriggerData","../effect/BlockLight":"BlockLight","../manager/InventoryManager":"InventoryManager","../manager/StatusManager":"StatusManager","../utils/IndexZ":"IndexZ","./EventHelper":"EventHelper","./Logic":"Logic","./PlayerAvatar":"PlayerAvatar"}],Shooter:[function(t,e,i){"use strict";cc._RF.push(e,"f9805u1Wn9OeouYmQSWcHcq","Shooter");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../actor/AreaOfEffect"),s=t("../base/Actor"),l=t("../collider/CCollider"),c=t("../data/BulletData"),u=t("../data/DamageData"),h=t("../data/EquipmentData"),d=t("../data/FromData"),p=t("../ecs/system/GameWorldSystem"),f=t("../item/Bullet"),g=t("../item/Laser"),y=t("../manager/InventoryManager"),m=t("../utils/ActorUtils"),v=t("../utils/AudioPlayer"),E=t("../utils/IndexZ"),_=t("../utils/NodeKey"),T=t("../utils/Utils"),D=t("./Controller"),S=t("./Logic"),O=cc._decorator,A=O.ccclass,C=O.property,R=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bullet=null,e.laser=null,e.isAI=!1,e.isFromPlayer=!1,e.dungeon=null,e.player=null,e.isEx=!1,e.isAutoAim=!0,e.bulletName="",e.data=new h.default,e.hv=cc.v2(1,0),e.isAiming=!1,e.remoteDamagePlayer=new u.default,e.from=new d.default,e.isBuilding=!1,e.aoePools={},e.aimTargetMap=new Map,e.sensorTargetMap=new Map,e.ignoreMap=new Map,e.defaultPos=cc.v3(0,0),e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.graphics=this.getComponent(cc.Graphics),this.bulletPool=new cc.NodePool(f.default),this.laserPool=new cc.NodePool(g.default),this.sprite=this.node.getChildByName("sprite"),this.anim=this.getComponent(cc.Animation);for(var t=0,e=[l.default.TAG.BOSS,l.default.TAG.BUILDING,l.default.TAG.ENERGY_SHIELD,l.default.TAG.WALL,l.default.TAG.WALL_TOP];t<e.length;t++){var i=e[t];this.aimTargetMap.set(i,!0)}this.initIgnoreMap(this.getParentNode().getComponent(s.default))},e.prototype.initIgnoreMap=function(t){if(!t)return!1;var e=t.node.getComponentsInChildren(l.default);if(e&&e.length>0)for(var i=0,o=e;i<o.length;i++){var a=o[i];this.ignoreMap.set(a.id,!0)}return!0},e.prototype.playWalk=function(t){this.anim&&(t?this.anim.play("ShooterWalk"):(this.anim.pause(),this.sprite.y=0))},e.prototype.changeRes=function(t,e){if(this.sprite||(this.sprite=this.node.getChildByName("sprite")),this.sprite){var i=this.getSpriteFrameByName(t,e);this.sprite.getComponent(cc.Sprite).spriteFrame=i,this.isBuilding||(this.sprite.width=1.5*i.getOriginalSize().width,this.sprite.height=1.5*i.getOriginalSize().height,this.sprite.anchorX=.2,1==this.data.far&&(this.sprite.width=2*this.sprite.width,this.sprite.height=2*this.sprite.height,this.sprite.anchorX=.5))}},e.prototype.changeResColor=function(t){this.sprite.color=t},e.prototype.getSpriteFrameByName=function(t,e){var i=S.default.spriteFrameRes(t+e);return i||(i=S.default.spriteFrameRes(t+"anim0")),i||(i=S.default.spriteFrameRes(t)),i},Object.defineProperty(e.prototype,"Hv",{get:function(){return this.hv},enumerable:!1,configurable:!0}),e.prototype.setHv=function(t){if(this.isAI||!D.default.isMouseMode()){this.hv=t;var e=this.hasNearEnemy();e.equals(cc.Vec3.ZERO)||(this.hv=cc.v2(e)),this.rotateCollider(cc.v2(this.hv.x,this.hv.y))}},e.prototype.getAoeNode=function(t,e){var i=null;return this.aoePools[t.name]||(this.aoePools[t.name]=new cc.NodePool(r.default)),this.aoePools[t.name]&&this.aoePools[t.name].size()>0&&e&&(i=this.aoePools[t.name].get()),i&&!i.active||(i=cc.instantiate(t)),i.opacity=255,i.active=!0,i},e.prototype.destroyAoePrefab=function(t){t&&(this.aoePools[t.key]||(this.aoePools[t.key]=new cc.NodePool(r.default)),t.node.active=!1,this.aoePools[t.key]&&this.aoePools[t.key].put(t.node))},e.prototype.fireAoe=function(t,e,i,o,a,n){var s=this;if(!this.dungeon)return null;o||(o=0);var l=this.getAoeNode(t,n).getComponent(r.default);if(l){var c=this.node.convertToWorldSpaceAR(i||cc.v3(0,0));c=this.dungeon.node.convertToNodeSpaceAR(c),l.show(this.dungeon.node,c,this.hv,o,e,a,n,function(e){n&&(e.active=!1,s.destroyAoePrefab(new _.default(t.name,e)))})}return l},e.prototype.fireBullet=function(t,e,i,o,a,n){e&&(this.defaultPos=e.clone()),1==this.data.isLineAim&&this.graphics?this.aimTargetLine(t,e,i,o,a,n):this.fireBulletDo(t,e,i,o,a,n,"")},e.prototype.fireSplitBullet=function(t,e,i,o,a,n,r){this.fireBulletDo(e,i,o,a,n,r,t)},e.prototype.fireBulletDo=function(t,e,o,a,n,r,s){var l=this;if(this.sprite&&s.length<1&&(this.sprite.stopAllActions(),this.sprite.position=cc.Vec3.ZERO,cc.tween(this.sprite).call(function(){l.changeRes(l.data.img,"anim1")}).by(.1,{position:cc.v3(10,0)}).call(function(){l.changeRes(l.data.img,"anim2")}).by(.05,{position:cc.v3(-5,0)}).by(.05,{position:cc.v3(0,0)}).call(function(){l.changeRes(l.data.img,"anim0")}).start()),t||(t=0),this.dungeon&&(!(s.length<1)||this.isAI||this.isEx||this.player.inventoryManager.equips[y.default.REMOTE].equipmetType==y.default.REMOTE)){s.length<1&&(this.data.remoteAudio&&this.data.remoteAudio.length>0?v.default.play(this.data.remoteAudio):v.default.play(v.default.SHOOT));var c=!1,u=s.length>0?s:this.data.bulletType,h=(o||0)+(s.length>0?0:this.data.bulletArcExNum),d=[10,-10,20,-20,30,-30,40,-40,50,-50,60,-60,-70,-70,80,-80,90,-90,100,-100,110,-110,120,-120,130,-130,140,-140,150,-150,160,-160,170,-170,180,-180];h>d.length?(d=[0,20,45,65,90,110,135,155,180,200,225,245,270,290,315,335],h==i.ARC_EX_NUM_8&&(d=[0,45,90,135,180,225,270,315,335]),c=!0):this.fire(u,t,this.hv.clone(),e,this.data.bulletArcOffsetX,n,r),this.fireArcBullet(u,e,h,n,r,d,this.data.bulletArcOffsetX),this.fireLineBullet(u,t,e,h,a,n,r,d,c,this.data.bulletArcOffsetX)}},e.prototype.fireArcBullet=function(t,e,i,o,a,n,r){if(!(i<=0))for(var s=0;s<i;s++)s<n.length&&this.fire(t,n[s],this.hv.clone(),e,r,o,a)},e.prototype.fireLineBullet=function(t,e,i,o,a,n,r,s,l,c){var u=this,h=a?this.data.bulletLineExNum+a:this.data.bulletLineExNum;0!=h&&this.schedule(function(){l||u.fire(t,e,u.hv.clone(),i,c,n,r),u.fireArcBullet(t,i,o,n,r,s,c)},this.data.bulletLineInterval>0?this.data.bulletLineInterval:.2,h,0)},e.prototype.fire=function(t,e,i,o,a,n,r){var s=S.default.bullets[t],l=this.bullet,c=this.bulletPool,u=s.isLaser>0;u&&(l=this.laser,c=this.laserPool);var h=null;c.size()>0&&(h=c.get()),h&&!h.active||(h=cc.instantiate(l)),h.parent=this.node;var d=cc.v3(0,0);o&&(d=o.clone(),0!=a&&d.addSelf(cc.v3(cc.v2(a,0).rotateSelf(e*Math.PI/180))));var p=this.node.convertToWorldSpaceAR(d);p=this.dungeon.node.convertToNodeSpaceAR(p),h.parent=this.dungeon.node,h.position=p,h.scaleX=1,h.scaleY=1,h.active=!0,u?this.showLaser(e,i,h,s,p):this.showBullet(e,i,h,s,p,n,r)},e.prototype.showBullet=function(t,e,i,o,a,n,r){var s=i.getComponent(f.default);s.entity.Transform.position=a,s.shooter=this,s.node.scaleY=this.node.scaleX>0?1:-1,s.node.zIndex=E.default.OVERHEAD,s.isFromPlayer=!this.isAI||this.isFromPlayer,s.dungeon=this.dungeon;var l=new c.default;l.valueCopy(o),s.isFromPlayer&&this.player&&!this.isEx&&(l.damage.physicalDamage=this.remoteDamagePlayer.physicalDamage,l.damage.isCriticalStrike=this.remoteDamagePlayer.isCriticalStrike),l.size+=this.data.bulletSize,l.speed+=this.data.bulletExSpeed,l.speed+this.data.bulletExSpeed>50&&(l.speed+=this.data.bulletExSpeed),l.from.valueCopy(this.from),s.changeBullet(l),this.bulletName=s.name+l.resName,s.enabled=!0,s.aoeData.valueCopy(r),s.aoePrefab=n,s.showBullet(cc.v2(cc.v2(e).rotateSelf(t*Math.PI/180)).normalize())},e.prototype.showLaser=function(t,e,i,o,a){var n=i.getComponent(g.default);n.entity.Transform.position=a,n.shooter=this,n.node.scaleY=this.node.scaleX>0?1:-1,n.node.zIndex=E.default.OVERHEAD,n.isFromPlayer=!this.isAI||this.isFromPlayer,n.dungeon=this.dungeon;var r=new c.default;r.valueCopy(o),n.isFromPlayer&&this.player&&!this.isEx&&(r.damage.physicalDamage=this.remoteDamagePlayer.physicalDamage,r.damage.isCriticalStrike=this.remoteDamagePlayer.isCriticalStrike),r.size+=this.data.bulletSize,r.speed+=this.data.bulletExSpeed,r.speed+this.data.bulletExSpeed>50&&(r.speed+=this.data.bulletExSpeed),r.from.valueCopy(this.from),n.changeBullet(r),this.bulletName=n.name+r.resName,n.enabled=!0,n.fire(cc.v2(e).rotateSelf(t*Math.PI/180),t)},e.prototype.addDestroyBullet=function(t,e){t.active=!1,this.destroyBullet(t,e)},e.prototype.destroyBullet=function(t,e){e?this.laserPool&&t&&this.laserPool.put(t):this.bulletPool&&t&&this.bulletPool.put(t)},e.prototype.start=function(){},e.prototype.drawLine=function(t,e,i){this.graphics&&(this.graphics.clear(),this.graphics.fillColor=t,this.graphics.circle(0,0,i/2+1),this.graphics.circle(e,0,i/2+1),this.graphics.rect(0,-i/2,e,i),this.graphics.fill())},e.prototype.getRayCastPoint=function(t,e){var i=e||cc.v3(0,0),o=t||3e3,a=cc.v3(o,0),n=this.node.convertToWorldSpaceAR(i),r=this.node.convertToWorldSpaceAR(a);this.isFromPlayer&&this.sensorTargetMap.has(l.default.TAG.ENERGY_SHIELD)?this.sensorTargetMap.delete(l.default.TAG.ENERGY_SHIELD):this.sensorTargetMap.set(l.default.TAG.ENERGY_SHIELD,!0);var s=p.default.colliderSystem.nearestRayCast(cc.v2(n),cc.v2(r),this.aimTargetMap,this.sensorTargetMap,this.ignoreMap);return s&&(a=this.node.convertToNodeSpaceAR(cc.v3(s.point))),a},e.prototype.aimTargetLine=function(t,e,i,o,a,n){var r=this;if(!this.isAiming&&(this.isAiming=!0,this.graphics)){var s=0,l=this.getRayCastPoint(3e3,e),c=!1,u=function(){s<1&&c?(r.fireBulletDo(t,e,i,o,a,n,""),r.unschedule(u),r.graphics.clear(),r.isAiming=!1):r.drawLine(cc.color(255,0,0,200),l.x,s),s>10&&!c?c=!0:c?s-=1:s+=1};this.schedule(u,.02,30)}},e.prototype.drawArc=function(t){if(this.graphics&&(this.graphics.clear(),!(t<0))){var e=1e3,i=2*-t*Math.PI/360,o=2*t*Math.PI/360,a=cc.v3(e*Math.cos(i),e*Math.sin(i)),n=cc.v3(e*Math.cos(o),e*Math.sin(o));this.graphics.arc(0,0,e,2*Math.PI-i,2*Math.PI-o),this.graphics.fill(),this.graphics.moveTo(0,0),this.graphics.lineTo(a.x,a.y),this.graphics.lineTo(n.x,n.y),this.graphics.close(),this.graphics.fill()}},e.prototype.updateLogic=function(){if(!this.isAI&&D.default.isMouseMode()&&D.default.mousePos&&this.dungeon){var t=cc.v2(this.dungeon.node.convertToWorldSpaceAR(this.player.node.position)),e=D.default.mousePos.add(cc.v2(this.dungeon.mainCamera.node.position)).sub(t).normalize();e.equals(cc.Vec2.ZERO)||(this.hv=e,this.rotateCollider(cc.v2(this.hv.x,this.hv.y)))}},e.prototype.getParentNode=function(){return this.parentNode?this.parentNode:this.node.parent},e.prototype.hasNearEnemy=function(){return this.isAutoAim&&!this.isAI&&this.dungeon?m.default.getDirectionFromNearestEnemy(this.player.node.position,this.isAI,this.dungeon,!1,600):cc.Vec3.ZERO},e.prototype.rotateCollider=function(t){if(!t.equals(cc.Vec2.ZERO)){var e=Math.abs(this.node.scaleX);this.node.scaleX=this.getParentNode().scaleX>0?e:-e;var i=Math.abs(this.node.scaleY);this.node.scaleY=this.node.scaleX<0?-i:i,this.node.angle=T.default.getRotateAngle(t,this.node.scaleX<0)}},e.DefAULT_SPEED=300,e.ARC_EX_NUM_8=80,e.ARC_EX_NUM_16=99,n([C(cc.Prefab)],e.prototype,"bullet",void 0),n([C(cc.Prefab)],e.prototype,"laser",void 0),n([C],e.prototype,"isAI",void 0),i=n([A],e)}(cc.Component);i.default=R,cc._RF.pop()},{"../actor/AreaOfEffect":"AreaOfEffect","../base/Actor":"Actor","../collider/CCollider":"CCollider","../data/BulletData":"BulletData","../data/DamageData":"DamageData","../data/EquipmentData":"EquipmentData","../data/FromData":"FromData","../ecs/system/GameWorldSystem":"GameWorldSystem","../item/Bullet":"Bullet","../item/Laser":"Laser","../manager/InventoryManager":"InventoryManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/NodeKey":"NodeKey","../utils/Utils":"Utils","./Controller":"Controller","./Logic":"Logic"}],ShopMart:[function(t,e,i){"use strict";cc._RF.push(e,"1b8085+xzBE16cPL5KYFJeE","ShopMart");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Player"),s=t("./Building"),l=cc._decorator,c=l.ccclass,u=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isOpen=!1,e}return a(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation)},e.prototype.open=function(){},e.prototype.close=function(){},e.prototype.onColliderEnter=function(t){t.node.getComponent(r.default)&&this.open()},e.prototype.onColliderExit=function(t){t.node.getComponent(r.default)&&this.close()},n([c],e)}(s.default));i.default=u,cc._RF.pop()},{"../logic/Player":"Player","./Building":"Building"}],ShopTable:[function(t,e,i){"use strict";cc._RF.push(e,"feb404aValPAJxRKh4uvHLm","ShopTable");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Logic"),l=t("./Building"),c=t("../utils/IndexZ"),u=cc._decorator,h=u.ccclass,d=(u.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.info=this.node.getChildByName("info"),this.label=this.info.getComponentInChildren(cc.Label)},e.prototype.start=function(){},e.prototype.showItem=function(){if(this.node.parent)if(this.data.isSaled)this.sale(!0);else{var t=this.node.parent.getComponent(r.default);if(t){var e=s.default.mapManager.getRandom4Save(s.default.mapManager.getRebornSeed(this.seed));this.data.shopType==i.EQUIPMENT?t.addEquipment(s.default.getRandomEquipType(e),r.default.getPosInMap(this.data.defaultPos),this.data.equipdata,3,this):this.data.shopType==i.ITEM&&t.addItem(r.default.getPosInMap(this.data.defaultPos),s.default.getRandomItemType(e),0,this)}this.sale(!1)}},e.prototype.setDefaultPos=function(t){this.data.defaultPos=t,this.entity.Transform.position=r.default.getPosInMap(t),this.node.position=this.entity.Transform.position.clone(),this.node.zIndex=c.default.getActorZIndex(this.entity.Transform.position)},e.prototype.sale=function(t){this.info||(this.info=this.node.getChildByName("info")),this.label||(this.label=this.info.getComponentInChildren(cc.Label)),this.data.isSaled=t,this.label.string=""+this.data.price,this.info.opacity=this.data.isSaled?0:255;var e=s.default.mapManager.getCurrentMapBuilding(this.data.defaultPos);e&&e.valueCopy(this.data)},e.EQUIPMENT=0,e.ITEM=1,i=n([h],e)}(l.default));i.default=d,cc._RF.pop()},{"../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","../utils/IndexZ":"IndexZ","./Building":"Building"}],SlimeVenom:[function(t,e,i){"use strict";cc._RF.push(e,"a7fa4vRR+xDO6TrjB6jQViO","SlimeVenom");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=t("../data/DamageData"),l=t("../base/Actor"),c=t("../data/FromData"),u=cc._decorator,h=u.ccclass,d=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isHide=!1,e.isForever=!1,e.from=c.default.getClone("\u53f2\u83b1\u59c6\u6bd2\u6db2","venom"),e.checkTimeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){this.venom1=this.node.getChildByName("sprite").getChildByName("venom1"),this.venom2=this.node.getChildByName("sprite").getChildByName("venom2"),this.venom3=this.node.getChildByName("sprite").getChildByName("venom2"),this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite")},e.prototype.onEnable=function(){var t=this;this.isHide=!1,this.sprite.opacity=255,this.venom1.angle=r.default.getRandomNum(0,180),this.venom2.angle=r.default.getRandomNum(0,180),this.venom2.angle=r.default.getRandomNum(0,180),this.anim.play(),this.isForever||this.scheduleOnce(function(){t.anim&&(t.isHide=!0,t.anim.play("VenomHide"),t.scheduleOnce(function(){cc.director.emit("destoryvenom",{detail:{coinNode:t.node}})},1.5))},3),this.damagePlayer(this.from)},e.prototype.addStatus=function(){},e.prototype.getNearPlayerDistance=function(t){return r.default.getDistanceNoSqrt(this.node.position,t.position)},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){r.default.isGamePause||this.isCheckTimeDelay(t)&&this.damagePlayer(this.from)},e.prototype.damagePlayer=function(t){if(this.target&&this.getNearPlayerDistance(this.target.node)<60*this.node.scale&&this.node.active&&!this.isHide){var e=new s.default;e.magicDamage=3,this.target.takeDamage(e,t)}},e.prototype.getCenterPosition=function(){return this.node.position.clone()},e.prototype.takeDamage=function(){return!1},e.prototype.actorName=function(){return"\u53f2\u83b1\u59c6\u6bd2\u6db2"},e.prototype.takeDizz=function(){},e.prototype.updateStatus=function(){},e.prototype.hideSelf=function(){},e.prototype.updateLife=function(){},e.prototype.updateDream=function(){return 0},e.prototype.setLinearVelocity=function(){},n([h],e)}(l.default));i.default=d,cc._RF.pop()},{"../base/Actor":"Actor","../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/Logic":"Logic"}],Slime:[function(t,e,i){"use strict";cc._RF.push(e,"68790KdPQVN37qkvHYOgA/X","Slime");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Boss"),s=t("../logic/EventHelper"),l=t("../logic/Logic"),c=t("../logic/Dungeon"),u=t("./SlimeVenom"),h=t("../manager/MonsterManager"),d=t("../utils/NextStep"),p=t("../utils/AudioPlayer"),f=t("../data/FromData"),g=t("../logic/Achievement"),y=t("../item/Item"),m=t("../utils/IndexZ"),v=t("../utils/ActorUtils"),E=t("../collider/CCollider"),_=cc._decorator,T=_.ccclass,D=_.property,S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.venom=null,e.healthBar=null,e.isFaceRight=!0,e.isMoving=!1,e.timeDelay=0,e.isHurt=!1,e.isCrownFall=!1,e.isDashing=!1,e.currentlinearVelocitySpeed=cc.Vec2.ZERO,e.scaleSize=1,e.slimeType=0,e.meleeSkill=new d.default,e.venomTimeDelay=0,e.childSlimeTimeDelay=0,e}var i;return a(e,t),i=e,e.prototype.init=function(t){switch(t){case 0:this.scaleSize=2;break;case 1:this.scaleSize=1.5;break;case 2:this.scaleSize=1;break;case 3:this.scaleSize=.5;break;case 4:this.scaleSize=.3;break;case 5:default:this.scaleSize=.2}this.slimeType=t,this.node.scaleY=this.scaleSize,this.node.scaleX=this.scaleSize},e.prototype.onLoad=function(){var t=this;this.meleeSkill.IsExcuting=!1,this.sc.isDied=!1,this.anim=this.getComponent(cc.Animation),this.updatePlayerPos(),this.venomPool=new cc.NodePool,this.sprite=this.node.getChildByName("sprite"),this.crown=this.sprite.getChildByName("crown"),this.decorate=this.node.getChildByName("sprite").getChildByName("body").getChildByName("decorate"),this.dashlight=this.sprite.getChildByName("dashlight"),this.dashlight.opacity=0,s.EventHelper.on("destoryvenom",function(e){t.destroyVenom(e.coinNode)}),this.scheduleOnce(function(){t.sc.isShow=!0,t.entity.NodeRender.node=t.node,t.entity.Move.linearDamping=10},1)},e.prototype.start=function(){t.prototype.start.call(this),this.crown&&0!=this.slimeType&&(this.crown.opacity=0),this.decorate&&this.slimeType>2&&(this.decorate.opacity=0)},e.prototype.getVenom=function(t,e){if(!(this.scaleSize<1||this.sc.isDied)){var i=null;this.venomPool.size()>0&&(i=this.venomPool.get()),i&&!i.active||(i=cc.instantiate(this.venom)),i.parent=t,i.position=e,i.scale=0==this.slimeType?1.5:1,i.getComponent(u.default).target=this.dungeon.player,i.zIndex=m.default.getActorZIndex(this.entity.Transform.position),i.opacity=255,i.active=!0}},e.prototype.destroyVenom=function(t){t&&(t.active=!1,this.venomPool&&this.venomPool.put(t))},e.prototype.AnimAttacking=function(){this.meleeSkill.IsExcuting=!1;var t=64+50*this.scaleSize,e=v.default.getNearestEnemyActor(this.entity.Transform.position,!0,this.dungeon);v.default.getTargetDistance(this,e)<t&&e&&e.takeDamage(this.data.getAttackPoint(),f.default.getClone(this.actorName(),"bossslimehelmet"),this)},e.prototype.onColliderEnter=function(t,e){if(e.tag==E.default.TAG.BOSS_HIT){var i=v.default.getEnemyCollisionTarget(t);i&&this.isDashing&&this.dungeon&&!this.isHurt&&!this.sc.isDied&&(this.isDashing=!1,this.entity.Move.linearVelocity=cc.Vec2.ZERO,i.takeDamage(this.data.getAttackPoint(),f.default.getClone(this.actorName(),"bossslimehelmet"),this))}},e.prototype.isVenomTimeDelay=function(t){return this.venomTimeDelay+=t,this.venomTimeDelay>.2&&(this.venomTimeDelay=0,!0)},e.prototype.isChildSlimeTimeDelay=function(t){return this.childSlimeTimeDelay+=t,this.childSlimeTimeDelay>5&&(this.childSlimeTimeDelay=0,!0)},e.prototype.updateLogic=function(t){if(this.healthBar.node.active=!this.sc.isDied,this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,this.bossAction()),this.dashlight.opacity=0,this.dungeon&&this.isDashing&&(this.dashlight.opacity=128,this.entity.Move.linearVelocity=this.currentlinearVelocitySpeed.clone()),this.dungeon&&this.getNearPlayerDistance(this.dungeon.player.node)<64&&!this.isHurt&&(this.entity.Move.linearVelocity=cc.v2(0,0)),this.sc.isDied&&(this.entity.Move.linearVelocity=cc.Vec2.ZERO),this.healthBar.node.active=!this.sc.isDied,this.data.currentHealth<1&&this.killed(),this.node.scaleY=this.scaleSize,this.node.scaleX=this.isFaceRight?this.scaleSize:-this.scaleSize,this.isVenomTimeDelay(t)&&this.isMoving&&!this.meleeSkill.IsExcuting&&this.getVenom(this.node.parent,this.entity.Transform.position),this.isChildSlimeTimeDelay(t)&&!this.sc.isDied&&0==this.slimeType&&this.dungeon){for(var e=0,i=0,o=this.dungeon.monsterManager.monsterList;i<o.length;i++)o[i].sc.isDied||e++;if(e<10&&this.dungeon.monsterManager.monsterList.length<50){var a=c.default.getIndexInMap(this.entity.Transform.position.clone());this.dungeon.monsterManager.addMonsterFromData(h.default.MONSTER_SLIME,a,this.dungeon,!0)}}},e.prototype.takeDamage=function(t){var e=this;if(this.sc.isDied||!this.sc.isShow)return!1;this.data.currentHealth-=this.data.getDamage(t).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.isHurt=!0,this.isDashing=!1,this.scheduleOnce(function(){e.node&&(e.isHurt=!1)},.1),this.anim.play("SlimeHit"),this.meleeSkill.IsExcuting=!1,this.data.currentHealth<this.data.Common.maxHealth/2&&!this.isCrownFall&&0==this.slimeType&&(this.isCrownFall=!0,this.sc.isShow=!1,this.scheduleOnce(function(){e.sc.isShow=!0,e.crown.opacity=0},1),this.anim.play("SlimeCrownFall")),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth);var i=[p.default.MONSTER_HIT,p.default.MONSTER_HIT1,p.default.MONSTER_HIT2];return p.default.play(i[l.default.getRandomNum(0,2)]),!0},e.prototype.killed=function(){var t=this;if(!this.sc.isDied&&(this.sc.isDied=!0,this.isDashing=!1,this.anim.play("SlimeDie"),this.getComponent(E.default).sensor=!0,this.scheduleOnce(function(){t.node&&(t.node.active=!1)},5),this.dungeon)){if(0==this.slimeType){var e=l.default.mapManager.getRandom4Save(this.seed);g.default.addMonsterKillAchievement(this.data.resName),s.EventHelper.emit(s.EventHelper.DUNGEON_ADD_OILGOLD,{pos:this.entity.Transform.position,count:100}),cc.director.emit(s.EventHelper.DUNGEON_ADD_ITEM,{detail:{pos:this.entity.Transform.position,res:y.default.HEART}}),cc.director.emit(s.EventHelper.DUNGEON_ADD_ITEM,{detail:{pos:this.entity.Transform.position,res:y.default.DREAM}}),this.dungeon.addEquipment(l.default.getRandomEquipType(e),c.default.getPosInMap(this.pos),null,3)}this.slimeType<i.DIVIDE_COUNT&&(cc.director.emit(s.EventHelper.DUNGEON_ADD_COIN,{detail:{pos:this.entity.Transform.position,count:5}}),cc.director.emit(s.EventHelper.BOSS_ADDSLIME,{detail:{posIndex:this.pos.clone(),slimeType:this.slimeType+1}}),cc.director.emit(s.EventHelper.BOSS_ADDSLIME,{detail:{posIndex:this.pos.clone(),slimeType:this.slimeType+1}}))}},e.prototype.bossAction=function(){var t=this;if(!this.sc.isDied&&this.dungeon&&!this.isHurt){var e=cc.v3(0,0);e.x+=l.default.getRandomNum(0,2e3)-1e3,e.y+=l.default.getRandomNum(0,2e3)-1e3;var i=this.getNearPlayerDistance(this.dungeon.player.node);this.entity.Transform.position=c.default.fixOuterMap(this.entity.Transform.position),this.pos=c.default.getIndexInMap(this.entity.Transform.position),this.changeZIndex();var o=e.clone();i<64+50*this.scaleSize&&!this.dungeon.player.sc.isDied&&!this.isDashing&&this.sc.isShow&&this.scaleSize>=1&&((o=this.dungeon.player.getCenterPosition().sub(this.entity.Transform.position)).equals(cc.Vec3.ZERO)||(o=o.normalizeSelf()),this.anim.getAnimationState("SlimeAttack").isPlaying||(this.meleeSkill.IsExcuting=!0,this.anim.play("SlimeAttack")));var a=300-50*this.scaleSize;i>128+35*this.scaleSize&&!this.dungeon.player.sc.isDied&&!this.isDashing&&this.sc.isShow&&l.default.getHalfChance()&&(cc.director.emit(s.EventHelper.PLAY_AUDIO,{detail:{name:p.default.MELEE}}),l.default.getHalfChance()&&(o=this.dungeon.player.getCenterPosition().sub(this.entity.Transform.position)),this.move(o,1.5*a),this.isDashing=!0,this.scheduleOnce(function(){t.node&&(t.isDashing=!1)},2)),l.default.getRandomNum(1,10)<3&&this.move(o,a)}},e.prototype.move=function(t,e){if(!(this.sc.isDied||this.isHurt||this.isDashing||!this.sc.isShow||this.meleeSkill.IsExcuting||t.equals(cc.Vec3.ZERO))){t.equals(cc.Vec3.ZERO)||(this.pos=c.default.getIndexInMap(this.entity.Transform.position));var i=t.x,o=t.y,a=(Math.abs(i),Math.abs(o),cc.v2(i,o));a=a.normalize().mul(e),this.entity.Move.linearVelocity=a.clone(),this.currentlinearVelocitySpeed=a.clone(),this.isMoving=0!=i||0!=o,this.isMoving&&(this.isFaceRight=i>0);var n=this.anim.getAnimationState("SlimeAttack").isPlaying;this.anim.getAnimationState("SlimeIdle").isPlaying||n||this.anim.play("SlimeIdle"),this.changeZIndex()}},e.prototype.actorName=function(){return"\u53f2\u83b1\u59c6\u4e4b\u738b"},e.DIVIDE_COUNT=4,n([D(cc.Prefab)],e.prototype,"venom",void 0),i=n([T],e)}(r.default);i.default=S,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/FromData":"FromData","../item/Item":"Item","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../manager/MonsterManager":"MonsterManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","../utils/NextStep":"NextStep","./Boss":"Boss","./SlimeVenom":"SlimeVenom"}],SpecialManager:[function(t,e,i){"use strict";cc._RF.push(e,"e58b4559dND3JlWZESKg4rV","SpecialManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../boss/SlimeVenom"),s=t("../data/DamageData"),l=t("./StatusManager"),c=t("../logic/NonPlayer"),u=t("../utils/IndexZ"),h=t("../actor/AreaOfEffect"),d=t("../data/AreaOfEffectData"),p=t("../logic/Logic"),f=t("../logic/EventHelper"),g=t("../utils/AudioPlayer"),y=t("../collider/CCollider"),m=cc._decorator,v=m.ccclass,E=m.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aoe=null,e.venom=null,e.howl=null,e.claw=null,e.blade=null,e}var i;return a(e,t),i=e,e.prototype.clear=function(){},e.prototype.addPlacement=function(t,e,o,a,n){if(this.dungeon){var r=this.node.convertToWorldSpaceAR(cc.v3(e,0));switch(r=this.dungeon.node.convertToNodeSpaceAR(r),t){case i.AFTER_VENOM:this.addVenom(r,o,a,n);break;case i.AFTER_CLAW:this.addClaw(r,o,a,n);break;case i.AFTER_BLADE:this.addBlade(r,o,a,n);break;case i.AFTER_ASH:this.addAoe(r,(new d.default).init(.3,.3,.1,n?4:3,u.default.getActorZIndex(this.node.parent.position),!0,!0,!0,!1,!1,new s.default(2),a,[l.default.DIZZ]),["ash001","ash002","ash003","ash004"],!1,o),cc.director.emit(f.EventHelper.CAMERA_SHAKE,{detail:{isHeavyShaking:!0}});break;case i.AFTER_ICE:g.default.play(g.default.ICEBOOM),this.addAoe(r,(new d.default).init(.8,1,.2,n?3:2,u.default.getActorZIndex(this.node.parent.position),!0,!0,!0,!1,!1,new s.default(3),a,[l.default.FROZEN]),["ice001","ice002","ice002","ice003","ice004"],!1,o),cc.director.emit(f.EventHelper.CAMERA_SHAKE,{detail:{isHeavyShaking:!1}});break;case i.AFTER_DOWN:g.default.play(g.default.ZOMBIE_FALL),this.addAoe(r,(new d.default).init(.3,1,.1,n?2:1,u.default.getActorZIndex(this.node.parent.position),!0,!0,!0,!1,!1,new s.default(1),a,[l.default.FALLEN_DOWN]),["ash001","ash002","ash003","ash004"],!1,o),cc.director.emit(f.EventHelper.CAMERA_SHAKE,{detail:{isHeavyShaking:!1}});break;case i.AFTER_SWORD:r.y+=32,this.addAoe(r,(new d.default).init(.4,.1,0,n?3:2,u.default.getActorZIndex(this.node.parent.position),!0,!0,!0,!1,!1,new s.default(4),a,[l.default.BLEEDING]),["specialswordlight001","specialswordlight002","specialswordlight003","specialswordlight004"],!1,o)}}},e.prototype.addEffect=function(t,e,o,a,n){if(this.dungeon){var r=this.node.convertToWorldSpaceAR(cc.v3(e,0));switch(r=this.dungeon.node.convertToNodeSpaceAR(r),t){case i.BEFORE_HOWL:this.addHowl(r,o,a,n)}}},e.prototype.addVenom=function(t,e,i,o){var a=cc.instantiate(this.venom);a.getComponent(r.default).target=this.dungeon.player,a.getComponent(r.default).isForever=!1,a.getComponent(r.default).from.valueCopy(i),a.parent=this.dungeon.node,a.position=t,a.zIndex=u.default.ACTOR,a.scale=0,cc.tween(a).to(.5,{scale:o?3:2}).start(),g.default.play(g.default.ZOMBIE_SPITTING1)},e.prototype.addHowl=function(t,e,i,o){var a=this.node.parent.getComponent(c.default);a&&a.addStatus(l.default.WEREWOLFDEFENCE,i);var n=cc.instantiate(this.howl);n.getComponent(h.default).show(this.dungeon.node,t,cc.v3(1,0),0,(new d.default).init(0,2,1.5,o?3:2,u.default.getActorZIndex(n.position),!0,!1,!0,!1,!1,new s.default(1),i,[l.default.DIZZ]))},e.prototype.addClaw=function(t,e,i,o){var a=cc.instantiate(this.claw);t.y+=32,a.getComponent(h.default).show(this.dungeon.node,t,cc.v3(1,0),0,(new d.default).init(0,.15,.1,o?2:1,u.default.getActorZIndex(a.position),!0,!1,!0,!1,!1,new s.default(2),i,[l.default.BLEEDING]))},e.prototype.addAoe=function(t,e,i,o,a){var n=cc.instantiate(this.aoe);t.y+=32;var r=n.getChildByName("sprite").getComponent(cc.Sprite),s=n.getComponent(y.default);if(i.length>0){var l=p.default.spriteFrameRes(i[0]);r.node.width=l.getOriginalSize().width,r.node.height=l.getOriginalSize().height,r.node.scale=4,r.node.scaleX=a?4:-4,s.w=3*r.node.width,s.h=3*r.node.height}for(var c=cc.tween(),u=function(t){c.then(cc.tween().delay(.2).call(function(){r.spriteFrame=p.default.spriteFrameRes(t)}))},d=0,f=i;d<f.length;d++)u(f[d]);o?cc.tween(n).repeatForever(c).start():cc.tween(n).then(c).delay(.2).call(function(){r.spriteFrame=null}).start(),n.getComponent(h.default).show(this.dungeon.node,t,cc.v3(1,0),0,e)},e.prototype.addBlade=function(t,e,i,o){var a=cc.instantiate(this.blade);t.y+=64,a.scaleX=e?1:-1,a.getComponent(h.default).show(this.dungeon.node,t,cc.v3(1,0),0,(new d.default).init(0,.2,.1,o?2:1,u.default.getActorZIndex(a.position),!0,!1,!0,!1,!1,new s.default(2),i,[]))},e.BEFORE_HOWL="special015",e.AFTER_VENOM="special019",e.AFTER_CLAW="special024",e.AFTER_BLADE="special008",e.AFTER_ASH="special030",e.AFTER_ICE="special031",e.AFTER_DOWN="special032",e.AFTER_SWORD="special033",n([E(cc.Prefab)],e.prototype,"aoe",void 0),n([E(cc.Prefab)],e.prototype,"venom",void 0),n([E(cc.Prefab)],e.prototype,"howl",void 0),n([E(cc.Prefab)],e.prototype,"claw",void 0),n([E(cc.Prefab)],e.prototype,"blade",void 0),i=n([v],e)}(cc.Component);i.default=_,cc._RF.pop()},{"../actor/AreaOfEffect":"AreaOfEffect","../boss/SlimeVenom":"SlimeVenom","../collider/CCollider":"CCollider","../data/AreaOfEffectData":"AreaOfEffectData","../data/DamageData":"DamageData","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/NonPlayer":"NonPlayer","../utils/AudioPlayer":"AudioPlayer","../utils/IndexZ":"IndexZ","./StatusManager":"StatusManager"}],Sphinx:[function(t,e,i){"use strict";cc._RF.push(e,"613334RiSdNUKEp1LtYmQ1e","Sphinx");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Boss"),s=t("../logic/Shooter"),l=t("../logic/Dungeon"),c=t("../manager/StatusManager"),u=t("../utils/NextStep"),h=t("../manager/MonsterManager"),d=t("../utils/AudioPlayer"),p=t("../logic/EventHelper"),f=t("../data/FromData"),g=t("../logic/Achievement"),y=t("../logic/Logic"),m=cc._decorator,v=m.ccclass,E=(m.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeDelay=0,e.isMoving=!1,e.stormSkill=new u.default,e.summonSkill=new u.default,e.actionTimeDelay=0,e}return a(e,t),e.prototype.init=function(){throw new Error("Method not implemented.")},e.prototype.onLoad=function(){this.sc.isDied=!1,this.sc.isShow=!1,this.anim=this.getComponent(cc.Animation),this.shooter01=this.node.getChildByName("Shooter01").getComponent(s.default),this.statusManager=this.node.getChildByName("StatusManager").getComponent(c.default),this.shooter01.from.valueCopy(f.default.getClone(this.actorName(),"sphinxhead"))},e.prototype.start=function(){},e.prototype.takeDamage=function(t){if(this.sc.isDied||!this.sc.isShow)return!1;this.data.currentHealth-=this.data.getDamage(t).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.playHit(this.node.getChildByName("sprite"));var e=[d.default.MONSTER_HIT,d.default.MONSTER_HIT1,d.default.MONSTER_HIT2];return d.default.play(e[y.default.getRandomNum(0,2)]),!0},e.prototype.killed=function(){var t=this;this.sc.isDied||(g.default.addMonsterKillAchievement(this.data.resName),this.sc.isDied=!0,this.scheduleOnce(function(){t.node&&(t.node.active=!1)},5),this.getLoot())},e.prototype.bossAction=function(){!this.sc.isDied&&this.sc.isShow&&this.dungeon&&(this.changeZIndex(),this.fireStorm(),this.summonMonster())},e.prototype.summonMonster=function(){var t=this;this.dungeon.getMonsterAliveNum()>1||this.summonSkill.next(function(){cc.director.emit(p.EventHelper.PLAY_AUDIO,{detail:{name:d.default.MELEE}}),t.summonSkill.IsExcuting=!0;var e=l.default.getIndexInMap(t.entity.Transform.position.clone());t.dungeon.monsterManager.addMonsterFromData(h.default.MONSTER_SANDSTATUE,cc.v3(e.x,e.y-1),t.dungeon,!0),t.dungeon.monsterManager.addMonsterFromData(h.default.MONSTER_SANDSTATUE,cc.v3(e.x+1,e.y-1),t.dungeon,!0),t.dungeon.monsterManager.addMonsterFromData(h.default.MONSTER_SANDSTATUE,cc.v3(e.x-1,e.y-1),t.dungeon,!0),t.dungeon.monsterManager.addMonsterFromData(h.default.MONSTER_ANUBIS,cc.v3(e.x-1,e.y-2),t.dungeon,!0),t.dungeon.monsterManager.addMonsterFromData(h.default.MONSTER_ANUBIS,cc.v3(e.x+1,e.y-2),t.dungeon,!0)},15,!0)},e.prototype.fireStorm=function(){var t=this;this.stormSkill.next(function(){t.stormSkill.IsExcuting=!0,t.anim.play("SphinxStorm"),t.scheduleOnce(function(){var e=t.entity.Transform.position.clone().add(t.shooter01.node.position),i=t.dungeon.player.getCenterPosition().sub(e);i.equals(cc.Vec3.ZERO)||(t.shooter01.setHv(cc.v2(i).normalize()),t.fireShooter(t.shooter01,"bullet023",0,-20),t.fireShooter(t.shooter01,"bullet123",0,0,0),t.fireShooter(t.shooter01,"bullet223",0,0,20))},.3),t.scheduleOnce(function(){t.stormSkill.IsExcuting=!1,t.anim.play("SphinxIdle")},2)},8,!0)},e.prototype.fireShooter=function(t,e,i,o,a){t.dungeon=this.dungeon,t.data.bulletType=e,t.data.bulletArcExNum=i,t.data.bulletLineExNum=o,t.fireBullet(a,cc.Vec3.ZERO)},e.prototype.showBoss=function(){this.sc.isShow=!0,this.entity.NodeRender.node=this.node,this.entity.Move.linearDamping=10,this.healthBar&&(this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.healthBar.node.active=!this.sc.isDied)},e.prototype.isActionTimeDelay=function(t){return this.actionTimeDelay+=t,this.actionTimeDelay>.2&&(this.actionTimeDelay=0,!0)},e.prototype.updateLogic=function(t){this.timeDelay+=t,this.timeDelay>1&&(this.timeDelay=0),this.isActionTimeDelay(t)&&this.bossAction(),this.data.currentHealth<1&&this.killed(),this.healthBar.node.active=!this.sc.isDied,this.entity.Move.linearVelocity=cc.Vec2.ZERO},e.prototype.actorName=function(){return"\u65af\u82ac\u514b\u65af"},n([v],e)}(r.default));i.default=E,cc._RF.pop()},{"../data/FromData":"FromData","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../manager/MonsterManager":"MonsterManager","../manager/StatusManager":"StatusManager","../utils/AudioPlayer":"AudioPlayer","../utils/NextStep":"NextStep","./Boss":"Boss"}],StackStateMachine:[function(t,e,i){"use strict";cc._RF.push(e,"9d89awtDlhAe5Rtlx6ayPx5","StackStateMachine");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function e(e,i,o){return t.call(this,e,i,o)||this}return a(e,t),e.prototype.setInitialState=function(t){this.stateStack=new Array,this.currentState=t},e.prototype.getCurrentState=function(){return this.currentState},e.prototype.getPreviousState=function(){return 0==this.stateStack.length?null:this.stateStack[this.stateStack.length-1]},e.prototype.changeState=function(t){this._changeState(t,!0)},e.prototype.revertToPreviousState=function(){if(0==this.stateStack.length)return!1;var t=this.stateStack.pop();return this._changeState(t,!1),!0},e.prototype._changeState=function(t,e){e&&this.currentState&&this.stateStack.push(this.currentState),this.currentState&&this.currentState.exit(this.owner),this.currentState=t,this.currentState.enter(this.owner)},e}(t("./DefaultStateMachine").default);i.default=n,cc._RF.pop()},{"./DefaultStateMachine":"DefaultStateMachine"}],StartBackground:[function(t,e,i){"use strict";cc._RF.push(e,"0b0949K3dtID5hiTr0pvVWm","StartBackground");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Logic"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bg1=null,e.bg2=null,e.bg3=null,e.bg4=null,e.bg5=null,e.bg6=null,e.bg7=null,e.defaultArr=[cc.v3(0,-120),cc.v3(0,-120),cc.v3(800,-120),cc.v3(0,0),cc.v3(0,0),cc.v3(0,-600),cc.v3(0,0)],e.bgArr=[],e.isStarted=!1,e.touchPos=cc.v2(0,0),e.LENGTH=720,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.bgArr.push(this.bg1),this.bgArr.push(this.bg2),this.bgArr.push(this.bg3),this.bgArr.push(this.bg4),this.bgArr.push(this.bg5),this.bgArr.push(this.bg6),this.bgArr.push(this.bg7),this.node.on(cc.Node.EventType.TOUCH_START,function(e){t.isStarted||(t.touchPos=t.node.convertToNodeSpaceAR(e.getLocation()))},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){t.isStarted||(t.touchPos=t.node.convertToNodeSpaceAR(e.getLocation()))},this),this.node.on(cc.Node.EventType.TOUCH_END,function(){t.touchPos=cc.v2(0,0)},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.touchPos=cc.v2(0,0)},this)},e.prototype.startPressed=function(){if(!this.isStarted){this.isStarted=!0;for(var t=0;t<this.bgArr.length;t++){var e=this.defaultArr[t].clone();this.bgArr[t].position=e}this.getComponent(cc.Animation).play()}},e.prototype.update=function(t){if(!this.isStarted)for(var e=0;e<this.bgArr.length;e++){var i=this.defaultArr[e].clone(),o=this.touchPos.x/this.LENGTH*60*e;i.x+=o,this.bgArr[e].position=r.default.lerpPos(this.bgArr[e].position,i,t*e*2)}},n([c(cc.Node)],e.prototype,"bg1",void 0),n([c(cc.Node)],e.prototype,"bg2",void 0),n([c(cc.Node)],e.prototype,"bg3",void 0),n([c(cc.Node)],e.prototype,"bg4",void 0),n([c(cc.Node)],e.prototype,"bg5",void 0),n([c(cc.Node)],e.prototype,"bg6",void 0),n([c(cc.Node)],e.prototype,"bg7",void 0),n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../logic/Logic":"Logic"}],Start:[function(t,e,i){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","Start");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Logic"),s=t("../utils/AudioPlayer"),l=t("../ui/dialog/NoticeDialog"),c=t("../ui/StartBackground"),u=cc._decorator,h=u.ccclass,d=u.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.title=null,e.startButton=null,e.continueButton=null,e.cheatButton=null,e.debugButton=null,e.tourButton=null,e.achieveButton=null,e.noticeButton=null,e.noticeDialog=null,e.startBg=null,e.cheatClickCount=0,e.debugClickCount=0,e.tourClickCount=0,e}return a(e,t),e.prototype.onLoad=function(){this.cheatButton.opacity=r.default.isCheatMode?255:0,this.debugButton.opacity=r.default.isDebug?255:0,this.noticeDialog.node.active=!1},e.prototype.start=function(){var t=this;s.default.play(s.default.PLAY_BG,!0),this.continueButton&&(this.continueButton.active=r.default.profileManager.hasSaveData,this.continueButton.active?this.scheduleOnce(function(){t.continueButton.getComponent(cc.Animation).play()},2):this.scheduleOnce(function(){t.startButton.getComponent(cc.Animation).play()},2))},e.prototype._startShow=function(){this.startBg.startPressed(),cc.tween(this.title).to(.5,{opacity:0}).start(),cc.tween(this.startButton).to(.5,{opacity:0}).start(),cc.tween(this.continueButton).to(.5,{opacity:0}).start(),cc.tween(this.achieveButton).to(.5,{opacity:0}).start(),cc.tween(this.noticeButton).to(.5,{opacity:0}).start()},e.prototype.startGame=function(){s.default.play(s.default.SELECT),this._startShow(),this.scheduleOnce(function(){cc.director.loadScene("pickavatar")},.5)},e.prototype.chooseChapter=function(){s.default.play(s.default.SELECT),cc.director.loadScene("chapter")},e.prototype.achievementScene=function(){s.default.play(s.default.SELECT),this._startShow(),this.scheduleOnce(function(){cc.director.loadScene("achievement")},.5)},e.prototype.continueGame=function(){r.default.resetData(),r.default.isFirst=1,s.default.play(s.default.SELECT),this._startShow(),this.scheduleOnce(function(){cc.director.loadScene("loading")},.5)},e.prototype.cheatModeChange=function(){if(this.cheatButton){if(r.default.isCheatMode)return r.default.isCheatMode=!1,void(this.cheatClickCount=0);this.cheatClickCount++,this.cheatClickCount>2&&(r.default.isCheatMode=!0)}},e.prototype.debugModeChange=function(){if(this.debugButton){if(r.default.isDebug)return r.default.isDebug=!1,void(this.debugClickCount=0);this.debugClickCount++,this.debugClickCount>2&&(r.default.isDebug=!0,cc.debug.setDisplayStats(!0))}},e.prototype.update=function(){this.debugButton&&(this.debugButton.opacity=r.default.isDebug?255:0),this.cheatButton&&(this.cheatButton.opacity=r.default.isCheatMode?255:0),this.tourButton&&(this.tourButton.opacity=r.default.isTour?255:0),cc.director.getScheduler().setTimeScale(1)},e.prototype.tourChange=function(){if(this.tourButton){if(r.default.isTour)return r.default.isTour=!1,void(this.tourClickCount=0);this.tourClickCount++,this.tourClickCount>2&&(r.default.isTour=!0)}},e.prototype.showNotice=function(){this.noticeDialog&&this.noticeDialog.show()},e.prototype.goTest=function(){cc.director.loadScene("test")},n([d(cc.Node)],e.prototype,"title",void 0),n([d(cc.Node)],e.prototype,"startButton",void 0),n([d(cc.Node)],e.prototype,"continueButton",void 0),n([d(cc.Node)],e.prototype,"cheatButton",void 0),n([d(cc.Node)],e.prototype,"debugButton",void 0),n([d(cc.Node)],e.prototype,"tourButton",void 0),n([d(cc.Node)],e.prototype,"achieveButton",void 0),n([d(cc.Node)],e.prototype,"noticeButton",void 0),n([d(l.default)],e.prototype,"noticeDialog",void 0),n([d(c.default)],e.prototype,"startBg",void 0),n([h],e)}(cc.Component);i.default=p,cc._RF.pop()},{"../ui/StartBackground":"StartBackground","../ui/dialog/NoticeDialog":"NoticeDialog","../utils/AudioPlayer":"AudioPlayer","./Logic":"Logic"}],StateContext:[function(t,e,i){"use strict";cc._RF.push(e,"355460dkOZEM7Y62EU2S7oe","StateContext"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(){this.isShow=!1,this.isDied=!1,this.isAttacking=!1,this.isDisguising=!1,this.isMoving=!1,this.isDodging=!1,this.isHurting=!1,this.isDashing=!1,this.isDizzing=!1,this.isFalling=!1,this.isBlinking=!1,this.isJumping=!1,this.isVanishing=!1,this.isTalking=!1},cc._RF.pop()},{}],StateMachine:[function(t,e,i){"use strict";cc._RF.push(e,"d6268XDmGFEdZj+80HdRhZG","StateMachine"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],State:[function(t,e,i){"use strict";cc._RF.push(e,"ee6413dVQ9N85ndee/MSlIy","State"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],StatusConditionType:[function(t,e,i){"use strict";cc._RF.push(e,"cfb92WuPb1L4plYKZHdFxR/","StatusConditionType"),Object.defineProperty(i,"__esModule",{value:!0}),i.StatusConditionType=void 0,function(t){t[t.SUITS1=0]="SUITS1",t[t.SUITS2=1]="SUITS2",t[t.SUITS3=2]="SUITS3",t[t.ITEM_REMOVE=3]="ITEM_REMOVE",t[t.ITEM_TICK=4]="ITEM_TICK",t[t.ITEM_USE=5]="ITEM_USE",t[t.MELEE_ATTACK=6]="MELEE_ATTACK",t[t.MELEE_COMBO=7]="MELEE_COMBO",t[t.MELEE_KILL=8]="MELEE_KILL",t[t.REMOTE_ATTACK=9]="REMOTE_ATTACK",t[t.REMOTE_HIT=10]="REMOTE_HIT",t[t.REMOTE_KILL=11]="REMOTE_KILL",t[t.REMOTE_COMBO=12]="REMOTE_COMBO",t[t.SKILL_START=13]="SKILL_START",t[t.SKILL_END=14]="SKILL_END",t[t.SKILL_TICK=15]="SKILL_TICK",t[t.TAKE_DAMAGE=16]="TAKE_DAMAGE",t[t.AOE_HIT=17]="AOE_HIT",t[t.AOE_ADD=18]="AOE_ADD",t[t.AOE_REMOVE=19]="AOE_REMOVE",t[t.AOE_TICK=20]="AOE_TICK",t[t.AOE_KILL=21]="AOE_KILL",t[t.STATUS_KILL=22]="STATUS_KILL",t[t.STANDSTILL=23]="STANDSTILL",t[t.MOVE=24]="MOVE",t[t.DREAM_OUT=25]="DREAM_OUT",t[t.DREAM_FULL=26]="DREAM_FULL",t[t.HEALTH_OUT=27]="HEALTH_OUT",t[t.HEALTH_FULL=28]="HEALTH_FULL",t[t.HEALTH_HALF=29]="HEALTH_HALF",t[t.DISPEL=30]="DISPEL"}(i.StatusConditionType||(i.StatusConditionType={})),cc._RF.pop()},{}],StatusData:[function(t,e,i){"use strict";cc._RF.push(e,"e6cc1ffzwVEGqcTbp1oM4Mh","StatusData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./CommonData"),a=t("./FromData"),n=function(){function t(){this.id=0,this.type=0,this.nameCn="",this.nameEn="",this.duration=0,this.desc="",this.spriteFrameName="",this.info1="",this.info2="",this.info3="",this.extraInfo="",this.infobase="",this.infocolor1="#ffffff",this.infocolor2="#ffffff",this.infocolor3="#ffffff",this.infobasecolor="#ffffff",this.physicalDamageDirect=0,this.physicalDamageOvertime=0,this.missRate=0,this.realDamageDirect=0,this.realDamageOvertime=0,this.dreamDirect=0,this.dreamOvertime=0,this.magicDamageDirect=0,this.magicDamageOvertime=0,this.dizzDurationDirect=0,this.dizzDurationOvertime=0,this.invisibleDuratonDirect=0,this.variation=0,this.finishStatus="",this.unique=0,this.exOilGold=0,this.clearHealth=0,this.avoidDeath=0,this.sanityDirect=0,this.sanityOvertime=0,this.solidDirect=0,this.solidOvertime=0,this.liquidDirect=0,this.liquidOvertime=0,this.common=new o.default,this.from=new a.default}return Object.defineProperty(t.prototype,"Common",{get:function(){return this.common},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"From",{get:function(){return this.from},enumerable:!1,configurable:!0}),t.prototype.valueCopy=function(t){t&&(this.common.valueCopy(t.common),this.from.valueCopy(t.from),this.nameCn=t.nameCn?t.nameCn:this.nameCn,this.nameEn=t.nameEn,this.id=t.id?t.id:0,this.type=t.type?t.type:0,this.duration=t.duration?t.duration:0,this.spriteFrameName=t.spriteFrameName,this.desc=t.desc,this.physicalDamageDirect=t.physicalDamageDirect?t.physicalDamageDirect:0,this.physicalDamageOvertime=t.physicalDamageOvertime?t.physicalDamageOvertime:0,this.missRate=t.missRate?t.missRate:0,this.realDamageDirect=t.realDamageDirect?t.realDamageDirect:0,this.realDamageOvertime=t.realDamageOvertime?t.realDamageOvertime:0,this.magicDamageDirect=t.magicDamageDirect?t.magicDamageDirect:0,this.magicDamageOvertime=t.magicDamageOvertime?t.magicDamageOvertime:0,this.dizzDurationDirect=t.dizzDurationDirect?t.dizzDurationDirect:0,this.dizzDurationOvertime=t.dizzDurationOvertime?t.dizzDurationOvertime:0,this.invisibleDuratonDirect=t.invisibleDuratonDirect?t.invisibleDuratonDirect:0,this.dreamDirect=t.dreamDirect?t.dreamDirect:0,this.dreamOvertime=t.dreamOvertime?t.dreamOvertime:0,this.sanityDirect=t.sanityDirect?t.sanityDirect:0,this.sanityOvertime=t.sanityOvertime?t.sanityOvertime:0,this.solidDirect=t.solidDirect?t.solidDirect:0,this.solidOvertime=t.solidOvertime?t.solidOvertime:0,this.liquidDirect=t.liquidDirect?t.liquidDirect:0,this.liquidOvertime=t.liquidOvertime?t.liquidOvertime:0,this.variation=t.variation?t.variation:0,this.unique=t.unique?t.unique:0,this.exOilGold=t.exOilGold?t.exOilGold:0,this.clearHealth=t.clearHealth?t.clearHealth:0,this.avoidDeath=t.avoidDeath?t.avoidDeath:0,this.finishStatus=t.finishStatus?t.finishStatus:"",this.info1=t.info1?t.info1:"",this.info2=t.info2?t.info2:"",this.info3=t.info3?t.info3:"",this.extraInfo=t.extraInfo?t.extraInfo:"",this.infobase=t.infobase?t.infobase:"",this.infocolor1=t.infocolor1?t.infocolor1:"#ffffff",this.infocolor2=t.infocolor2?t.infocolor2:"#ffffff",this.infocolor3=t.infocolor3?t.infocolor3:"#ffffff",this.infobasecolor=t.infobasecolor?t.infobasecolor:"#ffffff")},t.prototype.clone=function(){var e=new t;return e.common=this.common.clone(),e.from=this.from.clone(),e.nameCn=this.nameCn,e.nameEn=this.nameEn,e.id=this.id,e.duration=this.duration,e.desc=this.desc,e.physicalDamageDirect=this.physicalDamageDirect,e.physicalDamageOvertime=this.physicalDamageOvertime,e.missRate=this.missRate,e.realDamageDirect=this.realDamageDirect,e.realDamageOvertime=this.realDamageOvertime,e.magicDamageDirect=this.magicDamageDirect,e.magicDamageOvertime=this.magicDamageOvertime,e.spriteFrameName=this.spriteFrameName,e.dizzDurationDirect=this.dizzDurationDirect,e.dizzDurationOvertime=this.dizzDurationOvertime,e.invisibleDuratonDirect=this.invisibleDuratonDirect,e.dreamDirect=this.dreamDirect,e.dreamOvertime=this.dreamOvertime,e.sanityDirect=this.sanityDirect,e.sanityOvertime=this.sanityOvertime,e.liquidDirect=this.liquidDirect,e.liquidOvertime=this.liquidOvertime,e.solidDirect=this.solidDirect,e.solidOvertime=this.solidOvertime,e.type=this.type,e.variation=this.variation,e.finishStatus=this.finishStatus,e.unique=this.unique,e.exOilGold=this.exOilGold,e.clearHealth=this.clearHealth,e.avoidDeath=this.avoidDeath,e.info1=this.info1,e.info2=this.info2,e.info3=this.info3,e.extraInfo=this.extraInfo,e.infobase=this.infobase,e.infocolor1=this.infocolor1,e.infocolor2=this.infocolor2,e.infocolor3=this.infocolor3,e.infobasecolor=this.infobasecolor,e},t}();i.default=n,cc._RF.pop()},{"./CommonData":"CommonData","./FromData":"FromData"}],StatusEventType:[function(t,e,i){"use strict";cc._RF.push(e,"e9268x4uqpM3ZwTAm8dK3a3","StatusEventType"),Object.defineProperty(i,"__esModule",{value:!0}),i.StatusEventType=void 0,function(t){t[t.INIT=0]="INIT",t[t.DIED=1]="DIED",t[t.ITEM_ADD=2]="ITEM_ADD",t[t.ITEM_REMOVE=3]="ITEM_REMOVE",t[t.ITEM_TICK=4]="ITEM_TICK",t[t.ITEM_USE=5]="ITEM_USE",t[t.MELEE_ATTACK=6]="MELEE_ATTACK",t[t.MELEE_COMBO=7]="MELEE_COMBO",t[t.MELEE_KILL=8]="MELEE_KILL",t[t.REMOTE_ATTACK=9]="REMOTE_ATTACK",t[t.REMOTE_HIT=10]="REMOTE_HIT",t[t.REMOTE_KILL=11]="REMOTE_KILL",t[t.REMOTE_COMBO=12]="REMOTE_COMBO",t[t.SKILL_START=13]="SKILL_START",t[t.SKILL_END=14]="SKILL_END",t[t.SKILL_TICK=15]="SKILL_TICK",t[t.TAKE_DAMAGE=16]="TAKE_DAMAGE",t[t.DODGE=17]="DODGE",t[t.BLOCK=18]="BLOCK",t[t.PRARRY=19]="PRARRY",t[t.AOE_HIT=20]="AOE_HIT",t[t.AOE_ADD=21]="AOE_ADD",t[t.AOE_REMOVE=22]="AOE_REMOVE",t[t.AOE_TICK=23]="AOE_TICK",t[t.AOE_KILL=24]="AOE_KILL",t[t.STATUS_KILL=25]="STATUS_KILL",t[t.STANDSTILL=26]="STANDSTILL",t[t.MOVE=27]="MOVE",t[t.DREAM_OUT=28]="DREAM_OUT",t[t.DREAM_FULL=29]="DREAM_FULL",t[t.HEALTH_OUT=30]="HEALTH_OUT",t[t.HEALTH_FULL=31]="HEALTH_FULL",t[t.HEALTH_HALF=32]="HEALTH_HALF",t[t.DISPEL=33]="DISPEL"}(i.StatusEventType||(i.StatusEventType={})),cc._RF.pop()},{}],StatusIconDialog:[function(t,e,i){"use strict";cc._RF.push(e,"0334bGPnhpIAJMTQdBZ2+gl","StatusIconDialog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layout=null,e.labelTitle=null,e.infoBase=null,e.info1=null,e.info2=null,e.info3=null,e.extraInfo=null,e.infoDesc=null,e.count=null,e.iconNode=null,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.refreshStatusInfo=function(t){this.layout.color=cc.Color.WHITE,this.infoBase.node.active=!0,this.info1.node.active=!0,this.info2.node.active=!0,this.info3.node.active=!0,this.extraInfo.node.active=!0,this.labelTitle.string=t.nameCn,this.infoBase.string=""+t.infobase,this.infoBase.node.color=this.infoBase.node.color.fromHEX(t.infobasecolor),this.info1.string=t.info1,this.info1.node.color=this.info1.node.color.fromHEX(t.infocolor1),this.info2.string=t.info2,this.info2.node.color=this.info2.node.color.fromHEX(t.infocolor2),this.info3.string=t.info3,this.info3.node.color=this.info3.node.color.fromHEX(t.infocolor3),this.extraInfo.string=t.extraInfo,this.infoDesc.string=t.desc,this.infoBase.node.active=this.infoBase.string.length>0,this.info1.node.active=this.info1.string.length>0,this.info2.node.active=this.info2.string.length>0,this.info3.node.active=this.info3.string.length>0,this.extraInfo.node.active=this.extraInfo.string.length>0,this.count.string=""+t.duration,-1==t.duration&&(this.count.string="\u221e"),this.count.string=""+(t.duration>0?t.duration:"\u221e"),this.labelTitle.node.color=this.labelTitle.node.color.fromHEX("#F4C021")},e.prototype.showDialog=function(t,e,i){this.iconNode=t,this.refreshStatusInfo(i),this.node.active=!0,this.node.position=e.clone()},e.prototype.hideDialog=function(){this.node.active=!1},e.prototype.update=function(){this.iconNode&&!cc.isValid(this.iconNode)||this.hideDialog()},n([l(cc.Node)],e.prototype,"layout",void 0),n([l(cc.Label)],e.prototype,"labelTitle",void 0),n([l(cc.Label)],e.prototype,"infoBase",void 0),n([l(cc.Label)],e.prototype,"info1",void 0),n([l(cc.Label)],e.prototype,"info2",void 0),n([l(cc.Label)],e.prototype,"info3",void 0),n([l(cc.Label)],e.prototype,"extraInfo",void 0),n([l(cc.Label)],e.prototype,"infoDesc",void 0),n([l(cc.Label)],e.prototype,"count",void 0),n([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{}],StatusIconList:[function(t,e,i){"use strict";cc._RF.push(e,"7943ajtValDxKKH09iraTc/","StatusIconList");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./dialog/StatusIconDialog"),s=t("./StatusIcon"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.iconPrefab=null,e.dialogPrefab=null,e.layout=null,e}return a(e,t),e.prototype.onLoad=function(){this.dialog=this.initDialog()},e.prototype.initDialog=function(){var t=cc.instantiate(this.dialogPrefab);t.parent=this.node;var e=t.getComponent(r.default);return e.hideDialog(),e},e.prototype.getIcon=function(){var t=cc.instantiate(this.iconPrefab);t.parent=this.layout,t.active=!0;var e=t.getComponent(s.default);return this.addIconTouchEvent(e),e},e.prototype.addIconTouchEvent=function(t){var e=this;t.node.on(cc.Node.EventType.TOUCH_START,function(){var i=t.data;if(i){var o=e.node.convertToNodeSpaceAR(t.node.parent.convertToWorldSpaceAR(cc.Vec3.ZERO));e.dialog.showDialog(t.node,o.add(cc.v3(64,0)),i)}}),t.node.on(cc.Node.EventType.TOUCH_END,function(){e.dialog.hideDialog()}),t.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){e.dialog.hideDialog()})},n([u(cc.Prefab)],e.prototype,"iconPrefab",void 0),n([u(cc.Prefab)],e.prototype,"dialogPrefab",void 0),n([u(cc.Node)],e.prototype,"layout",void 0),n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"./StatusIcon":"StatusIcon","./dialog/StatusIconDialog":"StatusIconDialog"}],StatusIcon:[function(t,e,i){"use strict";cc._RF.push(e,"932dcHgnxxMzY9ASpbEVLeG","StatusIcon");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/StatusData"),s=t("../logic/Logic"),l=cc._decorator,c=l.ccclass,u=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stateRunning=!1,e.sprite=null,e.data=new r.default,e}return a(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.label=this.node.getChildByName("sprite").getChildByName("label").getComponent(cc.Label),this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.label=this.node.getChildByName("sprite").getChildByName("label").getComponent(cc.Label),this.anim=this.getComponent(cc.Animation)},e.prototype.start=function(){},e.prototype.showStatus=function(t){this.anim&&(this.data=t,this.sprite.spriteFrame=s.default.spriteFrameRes(t.spriteFrameName),this.anim.playAdditive("StatusShow"),this.stateRunning=!0,this.label.string=""+(t.duration>0?t.duration:""),this.label.node.opacity=t.duration<0||t.duration>500?0:255)},e.prototype.stopStatus=function(){this.node&&this.stateRunning&&this.node.destroy()},e.prototype.updateLogic=function(t){var e=this;this.data=t,this.label.string=""+(t.duration>0?t.duration:""),this.label.node.opacity=t.duration<0||t.duration>500?0:255,0==t.duration&&this.stateRunning&&(this.stateRunning=!1,this.anim.play("StatusHide"),this.scheduleOnce(function(){e.node&&e.node.destroy()},.5))},n([c],e)}(cc.Component));i.default=u,cc._RF.pop()},{"../data/StatusData":"StatusData","../logic/Logic":"Logic"}],StatusManager:[function(t,e,i){"use strict";cc._RF.push(e,"70cfczADURLkqYmvLLsshT9","StatusManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/StatusData"),s=t("../logic/Logic"),l=t("../data/FromData"),c=t("../status/Status"),u=t("../base/Actor"),h=t("../utils/ActorUtils"),d=cc._decorator,p=d.ccclass,f=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.statusPrefab=null,e.totalStatusData=new r.default,e.timeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){this.statusMap=new Map,this.actor=this.node.parent.getComponent(u.default)},e.prototype.start=function(){},e.prototype.addCustomStatus=function(t,e){if(t){var i=new r.default;i.valueCopy(t),i.From.valueCopy(e),this.stopOtherUniqueStatus(i.unique)&&this.showStatus(i,!1)}},e.prototype.addStatus=function(t,e,i){if(!(t.length<1)){var o=new r.default;o.valueCopy(s.default.status[t]),o.From.valueCopy(e),this.stopOtherUniqueStatus(o.unique)&&this.showStatus(o,i)}},e.prototype.addStatusListFromSave=function(t){if(t&&t.length>0)for(var e=0,i=t;e<i.length;e++){var o=i[e],a=new r.default;a.valueCopy(o),a.From.valueCopy(new l.default),this.showStatus(a,!0)}},e.prototype.hasStatus=function(t){var e=new r.default;if(e.valueCopy(s.default.status[t]),this.statusMap.has(e.id)){var i=this.statusMap.get(e.id);if(i&&i.node&&i.isValid&&i.isStatusRunning()&&i.data.id==e.id)return!0}return!1},e.prototype.stopStatus=function(t){var e=new r.default;if(e.valueCopy(s.default.status[t]),this.statusMap.has(e.id)){var i=this.statusMap.get(e.id);i&&i.node&&i.isValid&&i.isStatusRunning()&&i.data.id==e.id&&i.stopStatus()}},e.prototype.stopOtherUniqueStatus=function(t){return t<1||(this.statusMap.forEach(function(e){if(e&&e.data&&e.data.unique==t)return!(e.data.duration<0||(e.stopStatus(),0))}),!0)},e.prototype.stopAllStatus=function(){this.statusMap.forEach(function(t){t.stopStatus()})},e.prototype.stopAllBuffs=function(){this.statusMap.forEach(function(t){t&&t.data&&t.data.type==c.default.BUFF&&t.stopStatus()})},e.prototype.stopAllDebuffs=function(){this.statusMap.forEach(function(t){t&&t.data&&t.data.type==c.default.DEBUFF&&t.stopStatus()})},e.prototype.showStatus=function(t,e){var i=this;if(this.statusMap.forEach(function(t,e){t&&t.node&&t.isValid||i.statusMap.delete(e)}),this.statusMap.has(t.id)&&(n=this.statusMap.get(t.id))&&n.node&&n.isValid&&n.isStatusRunning()&&n.data.id==t.id)return n.data.duration=t.duration,n.data.duration>0&&t.duration>0&&(t.duration+=n.data.duration),void n.showStatus(t,this.actor,e);var o=cc.instantiate(this.statusPrefab);o.parent=this.node,o.active=!0;var a=o.getComponent(c.default);if(this.statusMap.has(t.id)){var n=this.statusMap.get(t.id);this.statusMap.set(9999+n.data.id,n)}if(this.statusMap.set(t.id,a),this.statusIconList){var r=this.statusIconList.getIcon();a.icon=r}a.showStatus(t,this.actor,e)},e.prototype.update=function(t){if(!s.default.isGamePause&&(this.node.parent&&(this.node.scaleX=this.node.parent.scaleX>0?1:-1),this.isTimeDelay(t)&&this.actor)){var e=this.updateStatus();this.actor.updateStatus(e,this.totalStatusData)}},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>1&&(this.timeDelay=0,!0)},e.prototype.updateStatus=function(){var t=this;this.totalStatusData=new r.default;var e=new Array;return this.statusMap.forEach(function(i){i&&i.node&&i.isValid&&(i.updateLogic(),0==i.data.duration?t.addStatus(i.data.finishStatus,i.data.From):(t.totalStatusData.missRate+=i.data.missRate?i.data.missRate:0,t.totalStatusData.variation+=i.data.variation?i.data.variation:0,t.totalStatusData.exOilGold+=i.data.exOilGold?i.data.exOilGold:0,t.totalStatusData.clearHealth+=i.data.clearHealth?i.data.clearHealth:0,t.totalStatusData.avoidDeath+=i.data.avoidDeath?i.data.avoidDeath:0,t.totalStatusData.Common.add(i.data.Common),e.push(i.data.clone())))}),e},e.addStatus2NearEnemy=function(t,e,i){if(t){var o=h.default.getNearestEnemyActor(t.node.position,!1,t.dungeon);o&&o.node&&o.node.active&&!o.sc.isDied&&!o.sc.isDisguising&&o.addStatus(e,i)}},e.addStatus2NearEnemies=function(t,e,i,o,a){if(t){for(var n=0,r=t.dungeon.monsterManager.monsterList;n<r.length;n++){var l=r[n],c=s.default.getDistanceNoSqrt(e.position,l.node.position);l&&l.node&&l.node.active&&c<o&&!l.sc.isDied&&!l.sc.isDisguising&&l.addStatus(i,a)}for(var u=0,h=t.dungeon.monsterManager.bossList;u<h.length;u++){var d=h[u];(c=s.default.getDistanceNoSqrt(e.position,d.node.position))<o&&!d.sc.isDied&&d.addStatus(i,a)}}},e.addStatus2NearAllies=function(t,e,i,o,a){if(t)for(var n=0,r=t.dungeon.nonPlayerManager.nonPlayerList;n<r.length;n++){var l=r[n],c=s.default.getDistanceNoSqrt(e.position,l.node.position);l&&l.node&&l.node.active&&c<o&&!l.sc.isDied&&!l.sc.isDisguising&&l.addStatus(i,a)}},e.FROZEN="status001",e.BURNING="status002",e.DIZZ="status003",e.TOXICOSIS="status004",e.CURSING="status005",e.BLEEDING="status006",e.ATTACKPLUS="status007",e.FASTMOVE="status008",e.FASTATTACK="status009",e.PERFECTDEFENCE="status010",e.HEALING="status011",e.RECOVERY="status012",e.STONE="status013",e.TWINE="status014",e.SHIELD_NORMAL="status015",e.SHIELD_LONG="status016",e.BOTTLE_HEALING="status017",e.TALENT_AIMED="status018",e.SHOES_SPEED="status019",e.CLOTHES_RECOVERY="status020",e.WEREWOLFDEFENCE="status021",e.GOLDAPPLE="status022",e.MAGIC_WEAPON="status023",e.MAGIC_WEAPON_STRONG="status024",e.FROZEN_STRONG="status025",e.TALENT_INVISIBLE="status026",e.SHIELD_PARRY="status027",e.TALENT_FLASH_DIZZ="status028",e.TALENT_FLASH_SPEED="status029",e.BOTTLE_REMOTE="status030",e.WINE_CLOUD="status033",e.FALLEN_DOWN="status034",e.DIZZ_LONG="status035",e.PET_DOG="status037",e.REAGENT="status038",e.REAGENT_SIDE_EFFECT="status039",e.AVOID_DEATH="status065",e.CAMP_FIRE="status066",e.HOLOGRAPHIC_DODGE="status067",e.DRINK="status068",e.SANITY_UP="status069",e.SANITY_DOWN="status070",e.EAT="status071",e.INSANE="status072",n([f(cc.Prefab)],e.prototype,"statusPrefab",void 0),n([p],e)}(cc.Component);i.default=g,cc._RF.pop()},{"../base/Actor":"Actor","../data/FromData":"FromData","../data/StatusData":"StatusData","../logic/Logic":"Logic","../status/Status":"Status","../utils/ActorUtils":"ActorUtils"}],Status:[function(t,e,i){"use strict";cc._RF.push(e,"71809qjadJJZIMwM9M2G6cL","Status");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/DamageData"),s=t("../data/StatusData"),l=t("../logic/Logic"),c=t("../manager/EquipmentManager"),u=cc._decorator,h=u.ccclass,d=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stateRunning=!1,e.sprite=null,e.data=new s.default,e}return a(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.label=this.node.getChildByName("sprite").getChildByName("label").getComponent(cc.Label),this.anim=this.getComponent(cc.Animation)},e.prototype.start=function(){},e.prototype.showStatus=function(t,e,i){if(this.anim&&(this.data=t,this.actor=e,this.sprite.spriteFrame=l.default.spriteFrameRes(t.spriteFrameName),this.anim.play("StatusShow"),i||this.doStatusDamage(!0),this.stateRunning=!0,this.label.string=""+(this.data.duration>0?this.data.duration:""),this.label.node.opacity=this.data.duration<0||this.data.duration>500?0:255,this.icon)){var o=t.Common;t.infobase=c.default.getInfoBase(o),t.info1=c.default.getInfo1(o),t.info2=c.default.getInfo2(o,null),t.info3=c.default.getInfo3(o),t.infobasecolor="#fffff0",t.infocolor1="#9370DB",t.infocolor2="#87CEFA",t.infocolor3="#BC8F8F",t.extraInfo=this.getInfo(t),this.icon.showStatus(t)}},e.prototype.getInfo=function(t){var e="";return e+=0==t.physicalDamageOvertime?"":"\u6bcf\u79d2\u53d7\u5230"+t.physicalDamageOvertime.toFixed(1).replace(".0","")+"\u70b9\u7269\u7406\u4f24\u5bb3\n",t.realDamageOvertime>0?e+=0==t.realDamageOvertime?"":"\u6bcf\u79d2\u53d7\u5230"+t.realDamageOvertime.toFixed(1).replace(".0","")+"\u70b9\u6d41\u8840\u4f24\u5bb3\n":e+=0==t.realDamageOvertime?"":"\u6bcf\u79d2\u6062\u590d"+-t.realDamageOvertime.toFixed(1).replace(".0","")+"\u70b9\u751f\u547d\n",e+=0==t.magicDamageOvertime?"":"\u6bcf\u79d2\u53d7\u5230"+t.magicDamageOvertime.toFixed(1).replace(".0","")+"\u70b9\u9b54\u6cd5\u4f24\u5bb3\n",e+=0==t.missRate?"":"\u653b\u51fb\u4e22\u5931\u51e0\u7387"+t.missRate.toFixed(1).replace(".0","")+"%\n",e+=0==t.dizzDurationOvertime?"":"\u7729\u6655"+t.dizzDurationOvertime.toFixed(1).replace(".0","")+"\u79d2\n",e+=0==t.invisibleDuratonDirect?"":"\u9690\u8eab"+t.invisibleDuratonDirect.toFixed(1).replace(".0","")+"\u79d2\n",e+=0==t.variation?"":"\u53d8\u5f02"+t.variation.toFixed(1).replace(".0","")+"\u79d2\n",e+=0==t.dreamOvertime?"":"\u6301\u7eed"+t.dreamOvertime.toFixed(1).replace(".0","")+"\u79d2\u6062\u590d\u68a6\u5883\n",e+=0==t.exOilGold?"":"\u989d\u5916\u7ecf\u9a8c\u83b7\u53d6"+t.exOilGold.toFixed(1).replace(".0","")+"\u70b9\n",(e+=0==t.clearHealth?"":"\u6e05\u7406\u5b8c\u623f\u95f4\u56de\u590d\u751f\u547d\n")+(0==t.avoidDeath?"":"\u62b5\u6321\u81f4\u547d\u4f24")},e.prototype.stopStatus=function(){this.node&&(this.data.duration=0,this.stateRunning&&(this.node.destroy(),this.icon&&this.icon.node.destroy()))},e.prototype.isStatusRunning=function(){return this.data.duration>0||-1==this.data.duration},e.prototype.doStatusDamage=function(t){if(this.data){var e=t?this.getDamageDirect():this.getDamageOverTime(),i=t?this.data.dizzDurationDirect:this.data.dizzDurationOvertime,o=t?this.data.dreamDirect:this.data.dreamOvertime;this.actor&&(0!=e.getTotalDamage()&&this.actor.takeDamage(e,this.data.From),i>0&&this.actor.takeDizz(i),o&&0!=o&&this.actor.updateDream(o),this.data.invisibleDuratonDirect>0&&this.actor.hideSelf(this.data.invisibleDuratonDirect),t?this.actor.updateLife(this.data.sanityDirect,this.data.solidDirect,this.data.liquidDirect):this.actor.updateLife(this.data.sanityOvertime,this.data.solidOvertime,this.data.liquidOvertime))}},e.prototype.updateLogic=function(){var t=this;this.label.string=""+(this.data.duration>0?this.data.duration:""),this.label.node.opacity=this.data.duration<0||this.data.duration>500?0:255,this.icon&&(this.icon.updateLogic(this.data),-1==this.data.duration&&(this.node.active=!1)),this.data.duration>0&&(-1!=this.data.duration&&this.data.duration--,this.doStatusDamage(!1)),0==this.data.duration&&this.stateRunning&&(this.stateRunning=!1,this.anim.play("StatusHide"),this.scheduleOnce(function(){t.node&&(t.node.destroy(),t.icon&&t.icon.node.destroy())},.5))},e.prototype.getDamageDirect=function(){var t=new r.default;return t.realDamage=this.data.realDamageDirect?this.data.realDamageDirect:0,t.physicalDamage=this.data.physicalDamageDirect?this.data.physicalDamageDirect:0,t.magicDamage=this.data.magicDamageDirect?this.data.magicDamageDirect:0,t},e.prototype.getDamageOverTime=function(){var t=new r.default;return t.realDamage=this.data.realDamageOvertime?this.data.realDamageOvertime:0,t.physicalDamage=this.data.physicalDamageOvertime?this.data.physicalDamageOvertime:0,t.magicDamage=this.data.magicDamageOvertime?this.data.magicDamageOvertime:0,t},e.BUFF=0,e.DEBUFF=1,n([h],e)}(cc.Component));i.default=d,cc._RF.pop()},{"../data/DamageData":"DamageData","../data/StatusData":"StatusData","../logic/Logic":"Logic","../manager/EquipmentManager":"EquipmentManager"}],SuitData:[function(t,e,i){"use strict";cc._RF.push(e,"f9543VeOPVDfIOgvubFIjVk","SuitData");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=t("./BaseData"),r=t("./EquipmentData"),s=function(t){function e(){var e=t.call(this)||this;return e.nameCn="",e.nameEn="",e.suitType="",e.suitNames="",e.desc="",e.count=0,e.equipList=[],e}return a(e,t),Object.defineProperty(e.prototype,"EquipList",{get:function(){return this.equipList},enumerable:!1,configurable:!0}),e.prototype.valueCopy=function(t){if(t){for(var e=0,i=t.equipList;e<i.length;e++){var o=i[e],a=new r.default;a.valueCopy(o),this.equipList.push(a)}this.count=t.count?t.count:0,this.nameCn=t.nameCn?t.nameCn:"",this.nameEn=t.nameEn?t.nameEn:"",this.suitType=t.suitType?t.suitType:"",this.desc=t.desc?t.desc:"",this.suitNames=t.suitNames?t.suitNames:""}},e.prototype.clone=function(){for(var t=new e,i=[],o=0,a=this.equipList;o<a.length;o++){var n=a[o],s=new r.default;s.valueCopy(n),i.push(s)}return t.equipList=i,t.nameCn=this.nameCn,t.nameEn=this.nameEn,t.count=this.count,t.suitType=this.suitType,t.desc=this.desc,t.suitNames=this.suitNames,t},e}(n.default);i.default=s,cc._RF.pop()},{"./BaseData":"BaseData","./EquipmentData":"EquipmentData"}],TalentDash:[function(t,e,i){"use strict";cc._RF.push(e,"52ac4HK4rpMhYIJb8+wkG1J","TalentDash");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=t("./Talent"),l=t("../item/DashShadow"),c=t("../data/DamageData"),u=t("../manager/StatusManager"),h=t("../utils/AudioPlayer"),d=t("../data/FromData"),p=t("../logic/PlayerAvatar"),f=t("../utils/ActorUtils"),g=cc._decorator,y=g.ccclass,m=g.property,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dashShadow=null,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.init=function(e){t.prototype.init.call(this,e),this.dashShadow.node.active=!1,this.node.parent=this.player.node.parent,this.dashShadow.init(this)},e.prototype.skillCanUse=function(){return!0},e.prototype.useSKill=function(){this.doSkill()},e.prototype.doSkill=function(){var t=this;if(this.talentSkill&&!this.talentSkill.IsExcuting){var e=3;this.hashTalent(s.default.DASH_13)&&(e=2);var i=1200;this.hashTalent(s.default.DASH_14)&&(i=2400),this.talentSkill.next(function(){t.talentSkill.IsExcuting=!0,cc.director.emit(r.EventHelper.PLAY_AUDIO,{detail:{name:h.default.DASH}}),t.schedule(function(){t.player.getWalkSmoke(t.node.parent,t.node.position)},.05,4,0);var e=t.player.entity.Move.linearVelocity.clone();t.player.sc.isMoving=!1,e=e.equals(cc.Vec2.ZERO)?t.player.isFaceRight?cc.v2(1,0):cc.v2(-1,0):e.normalizeSelf();var o=cc.v2(e.x,e.y);t.hashTalent(s.default.DASH_08)&&(i=100,t.showShadow(o)),t.hv=o.clone(),e=e.mul(i),t.player.entity.Move.linearVelocity=e,t.scheduleOnce(function(){t.player.entity.Move.linearVelocity=cc.Vec2.ZERO,t.player.playerAnim(p.default.STATE_IDLE,t.player.currentDir),t.IsExcuting=!1},.5)},e,!0)}},e.prototype.showShadow=function(t){this.dashShadow&&(this.dashShadow.setHv(t.clone()),this.dashShadow.show())},e.prototype.changePerformance=function(){},e.prototype.onColliderEnter=function(t){this.hashTalent(s.default.DASH_02)&&!this.hashTalent(s.default.DASH_08)&&this.attacking(t,this.node)},e.prototype.attacking=function(t,e){if(t&&e.active){var i=new c.default(1);this.hashTalent(s.default.DASH_07)&&(i.realDamage=5);var o=f.default.getEnemyActorByNode(t.node,!0);o&&!o.sc.isDied&&o.takeDamage(i)&&(this.beatBack(o),this.addTargetAllStatus(o))}},e.prototype.beatBack=function(t){if(this.hashTalent(s.default.DASH_04)){var e=this.hv.clone();e=e.normalizeSelf().mul(1e3),t.entity.Move.linearVelocity=cc.v2(e.x,e.y)}},e.prototype.addTargetAllStatus=function(t){this.addTargetStatus(s.default.DASH_05,t,u.default.FROZEN),this.addTargetStatus(s.default.DASH_06,t,u.default.DIZZ),this.addTargetStatus(s.default.DASH_03,t,u.default.BLEEDING)},e.prototype.addTargetStatus=function(t,e,i){this.hashTalent(t)&&e.addStatus(i,new d.default)},e.prototype.takeDamage=function(){return!1},n([m(l.default)],e.prototype,"dashShadow",void 0),n([y],e)}(s.default);i.default=v,cc._RF.pop()},{"../data/DamageData":"DamageData","../data/FromData":"FromData","../item/DashShadow":"DashShadow","../logic/EventHelper":"EventHelper","../logic/PlayerAvatar":"PlayerAvatar","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","./Talent":"Talent"}],TalentData:[function(t,e,i){"use strict";cc._RF.push(e,"337bcbBGB9GS4DrPZ+ZKu25","TalentData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./CommonData"),a=function(){function t(){this.desc="",this.nameCn="",this.nameEn="",this.resName="",this.cooldown=0,this.passive=0,this.lastTime=0,this.cost=1,this.storePoint=0,this.useCount=0,this.common=new o.default}return Object.defineProperty(t.prototype,"Common",{get:function(){return this.common},enumerable:!1,configurable:!0}),t.prototype.valueCopy=function(t){this.common.valueCopy(t.common),this.nameCn=t.nameCn?t.nameCn:this.nameCn,this.nameEn=t.nameEn?t.nameEn:this.nameEn,this.desc=t.desc?t.desc:this.desc,this.resName=t.resName?t.resName:"",this.cooldown=t.cooldown?t.cooldown:0,this.passive=t.passive?t.passive:0,this.storePoint=t.storePoint||0==t.storePoint?t.storePoint:1,this.cost=t.cost||0==t.cost?t.cost:1,this.useCount=t.useCount?t.useCount:0,this.lastTime=t.lastTime?t.lastTime:0},t.prototype.clone=function(){var e=new t;return e.common=this.common.clone(),e.nameCn=this.nameCn,e.nameEn=this.nameEn,e.desc=this.desc,e.resName=this.resName,e.cooldown=this.cooldown,e.passive=this.passive,e.lastTime=this.lastTime,e.storePoint=this.storePoint,e.cost=this.cost,e.useCount=this.useCount,e},t}();i.default=a,cc._RF.pop()},{"./CommonData":"CommonData"}],TalentMagic:[function(t,e,i){"use strict";cc._RF.push(e,"d3909410aVM/oDLjAGklG7U","TalentMagic");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=t("./Talent"),l=t("../manager/StatusManager"),c=t("../data/FromData"),u=t("./MagicCircle"),h=t("./MagicIce"),d=t("./FireGhost"),p=t("../logic/Logic"),f=t("./IceThron"),g=t("../utils/AudioPlayer"),y=cc._decorator,m=y.ccclass,v=y.property,E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.magiccircle=null,e.magicice=null,e.icethron=null,e.fireGhost=null,e.magicLighteningCircle=null,e.fireGhostNum=0,e.checkTimeDelay=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.ghostPool=new cc.NodePool(d.default),cc.director.on("destoryfireghost",function(e){t.destroyGhost(e.detail.coinNode)})},e.prototype.destroyGhost=function(t){t&&(t.active=!1,this.ghostPool&&(this.ghostPool.put(t),this.fireGhostNum--,cc.log("destroyGhost")))},e.prototype.init=function(e){var o=this;this.magicLighteningCircle.opacity=0,t.prototype.init.call(this,e),this.scheduleOnce(function(){o.hashTalent(s.default.MAGIC_07)&&o.player.addStatus(o.hashTalent(i.MAGIC_06)?l.default.MAGIC_WEAPON_STRONG:l.default.MAGIC_WEAPON,new c.default),o.hashTalent(s.default.MAGIC_13)&&!o.magicice.isShow&&o.magicice.showIce(),o.hashTalent(s.default.MAGIC_10)&&o.initFireGhosts(),o.hashTalent(i.MAGIC_16)&&o.showLighteningCircle()},.2)},e.prototype.skillCanUse=function(){return!0},e.prototype.useSKill=function(){this.doSkill()},e.prototype.doSkill=function(){var t=this;if(this.talentSkill&&!this.talentSkill.IsExcuting){var e=7;this.hashTalent(s.default.MAGIC_04)&&(e=3),this.talentSkill.next(function(){t.talentSkill.IsExcuting=!0,t.magiccircle.talentMaigc=t,t.magiccircle.playMagic(t.hashTalent(s.default.MAGIC_03))},e,!0)}},e.prototype.MagicFinish=function(){var t=this;this.hashTalent(s.default.MAGIC_09)||this.hashTalent(s.default.MAGIC_08)||(this.hashTalent(s.default.MAGIC_12)?this.showIceThron():this.hashTalent(s.default.MAGIC_11)?this.showIceThron():this.hashTalent(s.default.MAGIC_15)?this.schedule(function(){t.addLighteningFall(t.hashTalent(s.default.MAGIC_06),8)},.2,this.hashTalent(s.default.MAGIC_02)?1:0):this.hashTalent(s.default.MAGIC_14)?this.schedule(function(){t.addLighteningFall(t.hashTalent(s.default.MAGIC_06),5)},.2,this.hashTalent(s.default.MAGIC_02)?1:0):this.hashTalent(s.default.MAGIC_01)&&(g.default.play(g.default.SKILL_MAGICBALL),this.fire(this.player.shooterEx,80,this.hashTalent(s.default.MAGIC_06)?"bullet135":"bullet035")))},e.prototype.showIceThron=function(){var t=this;this.scheduleOnce(function(){g.default.play(g.default.SKILL_ICETHRON)},1);var e=[0,45,90,135,180,225,270,315],i=[15,60,105,150,195,240,285,330],o=[100,150],a=[e,i],n=[e,i,e],r=[e],l=[3],c=[100];this.hashTalent(s.default.MAGIC_02)&&(r=a,l=[3,4],c=o),this.hashTalent(s.default.MAGIC_12)&&(r=a,l=[3,5],c=o,this.hashTalent(s.default.MAGIC_02)&&(r=n,l=[3,4,5],c=[100,150,200]));var u=0;this.schedule(function(){for(var e=0;e<r[u].length;e++)cc.instantiate(t.icethron).getComponent(f.default).show(t.player,r[u][e],c[u],l[u]);u++},.5,r.length-1)},e.prototype.fire=function(t,e,i){t.data.bulletType=i,t.data.bulletArcExNum=e,this.hashTalent(s.default.MAGIC_02)&&(t.data.bulletArcExNum=80==e?99:2),t.data.bulletLineExNum=0,t.fireBullet(0)},e.prototype.changePerformance=function(){},e.prototype.takeIce=function(){return!(!this.hashTalent(s.default.MAGIC_13)||!this.magicice.isShow||(l.default.addStatus2NearEnemies(this.player,this.player.node,l.default.FROZEN,300,new c.default),this.magicice.breakIce(),0))},e.prototype.takeDamage=function(){return!1},e.prototype.addLighteningFall=function(t,e){r.EventHelper.emit(r.EventHelper.DUNGEON_ADD_LIGHTENINGFALL,{pos:this.getNearestEnemyPosition(),showArea:t,damage:e})},e.prototype.getNearestEnemyPosition=function(){for(var t,e=99999,i=0,o=this.player.weaponRight.meleeWeapon.dungeon.monsterManager.monsterList;i<o.length;i++){var a=o[i];a&&a.node&&a.node.active&&!a.sc.isDied&&(s=p.default.getDistanceNoSqrt(this.node.position,a.node.position))<e&&(e=s,t=a.node)}for(var n=0,r=this.player.weaponRight.meleeWeapon.dungeon.monsterManager.bossList;n<r.length;n++){var s,l=r[n];l.sc.isDied||(s=p.default.getDistanceNoSqrt(this.node.position,l.node.position))<e&&(e=s,t=l.node)}return t?t.position:this.node.position.addSelf(cc.v3(p.default.getRandomNum(0,600)-300,p.default.getRandomNum(0,600)-300))},e.prototype.showLighteningCircle=function(){var t=this;this.magicLighteningCircle.opacity=128,this.magicLighteningCircle.scale=1,cc.tween(this.magicLighteningCircle).to(1,{scale:10}).call(function(){l.default.addStatus2NearEnemies(t.player,t.player.node,l.default.DIZZ,300,new c.default),t.magicLighteningCircle.opacity=0,t.magicLighteningCircle.scale=1}).start()},e.prototype.initFireGhosts=function(){for(var t=this.fireGhostNum,e=0;e<5-t;e++){var i=null;this.ghostPool.size()>0&&(i=this.ghostPool.get()),i&&!i.active||(i=cc.instantiate(this.fireGhost)),this.fireGhostNum++,i.active=!0;var o=i.getComponent(d.default);o.initCollider(),this.player.node.parent.addChild(o.node),o.init(this.player,72*e)}},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>10&&(this.checkTimeDelay=0,!0)},n([v(u.default)],e.prototype,"magiccircle",void 0),n([v(h.default)],e.prototype,"magicice",void 0),n([v(cc.Prefab)],e.prototype,"icethron",void 0),n([v(cc.Prefab)],e.prototype,"fireGhost",void 0),n([v(cc.Node)],e.prototype,"magicLighteningCircle",void 0),i=n([m],e)}(s.default);i.default=E,cc._RF.pop()},{"../data/FromData":"FromData","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../manager/StatusManager":"StatusManager","../utils/AudioPlayer":"AudioPlayer","./FireGhost":"FireGhost","./IceThron":"IceThron","./MagicCircle":"MagicCircle","./MagicIce":"MagicIce","./Talent":"Talent"}],TalentShield:[function(t,e,i){"use strict";cc._RF.push(e,"9db0eWCt9hLa7XLpSo6xHBj","TalentShield");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../manager/StatusManager"),s=t("../logic/EventHelper"),l=t("../logic/Logic"),c=t("../data/DamageData"),u=t("./Talent"),h=t("../utils/AudioPlayer"),d=t("../data/FromData"),p=cc._decorator,f=p.ccclass,g=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shieldBackSprite=null,e.shieldFrontSprite=null,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){},e.prototype.init=function(e){t.prototype.init.call(this,e),this.shieldBackSprite=this.getSpriteChildSprite(["shieldback"]),this.shieldFrontSprite=this.getSpriteChildSprite(["shieldfront"]),this.shieldBackSprite.node.opacity=0,this.shieldFrontSprite.node.opacity=0,this.sprites=new Array;for(var i=[2,3,4,5,9,12,13,14],o=0;o<i.length;o++){var a=this.getSpriteChildSprite(["shieldfront","sprite"+i[o]]);a.node.opacity=0,this.sprites.push(a)}},e.prototype.changePerformance=function(){for(var t=0,e=this.sprites;t<e.length;t++)e[t].node.opacity=0;this.shieldFrontSprite.node.color=cc.color(255,255,255),this.changeRes("shield01")},e.prototype.changeRes=function(t){!t||t.length<1||(this.shieldBackSprite.spriteFrame=l.default.spriteFrameRes(t),this.shieldFrontSprite.spriteFrame=l.default.spriteFrameRes(t))},e.prototype.skillCanUse=function(){return!0},e.prototype.useSKill=function(){this.doSkill()},e.prototype.doSkill=function(){var t=this;if(this.talentSkill&&!this.talentSkill.IsExcuting){var e=7,o=1;this.hashTalent(i.SHIELD_13)&&(e=5),this.talentSkill.next(function(){var e=r.default.SHIELD_NORMAL,a=.1;t.talentSkill.IsExcuting=!0;var n=t.shieldFrontSprite.node.y;t.shieldBackSprite.node.scaleX=1,t.shieldFrontSprite.node.scaleX=0,t.shieldBackSprite.node.opacity=255,t.shieldFrontSprite.node.opacity=255,t.shieldFrontSprite.node.x=-8,t.hashTalent(i.SHIELD_14)&&(e=r.default.SHIELD_LONG,o=2),t.hashTalent(i.SHIELD_06)&&(o=0,a=0),cc.tween(t.shieldBackSprite.node).to(.1,{scaleX:0,scaleY:1}).to(.1,{position:cc.v3(-16,n)}).delay(o).to(a,{position:cc.v3(-8,n)}).to(a,{scale:1}).start(),cc.tween(t.shieldFrontSprite.node).to(.1,{scale:1}).to(.1,{position:cc.v3(8,n)}).delay(o).to(a,{position:cc.v3(-8,n)}).to(a,{scaleX:0,scaleY:1}).start(),t.player.addStatus(e,new d.default),t.scheduleOnce(function(){cc.director.emit(s.EventHelper.PLAY_AUDIO,{detail:{name:h.default.MELEE}})},.2),t.scheduleOnce(function(){t.talentSkill.IsExcuting=!1},o+.2),t.scheduleOnce(function(){t.shieldBackSprite.node.opacity=255},1)},e,!0)}},e.prototype.canAddStatus=function(t){return!this.hashTalent(i.SHIELD_04)||!(t==r.default.FROZEN||t==r.default.BURNING||t==r.default.DIZZ||t==r.default.TOXICOSIS||t==r.default.CURSING||t==r.default.BLEEDING)},e.prototype.takeDamage=function(t,e){if(e&&this.IsExcuting){if(this.hashTalent(i.SHIELD_05))return e.takeDamage(new c.default(5));if(this.hashTalent(i.SHIELD_02))return e.takeDamage(new c.default(1))}return!1},i=n([f],e)}(u.default));i.default=g,cc._RF.pop()},{"../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../manager/StatusManager":"StatusManager","../utils/AudioPlayer":"AudioPlayer","./Talent":"Talent"}],Talent:[function(t,e,i){"use strict";cc._RF.push(e,"11194HbWx5MlLwfYetzGt8W","Talent");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../utils/NextStep"),s=t("../logic/Player"),l=t("../logic/Logic"),c=t("../logic/EventHelper"),u=t("../actor/AreaOfEffect"),h=t("../ui/CoolDownView"),d=t("../utils/Utils"),p=t("../collider/CCollider"),f=t("../utils/AudioPlayer"),g=cc._decorator,y=g.ccclass,m=(g.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.talentSkill=new r.default,e.coolDownId=h.default.PROFESSION,e.checkTimeDelay=0,e}var i;return a(e,t),i=e,Object.defineProperty(e.prototype,"IsExcuting",{get:function(){return this.talentSkill.IsExcuting},set:function(t){this.talentSkill.IsExcuting=t},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){},e.prototype.init=function(t){this.player=this.getComponent(s.default),this.data=t},e.prototype.initCoolDown=function(t,e){var i=this;this.talentSkill.init(!1,e,t.storePoint,t.cooldown,t.lastTime,function(e){i.updateCooldownAndHud(t.cooldown,e)})},e.prototype.useSKill=function(){var t=this;if(this.talentSkill&&!this.talentSkill.IsExcuting)if(this.player.data.currentDream>=this.data.cost&&this.skillCanUse()){var e=this.data.cooldown;this.talentSkill.next(function(){t.data.lastTime=Date.now(),t.talentSkill.IsExcuting=!0,t.player.updateDream(t.data.cost),t.data.useCount++,t.doSkill(),t.updateCooldownAndHud(e,t.data.lastTime)},e,!0,function(i){t.updateCooldownAndHud(e,i)})}else this.skillCanUse()?(f.default.play(f.default.SELECT_FAIL),cc.director.emit(c.EventHelper.HUD_SHAKE_PLAYER_DREAMBAR),d.default.toast("\u80fd\u91cf\u4e0d\u8db3\u3002")):f.default.play(f.default.SELECT_FAIL)},e.prototype.refreshCooldown=function(){this.data.lastTime=this.talentSkill.refreshCoolDown(this.data.cooldown),this.updateCooldownAndHud(this.data.cooldown,this.data.lastTime)},e.prototype.cutCooldown=function(t){this.data.lastTime=this.talentSkill.cutCoolDown(t),this.updateCooldownAndHud(this.data.cooldown,this.data.lastTime)},e.prototype.updateCooldownAndHud=function(t,e){this.node&&(this.data.storePoint=this.talentSkill.StorePoint,c.EventHelper.emit(c.EventHelper.HUD_CONTROLLER_COOLDOWN,{id:this.coolDownId,duration:t,lastTime:e,storePoint:this.talentSkill.StorePoint,storePointMax:this.talentSkill.StorePointMax}))},e.prototype.getSpriteChildSprite=function(t){for(var e=this.node,i=0,o=t;i<o.length;i++){var a=o[i];e=e.getChildByName(a)}return e.getComponent(cc.Sprite)},e.prototype.hashTalent=function(t){return this.data.resName==t},e.prototype.shoot=function(t,e,i,o,a,n){t.data.bulletType=o,t.data.bulletArcExNum=e,t.data.bulletLineExNum=i,t.fireBullet(0,null,0,0,a,n)},e.prototype.addAoe=function(t,e,i,o,a,n){var r=cc.instantiate(t);e.y+=32;var s=r.getChildByName("sprite").getComponent(cc.Sprite),c=r.getComponent(p.default);if(o.length>0){var h=l.default.spriteFrameRes(o[0]);s.node.width=h.getOriginalSize().width,s.node.height=h.getOriginalSize().height,s.node.scale=4,s.node.scaleX=n?4:-4,c.w=3*s.node.width,c.h=3*s.node.height}for(var d=cc.tween(),f=function(t){d.then(cc.tween().delay(.2).call(function(){s.spriteFrame=l.default.spriteFrameRes(t)}))},g=0,y=o;g<y.length;g++)f(y[g]);a?cc.tween(r).repeatForever(d).start():cc.tween(r).then(d).delay(.2).call(function(){s.spriteFrame=null}).start(),r.getComponent(u.default).show(this.player.dungeon.node,e,cc.v2(1,0),0,i)},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},e.DASH="1000000",e.SHIELD="2000000",e.MAGIC="3000000",e.ARCHER="4000000",e.DASH_01=i.DASH+1,e.DASH_02=i.DASH+2,e.DASH_03=i.DASH+3,e.DASH_04=i.DASH+4,e.DASH_05=i.DASH+5,e.DASH_06=i.DASH+6,e.DASH_07=i.DASH+7,e.DASH_08=i.DASH+8,e.DASH_09=i.DASH+9,e.DASH_10=i.DASH+10,e.DASH_11=i.DASH+11,e.DASH_12=i.DASH+12,e.DASH_13=i.DASH+13,e.DASH_14=i.DASH+14,e.SHIELD_01=i.SHIELD+1,e.SHIELD_02=i.SHIELD+2,e.SHIELD_03=i.SHIELD+3,e.SHIELD_04=i.SHIELD+4,e.SHIELD_05=i.SHIELD+5,e.SHIELD_06=i.SHIELD+6,e.SHIELD_07=i.SHIELD+7,e.SHIELD_08=i.SHIELD+8,e.SHIELD_09=i.SHIELD+9,e.SHIELD_10=i.SHIELD+10,e.SHIELD_11=i.SHIELD+11,e.SHIELD_12=i.SHIELD+12,e.SHIELD_13=i.SHIELD+13,e.SHIELD_14=i.SHIELD+14,e.MAGIC_01=i.MAGIC+1,e.MAGIC_02=i.MAGIC+2,e.MAGIC_03=i.MAGIC+3,e.MAGIC_04=i.MAGIC+4,e.MAGIC_05=i.MAGIC+5,e.MAGIC_06=i.MAGIC+6,e.MAGIC_07=i.MAGIC+7,e.MAGIC_08=i.MAGIC+8,e.MAGIC_09=i.MAGIC+9,e.MAGIC_10=i.MAGIC+10,e.MAGIC_11=i.MAGIC+11,e.MAGIC_12=i.MAGIC+12,e.MAGIC_13=i.MAGIC+13,e.MAGIC_14=i.MAGIC+14,e.MAGIC_15=i.MAGIC+15,e.MAGIC_16=i.MAGIC+16,e.TALENT_000="talent000",e.TALENT_001="talent001",e.TALENT_002="talent002",e.TALENT_003="talent003",e.TALENT_004="talent004",e.TALENT_005="talent005",e.TALENT_006="talent006",e.TALENT_007="talent007",e.TALENT_008="talent008",e.TALENT_009="talent009",e.TALENT_010="talent010",e.TALENT_011="talent011",e.TALENT_012="talent012",e.TALENT_013="talent013",e.TALENT_014="talent014",e.TALENT_015="talent015",e.TALENT_016="talent016",e.TALENT_017="talent017",e.TALENT_018="talent018",e.TALENT_019="talent019",e.TALENT_100="talent100",e.TALENT_101="talent101",e.TALENT_102="talent102",e.TALENT_103="talent103",n([y],e)}(cc.Component));i.default=m,cc._RF.pop()},{"../actor/AreaOfEffect":"AreaOfEffect","../collider/CCollider":"CCollider","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Player":"Player","../ui/CoolDownView":"CoolDownView","../utils/AudioPlayer":"AudioPlayer","../utils/NextStep":"NextStep","../utils/Utils":"Utils"}],TarotCard:[function(t,e,i){"use strict";cc._RF.push(e,"e4b2bYbHidG7bCWzE85sIMb","TarotCard");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../data/TarotData"),s=cc._decorator,l=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.indexLabel=null,e.anim=null,e.frontNode=null,e.backNode=null,e.data=new r.default,e}return a(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.frontNode=this.node.getChildByName("sprite").getChildByName("front"),this.backNode=this.node.getChildByName("sprite").getChildByName("back"),this.indexLabel=this.node.getChildByName("sprite").getChildByName("front").getChildByName("index").getComponent(cc.Label),this.frontNode.scaleX=0,this.backNode.scaleY=1},e.prototype.initFromGround=function(){this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play("TarotIdle")},e.prototype.showCard=function(){this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play("TarotFilpToFront")},e.prototype.coverCard=function(){this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play("TarotFilpToBack")},e.prototype.start=function(){},n([l],e)}(cc.Component));i.default=c,cc._RF.pop()},{"../data/TarotData":"TarotData"}],TarotData:[function(t,e,i){"use strict";cc._RF.push(e,"2921ee/FxFNuIPjZdXjGRw+","TarotData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.nameCn="",this.nameEn="",this.desc="",this.resName="",this.index=0,this.word1="",this.word2="",this.word3="",this.word4="",this.word5="",this.word6=""}return t.prototype.valueCopy=function(t){this.nameCn=t.nameCn?t.nameCn:this.nameCn,this.nameEn=t.nameEn?t.nameEn:this.nameEn,this.index=t.index?t.index:this.index,this.resName=t.resName?t.resName:this.resName,this.desc=t.desc},t.prototype.clone=function(){var e=new t;return e.nameCn=this.nameCn,e.nameEn=this.nameEn,e.index=this.index,e.resName=this.resName,e.desc=this.desc,e},t}();i.default=o,cc._RF.pop()},{}],TarotManager:[function(t,e,i){"use strict";cc._RF.push(e,"b67c009qhlE0oYcKSjCxjFX","TarotManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../item/TarotCard"),s=t("../logic/Dungeon"),l=t("../utils/IndexZ"),c=cc._decorator,u=(c.ccclass,c.property),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.card=null,e}return a(e,t),e.prototype.getCard=function(t,e){var i=cc.instantiate(this.card);i.parent=this.node,i.position=s.default.getPosInMap(e),i.zIndex=l.default.getActorZIndex(i.position);var o=i.getComponent(r.default);return o.data.resName=t,o},e.THE_FOOL="tarot00",e.THE_MAGICIAN="tarot01",e.THE_HIGH_PRIESTESS="tarot02",e.THE_EMPRESS="tarot03",e.THE_EMPEROR="tarot04",e.THE_HIEROPHANT="tarot05",e.THE_LOVERS="tarot06",e.THE_CHARIOT="tarot07",e.STRENGTH="tarot08",e.THE_HERMIT="tarot09",e.THE_WHEEL_OF_FORTUNE="tarot10",e.JUSTICE="tarot11",e.THE_HANGEDMAN="tarot12",e.DEATH="tarot13",e.TEMPERANCE="tarot14",e.THE_DEVIL="tarot15",e.THE_TOWER="tarot16",e.THE_STAR="tarot17",e.THE_MOON="tarot18",e.THE_SUN="tarot19",e.JUDGEMENT="tarot20",e.THE_WORLD="tarot21",n([u(cc.Prefab)],e.prototype,"card",void 0),e}(cc.Component);i.default=h,cc._RF.pop()},{"../item/TarotCard":"TarotCard","../logic/Dungeon":"Dungeon","../utils/IndexZ":"IndexZ"}],TarotTable:[function(t,e,i){"use strict";cc._RF.push(e,"f0e8dVSyEpP0bI6DNiqwoQc","TarotTable");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../ui/Tips"),l=t("./Building"),c=t("../utils/IndexZ"),u=cc._decorator,h=u.ccclass,d=(u.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.onLoad=function(){var t=this;this.anim=this.getComponent(cc.Animation),this.tips=this.node.getChildByName("Tips").getComponent(s.default),this.tips.onInteract(function(){t.node&&t.showCards()})},e.prototype.start=function(){},e.prototype.showCards=function(){this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play()},e.prototype.setPos=function(t){this.pos=t,this.entity.Transform.position=r.default.getPosInMap(t),this.node.position=this.entity.Transform.position.clone(),this.node.zIndex=c.default.getActorZIndex(this.entity.Transform.position)},n([h],e)}(l.default));i.default=d,cc._RF.pop()},{"../logic/Dungeon":"Dungeon","../ui/Tips":"Tips","../utils/IndexZ":"IndexZ","./Building":"Building"}],TestFog:[function(t,e,i){"use strict";cc._RF.push(e,"1aa806ypbFLYIf29yLJ7ObM","TestFog");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.start=function(){},e.prototype.show=function(){this.mat||(this.mat=this.node.getComponent(cc.Sprite).getMaterial(0)),this.mat.setProperty("wh_ratio",this.node.width/this.node.height),this.mat.setProperty("center",cc.v2(.5,.5)),this.mat.setProperty("radius",.5)},n([s],e)}(cc.Component));i.default=l,cc._RF.pop()},{}],Test:[function(t,e,i){"use strict";cc._RF.push(e,"f27abc9Kq9M9YY+mw/i2T6U","Test");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,l=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.graphics=null,e.graphicsTest=null,e.camera=null,e.ray=null,e.shadow=null,e.shadowCamera=null,e.bg=null,e.radius=200,e.playerPos=cc.v2(640,360),e.zoomArr=[1,.5],e.index=0,e.waveOffset=0,e.rad=200,e}return a(e,t),e.prototype.onLoad=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){var i=e.getLocation();t.playerPos=i.clone()},this),this.node.on(cc.Node.EventType.TOUCH_START,function(e){var i=e.getLocation();t.playerPos=i.clone(),cc.log("playerPos:"+i.x+","+i.y)},this),this.mat2=this.bg.getComponent(cc.Sprite).getMaterial(0),this.bg.on(cc.Node.EventType.TOUCH_END,function(e){var i=t.camera.getWorldToScreenPoint(e.getLocation()),o=cc.view.getCanvasSize(),a=cc.view.getVisibleSize(),n=a.width/a.height,r=o.width/a.width;t.mat2.setProperty("canvas_size",cc.v2(o.width,o.height)),t.mat2.setProperty("wh_ratio",n);var s=cc.v2(i.x/a.width,i.y/a.height),l=Math.abs(s.y-.5)*a.height*r/o.height;t.mat2.setProperty("center",cc.v2(s.x,s.y>.5?.5+l:.5-l)),t.waveOffset=0},this),this.graphicsTest.strokeColor=cc.Color.RED,this.graphicsTest.lineWidth=32,this.graphicsTest.moveTo(0,0),this.graphicsTest.lineTo(300,0),this.graphicsTest.stroke(),this.graphicsTest.lineWidth=64,this.graphicsTest.moveTo(0,0),this.graphicsTest.lineTo(1,0),this.graphicsTest.stroke(),this.graphicsTest.lineWidth=64,this.graphicsTest.moveTo(300,0),this.graphicsTest.lineTo(301,0),this.graphicsTest.stroke()},e.prototype.changeZoom=function(){this.camera&&(this.camera.zoomRatio=this.zoomArr[this.index++],this.index>this.zoomArr.length-1&&(this.index=0))},e.prototype.changeRayCast=function(){this.graphicsTest.clear(),this.graphicsTest.fillColor=cc.color(255,255,255,30),this.graphicsTest.strokeColor=cc.color(255,255,255,30),this.rad-=10,this.graphicsTest.lineWidth=this.rad,this.graphicsTest.moveTo(0,0),this.graphicsTest.lineTo(1,0),this.graphicsTest.stroke()},e.prototype.start=function(){this.mat=this.graphics.getMaterial(0),this.mat1=this.ray.getMaterial(0),this.render(this.playerPos);var t=new cc.RenderTexture;t.initWithSize(cc.visibleRect.width/8,cc.visibleRect.height/8),t.setFilters(cc.Texture2D.Filter.NEAREST,cc.Texture2D.Filter.NEAREST),this.shadowCamera.targetTexture=t,this.shadowCamera.render(),this.shadow.spriteFrame=new cc.SpriteFrame(t)},e.prototype.render=function(t){var e=this.graphics.node.convertToNodeSpaceAR(t);this.graphics.clear(),this.graphics.fillColor=cc.color(0,255,0),this.graphics.circle(e.x,e.y,this.radius),this.graphics.fill()},e.prototype.updateMat=function(t,e,i){var o=cc.view.getCanvasSize(),a=cc.view.getVisibleSize(),n=a.width/a.height,r=i/a.height,s=o.width/a.width;t.setProperty("screen",cc.v2(o.width,o.height)),t.setProperty("maxRadius",r*this.camera.zoomRatio),t.setProperty("whRatio",n);var l=cc.v2(e.x/a.width,e.y/a.height),c=Math.abs(l.y-.5)*a.height*s/o.height;t.setProperty("lightPos",cc.v2(l.x,l.y>.5?.5+c:.5-c))},e.prototype.lateUpdate=function(){this.render(this.playerPos);var t=this.camera.getWorldToScreenPoint(this.playerPos);this.updateMat(this.mat,cc.v2(t.x,t.y),this.radius)},e.prototype.update=function(t){this.waveOffset>2||(this.waveOffset+=2*t,this.mat2.setProperty("wave_offset",this.waveOffset))},n([l(cc.Graphics)],e.prototype,"graphics",void 0),n([l(cc.Graphics)],e.prototype,"graphicsTest",void 0),n([l(cc.Camera)],e.prototype,"camera",void 0),n([l(cc.Graphics)],e.prototype,"ray",void 0),n([l(cc.Sprite)],e.prototype,"shadow",void 0),n([l(cc.Camera)],e.prototype,"shadowCamera",void 0),n([l(cc.Node)],e.prototype,"bg",void 0),n([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{}],Tile:[function(t,e,i){"use strict";cc._RF.push(e,"f8047r9sJ5IqqTgIdjYi6dc","Tile");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../utils/Random"),s=t("./Logic"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.isBroken=!1,e.isAutoShow=!0,e.timeDelay=0,e.isAnimPlaying=!1,e.isBreakingNow=!1,e.tileType="**",e.coverPrefix="",e.cover1="",e.cover2="",e.cover3="",e.cover4="",e.cover5="",e.floorPrefix="",e.isSmall=!1,e}return a(e,t),e.prototype.onLoad=function(){this.isAutoShow=!0,this.anim=this.getComponent(cc.Animation),this.floor=this.node.getChildByName("sprite").getChildByName("floor").getComponent(cc.Sprite)},e.prototype.start=function(){this.changeRes(this.getRes())},e.prototype.getRes=function(){var t=this.floorPrefix+"001";switch(this.tileType){case"**":t=this.floorPrefix+"001";break;case"*0":t=this.floorPrefix+"002",this.isSmall=!0;break;case"*1":t=this.floorPrefix+"003",this.isSmall=!0;break;case"*2":t=this.floorPrefix+"001",this.isSmall=!0;break;case"*3":t=this.floorPrefix+"002",this.isSmall=!0;break;case"*4":t=this.coverPrefix+"004";break;case"*5":t=this.cover1;break;case"*6":t=this.cover2;break;case"*7":t=this.cover3;break;case"*8":t=this.cover4;break;case"*9":t=this.cover5}return t},e.prototype.TileBreak=function(){},e.prototype.TileBreakFinish=function(){var t=this;this.isBroken=!0,this.isAnimPlaying=!1,this.isAutoShow&&this.scheduleOnce(function(){t.showTile()},2)},e.prototype.TileShow=function(){this.isAnimPlaying=!1},e.prototype.breakTile=function(){this.isAnimPlaying||(this.anim.play("TileBreak"),this.isBreakingNow=!0,this.isAnimPlaying=!0)},e.prototype.showTile=function(){!this.isAnimPlaying&&this.anim&&(this.anim.play("TileShow"),this.isBroken=!1,this.isBreakingNow=!1,this.isAnimPlaying=!0)},e.prototype.changeRes=function(t){this.floor.spriteFrame=s.default.spriteFrameRes(t),null==this.floor.spriteFrame&&(this.floor.spriteFrame=s.default.spriteFrameRes(this.floorPrefix+"001")),this.floor.node.width=this.isSmall?17:33,this.floor.node.height=this.isSmall?17:33},e.prototype.disappear=function(){cc.tween(this.node).to(.5+r.default.rand(),{opacity:0}).start()},n([u(cc.Label)],e.prototype,"label",void 0),n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../utils/Random":"Random","./Logic":"Logic"}],Tips:[function(t,e,i){"use strict";cc._RF.push(e,"36c4bnGdrlOy4Y1XkbF9xfT","Tips");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../base/BaseColliderComponent"),s=t("../collider/CCollider"),l=cc._decorator,c=l.ccclass,u=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.node.opacity=0},e.prototype.start=function(){},e.prototype.next=function(t,e){this.node&&this.node.active&&this.interactCallback&&this.interactCallback(t,e)},e.prototype.onInteract=function(t){this.interactCallback=t},e.prototype.onEnter=function(t){this.enterCallback=t},e.prototype.onExit=function(t){this.exitCallback=t},e.prototype.onColliderEnter=function(t){t.tag==s.default.TAG.PLAYER_INTERACT&&(this.node.opacity=255,this.enterCallback&&this.enterCallback(t.node))},e.prototype.onColliderExit=function(t){t.tag==s.default.TAG.PLAYER_INTERACT&&(this.node.opacity=0,this.exitCallback&&this.exitCallback(t.node))},n([c],e)}(r.default));i.default=u,cc._RF.pop()},{"../base/BaseColliderComponent":"BaseColliderComponent","../collider/CCollider":"CCollider"}],Toast:[function(t,e,i){"use strict";cc._RF.push(e,"2b27dQlgMFPKqLUuvpM/s/8","Toast");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/EventHelper"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t,e,i){this.msg=t,this.isCenter=e,this.isTap=i},h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.messgeQueue=[],e.isShowing=!1,e}return a(e,t),e.prototype.onLoad=function(){var t=this;r.EventHelper.on(r.EventHelper.HUD_TOAST,function(e){t.node&&t.addToast(e.msg,e.isCenter,e.isTap)})},e.prototype.addToast=function(t,e,i){if(!(t.length<1)){var o=!1;this.messgeQueue.length>0&&t==this.messgeQueue[this.messgeQueue.length-1].msg&&(o=!0),o||this.messgeQueue.splice(0,0,new u(t,e,i))}},e.prototype.showToast=function(t,e,i){var o=this;if(!(t.length<1)){this.isShowing=!0,this.label.node.width=e?300:600;var a=this.node;a.stopAllActions();var n=3;if(i){(n=.07*t.length)<3&&(n=3);var r=0;this.schedule(function(){o.label.string=""+t.substr(0,r++),a.width=o.label.node.width+10,a.height=o.label.node.height+10,a.opacity=255},.05,t.length,.3)}else this.scheduleOnce(function(){o.label.string=""+t,a.width=o.label.node.width+10,a.height=o.label.node.height+10,a.opacity=255},.05);var s=e?360:100;a.y=s-100,a.scale=0,cc.tween(a).to(.1,{scaleX:1}).to(.1,{scaleY:1}).to(.2,{y:s}).delay(n).to(.1,{scaleY:.1}).to(.1,{scaleX:0}).to(.1,{opacity:0}).call(function(){o.isShowing=!1}).start()}},e.prototype.update=function(){if(!this.isShowing&&this.messgeQueue.length>0){var t=this.messgeQueue.pop();this.showToast(t.msg,t.isCenter,t.isTap)}},n([c(cc.Label)],e.prototype,"label",void 0),n([l],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../logic/EventHelper":"EventHelper"}],TransformComponent:[function(t,e,i){"use strict";cc._RF.push(e,"b88f7ydsjZIxpocDUXOvbUx","TransformComponent");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0}),i.TransformComponent=void 0;var r=t("../ECS"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.position=cc.Vec3.ZERO,e}return a(e,t),e.prototype.reset=function(){this.position=cc.Vec3.ZERO},n([r.ecs.register("Transform")],e)}(r.ecs.IComponent);i.TransformComponent=s,cc._RF.pop()},{"../ECS":"ECS"}],Trap:[function(t,e,i){"use strict";cc._RF.push(e,"67e3dv84GNOwbSynhs23bOv","Trap");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("../logic/Dungeon"),s=t("../logic/Player"),l=t("../data/DamageData"),c=t("./Building"),u=t("../data/FromData"),h=t("../utils/IndexZ"),d=t("../manager/InventoryManager"),p=t("../collider/CCollider"),f=cc._decorator,g=f.ccclass,y=f.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.openSpriteFrame=null,e.closeSpriteFrame=null,e.halfSpriteFrame=null,e.isOpen=!1,e.pos=cc.v3(0,0),e.timeDelay=0,e}return a(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite")},e.prototype.start=function(){},e.prototype.setPos=function(t){this.pos=t,this.entity.Transform.position=r.default.getPosInMap(t),this.node.position=this.entity.Transform.position.clone(),this.node.zIndex=h.default.FLOOR},e.prototype.openTrap=function(){var t=this;this.isOpen||(this.isOpen=!0,this.sprite.getComponent(cc.Sprite).spriteFrame=this.openSpriteFrame,this.scheduleOnce(function(){t.isOpen=!1,t.halfSpriteFrame&&(t.sprite.getComponent(cc.Sprite).spriteFrame=t.halfSpriteFrame,t.scheduleOnce(function(){t.closeSpriteFrame&&(t.sprite.getComponent(cc.Sprite).spriteFrame=t.closeSpriteFrame)},.2))},.5))},e.prototype.onColliderStay=function(t){if(t.tag==p.default.TAG.PLAYER&&this.isOpen){this.isOpen=!1;var e=t.getComponent(s.default);e&&e.inventoryManager.getEquipBySuit(e.inventoryManager.equips[d.default.SHOES]).ignoreTrap<1&&e.takeDamage(new l.default(1),u.default.getClone(this.actorName(),"trap001"),this)}},e.prototype.update=function(t){this.timeDelay+=t,this.timeDelay>3&&(this.openTrap(),this.timeDelay=0)},e.prototype.actorName=function(){return"\u5c16\u523a"},n([y(cc.SpriteFrame)],e.prototype,"openSpriteFrame",void 0),n([y(cc.SpriteFrame)],e.prototype,"closeSpriteFrame",void 0),n([y(cc.SpriteFrame)],e.prototype,"halfSpriteFrame",void 0),n([g],e)}(c.default);i.default=m,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/Dungeon":"Dungeon","../logic/Player":"Player","../manager/InventoryManager":"InventoryManager","../utils/IndexZ":"IndexZ","./Building":"Building"}],TriggerData:[function(t,e,i){"use strict";cc._RF.push(e,"7d284fgMt1JO66faF7E9Mas","TriggerData");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.uuid="",e.res="",e.id=0,e.group=0,e.type=0,e.count=0,e.target=0,e.range=0,e.autoInterval=0,e.maxAmmo=0,e.bulletInterval=0,e.bulletAngle=0,e.bulletSize=0,e.bulletOffsetX=0,e.bulletArcOffsetX=0,e.bulletArcExNum=0,e.bulletLineExNum=0,e.bulletLineInterval=0,e.bulletSpeed=0,e}return a(e,t),e.prototype.valueCopy=function(t){t&&(this.uuid=t.uuid?t.uuid:"",this.res=t.res?t.res:"",this.id=t.id?t.id:0,this.group=t.group?t.group:0,this.type=t.type?t.type:0,this.count=t.count?t.count:0,this.target=t.target?t.target:0,this.range=t.range?t.range:0,this.maxAmmo=t.maxAmmo?t.maxAmmo:0,this.bulletInterval=t.bulletInterval?t.bulletInterval:0,this.bulletAngle=t.bulletAngle?t.bulletAngle:0,this.bulletSize=t.bulletSize?t.bulletSize:0,this.bulletOffsetX=t.bulletOffsetX?t.bulletOffsetX:0,this.bulletArcOffsetX=t.bulletArcOffsetX?t.bulletArcOffsetX:0,this.bulletArcExNum=t.bulletArcExNum?t.bulletArcExNum:0,this.bulletLineExNum=t.bulletLineExNum?t.bulletLineExNum:0,this.bulletLineInterval=t.bulletLineInterval?t.bulletLineInterval:0,this.bulletSpeed=t.bulletSpeed?t.bulletSpeed:0,this.autoInterval=t.autoInterval?t.autoInterval:0)},e.prototype.clone=function(){var t=new e;return t.uuid=t.uuid,t.res=this.res,t.id=this.id,t.group=t.group,t.type=this.type,t.count=this.count,t.target=this.target,t.range=this.range,t.maxAmmo=this.maxAmmo,t.bulletInterval=this.bulletInterval,t.bulletAngle=this.bulletAngle,t.bulletSize=this.bulletSize,t.bulletOffsetX=this.bulletOffsetX,t.bulletArcOffsetX=this.bulletArcOffsetX,t.bulletArcExNum=this.bulletArcExNum,t.bulletLineExNum=this.bulletLineExNum,t.bulletLineInterval=this.bulletLineInterval,t.bulletSpeed=this.bulletSpeed,t.autoInterval=this.autoInterval,t},e.ID_STATUS=0,e.ID_BULLET=1,e.ID_TALENT=2,e.GROUP_ATTACK=0,e.GROUP_HIT=1,e.GROUP_HURT=2,e.GROUP_USE=3,e.GROUP_AUTO=4,e.TYPE_ATTACK_1=1,e.TYPE_ATTACK_2=2,e.TYPE_ATTACK_3=3,e.TYPE_ATTTACK_REMOTE=4,e.TYPE_HIT=0,e.TYPE_HIT_CRIT=1,e.TYPE_HIT_BACK=2,e.TYPE_HIT_REMOTE=3,e.TYPE_HIT_CRIT_REMOTE=4,e.TYPE_HURT=0,e.TYPE_HURT_BLOCK=1,e.TYPE_HURT_PARRAY=2,e.TYPE_HURT_DODGE=3,e.TYPE_HURT_DREAM=4,e.TYPE_USE_ITEM=0,e.TYPE_USE_TALENT=1,e.TYPE_AUTO=0,e.TARGET_SELF=0,e.TARGET_OTHER=1,e.TARGET_OTHER_NEAREST=2,e.TARGET_ALL=3,e.TARGET_ALL_ENEMY=4,e.TARGET_ALL_ALLY=5,e}(t("./BaseData").default);i.default=n,cc._RF.pop()},{"./BaseData":"BaseData"}],Utils:[function(t,e,i){"use strict";cc._RF.push(e,"f719fThqrBMn6NkMcXey0jG","Utils");var o=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var a=t("../logic/EventHelper"),n=cc._decorator,r=n.ccclass,s=(n.property,function(){function t(){}return t.log=function(t){this.showLog&&cc.log(t)},t.clearComponentArray=function(t){for(var e=0,i=t;e<i.length;e++){var o=i[e];o&&o.isValid&&o.destroy()}},t.toast=function(t,e,i){a.EventHelper.emit(a.EventHelper.HUD_TOAST,{msg:t,isCenter:e,isTap:i})},t.getRotateAngle=function(t,e){var i=180*cc.v2(1,0).signAngle(cc.v2(t.normalize()))/Math.PI;return e?-i:i},t.getDay=function(t){var e=new Date(t),i=e.getMonth()+1,o=e.getDate();return(i<10?"0":"")+i+"\u6708"+(o<10?"0":"")+o+"\u65e5 "+this.getWeek(e)},t.getHour=function(t){var e=new Date(t),i=e.getHours()+1;i>23&&(i=0);var o=e.getMinutes();return(i<10?"0":"")+i+":"+(o<10?"0":"")+o},t.getYear=function(t){return new Date(t).getFullYear()+"\u5e74"},t.getWeek=function(t){var e="";return 0==t.getDay()&&(e="\u661f\u671f\u65e5"),1==t.getDay()&&(e="\u661f\u671f\u4e00"),2==t.getDay()&&(e="\u661f\u671f\u4e8c"),3==t.getDay()&&(e="\u661f\u671f\u4e09"),4==t.getDay()&&(e="\u661f\u671f\u56db"),5==t.getDay()&&(e="\u661f\u671f\u4e94"),6==t.getDay()&&(e="\u661f\u671f\u516d"),e},t.clamp=function(t,e,i){return t>e?e:t<i?i:t},t.clampPos=function(t,e,i){var o=t.clone();return t.x>e.x&&(o.x=e.x),t.y>e.y&&(o.y=e.y),t.x<i.x&&(o.x=i.x),t.y<i.y&&(o.y=i.y),o},t.showLog=!0,o([r],t)}());i.default=s,cc._RF.pop()},{"../logic/EventHelper":"EventHelper"}],Vector:[function(t,e,i){"use strict";cc._RF.push(e,"8b39avq6pdFOKx9CQMo7TwK","Vector"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,t&&"object"==typeof t?(this.x=t.x||0,this.y=t.y||0):(this.x=t||0,this.y=e||0)}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},t.v2=function(e,i){return new t(e,i)},t}();i.default=o,cc._RF.pop()},{}],WalkSmoke:[function(t,e,i){"use strict";cc._RF.push(e,"d3d56K96jBFs6t/GiwCmf8x","WalkSmoke");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./EventHelper"),s=cc._decorator,l=s.ccclass,c=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.start=function(){var t=this;this.scheduleOnce(function(){cc.director.emit(r.EventHelper.POOL_DESTORY_WALKSMOKE,{detail:{coinNode:t.node}})},.3)},n([l],e)}(cc.Component));i.default=c,cc._RF.pop()},{"./EventHelper":"EventHelper"}],WallPaint:[function(t,e,i){"use strict";cc._RF.push(e,"8d015BSVUpN0Ib41MCFXakS","WallPaint");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Building"),s=t("../logic/Logic"),l=cc._decorator,c=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.RANGE=3,e.RANGE_PlAYER=300,e.frame=null,e.paint=null,e}return a(e,t),e.prototype.init=function(t){this.mapStr=t;var e="wallpaint24x32_000";switch(t[2]){case"0":e="wallpaint24x32_000";break;case"1":e="wallpaint24x32_001";break;case"2":e="wallpaint24x32_002";break;case"3":e="wallpaint24x32_003";break;case"4":e="wallpaint32x16_000";break;case"5":e="wallpaint24x32_005";break;case"6":case"7":case"8":case"9":e="wallpaint24x32_000"}var i=s.default.spriteFrameRes(e);i&&(this.paint.spriteFrame=i,this.paint.node.width=i.getRect().width,this.paint.node.height=i.getRect().height,this.frame.node.width=this.paint.node.width+this.RANGE,this.frame.node.height=this.paint.node.height+this.RANGE)},n([u(cc.Sprite)],e.prototype,"frame",void 0),n([u(cc.Sprite)],e.prototype,"paint",void 0),n([c],e)}(r.default);i.default=h,cc._RF.pop()},{"../logic/Logic":"Logic","./Building":"Building"}],Wall:[function(t,e,i){"use strict";cc._RF.push(e,"e7c06zRjp9J+piF+ZsFdjSH","Wall");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./../logic/EventHelper"),s=t("../logic/Dungeon"),l=t("../logic/Logic"),c=t("./Building"),u=t("../collider/CCollider"),h=cc._decorator,d=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.half=!1,e.mapStr="##",e.wallName="",e.roofName="",e.resNameSecond="",e.type=i.TYPE_EMPTY,e.dir=0,e}var i;return a(e,t),i=e,e.prototype.onLoad=function(){this.wallsprite=this.node.getChildByName("sprite").getChildByName("wallsprite").getComponent(cc.Sprite),this.roofsprite=this.node.getChildByName("sprite").getChildByName("roofsprite").getComponent(cc.Sprite),this.shadowsprite=this.node.getChildByName("sprite").getChildByName("shadow").getComponent(cc.Sprite)},e.prototype.changeRes=function(t,e){if(this.wallsprite.spriteFrame=l.default.spriteFrameRes(t),this.roofsprite.spriteFrame=l.default.spriteFrameRes(e),this.type==i.TYPE_EMPTY)return this.node.opacity=0;this.type!=i.TYPE_OTHER1&&this.type!=i.TYPE_OTHER2&&this.type!=i.TYPE_OTHER3&&this.type!=i.TYPE_OTHER4||(this.roofsprite.node.opacity=0,this.wallsprite.node.height=256)},e.prototype.setPos=function(t){this.pos=t,this.entity.Transform.position=s.default.getPosInMap(t),this.node.position=this.entity.Transform.position.clone()},e.prototype.start=function(){this.node.opacity=255,this.changeRes(this.wallName,this.roofName)},e.prototype.ajustSpriteShow=function(t,e,i,o){this.wallsprite||(this.wallsprite=this.node.getChildByName("sprite").getChildByName("wallsprite").getComponent(cc.Sprite),this.roofsprite=this.node.getChildByName("sprite").getChildByName("roofsprite").getComponent(cc.Sprite),this.shadowsprite=this.node.getChildByName("sprite").getChildByName("shadow").getComponent(cc.Sprite)),this.shadowsprite.node.opacity=t?80:0,this.roofsprite.node.angle=e,this.wallsprite.node.scaleX=i?-1:1,this.roofsprite.node.scaleX=o.x,this.roofsprite.node.scaleY=o.y},e.prototype.isTop=function(){return this.type==i.TYPE_NORMAL&&0==this.dir||this.type==i.TYPE_CORNER&&this.dir<2||this.type==i.TYPE_INNER&&this.dir<2||this.type==i.TYPE_INNER_CORNER&&this.dir<2||this.type==i.TYPE_CONVEX&&0==this.dir||this.type==i.TYPE_CONCAVE&&0==this.dir},e.prototype.isSide=function(){return this.type==i.TYPE_NORMAL&&this.dir>1},e.prototype.init=function(t,e,o,a,n){var s=this;this.mapStr=t;var l=parseInt(t[2]);this.dir=l;var c=!1;switch(t[1]){case"#":this.type=i.TYPE_EMPTY;break;case"0":this.type=i.TYPE_OTHER1;break;case"1":this.type=i.TYPE_OTHER2;break;case"2":this.type=i.TYPE_OTHER3;break;case"3":this.type=i.TYPE_OTHER4;break;case"a":this.type=i.TYPE_NORMAL;break;case"b":this.type=i.TYPE_CORNER;break;case"c":this.type=i.TYPE_INNER;break;case"d":this.type=i.TYPE_CONVEX;break;case"e":this.type=i.TYPE_CONCAVE;break;case"f":this.type=i.TYPE_INNER_CORNER;break;case"g":this.type=i.TYPE_TWO_SIDES;break;case"h":this.type=i.TYPE_ALONE;break;case"i":this.type=i.TYPE_ROOF;break;case"j":this.type=i.TYPE_NORMAL,c=!0;break;case"k":this.type=i.TYPE_CORNER,c=!0;break;case"l":this.type=i.TYPE_INNER,c=!0;break;case"m":this.type=i.TYPE_CONVEX,c=!0;break;case"n":this.type=i.TYPE_CONCAVE,c=!0;break;case"o":this.type=i.TYPE_INNER_CORNER,c=!0;break;case"p":this.type=i.TYPE_TWO_SIDES,c=!0;break;case"q":this.type=i.TYPE_ALONE,c=!0;break;case"r":this.type=i.TYPE_ROOF,c=!0}var h=c?e.wallRes2:e.wallRes1,d="roof"+h+"anim008";switch(this.type){case i.TYPE_EMPTY:break;case i.TYPE_OTHER1:this.wallName=e.wallRes3;break;case i.TYPE_OTHER2:this.wallName=e.wallRes4;break;case i.TYPE_OTHER3:this.wallName=e.wallRes5;break;case i.TYPE_OTHER4:this.wallName=e.wallRes6;break;case i.TYPE_NORMAL:this.roofName="roof"+h+"anim000",this.wallName="wall"+h+"anim001";break;case i.TYPE_CORNER:this.roofName="roof"+h+"anim001",this.wallName=d;break;case i.TYPE_INNER:this.roofName="roof"+h+"anim002",this.wallName="wall"+h+"anim002";break;case i.TYPE_CONVEX:this.roofName="roof"+h+"anim003",this.wallName="wall"+h+"anim000";break;case i.TYPE_CONCAVE:this.roofName="roof"+h+"anim004",this.wallName=d;break;case i.TYPE_INNER_CORNER:this.roofName="roof"+h+"anim005",this.wallName="wall"+h+"anim002";break;case i.TYPE_TWO_SIDES:this.roofName="roof"+h+"anim006",this.wallName="wall"+h+"anim001";break;case i.TYPE_ALONE:this.roofName="roof"+h+"anim007",this.wallName="wall"+h+"anim000";break;case i.TYPE_ROOF:this.roofName=d,this.wallName=d}var p=!1,f=0,g=cc.v3(1,1),y=!1;switch(l){case 0:this.ajustSpriteShow(!0,f,p,g);break;case 1:this.isInnerOrCorner(this.type)?(p=!0,g=cc.v3(-1,1),y=!0):this.type==i.TYPE_TWO_SIDES?f=90:(this.wallName=d,g=cc.v3(1,-1)),this.ajustSpriteShow(y,f,p,g);break;case 2:this.isInnerOrCorner(this.type)?(g=cc.v3(1,-1),this.wallName=d):(this.type==i.TYPE_CONVEX&&(this.wallName="wall"+h+"anim002"),f=90),this.ajustSpriteShow(!1,f,p,g);break;case 3:this.isInnerOrCorner(this.type)?(g=cc.v3(-1,-1),this.wallName=d):(this.type==i.TYPE_CONVEX&&(this.wallName="wall"+h+"anim002",p=!0),f=-90),this.ajustSpriteShow(!1,f,p,g)}if(this.isTop())for(var m=0,v=this.ccolliders;m<v.length;m++)v[m].tag=u.default.TAG.WALL_TOP;if(this.setTargetTags(u.default.TAG.PLAYER,u.default.TAG.NONPLAYER,u.default.TAG.GOODNONPLAYER,u.default.TAG.BOSS,u.default.TAG.BUILDING,u.default.TAG.BULLET),o)this.entity.destroy();else if(a>0)for(var E=0,_=this.ccolliders;E<_.length;E++){var T=(O=_[E]).w/2;O.w+=O.w*a,O.offsetX=O.w/2-T}else if(n>0)for(var D=0,S=this.ccolliders;D<S.length;D++){var O;(O=S[D]).sensor?O.offsetY+=n*O.offsetY:(T=O.h/2,O.h+=O.h*n,O.offsetY=O.h/2-T)}this.combineWall&&r.EventHelper.on(r.EventHelper.DUNGEON_WALL_COLLIDER,function(t){s.node&&(0==t.type?s.onColliderEnter(t.other,t.self):1==t.type?s.onColliderStay(t.other,t.self):2==t.type&&s.onColliderExit(t.other,t.self))})},e.prototype.isInnerOrCorner=function(t){return t==i.TYPE_INNER||t==i.TYPE_CORNER||t==i.TYPE_INNER_CORNER},e.prototype.onColliderEnter=function(t,e){e.sensor&&(this.type==i.TYPE_EMPTY||t.tag!=u.default.TAG.PLAYER&&t.tag!=u.default.TAG.NONPLAYER||(this.combineWall||r.EventHelper.emit(r.EventHelper.DUNGEON_WALL_COLLIDER,{type:0,other:t,self:e}),this.type==i.TYPE_OTHER1||this.type==i.TYPE_OTHER2||this.type==i.TYPE_OTHER3||this.type==i.TYPE_OTHER4?this.wallsprite.node.opacity=180:this.roofsprite.node.opacity=180))},e.prototype.onColliderStay=function(t,e){e.sensor&&(this.type==i.TYPE_EMPTY||t.tag!=u.default.TAG.PLAYER&&t.tag!=u.default.TAG.NONPLAYER||(this.combineWall||r.EventHelper.emit(r.EventHelper.DUNGEON_WALL_COLLIDER,{type:1,other:t,self:e}),this.type==i.TYPE_OTHER1||this.type==i.TYPE_OTHER2||this.type==i.TYPE_OTHER3||this.type==i.TYPE_OTHER4?this.wallsprite.node.opacity=180:this.roofsprite.node.opacity=180))},e.prototype.onColliderExit=function(t,e){e.sensor&&(this.type==i.TYPE_EMPTY||t.tag!=u.default.TAG.PLAYER&&t.tag!=u.default.TAG.NONPLAYER||(this.combineWall||r.EventHelper.emit(r.EventHelper.DUNGEON_WALL_COLLIDER,{type:2,other:t,self:e}),this.type==i.TYPE_OTHER1||this.type==i.TYPE_OTHER2||this.type==i.TYPE_OTHER3||this.type==i.TYPE_OTHER4?this.wallsprite.node.opacity=255:this.roofsprite.node.opacity=255))},e.TYPE_EMPTY=-1,e.TYPE_NORMAL=0,e.TYPE_CORNER=1,e.TYPE_INNER=2,e.TYPE_CONVEX=3,e.TYPE_CONCAVE=4,e.TYPE_INNER_CORNER=5,e.TYPE_TWO_SIDES=6,e.TYPE_ALONE=7,e.TYPE_ROOF=8,e.TYPE_OTHER1=9,e.TYPE_OTHER2=10,e.TYPE_OTHER3=11,e.TYPE_OTHER4=12,i=n([d],e)}(c.default));i.default=p,cc._RF.pop()},{"../collider/CCollider":"CCollider","../logic/Dungeon":"Dungeon","../logic/Logic":"Logic","./../logic/EventHelper":"EventHelper","./Building":"Building"}],WarMachine:[function(t,e,i){"use strict";cc._RF.push(e,"e27dcjzJmBGK54bflNR6COZ","WarMachine");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Boss"),s=t("../data/DamageData"),l=t("../logic/Shooter"),c=t("../logic/Dungeon"),u=t("../logic/Logic"),h=t("../manager/StatusManager"),d=t("../utils/AudioPlayer"),p=t("../logic/EventHelper"),f=t("../data/FromData"),g=t("../logic/Achievement"),y=t("../utils/ActorUtils"),m=t("../collider/CCollider"),v=cc._decorator,E=v.ccclass,_=v.property,T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.text="hello",e.timeDelay=0,e.isMoving=!1,e.isMissileCoolDown=!1,e.isGatlingCoolDown=!1,e.isMainGunCoolDown=!1,e.actionCount=0,e.actionTimeDelay=0,e}return a(e,t),e.prototype.init=function(){throw new Error("Method not implemented.")},e.prototype.onLoad=function(){this.sc.isDied=!1,this.sc.isShow=!1,this.anim=this.getComponent(cc.Animation),this.shooter01=this.node.getChildByName("Shooter01").getComponent(l.default),this.shooter02=this.node.getChildByName("Shooter02").getComponent(l.default),this.shooter03=this.node.getChildByName("Shooter03").getComponent(l.default),this.shooter04=this.node.getChildByName("Shooter04").getComponent(l.default),this.shooter05=this.node.getChildByName("Shooter05").getComponent(l.default),this.statusManager=this.node.getChildByName("StatusManager").getComponent(h.default);var t=f.default.getClone(this.actorName(),"bossmachinehead");this.shooter01.from.valueCopy(t),this.shooter02.from.valueCopy(t),this.shooter03.from.valueCopy(t),this.shooter04.from.valueCopy(t),this.shooter05.from.valueCopy(t)},e.prototype.start=function(){this.initGuns()},e.prototype.takeDamage=function(t){if(this.sc.isDied||!this.sc.isShow)return!1;this.data.currentHealth-=this.data.getDamage(t).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth);var e=[d.default.MONSTER_HIT,d.default.MONSTER_HIT1,d.default.MONSTER_HIT2];return d.default.play(e[u.default.getRandomNum(0,2)]),!0},e.prototype.killed=function(){var t=this;this.sc.isDied||(this.anim&&this.anim.pause(),g.default.addMonsterKillAchievement(this.data.resName),this.sc.isDied=!0,this.scheduleOnce(function(){t.node&&(t.node.active=!1)},5),this.getLoot())},e.prototype.bossAction=function(){if(!this.sc.isDied&&this.sc.isShow&&this.dungeon){this.changeZIndex();var t=this.data.currentHealth<this.data.Common.maxHealth/2;if(this.dungeon&&u.default.getChance(90)&&this.fireMainGun(),this.getNearPlayerDistance(this.dungeon.player.node)<300?this.fireMissile(t):u.default.getChance(20)&&this.fireMissile(t),this.fireGatling(t),t){this.actionCount++;var e=cc.v3(1,0);this.actionCount>10&&(cc.director.emit(p.EventHelper.PLAY_AUDIO,{detail:{name:d.default.MELEE}}),e=cc.v3(-1,0)),this.actionCount>20&&(cc.director.emit(p.EventHelper.PLAY_AUDIO,{detail:{name:d.default.MELEE}}),this.actionCount=0),e.equals(cc.Vec3.ZERO)||(e=e.normalizeSelf(),this.move(e,600))}this.shooter01.setHv(cc.v2(0,-1));var i=this.entity.Transform.position.clone().add(this.shooter01.node.position),o=this.dungeon.player.getCenterPosition().sub(i);o.equals(cc.Vec3.ZERO)||this.shooter01.setHv(cc.v2(o).normalize())}else this.actionCount=0},e.prototype.initGuns=function(){this.isMainGunCoolDown=!1,this.isGatlingCoolDown=!1,this.isMissileCoolDown=!1,this.shooter01.setHv(cc.v2(0,-1)),this.shooter02.setHv(cc.v2(0,-1)),this.shooter03.setHv(cc.v2(0,-1)),this.shooter04.setHv(cc.v2(0,-1)),this.shooter05.setHv(cc.v2(0,-1));var t=this.entity.Transform.position.clone().add(this.shooter01.node.position),e=this.dungeon.player.getCenterPosition().sub(t);e.equals(cc.Vec3.ZERO)||this.shooter01.setHv(cc.v2(e).normalize())},e.prototype.fireMainGun=function(){var t=this;this.isMainGunCoolDown||(this.isMainGunCoolDown=!0,this.anim.play("WarMachineMainGunShoot"),this.scheduleOnce(function(){t.isMainGunCoolDown=!1},3))},e.prototype.MainGunShootFinish=function(){this.shooter01.setHv(cc.v2(0,-1));var t=this.entity.Transform.position.clone().add(this.shooter01.node.position),e=this.dungeon.player.getCenterPosition().sub(t);e.equals(cc.Vec3.ZERO)||(this.shooter01.setHv(cc.v2(e).normalize()),this.fireShooter(this.shooter01,"bullet016",0,0,0,cc.v3(48,0))),this.anim.play("WarMachineIdle")},e.prototype.fireGatling=function(t){var e=this;if(!this.isGatlingCoolDown){this.isGatlingCoolDown=!0,this.shooter02.setHv(cc.v2(0,-1)),this.shooter03.setHv(cc.v2(0,-1)),this.shooter02.data.bulletLineInterval=.5,this.shooter03.data.bulletLineInterval=.5;var i=6,o=u.default.getRandomNum(0,15);o=u.default.getHalfChance()?o:-o,t?(this.fireShooter(this.shooter02,"bullet111",0,4),this.fireShooter(this.shooter03,"bullet111",0,4),i=3):(this.fireShooter(this.shooter02,"bullet111",2,2),this.fireShooter(this.shooter03,"bullet111",2,2)),this.scheduleOnce(function(){e.isGatlingCoolDown=!1},i)}},e.prototype.fireMissile=function(t){var e=this;this.isMissileCoolDown||(this.isMissileCoolDown=!0,this.shooter04.setHv(cc.v2(0,-1)),this.shooter05.setHv(cc.v2(0,-1)),this.shooter04.data.bulletLineInterval=.5,this.shooter05.data.bulletLineInterval=.5,this.fireShooter(this.shooter04,"bullet015",2,t?1:0),this.fireShooter(this.shooter05,"bullet015",2,t?1:0),this.scheduleOnce(function(){e.isMissileCoolDown=!1},t?2:4))},e.prototype.fireShooter=function(t,e,i,o,a,n){t.dungeon=this.dungeon,t.data.bulletType=e,t.data.bulletArcExNum=i,t.data.bulletLineExNum=o,t.fireBullet(a,n)},e.prototype.showBoss=function(){this.initGuns(),this.sc.isShow=!0,this.entity.NodeRender.node=this.node,this.entity.Move.linearDamping=10,this.healthBar&&(this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.healthBar.node.active=!this.sc.isDied)},e.prototype.isActionTimeDelay=function(t){return this.actionTimeDelay+=t,this.actionTimeDelay>.2&&(this.actionTimeDelay=0,!0)},e.prototype.updateLogic=function(t){this.timeDelay+=t,this.timeDelay>1&&(this.timeDelay=0),this.isActionTimeDelay(t)&&this.bossAction(),this.data.currentHealth<1&&this.killed(),this.healthBar.node.active=!this.sc.isDied},e.prototype.move=function(t,e){if(!this.sc.isDied){t.equals(cc.Vec3.ZERO)||(this.pos=c.default.getIndexInMap(this.entity.Transform.position));var i=t.x,o=t.y,a=(Math.abs(i),Math.abs(o),cc.v2(i,o));a=a.normalize().mul(e),this.entity.Move.linearVelocity=a,this.isMoving=0!=i||0!=o,this.changeZIndex()}},e.prototype.onColliderEnter=function(t,e){if(e.tag==m.default.TAG.BOSS_HIT){var i=y.default.getEnemyCollisionTarget(t);if(i&&!this.sc.isDied){var o=new s.default;o.physicalDamage=5,i.takeDamage(o,f.default.getClone(this.actorName(),"bossmachinehead"),this)}}},e.prototype.actorName=function(){return"\u6218\u4e89\u673a\u5668"},n([_(cc.Label)],e.prototype,"label",void 0),n([_],e.prototype,"text",void 0),n([E],e)}(r.default);i.default=T,cc._RF.pop()},{"../collider/CCollider":"CCollider","../data/DamageData":"DamageData","../data/FromData":"FromData","../logic/Achievement":"Achievement","../logic/Dungeon":"Dungeon","../logic/EventHelper":"EventHelper","../logic/Logic":"Logic","../logic/Shooter":"Shooter","../manager/StatusManager":"StatusManager","../utils/ActorUtils":"ActorUtils","../utils/AudioPlayer":"AudioPlayer","./Boss":"Boss"}],WordManager:[function(t,e,i){"use strict";cc._RF.push(e,"0c333CGNPJP0ov5KegA/Xzf","WordManager"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(){},cc._RF.pop()},{}],WorldLoader:[function(t,e,i){"use strict";cc._RF.push(e,"1da44Z4XqpEhJs0KUhYRpQR","WorldLoader"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../data/ChapterData"),a=t("../data/LevelData"),n=t("../logic/Logic"),r=function(){function t(){this.worldMap=[],this.realWorldMap=new o.default(99),this.isloaded=!1,this.isloaded00=!1,this.isloaded01=!1,this.isloaded02=!1,this.isloaded03=!1,this.isloaded04=!1,this.isloaded05=!1,this.isloaded99=!1,this.isloaded=!1}return t.prototype.loadWorld=function(){if(this.worldMap.length>0)this.isloaded=!0;else{this.worldMap=new Array;for(var t=0;t<6;t++){var e=new o.default(t);this.worldMap.push(e)}this.loadTileSets()}},t.prototype.loadTileSets=function(){var t=this;cc.resources.load("Data/world/tilesets",function(e,i){if(e)cc.error(e);else{cc.log("tilesets loaded");for(var o={},a=0,n=i.json.tiles;a<n.length;a++){var r=n[a];o[r.id]=r.type}t.loadTiledMaps(o)}})},t.prototype.loadTiledMaps=function(t){var e=this;cc.resources.loadDir("Data/world/tiledmap",cc.JsonAsset,function(i,o){for(var n=0,r=o;n<r.length;n++){var s=r[n],l=s.name.split("_"),c=parseInt(l[1]),u=99==c?e.realWorldMap:e.worldMap[c],h=s.json.layers[0].properties;if(!h.width){h=new a.default;for(var d=0,p=s.json.layers[0].properties;d<p.length;d++){var f=p[d];f.name&&(h[f.name]=f.value)}}for(var g=new Array,y=new Array,m=h.width*h.roomWidth,v=h.height*h.roomHeight,E=0;E<v;E++){g[E]=new Array,y[E]=new Array;for(var _=0;_<m;_++){var T=s.json.layers[0].data[E*m+_];g[E][_]=t[T-1];var D=s.json.layers[1].data[E*m+_];y[E][_]=t[D-1]}}var S=new Array,O=new Array;for(E=0;E<g[0].length;E++)for(S[E]=new Array,O[E]=new Array,_=0;_<g.length;_++)S[E][g.length-1-_]=g[_][E],O[E][y.length-1-_]=y[_][E];h.map=S;var A=new Array,C=new Array,R=new Array;for(E=0;E<h.width;E++)for(A[E]=new Array,C[E]=new Array,R[E]=new Array,_=0;_<h.height;_++)A[E][_]=O[E*h.roomWidth][_*h.roomHeight],C[E][_]=O[E*h.roomWidth+1][_*h.roomHeight],R[E][_]=O[E*h.roomWidth+2][_*h.roomHeight];h.roomTypes=A,h.minimap=C,h.minimaplock=R,s.json.layers[2]&&s.json.layers[2].objects&&(h.lights=s.json.layers[2].objects);var L=new a.default;L.valueCopy(h),u.list.push(L)}e.realWorldMap.list.sort(function(t,e){return t.index-e.index});for(var b=0,P=e.worldMap;b<P.length;b++)P[b].list.sort(function(t,e){return t.index-e.index});e.isloaded=!0,cc.log("world loaded")})},t.prototype.getChapterLength=function(){return this.worldMap.length},t.prototype.getChapterData=function(t){return t>=99?this.realWorldMap:this.worldMap[t]},t.prototype.getLevelList=function(t){return this.getChapterData(t).list},t.prototype.getLevelData=function(t,e){var i=this.getLevelList(t);return i.length<1?null:(i[e].chapter=t,i[e])},t.prototype.getCurrentLevelData=function(){return this.getLevelData(n.default.chapterIndex,n.default.level)},t}();i.default=r,cc._RF.pop()},{"../data/ChapterData":"ChapterData","../data/LevelData":"LevelData","../logic/Logic":"Logic"}],WxHelper:[function(t,e,i){"use strict";cc._RF.push(e,"4e113prls5Op7r/tgtPErZz","WxHelper");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Logic"),s=cc._decorator,l=s.ccclass,c=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wx=window.wx,e.user=null,e.startButtonNode=null,e.rankList=null,e.rankListOpen=!1,e}return a(e,t),e.prototype.start=function(){if(this.rankList&&(this.CloseDialog(),this.rankList.node.active=this.rankListOpen),this.wx)if(this.startButtonNode){var t=cc.size(this.startButtonNode.width+10,this.startButtonNode.height+10),e=cc.view.getFrameSize(),i=cc.director.getWinSize(),o=(.5*i.width+this.startButtonNode.x-.5*t.width)/i.width*e.width,a=(.5*i.height-this.startButtonNode.y-.5*t.height)/i.height*e.height,n=t.width/i.width*e.width,r=t.height/i.height*e.height,s=this.wx.createUserInfoButton({type:"text",text:"",style:{left:o,top:a,width:n,height:r,lineHeight:0,backgroundColor:"",color:"#000000",textAlign:"center",fontSize:10,borderRadius:3}}),l=this,c=null;s.onTap(function(t){if(c)s.hide();else switch(t.errMsg){case"getUserInfo:ok":s.hide(),cc.sys.localStorage.setItem("hasUserInfo","1");var e=(c=t.userInfo).nickName,i=c.avatarUrl;l.setUserConfig(e,i),l.wx.getOpenDataContext().postMessage({message:"User info get success."});default:console.error(t.errMsg)}}),"1"==cc.sys.localStorage.getItem("hasUserInfo")&&s.hide()}else this.saveRankData()},e.prototype.setUserConfig=function(t,e){if(this.user){var i=this.user.getChildByName("mask").getComponentInChildren(cc.Sprite);this.user.getChildByName("userName").getComponent(cc.Label).string=t,cc.loader.load({url:e,type:"png"},function(t,e){t&&console.error(t),i.spriteFrame=new cc.SpriteFrame(e)})}},e.prototype.CloseDialog=function(){this.wx&&this.node&&this.rankList&&this.rankList.node&&(this.rankList.node.active=!1,this.wx.getOpenDataContext().postMessage({message:"close"}))},e.prototype.OpenDialog=function(){this.wx&&this.rankList&&(this.rankList.node.active=!0,this.saveRankData())},e.prototype.saveRankData=function(){if(this.wx){var t=this;t.wx.setUserCloudStorage({KVDataList:[{key:"score",value:r.default.coins+""}],success:function(e){console.log("score"+r.default.coins),console.log(e),t.wx.getOpenDataContext().postMessage({message:"updateMaxScore"})},fail:function(t){console.log("failed"+r.default.coins),console.log(t)}})}else console.log("wx is empty")},n([c(cc.Node)],e.prototype,"user",void 0),n([c(cc.Node)],e.prototype,"startButtonNode",void 0),n([c(cc.WXSubContextView)],e.prototype,"rankList",void 0),n([c],e.prototype,"rankListOpen",void 0),n([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"./Logic":"Logic"}],use_reversed_rotateBy:[function(t,e){"use strict";cc._RF.push(e,"20f25G5HaZKk4Y2GuqawsGN","use_reversed_rotateBy"),cc.RotateBy._reverse=!0,cc._RF.pop()},{}]},{},["ActorAttackBox","AreaDetector","AreaOfEffect","ColliderTag","NonPlayerActorState","ShadowPlayer","Actor","BaseColliderComponent","BaseNonPlayerActorState","StateContext","DefaultStateMachine","FsmEvent","StackStateMachine","State","StateMachine","Boss","BossAttackCollider","Captain","CaptainSword","Dragon","Dryad","DryadGrass","EvilEye","IceDemon","IceDemonThron","Kraken","KrakenSwingHand","Rah","Slime","SlimeVenom","Sphinx","WarMachine","AirExit","Box","Building","CampFire","Chest","DecorationFloor","Door","Emplacement","EnergyShield","ExitDoor","FallStone","FootBoard","Furniture","HitBuilding","InteractBuilding","LightBuilding","MagicLightening","MartCashier","MartShelves","MgCrack","MgWentLine","MonsterGenerator","MushRoomChild","Portal","RoomBed","RoomClock","RoomFishtank","RoomKitchen","RoomStool","RoomTrashCan","RoomTv","RoomWaterDispenser","SavePoint","Saw","ShopMart","ShopTable","TarotTable","Trap","Wall","WallPaint","CCollider","OnContactListener","Quadtree","Vector","AchievementData","AreaOfEffectData","AttributeData","AvatarData","BaseData","BuildingData","BulletData","CellphoneData","ChapterData","ChunkData","CommonData","DamageData","DialogueData","DungeonStyleData","EquipmentData","EquipmentDescData","EquipmentStringData","ExitData","FromData","FurnitureData","GoodsData","GroundOilGoldData","InventoryData","ItemData","LevelData","LifeData","MapData","MapLightData","MapManagerData","NonPlayerData","OilGoldData","PlayerData","ProfessionData","ProfileData","SavePointData","StatusData","SuitData","TalentData","TarotData","TriggerData","ECS","ColliderComponent","InputComponent","MoveComponent","NodeRenderComponent","TransformComponent","ActorEntity","ColliderSystem","GameWorldSystem","InputSystem","MoveSystem","RayCastResult","BlockLight","Light","ShadowOfSight","Equipment","GameWorld","Bullet","Coin","DashShadow","Goods","Item","Laser","OilGold","TarotCard","Achievement","CameraControl","Chapter","CoinCount","Controller","Dungeon","EventHelper","Game","GameFinish","GameOver","HealthBar","Inventory","JoyController","Joystick","KeyboardController","Loading","Logic","MeleeShadowWeapon","MeleeWeapon","MeleeWeaponChild","NonPlayer","OilGoldCount","Player","PlayerAvatar","PlayerWeapon","Shield","Shooter","Start","Test","Tile","WalkSmoke","WxHelper","AoeManager","BaseManager","BuildingManager","DungeonStyleManager","EquipmentManager","FloatingLabelManager","InventoryManager","ItemManager","LightManager","LoadingManager","MapManager","MonsterManager","MonsterRandomAttr","NonPlayerManager","ProfileManager","SpecialManager","StatusManager","TarotManager","WordManager","Chunk","ChunkLookCamera","ChunkWorld","Seeker","WorldLoader","Settings","OilLake","PerlinNoise2D","RectDoor","RectDungeon","RectRoom","RoomType","Status","StatusConditionType","StatusEventType","FireGhost","IceThron","MagicCircle","MagicIce","OrganizationTalent","ProfessionTalent","Talent","TalentDash","TalentMagic","TalentShield","AchievementItem","AttributeSelector","BrightnessBar","Cellphone","CellphoneItem","CoolDownView","CutScene","Dialogue","Doll","DollJoyStick","FloatingLabel","GameHud","InventoryItem","LoadingIcon","MiniMap","MiniTile","PaletteSelector","ParallaxBackground","PickAvatar","PlayerInfoDialog","SatietyView","StartBackground","StatusIcon","StatusIconList","TestFog","Tips","Toast","AchievementItemDialog","BaseDialog","CellphoneDialog","DollMachineDialog","EquipmentAndItemDialog","InventoryDialog","MartShelvesDialog","NoticeDialog","SettingsDialog","StatusIconDialog","ActorUtils","AudioPlayer","IndexZ","LocalStorage","NextStep","NodeKey","Random","Random4Save","Utils","use_reversed_rotateBy"]);